
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>utool.util_dict &#8212; wbia-vtool 3.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for utool.util_dict</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot; convinience functions for dictionaries &quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">operator</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">it</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">zip</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">map</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="k">import</span> <span class="n">util_inject</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="k">import</span> <span class="n">util_list</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="k">import</span> <span class="n">util_const</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="k">import</span> <span class="n">util_iter</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

    <span class="n">HAVE_NUMPY</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">HAVE_NUMPY</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">pass</span>
<span class="nb">print</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">util_inject</span><span class="o">.</span><span class="n">inject2</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="dzip"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dzip">[docs]</a><span class="nd">@profile</span>
<span class="k">def</span> <span class="nf">dzip</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="n">list2</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zips elementwise pairs between list1 and list2 into a dictionary. Values</span>
<span class="sd">    from list2 can be broadcast onto list1.</span>

<span class="sd">    Args:</span>
<span class="sd">        list1 (sequence): full sequence</span>
<span class="sd">        list2 (sequence): can either be a sequence of one item or a sequence of</span>
<span class="sd">            equal length to `list1`</span>

<span class="sd">    SeeAlso:</span>
<span class="sd">        util_list.broadcast_zip</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: similar to dict(zip(list1, list2))</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict dzip</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; assert dzip([1, 2, 3], [4]) == {1: 4, 2: 4, 3: 4}</span>
<span class="sd">        &gt;&gt;&gt; assert dzip([1, 2, 3], [4, 4, 4]) == {1: 4, 2: 4, 3: 4}</span>
<span class="sd">        &gt;&gt;&gt; ut.assert_raises(ValueError, dzip, [1, 2, 3], [])</span>
<span class="sd">        &gt;&gt;&gt; ut.assert_raises(ValueError, dzip, [], [4, 5, 6])</span>
<span class="sd">        &gt;&gt;&gt; ut.assert_raises(ValueError, dzip, [], [4])</span>
<span class="sd">        &gt;&gt;&gt; ut.assert_raises(ValueError, dzip, [1, 2], [4, 5, 6])</span>
<span class="sd">        &gt;&gt;&gt; ut.assert_raises(ValueError, dzip, [1, 2, 3], [4, 5])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">list1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">list2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Corner case:</span>
        <span class="c1"># allow the first list to be empty and the second list to broadcast a</span>
        <span class="c1"># value. This means that the equality check wont work for the case</span>
        <span class="c1"># where list1 and list2 are supposed to correspond, but the length of</span>
        <span class="c1"># list2 is 1.</span>
        <span class="n">list2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">list2</span> <span class="o">=</span> <span class="n">list2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;out of alignment len(list1)=</span><span class="si">%r</span><span class="s1">, len(list2)=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list2</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="n">list2</span><span class="p">))</span></div>


<div class="viewcode-block" id="map_dict_vals"><a class="viewcode-back" href="../../utool.html#utool.util_dict.map_dict_vals">[docs]</a><span class="k">def</span> <span class="nf">map_dict_vals</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">dict_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; applies a function to each of the keys in a dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">        func (callable): a function</span>
<span class="sd">        dict_ (dict): a dictionary</span>

<span class="sd">    Returns:</span>
<span class="sd">        newdict: transformed dictionary</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-map_dict_vals</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;a&#39;: [1, 2, 3], &#39;b&#39;: []}</span>
<span class="sd">        &gt;&gt;&gt; func = len</span>
<span class="sd">        &gt;&gt;&gt; newdict = map_dict_vals(func, dict_)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(newdict)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;a&#39;: 3, &#39;b&#39;: 0}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="fm">__getitem__</span>
    <span class="n">keyval_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)]</span>
    <span class="n">dictclass</span> <span class="o">=</span> <span class="n">OrderedDict</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="k">else</span> <span class="nb">dict</span>
    <span class="n">newdict</span> <span class="o">=</span> <span class="n">dictclass</span><span class="p">(</span><span class="n">keyval_list</span><span class="p">)</span>
    <span class="c1"># newdict = type(dict_)(keyval_list)</span>
    <span class="k">return</span> <span class="n">newdict</span></div>


<div class="viewcode-block" id="map_dict_keys"><a class="viewcode-back" href="../../utool.html#utool.util_dict.map_dict_keys">[docs]</a><span class="k">def</span> <span class="nf">map_dict_keys</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">dict_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; applies a function to each of the keys in a dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">        func (callable): a function</span>
<span class="sd">        dict_ (dict): a dictionary</span>

<span class="sd">    Returns:</span>
<span class="sd">        newdict: transformed dictionary</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-map_dict_keys</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;a&#39;: [1, 2, 3], &#39;b&#39;: []}</span>
<span class="sd">        &gt;&gt;&gt; func = ord</span>
<span class="sd">        &gt;&gt;&gt; newdict = map_dict_keys(func, dict_)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(newdict)</span>
<span class="sd">        &gt;&gt;&gt; ut.assert_raises(AssertionError, map_dict_keys, len, dict_)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {97: [1, 2, 3], 98: []}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="fm">__getitem__</span>
        <span class="c1"># op.itemgetter(func)</span>
    <span class="n">keyval_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">func</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)]</span>
    <span class="c1"># newdict = type(dict_)(keyval_list)</span>
    <span class="n">dictclass</span> <span class="o">=</span> <span class="n">OrderedDict</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="k">else</span> <span class="nb">dict</span>
    <span class="n">newdict</span> <span class="o">=</span> <span class="n">dictclass</span><span class="p">(</span><span class="n">keyval_list</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">newdict</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
        <span class="n">dict_</span>
    <span class="p">),</span> <span class="s1">&#39;multiple input keys were mapped to the same output key&#39;</span>
    <span class="k">return</span> <span class="n">newdict</span></div>


<span class="n">map_vals</span> <span class="o">=</span> <span class="n">map_dict_vals</span>
<span class="n">map_keys</span> <span class="o">=</span> <span class="n">map_dict_keys</span>


<div class="viewcode-block" id="AutoVivification"><a class="viewcode-back" href="../../utool.html#utool.util_dict.AutoVivification">[docs]</a><span class="k">class</span> <span class="nc">AutoVivification</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of perl&#39;s autovivification feature.</span>

<span class="sd">    An AutoVivification is an infinitely nested default dict of dicts.</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/651794/best-way-to-init-dict-of-dicts</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; dict_ = AutoVivification()</span>
<span class="sd">        &gt;&gt;&gt; # Notice that there is no KeyError</span>
<span class="sd">        &gt;&gt;&gt; dict_[0][10][100] = None</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;dict_ = %r&#39; % (dict_,))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        dict_ = {0: {10: {100: None}}}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># value = super(AutoVivification, self).__getitem__(key)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)()</span>
        <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="OrderedAutoVivification"><a class="viewcode-back" href="../../utool.html#utool.util_dict.OrderedAutoVivification">[docs]</a><span class="k">class</span> <span class="nc">OrderedAutoVivification</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of perl&#39;s autovivification feature.</span>

<span class="sd">    An OrderedAutoVivification is an infinitely nested default dict of ordered</span>
<span class="sd">    dicts.</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/651794/best-way-to-init-dict-of-dicts</span>

<span class="sd">    Doctest:</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; dict_ = AutoOrderedDict()</span>
<span class="sd">        &gt;&gt;&gt; # Notice that there is no KeyError</span>
<span class="sd">        &gt;&gt;&gt; dict_[0][10][100] = None</span>
<span class="sd">        &gt;&gt;&gt; dict_[0][10][1] = None</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;dict_ = %r&#39; % (dict_,))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        dict_ = {0: {10: {100: None, 1: None}}}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># value = super(OrderedAutoVivification, self).__getitem__(key)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)()</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

        <span class="k">return</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="fm">__str__</span> <span class="o">=</span> <span class="fm">__repr__</span></div>


<span class="n">AutoDict</span> <span class="o">=</span> <span class="n">AutoVivification</span>
<span class="n">AutoOrderedDict</span> <span class="o">=</span> <span class="n">OrderedAutoVivification</span>


<div class="viewcode-block" id="count_dict_vals"><a class="viewcode-back" href="../../utool.html#utool.util_dict.count_dict_vals">[docs]</a><span class="k">def</span> <span class="nf">count_dict_vals</span><span class="p">(</span><span class="n">dict_of_lists</span><span class="p">):</span>
    <span class="n">count_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;len(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,):</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_of_lists</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">count_dict</span></div>


<div class="viewcode-block" id="dict_keysubset"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_keysubset">[docs]</a><span class="k">def</span> <span class="nf">dict_keysubset</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict_</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_dict_hashid"><a class="viewcode-back" href="../../utool.html#utool.util_dict.get_dict_hashid">[docs]</a><span class="k">def</span> <span class="nf">get_dict_hashid</span><span class="p">(</span><span class="n">dict_</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict):</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: id hash</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/5884066/hashing-a-python-dictionary</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-get_dict_hashid</span>
<span class="sd">        python3 -m utool.util_dict --test-get_dict_hashid</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {}</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;a&#39;: &#39;b&#39;}</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;a&#39;: {&#39;c&#39;: &#39;d&#39;}}</span>
<span class="sd">        &gt;&gt;&gt; #dict_ = {&#39;a&#39;: {&#39;c&#39;: &#39;d&#39;}, 1: 143, dict: set}</span>
<span class="sd">        &gt;&gt;&gt; #dict_ = {&#39;a&#39;: {&#39;c&#39;: &#39;d&#39;}, 1: 143 } non-determenism</span>
<span class="sd">        &gt;&gt;&gt; hashid = get_dict_hashid(dict_)</span>
<span class="sd">        &gt;&gt;&gt; result = str(hashid)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        mxgkepoboqjerkhb</span>

<span class="sd">        oegknoalkrkojumi</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">sorted_</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># print(&#39;raw_text = %r&#39; % (raw_text,))</span>
    <span class="n">hashid</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">hashstr27</span><span class="p">(</span><span class="n">raw_text</span><span class="p">)</span>
    <span class="c1"># from utool import util_hash</span>
    <span class="c1"># hashid = hash(frozenset(dict_.items()))</span>
    <span class="c1"># hashid = util_hash.make_hash(dict_)</span>
    <span class="k">return</span> <span class="n">hashid</span></div>


<div class="viewcode-block" id="hashdict"><a class="viewcode-back" href="../../utool.html#utool.util_dict.hashdict">[docs]</a><span class="k">class</span> <span class="nc">hashdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    hashable dict implementation, suitable for use as a key into</span>
<span class="sd">    other dicts.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; h1 = hashdict({&quot;apples&quot;: 1, &quot;bananas&quot;:2})</span>
<span class="sd">        &gt;&gt;&gt; h2 = hashdict({&quot;bananas&quot;: 3, &quot;mangoes&quot;: 5})</span>
<span class="sd">        &gt;&gt;&gt; h1+h2</span>
<span class="sd">        hashdict(apples=1, bananas=3, mangoes=5)</span>
<span class="sd">        &gt;&gt;&gt; d1 = {}</span>
<span class="sd">        &gt;&gt;&gt; d1[h1] = &quot;salad&quot;</span>
<span class="sd">        &gt;&gt;&gt; d1[h1]</span>
<span class="sd">        &#39;salad&#39;</span>
<span class="sd">        &gt;&gt;&gt; d1[h2]</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        KeyError: hashdict(bananas=3, mangoes=5)</span>

<span class="sd">    References:</span>
<span class="sd">       http://stackoverflow.com/questions/1151658/python-hashable-dicts</span>
<span class="sd">       http://stackoverflow.com/questions/1151658/python-hashable-dicts</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">(</span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__key</span><span class="p">()),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__key</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> does not support item assignment&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> does not support item assignment&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="p">)</span>

<div class="viewcode-block" id="hashdict.clear"><a class="viewcode-back" href="../../utool.html#utool.util_dict.hashdict.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> does not support item assignment&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="hashdict.pop"><a class="viewcode-back" href="../../utool.html#utool.util_dict.hashdict.pop">[docs]</a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> does not support item assignment&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="hashdict.popitem"><a class="viewcode-back" href="../../utool.html#utool.util_dict.hashdict.popitem">[docs]</a>    <span class="k">def</span> <span class="nf">popitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> does not support item assignment&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="hashdict.setdefault"><a class="viewcode-back" href="../../utool.html#utool.util_dict.hashdict.setdefault">[docs]</a>    <span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> does not support item assignment&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="hashdict.update"><a class="viewcode-back" href="../../utool.html#utool.util_dict.hashdict.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> does not support item assignment&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="p">)</span></div>

    <span class="c1"># update is not ok because it mutates the object</span>
    <span class="c1"># __add__ is ok because it creates a new object</span>
    <span class="c1"># while the new object is under construction, it&#39;s ok to mutate it</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">hashdict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="nb">dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="dict_stack"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_stack">[docs]</a><span class="k">def</span> <span class="nf">dict_stack</span><span class="p">(</span><span class="n">dict_list</span><span class="p">,</span> <span class="n">key_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    stacks values from two dicts into a new dict where the values are list of</span>
<span class="sd">    the input values. the keys are the same.</span>

<span class="sd">    DEPRICATE in favor of dict_stack2</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_list (list): list of dicts with similar keys</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict dict_stacked</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-dict_stack</span>
<span class="sd">        python -m utool.util_dict --test-dict_stack:1</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict1_ = {&#39;a&#39;: 1, &#39;b&#39;: 2}</span>
<span class="sd">        &gt;&gt;&gt; dict2_ = {&#39;a&#39;: 2, &#39;b&#39;: 3, &#39;c&#39;: 4}</span>
<span class="sd">        &gt;&gt;&gt; dict_stacked = dict_stack([dict1_, dict2_])</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(dict_stacked, sorted_=True)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;a&#39;: [1, 2], &#39;b&#39;: [2, 3], &#39;c&#39;: [4]}</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; # Get equivalent behavior with dict_stack2?</span>
<span class="sd">        &gt;&gt;&gt; # Almost, as long as None is not part of the list</span>
<span class="sd">        &gt;&gt;&gt; dict1_ = {&#39;a&#39;: 1, &#39;b&#39;: 2}</span>
<span class="sd">        &gt;&gt;&gt; dict2_ = {&#39;a&#39;: 2, &#39;b&#39;: 3, &#39;c&#39;: 4}</span>
<span class="sd">        &gt;&gt;&gt; dict_stacked_ = dict_stack2([dict1_, dict2_])</span>
<span class="sd">        &gt;&gt;&gt; dict_stacked = {key: ut.filter_Nones(val) for key, val in dict_stacked_.items()}</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(dict_stacked, sorted_=True)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;a&#39;: [1, 2], &#39;b&#39;: [2, 3], &#39;c&#39;: [4]}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dict_stacked_</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dict_</span> <span class="ow">in</span> <span class="n">dict_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">):</span>
            <span class="n">dict_stacked_</span><span class="p">[</span><span class="n">key_prefix</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="n">dict_stacked</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dict_stacked_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dict_stacked</span></div>


<div class="viewcode-block" id="dict_stack2"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_stack2">[docs]</a><span class="k">def</span> <span class="nf">dict_stack2</span><span class="p">(</span><span class="n">dict_list</span><span class="p">,</span> <span class="n">key_suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stacks vals from a list of dicts into a dict of lists. Inserts Nones in</span>
<span class="sd">    place of empty items to preserve order.</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_list (list): list of dicts</span>
<span class="sd">        key_suffix (str): (default = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: stacked_dict</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # Usual case: multiple dicts as input</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict1_ = {&#39;a&#39;: 1, &#39;b&#39;: 2}</span>
<span class="sd">        &gt;&gt;&gt; dict2_ = {&#39;a&#39;: 2, &#39;b&#39;: 3, &#39;c&#39;: 4}</span>
<span class="sd">        &gt;&gt;&gt; dict_list = [dict1_, dict2_]</span>
<span class="sd">        &gt;&gt;&gt; dict_stacked = dict_stack2(dict_list)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(dict_stacked)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;a&#39;: [1, 2], &#39;b&#39;: [2, 3], &#39;c&#39;: [None, 4]}</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # Corner case: one dict as input</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict1_ = {&#39;a&#39;: 1, &#39;b&#39;: 2}</span>
<span class="sd">        &gt;&gt;&gt; dict_list = [dict1_]</span>
<span class="sd">        &gt;&gt;&gt; dict_stacked = dict_stack2(dict_list)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(dict_stacked)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;a&#39;: [1], &#39;b&#39;: [2]}</span>

<span class="sd">    Example2:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # Corner case: zero dicts as input</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_list = []</span>
<span class="sd">        &gt;&gt;&gt; dict_stacked = dict_stack2(dict_list)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(dict_stacked)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {}</span>

<span class="sd">    Example3:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # Corner case: empty dicts as input</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_list = [{}]</span>
<span class="sd">        &gt;&gt;&gt; dict_stacked = dict_stack2(dict_list)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(dict_stacked)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {}</span>

<span class="sd">    Example4:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # Corner case: one dict is empty</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict1_ = {&#39;a&#39;: [1, 2], &#39;b&#39;: [2, 3]}</span>
<span class="sd">        &gt;&gt;&gt; dict2_ = {}</span>
<span class="sd">        &gt;&gt;&gt; dict_list = [dict1_, dict2_]</span>
<span class="sd">        &gt;&gt;&gt; dict_stacked = dict_stack2(dict_list)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(dict_stacked)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;a&#39;: [[1, 2], None], &#39;b&#39;: [[2, 3], None]}</span>

<span class="sd">    Example5:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # Corner case: disjoint dicts</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict1_ = {&#39;a&#39;: [1, 2], &#39;b&#39;: [2, 3]}</span>
<span class="sd">        &gt;&gt;&gt; dict2_ = {&#39;c&#39;: 4}</span>
<span class="sd">        &gt;&gt;&gt; dict_list = [dict1_, dict2_]</span>
<span class="sd">        &gt;&gt;&gt; dict_stacked = dict_stack2(dict_list)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(dict_stacked)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;a&#39;: [[1, 2], None], &#39;b&#39;: [[2, 3], None], &#39;c&#39;: [None, 4]}</span>

<span class="sd">    Example6:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # Corner case: 3 dicts</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_list = [{&#39;a&#39;: 1}, {&#39;b&#39;: 1}, {&#39;c&#39;: 1}, {&#39;b&#39;: 2}]</span>
<span class="sd">        &gt;&gt;&gt; default = None</span>
<span class="sd">        &gt;&gt;&gt; dict_stacked = dict_stack2(dict_list, default=default)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(dict_stacked)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;a&#39;: [1, None, None, None], &#39;b&#39;: [None, 1, None, 2], &#39;c&#39;: [None, None, 1, None]}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dict_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">map_dict_vals</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">kw</span><span class="p">)</span> <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">dict_list</span><span class="p">]</span>
        <span class="c1"># Reduce does not handle default quite correctly</span>
        <span class="n">default1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">default2</span> <span class="o">=</span> <span class="p">[</span><span class="n">default</span><span class="p">]</span>
        <span class="n">accum_</span> <span class="o">=</span> <span class="n">dict_list_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">dict_</span> <span class="ow">in</span> <span class="n">dict_list_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">default1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
            <span class="n">accum_</span> <span class="o">=</span> <span class="n">dict_union_combine</span><span class="p">(</span>
                <span class="n">accum_</span><span class="p">,</span> <span class="n">dict_</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default1</span><span class="p">,</span> <span class="n">default2</span><span class="o">=</span><span class="n">default2</span>
            <span class="p">)</span>
        <span class="n">stacked_dict</span> <span class="o">=</span> <span class="n">accum_</span>
        <span class="c1"># stacked_dict = reduce(partial(dict_union_combine, default=[default]), dict_list_)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stacked_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Augment keys if requested</span>
    <span class="k">if</span> <span class="n">key_suffix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stacked_dict</span> <span class="o">=</span> <span class="n">map_dict_keys</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">key_suffix</span><span class="p">,</span> <span class="n">stacked_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stacked_dict</span></div>


<div class="viewcode-block" id="invert_dict"><a class="viewcode-back" href="../../utool.html#utool.util_dict.invert_dict">[docs]</a><span class="k">def</span> <span class="nf">invert_dict</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">unique_vals</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reverses the keys and values in a dictionary. Set unique_vals to False if</span>
<span class="sd">    the values in the dict are not unique.</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict_): dictionary</span>
<span class="sd">        unique_vals (bool): if False, inverted keys are returned in a list.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: inverted_dict</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-invert_dict</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;a&#39;: 1, &#39;b&#39;: 2}</span>
<span class="sd">        &gt;&gt;&gt; inverted_dict = invert_dict(dict_)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr4(inverted_dict, nl=False)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {1: &#39;a&#39;, 2: &#39;b&#39;}</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = OrderedDict([(2, &#39;good&#39;,), (1, &#39;ok&#39;,), (0, &#39;junk&#39;,), (None, &#39;UNKNOWN&#39;,)])</span>
<span class="sd">        &gt;&gt;&gt; inverted_dict = invert_dict(dict_)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr4(inverted_dict, nl=False)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;good&#39;: 2, &#39;ok&#39;: 1, &#39;junk&#39;: 0, &#39;UNKNOWN&#39;: None}</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;a&#39;: 1, &#39;b&#39;: 0, &#39;c&#39;: 0, &#39;d&#39;: 0, &#39;e&#39;: 0, &#39;f&#39;: 2}</span>
<span class="sd">        &gt;&gt;&gt; inverted_dict = invert_dict(dict_, unique_vals=False)</span>
<span class="sd">        &gt;&gt;&gt; inverted_dict = ut.map_dict_vals(sorted, inverted_dict)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr4(inverted_dict, nl=False)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {0: [&#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;], 1: [&#39;a&#39;], 2: [&#39;f&#39;]}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">unique_vals</span><span class="p">:</span>
        <span class="n">inverted_items</span> <span class="o">=</span> <span class="p">[(</span><span class="n">val</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)]</span>
        <span class="n">inverted_dict</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">dict_</span><span class="p">)(</span><span class="n">inverted_items</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inverted_dict</span> <span class="o">=</span> <span class="n">group_items</span><span class="p">(</span><span class="n">dict_</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">dict_</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">inverted_dict</span></div>


<div class="viewcode-block" id="iter_all_dict_combinations_ordered"><a class="viewcode-back" href="../../utool.html#utool.util_dict.iter_all_dict_combinations_ordered">[docs]</a><span class="k">def</span> <span class="nf">iter_all_dict_combinations_ordered</span><span class="p">(</span><span class="n">varied_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Same as all_dict_combinations but preserves order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tups_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">val_list</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val_list</span><span class="p">)</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">varied_dict</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">dict_iter</span> <span class="o">=</span> <span class="p">(</span><span class="n">OrderedDict</span><span class="p">(</span><span class="n">tups</span><span class="p">)</span> <span class="k">for</span> <span class="n">tups</span> <span class="ow">in</span> <span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">tups_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dict_iter</span></div>


<div class="viewcode-block" id="all_dict_combinations_ordered"><a class="viewcode-back" href="../../utool.html#utool.util_dict.all_dict_combinations_ordered">[docs]</a><span class="k">def</span> <span class="nf">all_dict_combinations_ordered</span><span class="p">(</span><span class="n">varied_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Same as all_dict_combinations but preserves order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dict_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">iter_all_dict_combinations_ordered</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dict_list</span></div>


<div class="viewcode-block" id="all_dict_combinations"><a class="viewcode-back" href="../../utool.html#utool.util_dict.all_dict_combinations">[docs]</a><span class="k">def</span> <span class="nf">all_dict_combinations</span><span class="p">(</span><span class="n">varied_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    all_dict_combinations</span>

<span class="sd">    Args:</span>
<span class="sd">        varied_dict (dict):  a dict with lists of possible parameter settings</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: dict_list a list of dicts correpsonding to all combinations of params settings</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-all_dict_combinations</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; varied_dict = {&#39;logdist_weight&#39;: [0.0, 1.0], &#39;pipeline_root&#39;: [&#39;vsmany&#39;], &#39;sv_on&#39;: [True, False, None]}</span>
<span class="sd">        &gt;&gt;&gt; dict_list = all_dict_combinations(varied_dict)</span>
<span class="sd">        &gt;&gt;&gt; result = str(ut.repr4(dict_list))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [</span>
<span class="sd">            {&#39;logdist_weight&#39;: 0.0, &#39;pipeline_root&#39;: &#39;vsmany&#39;, &#39;sv_on&#39;: True},</span>
<span class="sd">            {&#39;logdist_weight&#39;: 0.0, &#39;pipeline_root&#39;: &#39;vsmany&#39;, &#39;sv_on&#39;: False},</span>
<span class="sd">            {&#39;logdist_weight&#39;: 0.0, &#39;pipeline_root&#39;: &#39;vsmany&#39;, &#39;sv_on&#39;: None},</span>
<span class="sd">            {&#39;logdist_weight&#39;: 1.0, &#39;pipeline_root&#39;: &#39;vsmany&#39;, &#39;sv_on&#39;: True},</span>
<span class="sd">            {&#39;logdist_weight&#39;: 1.0, &#39;pipeline_root&#39;: &#39;vsmany&#39;, &#39;sv_on&#39;: False},</span>
<span class="sd">            {&#39;logdist_weight&#39;: 1.0, &#39;pipeline_root&#39;: &#39;vsmany&#39;, &#39;sv_on&#39;: None},</span>
<span class="sd">        ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># tups_list = [[(key, val) for val in val_list]</span>
    <span class="c1">#             if isinstance(val_list, (list, tuple))</span>
    <span class="c1">#             else [(key, val_list)]</span>
    <span class="c1">#             for (key, val_list) in six.iteritems(varied_dict)]</span>
    <span class="n">tups_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">val_list</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">))</span>
        <span class="c1"># if isinstance(val_list, (list, tuple))</span>
        <span class="k">else</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">val_list</span><span class="p">)]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val_list</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems_sorted</span><span class="p">(</span><span class="n">varied_dict</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">tups</span><span class="p">)</span> <span class="k">for</span> <span class="n">tups</span> <span class="ow">in</span> <span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">tups_list</span><span class="p">)]</span>
    <span class="c1"># dict_list = [{key: val for (key, val) in tups} for tups in it.product(*tups_list)]</span>
    <span class="c1"># from collections import OrderedDict</span>
    <span class="c1"># dict_list = [OrderedDict([(key, val) for (key, val) in tups]) for tups in it.product(*tups_list)]</span>
    <span class="k">return</span> <span class="n">dict_list</span></div>


<div class="viewcode-block" id="all_dict_combinations_lbls"><a class="viewcode-back" href="../../utool.html#utool.util_dict.all_dict_combinations_lbls">[docs]</a><span class="k">def</span> <span class="nf">all_dict_combinations_lbls</span><span class="p">(</span>
    <span class="n">varied_dict</span><span class="p">,</span> <span class="n">remove_singles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_lone_singles</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns a label for each variation in a varydict.</span>

<span class="sd">    It tries to not be oververbose and returns only what parameters are varied</span>
<span class="sd">    in each label.</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-all_dict_combinations_lbls</span>
<span class="sd">        python -m utool.util_dict --exec-all_dict_combinations_lbls:1</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; import utool</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; varied_dict = {&#39;logdist_weight&#39;: [0.0, 1.0], &#39;pipeline_root&#39;: [&#39;vsmany&#39;], &#39;sv_on&#39;: [True, False, None]}</span>
<span class="sd">        &gt;&gt;&gt; comb_lbls = utool.all_dict_combinations_lbls(varied_dict)</span>
<span class="sd">        &gt;&gt;&gt; result = (utool.repr4(comb_lbls))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [</span>
<span class="sd">            &#39;logdist_weight=0.0,sv_on=True&#39;,</span>
<span class="sd">            &#39;logdist_weight=0.0,sv_on=False&#39;,</span>
<span class="sd">            &#39;logdist_weight=0.0,sv_on=None&#39;,</span>
<span class="sd">            &#39;logdist_weight=1.0,sv_on=True&#39;,</span>
<span class="sd">            &#39;logdist_weight=1.0,sv_on=False&#39;,</span>
<span class="sd">            &#39;logdist_weight=1.0,sv_on=None&#39;,</span>
<span class="sd">        ]</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; varied_dict = {&#39;logdist_weight&#39;: [0.0], &#39;pipeline_root&#39;: [&#39;vsmany&#39;], &#39;sv_on&#39;: [True]}</span>
<span class="sd">        &gt;&gt;&gt; allow_lone_singles = True</span>
<span class="sd">        &gt;&gt;&gt; comb_lbls = ut.all_dict_combinations_lbls(varied_dict, allow_lone_singles=allow_lone_singles)</span>
<span class="sd">        &gt;&gt;&gt; result = (ut.repr4(comb_lbls))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [</span>
<span class="sd">            &#39;logdist_weight=0.0,pipeline_root=vsmany,sv_on=True&#39;,</span>
<span class="sd">        ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">is_lone_single</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val_list</span> <span class="ow">in</span> <span class="n">iteritems_sorted</span><span class="p">(</span><span class="n">varied_dict</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">remove_singles</span> <span class="ow">or</span> <span class="p">(</span><span class="n">allow_lone_singles</span> <span class="ow">and</span> <span class="n">is_lone_single</span><span class="p">):</span>
        <span class="c1"># all entries have one length</span>
        <span class="n">multitups_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">val_list</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val_list</span> <span class="ow">in</span> <span class="n">iteritems_sorted</span><span class="p">(</span><span class="n">varied_dict</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">multitups_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">val_list</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val_list</span> <span class="ow">in</span> <span class="n">iteritems_sorted</span><span class="p">(</span><span class="n">varied_dict</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">]</span>
    <span class="n">combtup_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">multitups_list</span><span class="p">))</span>
    <span class="n">combtup_list2</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">combtup</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">combtup</span> <span class="ow">in</span> <span class="n">combtup_list</span>
    <span class="p">]</span>
    <span class="n">comb_lbls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">combtup</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">combtup</span> <span class="ow">in</span> <span class="n">combtup_list2</span>
    <span class="p">]</span>
    <span class="c1"># comb_lbls = list(map(str, comb_pairs))</span>
    <span class="k">return</span> <span class="n">comb_lbls</span></div>


<div class="viewcode-block" id="dict_union2"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_union2">[docs]</a><span class="k">def</span> <span class="nf">dict_union2</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dict1</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict2</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span></div>


<div class="viewcode-block" id="dict_union"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_union">[docs]</a><span class="k">def</span> <span class="nf">dict_union</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">dict_</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)])</span></div>


<div class="viewcode-block" id="build_conflict_dict"><a class="viewcode-back" href="../../utool.html#utool.util_dict.build_conflict_dict">[docs]</a><span class="k">def</span> <span class="nf">build_conflict_dict</span><span class="p">(</span><span class="n">key_list</span><span class="p">,</span> <span class="n">val_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds dict where a list of values is associated with more than one key</span>

<span class="sd">    Args:</span>
<span class="sd">        key_list (list):</span>
<span class="sd">        val_list (list):</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: key_to_vals</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-build_conflict_dict</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; key_list = [  1,   2,   2,   3,   1]</span>
<span class="sd">        &gt;&gt;&gt; val_list = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;]</span>
<span class="sd">        &gt;&gt;&gt; key_to_vals = build_conflict_dict(key_list, val_list)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr4(key_to_vals)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {</span>
<span class="sd">            1: [&#39;a&#39;, &#39;e&#39;],</span>
<span class="sd">            2: [&#39;b&#39;, &#39;c&#39;],</span>
<span class="sd">            3: [&#39;d&#39;],</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key_to_vals</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">key_list</span><span class="p">,</span> <span class="n">val_list</span><span class="p">):</span>
        <span class="n">key_to_vals</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">key_to_vals</span></div>


<div class="viewcode-block" id="assert_keys_are_subset"><a class="viewcode-back" href="../../utool.html#utool.util_dict.assert_keys_are_subset">[docs]</a><span class="k">def</span> <span class="nf">assert_keys_are_subset</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; dict1 = {1:1, 2:2, 3:3}</span>
<span class="sd">        &gt;&gt;&gt; dict2 = {2:3, 3:3}</span>
<span class="sd">        &gt;&gt;&gt; assert_keys_are_subset(dict1, dict2)</span>
<span class="sd">        &gt;&gt;&gt; #dict2 = {4:3, 3:3}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">keys2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">unknown_keys</span> <span class="o">=</span> <span class="n">keys2</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">keys1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">unknown_keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;unknown_keys=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">unknown_keys</span><span class="p">,)</span></div>


<div class="viewcode-block" id="augdict"><a class="viewcode-back" href="../../utool.html#utool.util_dict.augdict">[docs]</a><span class="k">def</span> <span class="nf">augdict</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">dict1_</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dict1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dict2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dict1_</span> <span class="o">=</span> <span class="n">update_existing</span><span class="p">(</span><span class="n">dict1_</span><span class="p">,</span> <span class="n">dict2</span><span class="p">,</span> <span class="n">assert_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dict1_</span> <span class="o">=</span> <span class="n">update_existing</span><span class="p">(</span><span class="n">dict1_</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">assert_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dict1_</span></div>


<div class="viewcode-block" id="update_existing"><a class="viewcode-back" href="../../utool.html#utool.util_dict.update_existing">[docs]</a><span class="k">def</span> <span class="nf">update_existing</span><span class="p">(</span>
    <span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">assert_exists</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">iswarning</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alias_dict</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    updates vals in dict1 using vals from dict2 only if the</span>
<span class="sd">    key is already in dict1.</span>

<span class="sd">    Args:</span>
<span class="sd">        dict1 (dict):</span>
<span class="sd">        dict2 (dict):</span>
<span class="sd">        copy (bool): if true modifies dictionary in place (default = False)</span>
<span class="sd">        assert_exists (bool): if True throws error if new key specified (default = False)</span>
<span class="sd">        alias_dict (dict): dictionary of alias keys for dict2 (default = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict - updated dictionary</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-update_existing</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; dict1 = {&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3}</span>
<span class="sd">        &gt;&gt;&gt; dict2 = {&#39;a&#39;: 2, &#39;d&#39;: 3}</span>
<span class="sd">        &gt;&gt;&gt; dict1_ = update_existing(dict1, dict2)</span>
<span class="sd">        &gt;&gt;&gt; assert &#39;d&#39; not in dict1</span>
<span class="sd">        &gt;&gt;&gt; assert dict1[&#39;a&#39;] == 2</span>
<span class="sd">        &gt;&gt;&gt; assert dict1_ is dict1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">assert_exists</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">assert_keys_are_subset</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">utool</span> <span class="k">import</span> <span class="n">util_dbg</span>

            <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">iswarning</span><span class="o">=</span><span class="n">iswarning</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">iswarning</span><span class="p">:</span>
                <span class="k">raise</span>
    <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
        <span class="n">dict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dict1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">alias_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">alias_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict2</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">alias_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">:</span>
            <span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
    <span class="k">return</span> <span class="n">dict1</span></div>


<div class="viewcode-block" id="update_dict"><a class="viewcode-back" href="../../utool.html#utool.util_dict.update_dict">[docs]</a><span class="k">def</span> <span class="nf">update_dict</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alias_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
        <span class="n">dict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dict1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">alias_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">alias_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict2</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">alias_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
    <span class="k">return</span> <span class="n">dict1</span></div>


<div class="viewcode-block" id="dict_update_newkeys"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_update_newkeys">[docs]</a><span class="k">def</span> <span class="nf">dict_update_newkeys</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">dict2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Like dict.update, but does not overwrite items &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_</span><span class="p">:</span>
            <span class="n">dict_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>


<div class="viewcode-block" id="is_dicteq"><a class="viewcode-back" href="../../utool.html#utool.util_dict.is_dicteq">[docs]</a><span class="k">def</span> <span class="nf">is_dicteq</span><span class="p">(</span><span class="n">dict1_</span><span class="p">,</span> <span class="n">dict2_</span><span class="p">,</span> <span class="n">almosteq_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_err</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Checks to see if dicts are the same. Performs recursion. Handles numpy &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict1_</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict2_</span><span class="p">),</span> <span class="s1">&#39;dicts are not of same length&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="n">val1</span><span class="p">),</span> <span class="p">(</span><span class="n">key2</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dict1_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">dict2_</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">assert</span> <span class="n">key1</span> <span class="o">==</span> <span class="n">key2</span><span class="p">,</span> <span class="s1">&#39;key mismatch&#39;</span>
            <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">val1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">val2</span><span class="p">),</span> <span class="s1">&#39;vals are not same type&#39;</span>
            <span class="k">if</span> <span class="n">HAVE_NUMPY</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">val1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">almosteq_ok</span> <span class="ow">and</span> <span class="n">ut</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">val1</span><span class="p">):</span>
                    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
                        <span class="n">ut</span><span class="o">.</span><span class="n">almost_eq</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>
                    <span class="p">),</span> <span class="s1">&#39;float vals are not within thresh&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x1</span> <span class="o">==</span> <span class="n">x2</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)]</span>
                    <span class="p">),</span> <span class="s1">&#39;np vals are different&#39;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">is_dicteq</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">almosteq_ok</span><span class="o">=</span><span class="n">almosteq_ok</span><span class="p">,</span> <span class="n">verbose_err</span><span class="o">=</span><span class="n">verbose_err</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">val1</span> <span class="o">==</span> <span class="n">val2</span><span class="p">,</span> <span class="s1">&#39;vals are different&#39;</span>
    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose_err</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="dict_subset"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_subset">[docs]</a><span class="k">def</span> <span class="nf">dict_subset</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">util_const</span><span class="o">.</span><span class="n">NoParam</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict):</span>
<span class="sd">        keys (list):</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: subset dictionary</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;K&#39;: 3, &#39;dcvs_clip_max&#39;: 0.2, &#39;p&#39;: 0.1}</span>
<span class="sd">        &gt;&gt;&gt; keys = [&#39;K&#39;, &#39;dcvs_clip_max&#39;]</span>
<span class="sd">        &gt;&gt;&gt; d = tuple([])</span>
<span class="sd">        &gt;&gt;&gt; subdict_ = dict_subset(dict_, keys)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr4(subdict_, sorted_=True, newlines=False)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;K&#39;: 3, &#39;dcvs_clip_max&#39;: 0.2}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">util_const</span><span class="o">.</span><span class="n">NoParam</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">dict_take</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">dict_take</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
    <span class="n">subdict_</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">items</span><span class="p">)))</span>
    <span class="c1"># item_sublist = [(key, dict_[key]) for key in keys]</span>
    <span class="c1">##subdict_ = type(dict_)(item_sublist)  # maintain old dict format</span>
    <span class="c1"># subdict_ = OrderedDict(item_sublist)</span>
    <span class="k">return</span> <span class="n">subdict_</span></div>


<div class="viewcode-block" id="dict_to_keyvals"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_to_keyvals">[docs]</a><span class="k">def</span> <span class="nf">dict_to_keyvals</span><span class="p">(</span><span class="n">dict_</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">))</span></div>


<div class="viewcode-block" id="dict_setdiff"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_setdiff">[docs]</a><span class="k">def</span> <span class="nf">dict_setdiff</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">negative_keys</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns a copy of dict_ without keys in the negative_keys list</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict):</span>
<span class="sd">        negative_keys (list):</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">negative_keys</span><span class="p">)]</span>
    <span class="n">subdict_</span> <span class="o">=</span> <span class="n">dict_subset</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">subdict_</span></div>


<div class="viewcode-block" id="delete_dict_keys"><a class="viewcode-back" href="../../utool.html#utool.util_dict.delete_dict_keys">[docs]</a><span class="k">def</span> <span class="nf">delete_dict_keys</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">key_list</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes items from a dictionary inplace. Keys that do not exist are</span>
<span class="sd">    ignored.</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict): dict like object with a __del__ attribute</span>
<span class="sd">        key_list (list): list of keys that specify the items to remove</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-delete_dict_keys</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;bread&#39;: 1, &#39;churches&#39;: 1, &#39;cider&#39;: 2, &#39;very small rocks&#39;: 2}</span>
<span class="sd">        &gt;&gt;&gt; key_list = [&#39;duck&#39;, &#39;bread&#39;, &#39;cider&#39;]</span>
<span class="sd">        &gt;&gt;&gt; delete_dict_keys(dict_, key_list)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr4(dict_, nl=False)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;churches&#39;: 1, &#39;very small rocks&#39;: 2}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">invalid_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">key_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">valid_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">key_list</span><span class="p">)</span> <span class="o">-</span> <span class="n">invalid_keys</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">valid_keys</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">dict_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dict_</span></div>


<span class="n">delete_keys</span> <span class="o">=</span> <span class="n">delete_dict_keys</span>


<div class="viewcode-block" id="dict_take_gen"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_take_gen">[docs]</a><span class="k">def</span> <span class="nf">dict_take_gen</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    generate multiple values from a dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict):</span>
<span class="sd">        keys (list):</span>

<span class="sd">    Varargs:</span>
<span class="sd">        d: if specified is default for key errors</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-dict_take_gen</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {1: &#39;a&#39;, 2: &#39;b&#39;, 3: &#39;c&#39;}</span>
<span class="sd">        &gt;&gt;&gt; keys = [1, 2, 3, 4, 5]</span>
<span class="sd">        &gt;&gt;&gt; result = list(dict_take_gen(dict_, keys, None))</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr4(result, nl=False)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, None, None]</span>

<span class="sd">    Example2:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {1: &#39;a&#39;, 2: &#39;b&#39;, 3: &#39;c&#39;}</span>
<span class="sd">        &gt;&gt;&gt; keys = [1, 2, 3, 4, 5]</span>
<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        &gt;&gt;&gt;     print(list(dict_take_gen(dict_, keys)))</span>
<span class="sd">        &gt;&gt;&gt;     result = &#39;did not get key error&#39;</span>
<span class="sd">        &gt;&gt;&gt; except KeyError:</span>
<span class="sd">        &gt;&gt;&gt;     result = &#39;correctly got key error&#39;</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        correctly got key error</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="c1"># hack for string keys that makes copy-past easier</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># no default given throws key error</span>
        <span class="n">dictget</span> <span class="o">=</span> <span class="n">dict_</span><span class="o">.</span><span class="fm">__getitem__</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># default given does not throw key erro</span>
        <span class="n">dictget</span> <span class="o">=</span> <span class="n">dict_</span><span class="o">.</span><span class="n">get</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;len(d) must be 1 or 0&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">HAVE_NUMPY</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c1"># recursive call</span>
            <span class="k">yield</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_take_gen</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">dictget</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span></div>


<div class="viewcode-block" id="dict_take"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_take">[docs]</a><span class="k">def</span> <span class="nf">dict_take</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get multiple values from a dictionary &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_take_gen</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_take_gen</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span></div>
    <span class="c1"># return [dict_[key] for key in keys]</span>


<span class="n">dict_take_list</span> <span class="o">=</span> <span class="n">dict_take</span>
<span class="c1"># def dict_take(dict_, keys, *d):</span>
<span class="c1">#    &quot;&quot;&quot; alias &quot;&quot;&quot;</span>
<span class="c1">#    try:</span>
<span class="c1">#        return dict_take_list(dict_, keys, *d)</span>
<span class="c1">#    except TypeError:</span>
<span class="c1">#        return dict_take_list(dict_, [keys], *d)[0]</span>


<span class="c1"># def dict_unflat_take(dict_, unflat_key_list, *d):</span>
<span class="c1">#    return [dict_unflat_take(dict_, xs, *d)</span>
<span class="c1">#            if isinstance(xs, list) else</span>
<span class="c1">#            dict_take(dict_, xs, *d)</span>
<span class="c1">#            for xs in unflat_key_list]</span>


<div class="viewcode-block" id="dict_take_asnametup"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_take_asnametup">[docs]</a><span class="k">def</span> <span class="nf">dict_take_asnametup</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;_NamedTup&#39;</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">dict_take</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
    <span class="n">_NamedTup</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
    <span class="n">tup</span> <span class="o">=</span> <span class="n">_NamedTup</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tup</span></div>


<div class="viewcode-block" id="dict_take_pop"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_take_pop">[docs]</a><span class="k">def</span> <span class="nf">dict_take_pop</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; like dict_take but pops values off</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-dict_take_pop</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {1: &#39;a&#39;, &#39;other&#39;: None, &#39;another&#39;: &#39;foo&#39;, 2: &#39;b&#39;, 3: &#39;c&#39;}</span>
<span class="sd">        &gt;&gt;&gt; keys = [1, 2, 3, 4, 5]</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;before: &#39; + ut.repr4(dict_))</span>
<span class="sd">        &gt;&gt;&gt; result = list(dict_take_pop(dict_, keys, None))</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr4(result, nl=False)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;after: &#39; + ut.repr4(dict_))</span>
<span class="sd">        &gt;&gt;&gt; assert len(dict_) == 2</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, None, None]</span>

<span class="sd">    Example2:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {1: &#39;a&#39;, 2: &#39;b&#39;, 3: &#39;c&#39;}</span>
<span class="sd">        &gt;&gt;&gt; keys = [1, 2, 3, 4, 5]</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;before: &#39; + ut.repr4(dict_))</span>
<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        &gt;&gt;&gt;     print(list(dict_take_pop(dict_, keys)))</span>
<span class="sd">        &gt;&gt;&gt;     result = &#39;did not get key error&#39;</span>
<span class="sd">        &gt;&gt;&gt; except KeyError:</span>
<span class="sd">        &gt;&gt;&gt;     result = &#39;correctly got key error&#39;</span>
<span class="sd">        &gt;&gt;&gt; assert len(dict_) == 0</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;after: &#39; + ut.repr4(dict_))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        correctly got key error</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">dict_</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">dict_</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;len(d) must be 1 or 0&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="dict_assign"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_assign">[docs]</a><span class="k">def</span> <span class="nf">dict_assign</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; simple method for assigning or setting values with a similar interface</span>
<span class="sd">    to dict_take &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="n">dict_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>


<div class="viewcode-block" id="dict_where_len0"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_where_len0">[docs]</a><span class="k">def</span> <span class="nf">dict_where_len0</span><span class="p">(</span><span class="n">dict_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Accepts a dict of lists. Returns keys that have vals with no length</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dict_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">dict_</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">flags</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">keys</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_dict_column"><a class="viewcode-back" href="../../utool.html#utool.util_dict.get_dict_column">[docs]</a><span class="k">def</span> <span class="nf">get_dict_column</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">colx</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict_): a dictionary of lists</span>
<span class="sd">        colx (int):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-get_dict_column</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;a&#39;: [0, 1, 2], &#39;b&#39;: [3, 4, 5], &#39;c&#39;: [6, 7, 8]}</span>
<span class="sd">        &gt;&gt;&gt; colx = [2, 0]</span>
<span class="sd">        &gt;&gt;&gt; retdict_ = get_dict_column(dict_, colx)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(retdict_)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;a&#39;: [2, 0], &#39;b&#39;: [5, 3], &#39;c&#39;: [8, 6]}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">retdict_</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">util_list</span><span class="o">.</span><span class="n">list_take</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">colx</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)}</span>
    <span class="k">return</span> <span class="n">retdict_</span></div>


<div class="viewcode-block" id="dict_take_column"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_take_column">[docs]</a><span class="k">def</span> <span class="nf">dict_take_column</span><span class="p">(</span><span class="n">list_of_dicts_</span><span class="p">,</span> <span class="n">colkey</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">dict_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colkey</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="k">for</span> <span class="n">dict_</span> <span class="ow">in</span> <span class="n">list_of_dicts_</span><span class="p">]</span></div>


<div class="viewcode-block" id="dict_set_column"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_set_column">[docs]</a><span class="k">def</span> <span class="nf">dict_set_column</span><span class="p">(</span><span class="n">list_of_dicts_</span><span class="p">,</span> <span class="n">colkey</span><span class="p">,</span> <span class="n">value_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">dict_</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_dicts_</span><span class="p">,</span> <span class="n">value_list</span><span class="p">):</span>
        <span class="n">dict_</span><span class="p">[</span><span class="n">colkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="dictinfo"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dictinfo">[docs]</a><span class="k">def</span> <span class="nf">dictinfo</span><span class="p">(</span><span class="n">dict_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    dictinfo</span>

<span class="sd">    In depth debugging info</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {}</span>
<span class="sd">        &gt;&gt;&gt; result = dictinfo(dict_)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;expected dict got </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">num_keys</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
    <span class="n">key_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">keys</span><span class="p">)))</span>
    <span class="n">val_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">vals</span><span class="p">)))</span>

    <span class="n">fmtstr_</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">unindent</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    * num_keys  = {num_keys}</span>
<span class="sd">    * key_types = {key_types}</span>
<span class="sd">    * val_types = {val_types}</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="c1"># each key holds an ndarray</span>
            <span class="n">val_shape_stats</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">vals</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">val_shape_stats_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">val_shape_stats</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">newlines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">val_dtypes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">val</span><span class="o">.</span><span class="n">dtype</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]))</span>
            <span class="n">fmtstr_</span> <span class="o">+=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unindent</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            * val_shape_stats = {val_shape_stats_str}</span>
<span class="sd">            * val_dtypes = {val_dtypes}</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">val_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="c1"># each key holds a list</span>
            <span class="n">val_len_stats</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">vals</span><span class="p">)))</span>
            <span class="n">val_len_stats_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr4</span><span class="p">(</span><span class="n">val_len_stats</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">newlines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">list_depth</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="n">deep_val_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">list_deep_types</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
            <span class="n">fmtstr_</span> <span class="o">+=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unindent</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            * list_depth = {depth}</span>
<span class="sd">            * val_len_stats = {val_len_stats_str}</span>
<span class="sd">            * deep_types = {deep_val_types}</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">deep_val_types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">deep_val_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="n">deep_val_dtypes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">val</span><span class="o">.</span><span class="n">dtype</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]))</span>
                    <span class="n">fmtstr_</span> <span class="o">+=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unindent</span><span class="p">(</span>
                        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    * deep_val_dtypes = {deep_val_dtypes}</span>
<span class="sd">                    &quot;&quot;&quot;</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">val_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="c1"># each key holds a scalar</span>
            <span class="n">val_stats</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="n">fmtstr_</span> <span class="o">+=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unindent</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            * val_stats = {val_stats}</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fmtstr</span> <span class="o">=</span> <span class="n">fmtstr_</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ut</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">fmtstr</span><span class="p">)</span></div>


<div class="viewcode-block" id="dict_find_keys"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_find_keys">[docs]</a><span class="k">def</span> <span class="nf">dict_find_keys</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">val_list</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict):</span>
<span class="sd">        val_list (list):</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: found_dict</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-dict_find_keys</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;default&#39;: 1, &#39;hierarchical&#39;: 5, &#39;linear&#39;: 0, &#39;kdtree&#39;: 1,</span>
<span class="sd">        ...          &#39;composite&#39;: 3, &#39;autotuned&#39;: 255, &#39;saved&#39;: 254, &#39;kmeans&#39;: 2,</span>
<span class="sd">        ...          &#39;lsh&#39;: 6, &#39;kdtree_single&#39;: 4}</span>
<span class="sd">        &gt;&gt;&gt; val_list = [1]</span>
<span class="sd">        &gt;&gt;&gt; found_dict = dict_find_keys(dict_, val_list)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(ut.map_vals(sorted, found_dict))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {1: [&#39;default&#39;, &#39;kdtree&#39;]}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">found_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">search_val</span><span class="p">:</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span> <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">search_val</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">search_val</span> <span class="ow">in</span> <span class="n">val_list</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">found_dict</span></div>


<div class="viewcode-block" id="dict_find_other_sameval_keys"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_find_other_sameval_keys">[docs]</a><span class="k">def</span> <span class="nf">dict_find_other_sameval_keys</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;default&#39;: 1, &#39;hierarchical&#39;: 5, &#39;linear&#39;: 0, &#39;kdtree&#39;: 1,</span>
<span class="sd">        ...          &#39;composite&#39;: 3, &#39;autotuned&#39;: 255, &#39;saved&#39;: 254, &#39;kmeans&#39;: 2,</span>
<span class="sd">        ...          &#39;lsh&#39;: 6, &#39;kdtree_single&#39;: 4}</span>
<span class="sd">        &gt;&gt;&gt; key = &#39;default&#39;</span>
<span class="sd">        &gt;&gt;&gt; found_dict = dict_find_keys(dict_, val_list)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">dict_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">found_dict</span> <span class="o">=</span> <span class="n">dict_find_keys</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="p">[</span><span class="n">value</span><span class="p">])</span>
    <span class="n">other_keys</span> <span class="o">=</span> <span class="n">found_dict</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
    <span class="n">other_keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">other_keys</span></div>


<div class="viewcode-block" id="dict_hist"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_hist">[docs]</a><span class="nd">@profile</span>
<span class="k">def</span> <span class="nf">dict_hist</span><span class="p">(</span><span class="n">item_list</span><span class="p">,</span> <span class="n">weight_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds a histogram of items in item_list</span>

<span class="sd">    Args:</span>
<span class="sd">        item_list (list): list with hashable items (usually containing duplicates)</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict : dictionary where the keys are items in item_list, and the values</span>
<span class="sd">          are the number of times the item appears in item_list.</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-dict_hist</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; item_list = [1, 2, 39, 900, 1232, 900, 1232, 2, 2, 2, 900]</span>
<span class="sd">        &gt;&gt;&gt; hist_ = dict_hist(item_list)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(hist_)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {1: 1, 2: 4, 39: 1, 900: 3, 1232: 2}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># hist_ = defaultdict(lambda: 0)</span>
        <span class="n">hist_</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hist_</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">weight_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># weight_list = it.repeat(1)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
            <span class="n">hist_</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">item_list</span><span class="p">,</span> <span class="n">weight_list</span><span class="p">):</span>
            <span class="n">hist_</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span>
    <span class="c1"># hist_ = dict(hist_)</span>
    <span class="k">if</span> <span class="n">ordered</span><span class="p">:</span>
        <span class="c1"># import utool as ut</span>
        <span class="c1"># key_order = ut.sortedby(list(hist_.keys()), list(hist_.values()))</span>
        <span class="n">getval</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">key_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">hist_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">getval</span><span class="p">)]</span>
        <span class="n">hist_</span> <span class="o">=</span> <span class="n">order_dict_by</span><span class="p">(</span><span class="n">hist_</span><span class="p">,</span> <span class="n">key_order</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hist_</span></div>


<div class="viewcode-block" id="range_hist"><a class="viewcode-back" href="../../utool.html#utool.util_dict.range_hist">[docs]</a><span class="k">def</span> <span class="nf">range_hist</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bins items into a discrete histogram by values and/or ranges.</span>

<span class="sd">        items = [1, 2, 3, 4, 5, 6, 7]</span>
<span class="sd">        bins = [0, 1, 2, (3, float(&#39;inf&#39;))]</span>
<span class="sd">        ut.range_hist(items, bins)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">big_hist</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_hist</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">odict</span><span class="p">([(</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">big_hist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">hist</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">hist</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">hist</span></div>


<div class="viewcode-block" id="dict_hist_cumsum"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_hist_cumsum">[docs]</a><span class="k">def</span> <span class="nf">dict_hist_cumsum</span><span class="p">(</span><span class="n">hist_</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; VERY HACKY &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">items</span> <span class="o">=</span> <span class="n">hist_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">items</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="n">key_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_list_column</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">val_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_list_column</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">cumhist_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">key_list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">val_list</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">cumhist_</span></div>


<div class="viewcode-block" id="merge_dicts"><a class="viewcode-back" href="../../utool.html#utool.util_dict.merge_dicts">[docs]</a><span class="k">def</span> <span class="nf">merge_dicts</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    add / concatenate / union / join / merge / combine dictionaries</span>

<span class="sd">    Copies the first dictionary given and then repeatedly calls update using</span>
<span class="sd">    the rest of the dicts given in args. Duplicate keys will receive the last</span>
<span class="sd">    value specified the list of dictionaries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: mergedict_</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-merge_dicts</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/38987/how-can-i-merge-two-python-dictionaries-in-a-single-expression</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; x = {&#39;a&#39;: 1, &#39;b&#39;: 2}</span>
<span class="sd">        &gt;&gt;&gt; y = {&#39;b&#39;: 3, &#39;c&#39;: 4}</span>
<span class="sd">        &gt;&gt;&gt; mergedict_ = merge_dicts(x, y)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr4(mergedict_, sorted_=True, newlines=False)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;a&#39;: 1, &#39;b&#39;: 3, &#39;c&#39;: 4}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iter_</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">mergedict_</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">iter_</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">dict_</span> <span class="ow">in</span> <span class="n">iter_</span><span class="p">:</span>
        <span class="n">mergedict_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mergedict_</span></div>


<div class="viewcode-block" id="dict_union3"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_union3">[docs]</a><span class="k">def</span> <span class="nf">dict_union3</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">,</span> <span class="n">combine_op</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">add</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        dict1 (dict):</span>
<span class="sd">        dict2 (dict):</span>
<span class="sd">        combine_op (func): (default=op.add)</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: mergedict_</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --exec-dict_union3</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict1 = {&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4}</span>
<span class="sd">        &gt;&gt;&gt; dict2 = {&#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 5, &#39;e&#39;: 21, &#39;f&#39;: 42}</span>
<span class="sd">        &gt;&gt;&gt; combine_op = op.add</span>
<span class="sd">        &gt;&gt;&gt; mergedict_ = dict_union3(dict1, dict2, combine_op)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;mergedict_ = %s&#39; % (ut.repr4(mergedict_, nl=False),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        mergedict_ = {&#39;a&#39;: 1, &#39;b&#39;: 4, &#39;c&#39;: 6, &#39;d&#39;: 9, &#39;e&#39;: 21, &#39;f&#39;: 42}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">keys2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="c1"># Combine common keys</span>
    <span class="n">keys3</span> <span class="o">=</span> <span class="n">keys1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">keys2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">combine_op</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;Can only combine disjoint dicts when combine_op is None&#39;</span><span class="p">)</span>
    <span class="n">dict3</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">combine_op</span><span class="p">(</span><span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys3</span><span class="p">}</span>
    <span class="c1"># Combine unique keys</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys1</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">keys3</span><span class="p">):</span>
        <span class="n">dict3</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys2</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">keys3</span><span class="p">):</span>
        <span class="n">dict3</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dict3</span></div>


<div class="viewcode-block" id="dict_intersection"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_intersection">[docs]</a><span class="k">def</span> <span class="nf">dict_intersection</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">combine_op</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">add</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        dict1 (dict):</span>
<span class="sd">        dict2 (dict):</span>
<span class="sd">        combine (bool): Combines keys only if the values are equal if False else</span>
<span class="sd">            values are combined using combine_op (default = False)</span>
<span class="sd">        combine_op (func): (default = op.add)</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: mergedict_</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --exec-dict_intersection</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict1 = {&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4}</span>
<span class="sd">        &gt;&gt;&gt; dict2 = {&#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 5, &#39;e&#39;: 21, &#39;f&#39;: 42}</span>
<span class="sd">        &gt;&gt;&gt; combine = False</span>
<span class="sd">        &gt;&gt;&gt; mergedict_ = dict_intersection(dict1, dict2, combine)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;mergedict_ = %s&#39; % (ut.repr4(mergedict_, nl=False),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        mergedict_ = {&#39;b&#39;: 2, &#39;c&#39;: 3}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">isect_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
        <span class="c1"># TODO: depricate this</span>
        <span class="n">dict_isect</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">combine_op</span><span class="p">(</span><span class="n">dict1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">dict2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">isect_keys</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># maintain order if possible</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">):</span>
            <span class="n">isect_keys_</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">isect_keys</span><span class="p">]</span>
            <span class="n">_dict_cls</span> <span class="o">=</span> <span class="n">OrderedDict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">isect_keys_</span> <span class="o">=</span> <span class="n">isect_keys</span>
            <span class="n">_dict_cls</span> <span class="o">=</span> <span class="nb">dict</span>
        <span class="n">dict_isect</span> <span class="o">=</span> <span class="n">_dict_cls</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">dict1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">isect_keys_</span> <span class="k">if</span> <span class="n">dict1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">dict2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">dict_isect</span></div>


<div class="viewcode-block" id="dict_isect_combine"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_isect_combine">[docs]</a><span class="k">def</span> <span class="nf">dict_isect_combine</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">,</span> <span class="n">combine_op</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">add</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Intersection of dict keys and combination of dict values &quot;&quot;&quot;</span>
    <span class="n">keys3</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">dict3</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">combine_op</span><span class="p">(</span><span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys3</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">dict3</span></div>


<div class="viewcode-block" id="dict_union_combine"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_union_combine">[docs]</a><span class="k">def</span> <span class="nf">dict_union_combine</span><span class="p">(</span>
    <span class="n">dict1</span><span class="p">,</span>
    <span class="n">dict2</span><span class="p">,</span>
    <span class="n">combine_op</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="n">util_const</span><span class="o">.</span><span class="n">NoParam</span><span class="p">,</span>
    <span class="n">default2</span><span class="o">=</span><span class="n">util_const</span><span class="o">.</span><span class="n">NoParam</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combine of dict keys and uses dfault value when key does not exist</span>

<span class="sd">    CAREFUL WHEN USING THIS WITH REDUCE. Use dict_stack2 instead</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys3</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">util_const</span><span class="o">.</span><span class="n">NoParam</span><span class="p">:</span>
        <span class="n">dict3</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">combine_op</span><span class="p">(</span><span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys3</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">default2</span> <span class="ow">is</span> <span class="n">util_const</span><span class="o">.</span><span class="n">NoParam</span><span class="p">:</span>
            <span class="n">default2</span> <span class="o">=</span> <span class="n">default</span>
        <span class="n">dict3</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">combine_op</span><span class="p">(</span><span class="n">dict1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">),</span> <span class="n">dict2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default2</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys3</span>
        <span class="p">}</span>
    <span class="k">return</span> <span class="n">dict3</span></div>


<div class="viewcode-block" id="dict_accum"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_accum">[docs]</a><span class="k">def</span> <span class="nf">dict_accum</span><span class="p">(</span><span class="o">*</span><span class="n">dict_list</span><span class="p">):</span>
    <span class="n">accumulator</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dict_</span> <span class="ow">in</span> <span class="n">dict_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dict_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">accumulator</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">accumulator</span></div>


<span class="n">dict_isect</span> <span class="o">=</span> <span class="n">dict_intersection</span>


<div class="viewcode-block" id="dict_filter_nones"><a class="viewcode-back" href="../../utool.html#utool.util_dict.dict_filter_nones">[docs]</a><span class="k">def</span> <span class="nf">dict_filter_nones</span><span class="p">(</span><span class="n">dict_</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes None values</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict):  a dictionary</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict:</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --exec-dict_filter_nones</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # UNSTABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # fails on python 3 because of dict None order</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {1: None, 2: &#39;blue&#39;, 3: &#39;four&#39;, None: &#39;fun&#39;}</span>
<span class="sd">        &gt;&gt;&gt; dict2_ = dict_filter_nones(dict_)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr4(dict2_, nl=False)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {None: &#39;fun&#39;, 2: &#39;blue&#39;, 3: &#39;four&#39;}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dict2_</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">dict2_</span></div>


<div class="viewcode-block" id="groupby_tags"><a class="viewcode-back" href="../../utool.html#utool.util_dict.groupby_tags">[docs]</a><span class="k">def</span> <span class="nf">groupby_tags</span><span class="p">(</span><span class="n">item_list</span><span class="p">,</span> <span class="n">tags_list</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    case where an item can belong to multiple groups</span>

<span class="sd">    Args:</span>
<span class="sd">        item_list (list):</span>
<span class="sd">        tags_list (list):</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: groupid_to_items</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-groupby_tags</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; tagged_item_list = {</span>
<span class="sd">        &gt;&gt;&gt;     &#39;spam&#39;: [&#39;meat&#39;, &#39;protein&#39;, &#39;food&#39;],</span>
<span class="sd">        &gt;&gt;&gt;     &#39;eggs&#39;: [&#39;protein&#39;, &#39;food&#39;],</span>
<span class="sd">        &gt;&gt;&gt;     &#39;cheese&#39;: [&#39;dairy&#39;, &#39;protein&#39;, &#39;food&#39;],</span>
<span class="sd">        &gt;&gt;&gt;     &#39;jam&#39;:  [&#39;fruit&#39;, &#39;food&#39;],</span>
<span class="sd">        &gt;&gt;&gt;     &#39;banana&#39;: [&#39;weapon&#39;, &#39;fruit&#39;, &#39;food&#39;],</span>
<span class="sd">        &gt;&gt;&gt; }</span>
<span class="sd">        &gt;&gt;&gt; item_list = list(tagged_item_list.keys())</span>
<span class="sd">        &gt;&gt;&gt; tags_list = list(tagged_item_list.values())</span>
<span class="sd">        &gt;&gt;&gt; groupid_to_items = groupby_tags(item_list, tags_list)</span>
<span class="sd">        &gt;&gt;&gt; groupid_to_items = ut.map_vals(sorted, groupid_to_items)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;groupid_to_items = %s&#39; % (ut.repr4(groupid_to_items),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        groupid_to_items = {</span>
<span class="sd">            &#39;dairy&#39;: [&#39;cheese&#39;],</span>
<span class="sd">            &#39;food&#39;: [&#39;banana&#39;, &#39;cheese&#39;, &#39;eggs&#39;, &#39;jam&#39;, &#39;spam&#39;],</span>
<span class="sd">            &#39;fruit&#39;: [&#39;banana&#39;, &#39;jam&#39;],</span>
<span class="sd">            &#39;meat&#39;: [&#39;spam&#39;],</span>
<span class="sd">            &#39;protein&#39;: [&#39;cheese&#39;, &#39;eggs&#39;, &#39;spam&#39;],</span>
<span class="sd">            &#39;weapon&#39;: [&#39;banana&#39;],</span>
<span class="sd">        }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">groupid_to_items</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tags</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tags_list</span><span class="p">,</span> <span class="n">item_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
            <span class="n">groupid_to_items</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">groupid_to_items</span></div>


<div class="viewcode-block" id="groupby_attr"><a class="viewcode-back" href="../../utool.html#utool.util_dict.groupby_attr">[docs]</a><span class="k">def</span> <span class="nf">groupby_attr</span><span class="p">(</span><span class="n">item_list</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">group_items</span><span class="p">(</span><span class="n">item_list</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="n">attrname</span><span class="p">),</span> <span class="n">item_list</span><span class="p">))</span></div>


<div class="viewcode-block" id="group_pairs"><a class="viewcode-back" href="../../utool.html#utool.util_dict.group_pairs">[docs]</a><span class="k">def</span> <span class="nf">group_pairs</span><span class="p">(</span><span class="n">pair_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Groups a list of items using the first element in each pair as the item and</span>
<span class="sd">    the second element as the groupid.</span>

<span class="sd">    Args:</span>
<span class="sd">        pair_list (list): list of 2-tuples (item, groupid)</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: groupid_to_items: maps a groupid to a list of items</span>

<span class="sd">    SeeAlso:</span>
<span class="sd">        group_items</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize dict of lists</span>
    <span class="n">groupid_to_items</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1"># Insert each item into the correct group</span>
    <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">groupid</span> <span class="ow">in</span> <span class="n">pair_list</span><span class="p">:</span>
        <span class="n">groupid_to_items</span><span class="p">[</span><span class="n">groupid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">groupid_to_items</span></div>


<div class="viewcode-block" id="group_items"><a class="viewcode-back" href="../../utool.html#utool.util_dict.group_items">[docs]</a><span class="k">def</span> <span class="nf">group_items</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sorted_</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Groups a list of items by group id.</span>

<span class="sd">    Args:</span>
<span class="sd">        items (list): a list of the values to be grouped.</span>
<span class="sd">            if `by` is None, then each item is assumed to be a</span>
<span class="sd">            (groupid, value) pair.</span>
<span class="sd">        by (list): a corresponding list to group items by.</span>
<span class="sd">            if specified, these are used as the keys to group values</span>
<span class="sd">            in `items`</span>
<span class="sd">        sorted_ (bool): if True preserves the ordering of items within groups</span>
<span class="sd">            (default = True) FIXME. the opposite is true</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: groupid_to_items: maps a groupid to a list of items</span>

<span class="sd">    SeeAlso:</span>
<span class="sd">        group_indices - first part of a a more fine grained grouping algorithm</span>
<span class="sd">        apply_gropuing - second part of a more fine grained grouping algorithm</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --test-group_items</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; items = [&#39;ham&#39;,     &#39;jam&#39;,   &#39;spam&#39;,     &#39;eggs&#39;,    &#39;cheese&#39;, &#39;bannana&#39;]</span>
<span class="sd">        &gt;&gt;&gt; by    = [&#39;protein&#39;, &#39;fruit&#39;, &#39;protein&#39;,  &#39;protein&#39;, &#39;dairy&#39;,  &#39;fruit&#39;]</span>
<span class="sd">        &gt;&gt;&gt; groupid_to_items = ut.group_items(items, iter(by))</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(groupid_to_items)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;dairy&#39;: [&#39;cheese&#39;], &#39;fruit&#39;: [&#39;jam&#39;, &#39;bannana&#39;], &#39;protein&#39;: [&#39;ham&#39;, &#39;spam&#39;, &#39;eggs&#39;]}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">items</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">sorted_</span><span class="p">:</span>
            <span class="c1"># Sort by groupid for cache efficiency (does this even do anything?)</span>
            <span class="c1"># I forgot why this is needed? Determenism?</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pairs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c1"># Python 3 does not allow sorting mixed types</span>
                <span class="n">pairs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">items</span>

    <span class="c1"># Initialize a dict of lists</span>
    <span class="n">groupid_to_items</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1"># Insert each item into the correct group</span>
    <span class="k">for</span> <span class="n">groupid</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
        <span class="n">groupid_to_items</span><span class="p">[</span><span class="n">groupid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">groupid_to_items</span></div>


<div class="viewcode-block" id="hierarchical_group_items"><a class="viewcode-back" href="../../utool.html#utool.util_dict.hierarchical_group_items">[docs]</a><span class="k">def</span> <span class="nf">hierarchical_group_items</span><span class="p">(</span><span class="n">item_list</span><span class="p">,</span> <span class="n">groupids_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generalization of group_item. Convert a flast list of ids into a heirarchical dictionary.</span>

<span class="sd">    TODO: move to util_dict</span>

<span class="sd">    Reference:</span>
<span class="sd">        http://stackoverflow.com/questions/10193235/python-translate-a-table-to-a-hierarchical-dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">        item_list (list):</span>
<span class="sd">        groupids_list (list):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --exec-hierarchical_group_items</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; item_list     = [1, 2, 3, 4]</span>
<span class="sd">        &gt;&gt;&gt; groupids_list = [[1, 1, 2, 2]]</span>
<span class="sd">        &gt;&gt;&gt; tree = hierarchical_group_items(item_list, groupids_list)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;tree = &#39; + ut.repr4(tree, nl=len(groupids_list) - 1))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        tree = {1: [1, 2], 2: [3, 4]}</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; item_list     = [1, 2, 3, 4, 5, 6, 7, 8]</span>
<span class="sd">        &gt;&gt;&gt; groupids_list = [[1, 2, 1, 2, 1, 2, 1, 2], [3, 2, 2, 2, 3, 1, 1, 1]]</span>
<span class="sd">        &gt;&gt;&gt; tree = hierarchical_group_items(item_list, groupids_list)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;tree = &#39; + ut.repr4(tree, nl=len(groupids_list) - 1))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        tree = {</span>
<span class="sd">            1: {1: [7], 2: [3], 3: [1, 5]},</span>
<span class="sd">            2: {1: [6, 8], 2: [2, 4]},</span>
<span class="sd">        }</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; item_list     = [1, 2, 3, 4]</span>
<span class="sd">        &gt;&gt;&gt; groupids_list = [[1, 1, 1, 2], [1, 2, 2, 2], [1, 3, 1, 1]]</span>
<span class="sd">        &gt;&gt;&gt; tree = hierarchical_group_items(item_list, groupids_list)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;tree = &#39; + ut.repr4(tree, nl=len(groupids_list) - 1))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        tree = {</span>
<span class="sd">            1: {</span>
<span class="sd">                1: {1: [1]},</span>
<span class="sd">                2: {1: [3], 3: [2]},</span>
<span class="sd">            },</span>
<span class="sd">            2: {</span>
<span class="sd">                2: {1: [4]},</span>
<span class="sd">            },</span>
<span class="sd">        }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Construct a defaultdict type with the appropriate number of levels</span>
    <span class="n">num_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groupids_list</span><span class="p">)</span>
    <span class="n">leaf_type</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">defaultdict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_groups</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">node_type</span> <span class="o">=</span> <span class="n">leaf_type</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groupids_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">node_type</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">defaultdict</span><span class="p">,</span> <span class="n">node_type</span><span class="p">)</span>
        <span class="n">root_type</span> <span class="o">=</span> <span class="n">node_type</span>
    <span class="k">elif</span> <span class="n">num_groups</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">root_type</span> <span class="o">=</span> <span class="nb">list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must suply groupids&#39;</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">root_type</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">groupid_tuple_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">groupids_list</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">groupid_tuple</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">groupid_tuple_list</span><span class="p">,</span> <span class="n">item_list</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="k">for</span> <span class="n">groupid</span> <span class="ow">in</span> <span class="n">groupid_tuple</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">groupid</span><span class="p">]</span>
        <span class="n">node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tree</span></div>


<div class="viewcode-block" id="iflatten_dict_values"><a class="viewcode-back" href="../../utool.html#utool.util_dict.iflatten_dict_values">[docs]</a><span class="k">def</span> <span class="nf">iflatten_dict_values</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">_iter</span> <span class="o">=</span> <span class="p">(</span><span class="n">iflatten_dict_values</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">util_iter</span><span class="o">.</span><span class="n">iflatten</span><span class="p">(</span><span class="n">_iter</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span></div>


<span class="c1"># def iflatten_dict_items(node, depth=0):</span>
<span class="c1">#    if isinstance(node, dict):</span>
<span class="c1">#        six.iteritems(node)</span>
<span class="c1">#        _iter = ((key, iflatten_dict_items(value)) for key, value in six.iteritems(node))</span>
<span class="c1">#        return util_iter.iflatten(_iter)</span>
<span class="c1">#    else:</span>
<span class="c1">#        return node</span>


<span class="c1"># def iflatten_dict_keys(node, depth=0):</span>
<span class="c1">#    if isinstance(node, dict):</span>
<span class="c1">#        _iter = (iflatten_dict_keys(value) for key, value in six.iteritems(node))</span>
<span class="c1">#        return util_iter.iflatten(_iter)</span>
<span class="c1">#    else:</span>
<span class="c1">#        return node</span>


<div class="viewcode-block" id="hierarchical_map_vals"><a class="viewcode-back" href="../../utool.html#utool.util_dict.hierarchical_map_vals">[docs]</a><span class="k">def</span> <span class="nf">hierarchical_map_vals</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    node is a dict tree like structure with leaves of type list</span>

<span class="sd">    TODO: move to util_dict</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --exec-hierarchical_map_vals</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; item_list     = [1, 2, 3, 4, 5, 6, 7, 8]</span>
<span class="sd">        &gt;&gt;&gt; groupids_list = [[1, 2, 1, 2, 1, 2, 1, 2], [3, 2, 2, 2, 3, 1, 1, 1]]</span>
<span class="sd">        &gt;&gt;&gt; tree = ut.hierarchical_group_items(item_list, groupids_list)</span>
<span class="sd">        &gt;&gt;&gt; len_tree = ut.hierarchical_map_vals(len, tree)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;len_tree = &#39; + ut.repr4(len_tree, nl=1))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        len_tree = {</span>
<span class="sd">            1: {1: 1, 2: 1, 3: 2},</span>
<span class="sd">            2: {1: 2, 2: 2},</span>
<span class="sd">        }</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # UNSTABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; depth = 4</span>
<span class="sd">        &gt;&gt;&gt; item_list = list(range(2 ** (depth + 1)))</span>
<span class="sd">        &gt;&gt;&gt; num = len(item_list) // 2</span>
<span class="sd">        &gt;&gt;&gt; groupids_list = []</span>
<span class="sd">        &gt;&gt;&gt; total = 0</span>
<span class="sd">        &gt;&gt;&gt; for level in range(depth):</span>
<span class="sd">        ...     num2 = len(item_list) // int((num * 2))</span>
<span class="sd">        ...     #nonflat_levelids = [([total + 2 * x + 1] * num + [total + 2 * x + 2] * num) for x in range(num2)]</span>
<span class="sd">        ...     nonflat_levelids = [([1] * num + [2] * num) for x in range(num2)]</span>
<span class="sd">        ...     levelids = ut.flatten(nonflat_levelids)</span>
<span class="sd">        ...     groupids_list.append(levelids)</span>
<span class="sd">        ...     total += num2 * 2</span>
<span class="sd">        ...     num //= 2</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;groupids_list = %s&#39; % (ut.repr4(groupids_list, nl=1),))</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;depth = %r&#39; % (len(groupids_list),))</span>
<span class="sd">        &gt;&gt;&gt; tree = ut.hierarchical_group_items(item_list, groupids_list)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;tree = &#39; + ut.repr4(tree, nl=None))</span>
<span class="sd">        &gt;&gt;&gt; flat_tree_values = list(ut.iflatten_dict_values(tree))</span>
<span class="sd">        &gt;&gt;&gt; assert sorted(flat_tree_values) == sorted(item_list)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;flat_tree_values = &#39; + str(flat_tree_values))</span>
<span class="sd">        &gt;&gt;&gt; #print(&#39;flat_tree_keys = &#39; + str(list(ut.iflatten_dict_keys(tree))))</span>
<span class="sd">        &gt;&gt;&gt; #print(&#39;iflatten_dict_items = &#39; + str(list(ut.iflatten_dict_items(tree))))</span>
<span class="sd">        &gt;&gt;&gt; len_tree = ut.hierarchical_map_vals(len, tree, max_depth=4)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;len_tree = &#39; + ut.repr4(len_tree, nl=None))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if not isinstance(node, dict):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">max_depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">:</span>
        <span class="c1"># return func(node)</span>
        <span class="k">return</span> <span class="n">map_dict_vals</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        <span class="c1"># return {key: func(val) for key, val in six.iteritems(node)}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># recursion</span>
        <span class="c1"># return {key: hierarchical_map_vals(func, val, max_depth, depth + 1) for key, val in six.iteritems(node)}</span>
        <span class="c1"># keyval_list = [(key, hierarchical_map_vals(func, val, max_depth, depth + 1)) for key, val in six.iteritems(node)]</span>
        <span class="n">keyval_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">hierarchical_map_vals</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">keyval_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">keyval_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="move_odict_item"><a class="viewcode-back" href="../../utool.html#utool.util_dict.move_odict_item">[docs]</a><span class="k">def</span> <span class="nf">move_odict_item</span><span class="p">(</span><span class="n">odict</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">newpos</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/22663966/changing-order-of-ordered-dictionary-in-python</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --exec-move_odict_item</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; odict = OrderedDict()</span>
<span class="sd">        &gt;&gt;&gt; odict[&#39;a&#39;] = 1</span>
<span class="sd">        &gt;&gt;&gt; odict[&#39;b&#39;] = 2</span>
<span class="sd">        &gt;&gt;&gt; odict[&#39;c&#39;] = 3</span>
<span class="sd">        &gt;&gt;&gt; odict[&#39;e&#39;] = 5</span>
<span class="sd">        &gt;&gt;&gt; print(ut.repr4(odict, nl=False))</span>
<span class="sd">        &gt;&gt;&gt; move_odict_item(odict, &#39;c&#39;, 1)</span>
<span class="sd">        &gt;&gt;&gt; print(ut.repr4(odict, nl=False))</span>
<span class="sd">        &gt;&gt;&gt; move_odict_item(odict, &#39;a&#39;, 3)</span>
<span class="sd">        &gt;&gt;&gt; print(ut.repr4(odict, nl=False))</span>
<span class="sd">        &gt;&gt;&gt; move_odict_item(odict, &#39;a&#39;, 0)</span>
<span class="sd">        &gt;&gt;&gt; print(ut.repr4(odict, nl=False))</span>
<span class="sd">        &gt;&gt;&gt; move_odict_item(odict, &#39;b&#39;, 2)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr4(odict, nl=False)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;a&#39;: 1, &#39;c&#39;: 3, &#39;b&#39;: 2, &#39;e&#39;: 5}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">odict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">odict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">otherkey</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">odict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
        <span class="k">if</span> <span class="n">otherkey</span> <span class="o">!=</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">newpos</span><span class="p">:</span>
            <span class="n">odict</span><span class="p">[</span><span class="n">otherkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">odict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">otherkey</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">odict</span></div>


<span class="n">hmap_vals</span> <span class="o">=</span> <span class="n">hierarchical_map_vals</span>


<span class="c1"># def hierarchical_map_nodes(func, node, max_depth=None, depth=0):</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    applies function to non-leaf nodes</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    if not isinstance(node, dict):</span>
<span class="c1">#        return node</span>
<span class="c1">#    elif max_depth is not None and depth &gt;= max_depth:</span>
<span class="c1">#        #return func(node)</span>
<span class="c1">#        return func(node)</span>
<span class="c1">#    else:</span>
<span class="c1">#        # recursion</span>
<span class="c1">#        return {key: func(hierarchical_map_vals(func, val, max_depth, depth + 1)) for key, val in six.iteritems(node)}</span>


<div class="viewcode-block" id="DictLike"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike">[docs]</a><span class="k">class</span> <span class="nc">DictLike</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    move to util_dict rectify with util_dev</span>

<span class="sd">    An inherited class must specify the ``getitem``, ``setitem``, and</span>
<span class="sd">      ``keys`` methods.</span>


<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DictLike.getitem"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike.getitem">[docs]</a>    <span class="k">def</span> <span class="nf">getitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;abstract getitem function&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DictLike.setitem"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike.setitem">[docs]</a>    <span class="k">def</span> <span class="nf">setitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;abstract setitem function&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DictLike.delitem"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike.delitem">[docs]</a>    <span class="k">def</span> <span class="nf">delitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;abstract delitem function&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DictLike.keys"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;abstract keys function&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delitem</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getitem</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setitem</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="DictLike.items"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span></div>

<div class="viewcode-block" id="DictLike.values"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="DictLike.copy"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="DictLike.asdict"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike.asdict">[docs]</a>    <span class="k">def</span> <span class="nf">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="DictLike.iteritems"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike.iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">itervalues</span><span class="p">()):</span>
            <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span></div>

<div class="viewcode-block" id="DictLike.itervalues"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike.itervalues">[docs]</a>    <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="DictLike.iterkeys"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike.iterkeys">[docs]</a>    <span class="k">def</span> <span class="nf">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="DictLike.get"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DictLike.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span></div></div>


<div class="viewcode-block" id="sort_dict"><a class="viewcode-back" href="../../utool.html#utool.util_dict.sort_dict">[docs]</a><span class="k">def</span> <span class="nf">sort_dict</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    sorts a dictionary by its values or its keys</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict_):  a dictionary</span>
<span class="sd">        part (str): specifies to sort by keys or values</span>
<span class="sd">        key (Optional[func]): a function that takes specified part</span>
<span class="sd">            and returns a sortable value</span>
<span class="sd">        reverse (bool): (Defaults to False) - True for descinding order. False</span>
<span class="sd">            for ascending order.</span>

<span class="sd">    Returns:</span>
<span class="sd">        OrderedDict: sorted dictionary</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict sort_dict</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;a&#39;: 3, &#39;c&#39;: 2, &#39;b&#39;: 1}</span>
<span class="sd">        &gt;&gt;&gt; results = []</span>
<span class="sd">        &gt;&gt;&gt; results.append(sort_dict(dict_, &#39;keys&#39;))</span>
<span class="sd">        &gt;&gt;&gt; results.append(sort_dict(dict_, &#39;vals&#39;))</span>
<span class="sd">        &gt;&gt;&gt; results.append(sort_dict(dict_, &#39;vals&#39;, lambda x: -x))</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr4(results)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [</span>
<span class="sd">            {&#39;a&#39;: 3, &#39;b&#39;: 1, &#39;c&#39;: 2},</span>
<span class="sd">            {&#39;b&#39;: 1, &#39;c&#39;: 2, &#39;a&#39;: 3},</span>
<span class="sd">            {&#39;a&#39;: 3, &#39;c&#39;: 2, &#39;b&#39;: 1},</span>
<span class="sd">        ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">part</span> <span class="o">==</span> <span class="s1">&#39;keys&#39;</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">part</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;vals&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">}:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown method part=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">part</span><span class="p">,))</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_key</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">_key</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">key</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

    <span class="n">sorted_items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">_key</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
    <span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">sorted_items</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sorted_dict</span></div>


<div class="viewcode-block" id="order_dict_by"><a class="viewcode-back" href="../../utool.html#utool.util_dict.order_dict_by">[docs]</a><span class="k">def</span> <span class="nf">order_dict_by</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">key_order</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reorders items in a dictionary according to a custom key order</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict_):  a dictionary</span>
<span class="sd">        key_order (list): custom key order</span>

<span class="sd">    Returns:</span>
<span class="sd">        OrderedDict: sorted_dict</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --exec-order_dict_by</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {1: 1, 2: 2, 3: 3, 4: 4}</span>
<span class="sd">        &gt;&gt;&gt; key_order = [4, 2, 3, 1]</span>
<span class="sd">        &gt;&gt;&gt; sorted_dict = order_dict_by(dict_, key_order)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;sorted_dict = %s&#39; % (ut.repr4(sorted_dict, nl=False),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; assert result == &#39;sorted_dict = {4: 4, 2: 2, 3: 3, 1: 1}&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dict_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">other_keys</span> <span class="o">=</span> <span class="n">dict_keys</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">key_order</span><span class="p">)</span>
    <span class="n">key_order</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">key_order</span><span class="p">,</span> <span class="n">other_keys</span><span class="p">)</span>
    <span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">dict_</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_order</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict_keys</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sorted_dict</span></div>


<div class="viewcode-block" id="iteritems_sorted"><a class="viewcode-back" href="../../utool.html#utool.util_dict.iteritems_sorted">[docs]</a><span class="k">def</span> <span class="nf">iteritems_sorted</span><span class="p">(</span><span class="n">dict_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; change to iteritems ordered &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)))</span></div>


<div class="viewcode-block" id="keys_sorted_by_value"><a class="viewcode-back" href="../../utool.html#utool.util_dict.keys_sorted_by_value">[docs]</a><span class="k">def</span> <span class="nf">keys_sorted_by_value</span><span class="p">(</span><span class="n">dict_</span><span class="p">):</span>
    <span class="n">sorted_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">key</span><span class="p">:</span> <span class="n">dict_</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">sorted_keys</span></div>


<div class="viewcode-block" id="flatten_dict_vals"><a class="viewcode-back" href="../../utool.html#utool.util_dict.flatten_dict_vals">[docs]</a><span class="k">def</span> <span class="nf">flatten_dict_vals</span><span class="p">(</span><span class="n">dict_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flattens only values in a heirarchical dictionary, keys are nested.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">augkey</span><span class="p">),</span> <span class="n">augval</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dict_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">augkey</span><span class="p">,</span> <span class="n">augval</span> <span class="ow">in</span> <span class="n">flatten_dict_vals</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="n">dict_</span><span class="p">}</span></div>


<div class="viewcode-block" id="flatten_dict_items"><a class="viewcode-back" href="../../utool.html#utool.util_dict.flatten_dict_items">[docs]</a><span class="k">def</span> <span class="nf">flatten_dict_items</span><span class="p">(</span><span class="n">dict_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flattens keys / values in a heirarchical dictionary</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; item_list     = [1, 2, 3, 4]</span>
<span class="sd">        &gt;&gt;&gt; groupids_list = [[1, 1, 1, 2], [1, 2, 2, 2], [1, 3, 1, 1]]</span>
<span class="sd">        &gt;&gt;&gt; dict_ = hierarchical_group_items(item_list, groupids_list)</span>
<span class="sd">        &gt;&gt;&gt; flatter_dict = flatten_dict_items(dict_)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;flatter_dict = &#39; + ut.repr4(flatter_dict, nl=1))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        flatter_dict = {</span>
<span class="sd">            (1, 1, 1): [1],</span>
<span class="sd">            (1, 2, 1): [3],</span>
<span class="sd">            (1, 2, 3): [2],</span>
<span class="sd">            (2, 2, 1): [4],</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">flat_dict</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten_dict_vals</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span>
    <span class="n">flatter_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">[(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">unpack_iterables</span><span class="p">(</span><span class="n">key</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">flat_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">flatter_dict</span></div>


<div class="viewcode-block" id="depth_atleast"><a class="viewcode-back" href="../../utool.html#utool.util_dict.depth_atleast">[docs]</a><span class="k">def</span> <span class="nf">depth_atleast</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns if depth of list is at least ``depth``</span>

<span class="sd">    Args:</span>
<span class="sd">        list_ (list):</span>
<span class="sd">        depth (int):</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict --exec-depth_atleast --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; list_ = [[[[0]]], [[0]]]</span>
<span class="sd">        &gt;&gt;&gt; depth = 0</span>
<span class="sd">        &gt;&gt;&gt; result = [depth_atleast(list_, depth) for depth in range(0, 7)]</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">depth_atleast</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="DefaultValueDict"><a class="viewcode-back" href="../../utool.html#utool.util_dict.DefaultValueDict">[docs]</a><span class="k">class</span> <span class="nc">DefaultValueDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    picklable default dictionary that can store scalar values.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_dict import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; self = ut.DefaultValueDict(0)</span>
<span class="sd">        &gt;&gt;&gt; print(self[4])</span>
<span class="sd">        &gt;&gt;&gt; self[4] = 4</span>
<span class="sd">        &gt;&gt;&gt; print(self[4])</span>
<span class="sd">        0</span>
<span class="sd">        4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">if</span> <span class="n">other</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_dict</span>
<span class="sd">        python -m utool.util_dict --allexamples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>

    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c1"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>  <span class="c1"># NOQA</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">wbia-vtool</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../utool.html">utool package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../utool.html">utool</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Wild Me.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>