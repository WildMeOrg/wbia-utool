
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>utool.util_str &#8212; wbia-vtool 3.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for utool.util_str</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module that handles string formating and manipulation of various data</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">range</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">split</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_type</span>

<span class="c1"># from utool import util_time</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_cplat</span>
<span class="kn">from</span> <span class="nn">utool._internal</span> <span class="kn">import</span> <span class="n">meta_util_six</span>
<span class="kn">from</span> <span class="nn">utool._internal</span> <span class="kn">import</span> <span class="n">meta_util_arg</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_inject</span>

<span class="nb">print</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">util_inject</span><span class="o">.</span><span class="n">inject2</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">ENABLE_COLORS</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">util_cplat</span><span class="o">.</span><span class="n">WIN32</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">meta_util_arg</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s1">&#39;--nopygments&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_NUMPY</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">if</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_PANDAS</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">TAU</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># References: tauday.com</span>

<span class="n">NO_TRUNCATE</span> <span class="o">=</span> <span class="s1">&#39;--no-truncate&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>

<span class="n">TRIPLE_DOUBLE_QUOTE</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&quot;&#39;</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">TRIPLE_SINGLE_QUOTE</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">SINGLE_QUOTE</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&#39;&quot;</span>
<span class="n">DOUBLE_QUOTE</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&quot;&#39;</span>
<span class="n">BACKSLASH</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
<span class="n">NEWLINE</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="n">TAUFMTSTR</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{coeff:,.1f}{taustr}</span><span class="s1">&#39;</span>
<span class="k">if</span> <span class="s1">&#39;--myway&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
    <span class="n">TAUSTR</span> <span class="o">=</span> <span class="s1">&#39;*2pi&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">TAUSTR</span> <span class="o">=</span> <span class="s1">&#39;tau&#39;</span>


<div class="viewcode-block" id="is_byte_encoded_unicode"><a class="viewcode-back" href="../../utool.html#utool.util_str.is_byte_encoded_unicode">[docs]</a><span class="k">def</span> <span class="nf">is_byte_encoded_unicode</span><span class="p">(</span><span class="n">str_</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;\x&#39;</span> <span class="ow">in</span> <span class="nb">repr</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span></div>


<span class="n">ensure_unicode</span> <span class="o">=</span> <span class="n">meta_util_six</span><span class="o">.</span><span class="n">ensure_unicode</span>


<div class="viewcode-block" id="ensure_ascii"><a class="viewcode-back" href="../../utool.html#utool.util_str.ensure_ascii">[docs]</a><span class="k">def</span> <span class="nf">ensure_ascii</span><span class="p">(</span><span class="n">str_</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">str_</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;it was not a ascii-encoded unicode string&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;It may have been an ascii-encoded unicode string&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">str_</span></div>


<div class="viewcode-block" id="ensure_unicode_strlist"><a class="viewcode-back" href="../../utool.html#utool.util_str.ensure_unicode_strlist">[docs]</a><span class="k">def</span> <span class="nf">ensure_unicode_strlist</span><span class="p">(</span><span class="n">str_list</span><span class="p">):</span>
    <span class="n">__STR__</span> <span class="o">=</span> <span class="n">util_type</span><span class="o">.</span><span class="n">__STR__</span>
    <span class="n">flag_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">__STR__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_byte_encoded_unicode</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">str_</span> <span class="ow">in</span> <span class="n">str_list</span>
    <span class="p">]</span>
    <span class="n">new_str_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">str_</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span> <span class="k">else</span> <span class="n">__STR__</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">str_</span><span class="p">,</span> <span class="n">flag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">str_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">new_str_list</span></div>


<div class="viewcode-block" id="replace_between_tags"><a class="viewcode-back" href="../../utool.html#utool.util_str.replace_between_tags">[docs]</a><span class="k">def</span> <span class="nf">replace_between_tags</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">repl_</span><span class="p">,</span> <span class="n">start_tag</span><span class="p">,</span> <span class="n">end_tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replaces text between sentinal lines in a block of text.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str):</span>
<span class="sd">        repl\_ (str):</span>
<span class="sd">        start_tag (str):</span>
<span class="sd">        end_tag (str): (default=None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: new_text</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-replace_between_tags</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; text = ut.codeblock(</span>
<span class="sd">            &#39;&#39;&#39;</span>
<span class="sd">            class:</span>
<span class="sd">                # &lt;FOO&gt;</span>
<span class="sd">                bar</span>
<span class="sd">                # &lt;/FOO&gt;</span>
<span class="sd">                baz</span>
<span class="sd">            &#39;&#39;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; repl_ = &#39;spam&#39;</span>
<span class="sd">        &gt;&gt;&gt; start_tag = &#39;# &lt;FOO&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; end_tag = &#39;# &lt;/FOO&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; new_text = replace_between_tags(text, repl_, start_tag, end_tag)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;new_text =\n%s&#39; % (str(new_text),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        new_text =</span>
<span class="sd">        class:</span>
<span class="sd">            # &lt;FOO&gt;</span>
<span class="sd">        spam</span>
<span class="sd">            # &lt;/FOO&gt;</span>
<span class="sd">            baz</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">editing</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">editing</span><span class="p">:</span>
            <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">start_tag</span><span class="p">):</span>
            <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">repl_</span><span class="p">)</span>
            <span class="n">editing</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">end_tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">end_tag</span><span class="p">):</span>
            <span class="n">editing</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_lines</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_text</span></div>


<div class="viewcode-block" id="theta_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.theta_str">[docs]</a><span class="k">def</span> <span class="nf">theta_str</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">taustr</span><span class="o">=</span><span class="n">TAUSTR</span><span class="p">,</span> <span class="n">fmtstr</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{coeff:,.1f}{taustr}</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format theta so it is interpretable in base 10</span>

<span class="sd">    Args:</span>
<span class="sd">        theta (float) angle in radians</span>
<span class="sd">        taustr (str): default 2pi</span>

<span class="sd">    Returns:</span>
<span class="sd">        str : theta_str - the angle in tau units</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; theta = 3.1415</span>
<span class="sd">        &gt;&gt;&gt; result = theta_str(theta)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        0.5*2pi</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; theta = 6.9932</span>
<span class="sd">        &gt;&gt;&gt; taustr = &#39;tau&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = theta_str(theta, taustr)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        1.1tau</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">coeff</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">/</span> <span class="n">TAU</span>
    <span class="n">theta_str</span> <span class="o">=</span> <span class="n">fmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">coeff</span><span class="p">,</span> <span class="n">taustr</span><span class="o">=</span><span class="n">taustr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">theta_str</span></div>


<div class="viewcode-block" id="bbox_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.bbox_str">[docs]</a><span class="k">def</span> <span class="nf">bbox_str</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;makes a string from an integer bounding box&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;None&#39;</span>
    <span class="n">fmtstr</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;%&#39;</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">fmtstr</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span></div>


<div class="viewcode-block" id="verts_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.verts_str">[docs]</a><span class="k">def</span> <span class="nf">verts_str</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;makes a string from a list of integer verticies&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;None&#39;</span>
    <span class="n">fmtstr</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;%&#39;</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span> <span class="o">+</span> <span class="s1">&#39;, %&#39;</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">fmtstr</span> <span class="o">%</span> <span class="n">vert</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span> <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="n">verts</span><span class="p">])</span></div>


<span class="c1"># --- Strings ----</span>


<div class="viewcode-block" id="scalar_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.scalar_str">[docs]</a><span class="k">def</span> <span class="nf">scalar_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_precision</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">isfloat</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">))</span> <span class="ow">or</span> <span class="n">util_type</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">isfloat</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;%.&#39;</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="p">,)</span>
    <span class="k">elif</span> <span class="n">max_precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">isfloat</span><span class="p">:</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;%.&#39;</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">max_precision</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="p">,)</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="n">str_</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;0.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">str_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></div>


<div class="viewcode-block" id="remove_chars"><a class="viewcode-back" href="../../utool.html#utool.util_str.remove_chars">[docs]</a><span class="k">def</span> <span class="nf">remove_chars</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">char_list</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    removes all chars in char_list from str\_</span>

<span class="sd">    Args:</span>
<span class="sd">        str\_ (str):</span>
<span class="sd">        char_list (list):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: outstr</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; str_ = &#39;1, 2, 3, 4&#39;</span>
<span class="sd">        &gt;&gt;&gt; char_list = [&#39;,&#39;]</span>
<span class="sd">        &gt;&gt;&gt; result = remove_chars(str_, char_list)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        1 2 3 4</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outstr</span> <span class="o">=</span> <span class="n">str_</span><span class="p">[:]</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">char_list</span><span class="p">:</span>
        <span class="n">outstr</span> <span class="o">=</span> <span class="n">outstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outstr</span></div>


<div class="viewcode-block" id="get_indentation"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_indentation">[docs]</a><span class="k">def</span> <span class="nf">get_indentation</span><span class="p">(</span><span class="n">line_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns the number of preceding spaces</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span></div>


<div class="viewcode-block" id="get_minimum_indentation"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_minimum_indentation">[docs]</a><span class="k">def</span> <span class="nf">get_minimum_indentation</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns the number of preceding spaces</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): unicode text</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: indentation</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-get_minimum_indentation --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; text = &#39;    foo\n   bar&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = get_minimum_indentation(text)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">indentations</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_indentation</span><span class="p">(</span><span class="n">line_</span><span class="p">)</span> <span class="k">for</span> <span class="n">line_</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indentations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">indentations</span><span class="p">)</span></div>


<div class="viewcode-block" id="unindent"><a class="viewcode-back" href="../../utool.html#utool.util_str.unindent">[docs]</a><span class="k">def</span> <span class="nf">unindent</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unindent a block of text</span>

<span class="sd">    Alias for textwrap.dedent</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>


<div class="viewcode-block" id="codeblock"><a class="viewcode-back" href="../../utool.html#utool.util_str.codeblock">[docs]</a><span class="k">def</span> <span class="nf">codeblock</span><span class="p">(</span><span class="n">block_str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convinience function for defining code strings. Esspecially useful for</span>
<span class="sd">    templated code.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">block_str</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="flatten_textlines"><a class="viewcode-back" href="../../utool.html#utool.util_str.flatten_textlines">[docs]</a><span class="k">def</span> <span class="nf">flatten_textlines</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; *</span><span class="se">\n</span><span class="s1"> *&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_text</span></div>


<div class="viewcode-block" id="remove_doublspaces"><a class="viewcode-back" href="../../utool.html#utool.util_str.remove_doublspaces">[docs]</a><span class="k">def</span> <span class="nf">remove_doublspaces</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;  *&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>
    <span class="c1"># , flags=re.MULTILINE)</span>
    <span class="k">return</span> <span class="n">new_text</span></div>


<div class="viewcode-block" id="remove_doublenewlines"><a class="viewcode-back" href="../../utool.html#utool.util_str.remove_doublenewlines">[docs]</a><span class="k">def</span> <span class="nf">remove_doublenewlines</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">(</span><span class="se">\n</span><span class="s1">| )*&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_text</span></div>


<div class="viewcode-block" id="textblock"><a class="viewcode-back" href="../../utool.html#utool.util_str.textblock">[docs]</a><span class="k">def</span> <span class="nf">textblock</span><span class="p">(</span><span class="n">multiline_text</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        block_str (str):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-textblock</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; multiline_text = &#39;&#39;&#39; a big string</span>
<span class="sd">        &gt;&gt;&gt; that should be layed out flat</span>
<span class="sd">        &gt;&gt;&gt; yet still provide nice python</span>
<span class="sd">        &gt;&gt;&gt; code that doesnt go too far over</span>
<span class="sd">        &gt;&gt;&gt; 80 characters.</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; Two newlines should be respected though</span>
<span class="sd">        &gt;&gt;&gt; &#39;&#39;&#39;</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; new_text = textblock(multiline_text)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; result = new_text</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">flatten_textlines</span><span class="p">,</span> <span class="n">multiline_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)))</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_lines</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_text</span></div>


<div class="viewcode-block" id="indent"><a class="viewcode-back" href="../../utool.html#utool.util_str.indent">[docs]</a><span class="k">def</span> <span class="nf">indent</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;    &#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Indents a block of text</span>

<span class="sd">    Args:</span>
<span class="sd">        str\_ (str):</span>
<span class="sd">        indent (str): (default = &#39;    &#39;) TODO rename to indent or rename func</span>

<span class="sd">    Returns:</span>
<span class="sd">        str:</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-indent</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; str_ = &#39;foobar\nbazbiz&#39;</span>
<span class="sd">        &gt;&gt;&gt; indent = &#39;    &#39;</span>
<span class="sd">        &gt;&gt;&gt; result = indent(str_, indent)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">indent_rest</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span></div>


<div class="viewcode-block" id="indent_rest"><a class="viewcode-back" href="../../utool.html#utool.util_str.indent_rest">[docs]</a><span class="k">def</span> <span class="nf">indent_rest</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;    &#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;TODO fix name Indents every part of the string except the beginning</span>
<span class="sd">    SeeAlso: wbia/templates/generate_notebook.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">str_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">indent</span><span class="p">)</span></div>


<div class="viewcode-block" id="indentjoin"><a class="viewcode-back" href="../../utool.html#utool.util_str.indentjoin">[docs]</a><span class="k">def</span> <span class="nf">indentjoin</span><span class="p">(</span><span class="n">strlist</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    &#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convineince indentjoin</span>

<span class="sd">    similar to &#39;\n    &#39;.join(strlist) but indent is also prefixed</span>

<span class="sd">    Args:</span>
<span class="sd">        strlist (?):</span>
<span class="sd">        indent  (str):</span>
<span class="sd">        suffix  (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: joined list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indent_</span> <span class="o">=</span> <span class="n">indent</span>
    <span class="n">strlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">strlist</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">indent_</span> <span class="o">+</span> <span class="n">indent_</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span> <span class="o">+</span> <span class="n">suffix</span> <span class="k">for</span> <span class="n">str_</span> <span class="ow">in</span> <span class="n">strlist</span><span class="p">])</span></div>


<div class="viewcode-block" id="truncate_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.truncate_str">[docs]</a><span class="k">def</span> <span class="nf">truncate_str</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span> <span class="n">truncmsg</span><span class="o">=</span><span class="s1">&#39; ~~~TRUNCATED~~~ &#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes the middle part of any string over maxlen characters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">NO_TRUNCATE</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">str_</span>
    <span class="k">if</span> <span class="n">maxlen</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">maxlen</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxlen</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">str_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">maxlen_</span> <span class="o">=</span> <span class="n">maxlen</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">truncmsg</span><span class="p">)</span>
        <span class="n">lowerb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">maxlen_</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
        <span class="n">upperb</span> <span class="o">=</span> <span class="n">maxlen_</span> <span class="o">-</span> <span class="n">lowerb</span>
        <span class="n">tup</span> <span class="o">=</span> <span class="p">(</span><span class="n">str_</span><span class="p">[:</span><span class="n">lowerb</span><span class="p">],</span> <span class="n">truncmsg</span><span class="p">,</span> <span class="n">str_</span><span class="p">[</span><span class="o">-</span><span class="n">upperb</span><span class="p">:])</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span></div>


<div class="viewcode-block" id="pack_into"><a class="viewcode-back" href="../../utool.html#utool.util_str.pack_into">[docs]</a><span class="k">def</span> <span class="nf">pack_into</span><span class="p">(</span>
    <span class="n">text</span><span class="p">,</span>
    <span class="n">textwidth</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span>
    <span class="n">breakchars</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
    <span class="n">break_words</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">newline_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">wordsep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
    <span class="n">remove_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    DEPRICATE IN FAVOR OF textwrap.wrap</span>

<span class="sd">    TODO: Look into textwrap.wrap</span>

<span class="sd">    Inserts newlines into a string enforcing a maximum textwidth.</span>
<span class="sd">    Similar to vim&#39;s gq command in visual select mode.</span>

<span class="sd">    breakchars is a string containing valid characters to insert a newline</span>
<span class="sd">    before or after.</span>

<span class="sd">    break_words is True if words are allowed to be split over multiple lines.</span>

<span class="sd">    all inserted newlines are prefixed with newline_prefix</span>

<span class="sd">    #FIXME:</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; text = &quot;set_image_uris(ibs&lt;139684018194000&gt;, [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13], [u&#39;66ec193a-1619-b3b6-216d-1784b4833b61.jpg&#39;, u&#39;d8903434-942f-e0f5-d6c2-0dcbe3137bf7.jpg&#39;, u&#39;b73b72f4-4acb-c445-e72c-05ce02719d3d.jpg&#39;, u&#39;0cd05978-3d83-b2ee-2ac9-798dd571c3b3.jpg&#39;, u&#39;0a9bc03d-a75e-8d14-0153-e2949502aba7.jpg&#39;, u&#39;2deeff06-5546-c752-15dc-2bd0fdb1198a.jpg&#39;, u&#39;a9b70278-a936-c1dd-8a3b-bc1e9a998bf0.png&#39;, u&#39;42fdad98-369a-2cbc-67b1-983d6d6a3a60.jpg&#39;, u&#39;c459d381-fd74-1d99-6215-e42e3f432ea9.jpg&#39;, u&#39;33fd9813-3a2b-774b-3fcc-4360d1ae151b.jpg&#39;, u&#39;97e8ea74-873f-2092-b372-f928a7be30fa.jpg&#39;, u&#39;588bc218-83a5-d400-21aa-d499832632b0.jpg&#39;, u&#39;163a890c-36f2-981e-3529-c552b6d668a3.jpg&#39;], ) &quot;  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; textwidth = 160</span>
<span class="sd">        &gt;&gt;&gt; breakchars = &#39; &#39;</span>
<span class="sd">        &gt;&gt;&gt; break_words = True</span>
<span class="sd">        &gt;&gt;&gt; newline_prefix = &#39;    &#39;</span>
<span class="sd">        &gt;&gt;&gt; wordsep = &#39; &#39;</span>
<span class="sd">        &gt;&gt;&gt; packstr1 = pack_into(text, textwidth, breakchars, break_words, newline_prefix, wordsep)</span>
<span class="sd">        &gt;&gt;&gt; break_words = False</span>
<span class="sd">        &gt;&gt;&gt; packstr2 = pack_into(text, textwidth, breakchars, break_words, newline_prefix, wordsep)</span>
<span class="sd">        &gt;&gt;&gt; print(packstr1)</span>
<span class="sd">        &gt;&gt;&gt; print(packstr2)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -c &quot;import utool&quot; --dump-utool-init</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># FIXME: messy code</span>
    <span class="n">textwidth_</span> <span class="o">=</span> <span class="n">textwidth</span>
    <span class="c1"># Accumulate a list of lines</span>
    <span class="n">line_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
    <span class="c1"># Split text into list of words</span>
    <span class="n">word_list</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">breakchars</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">remove_newlines</span><span class="p">:</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
        <span class="n">available</span> <span class="o">=</span> <span class="n">textwidth_</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Check to see if we need to make a new line</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">available</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">break_words</span><span class="p">:</span>
                <span class="c1"># If we are allowed to break words over multiple lines</span>
                <span class="c1"># Fill the rest of the available textwidth with part of the</span>
                <span class="c1"># word</span>
                <span class="n">line_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">word</span><span class="p">[:</span><span class="n">available</span><span class="p">]</span>
                <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">available</span><span class="p">:]</span>
            <span class="c1"># Append a new line to the list</span>
            <span class="c1"># Reset the avaiablable textwidth for new line</span>
            <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">textwidth_</span> <span class="o">=</span> <span class="n">textwidth</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">newline_prefix</span><span class="p">)</span>
            <span class="n">available</span> <span class="o">=</span> <span class="n">textwidth_</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">break_words</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="c1"># Append the word and a separator to the current line.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Weird if statement. Probably bug somewhere.</span>
            <span class="n">textwidth_</span> <span class="o">=</span> <span class="n">textwidth</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">newline_prefix</span><span class="p">)</span>
        <span class="n">line_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">word</span> <span class="o">+</span> <span class="n">wordsep</span>
    <span class="n">packed_str</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">newline_prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">packed_str</span></div>


<div class="viewcode-block" id="packstr"><a class="viewcode-back" href="../../utool.html#utool.util_str.packstr">[docs]</a><span class="k">def</span> <span class="nf">packstr</span><span class="p">(</span>
    <span class="n">instr</span><span class="p">,</span>
    <span class="n">textwidth</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span>
    <span class="n">breakchars</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
    <span class="n">break_words</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">newline_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">indentation</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">nlprefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wordsep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
    <span class="n">remove_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;alias for pack_into. has more up to date kwargs&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instr</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">instr</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">instr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nlprefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">newline_prefix</span> <span class="o">=</span> <span class="n">nlprefix</span>
    <span class="n">str_</span> <span class="o">=</span> <span class="n">pack_into</span><span class="p">(</span>
        <span class="n">instr</span><span class="p">,</span>
        <span class="n">textwidth</span><span class="p">,</span>
        <span class="n">breakchars</span><span class="p">,</span>
        <span class="n">break_words</span><span class="p">,</span>
        <span class="n">newline_prefix</span><span class="p">,</span>
        <span class="n">wordsep</span><span class="p">,</span>
        <span class="n">remove_newlines</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">indentation</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="n">indent</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">indentation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">str_</span></div>


<div class="viewcode-block" id="packtext"><a class="viewcode-back" href="../../utool.html#utool.util_str.packtext">[docs]</a><span class="k">def</span> <span class="nf">packtext</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        text (str):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-pack_paragraph --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; width = 80</span>
<span class="sd">        &gt;&gt;&gt; text = lorium_ipsum()</span>
<span class="sd">        &gt;&gt;&gt; result = packtext(text)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
    <span class="kn">import</span> <span class="nn">textwrap</span>

    <span class="n">new_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">remove_doublspaces</span><span class="p">(</span><span class="n">new_text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">new_text</span></div>


<div class="viewcode-block" id="joins"><a class="viewcode-back" href="../../utool.html#utool.util_str.joins">[docs]</a><span class="k">def</span> <span class="nf">joins</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">list_</span><span class="p">,</span> <span class="n">with_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_tail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tostrip</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="n">head</span> <span class="o">=</span> <span class="n">string</span> <span class="k">if</span> <span class="n">with_head</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
    <span class="n">tail</span> <span class="o">=</span> <span class="n">string</span> <span class="k">if</span> <span class="n">with_tail</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
    <span class="n">to_return</span> <span class="o">=</span> <span class="n">head</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">,</span> <span class="n">list_</span><span class="p">))</span> <span class="o">+</span> <span class="n">tail</span>
    <span class="n">to_return</span> <span class="o">=</span> <span class="n">to_return</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">tostrip</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">to_return</span></div>


<div class="viewcode-block" id="indent_list"><a class="viewcode-back" href="../../utool.html#utool.util_str.indent_list">[docs]</a><span class="k">def</span> <span class="nf">indent_list</span><span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="n">list_</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="n">list_</span><span class="p">))</span></div>


<div class="viewcode-block" id="filesize_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.filesize_str">[docs]</a><span class="k">def</span> <span class="nf">filesize_str</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="n">mb_str</span> <span class="o">=</span> <span class="n">file_megabytes_str</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;filesize(</span><span class="si">%r</span><span class="s1">)=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mb_str</span><span class="p">)</span></div>


<div class="viewcode-block" id="seconds_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.seconds_str">[docs]</a><span class="k">def</span> <span class="nf">seconds_str</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        str</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; num_list = sorted([4.2 / (10.0 ** exp_)</span>
<span class="sd">        &gt;&gt;&gt;                    for exp_ in range(-13, 13, 4)])</span>
<span class="sd">        &gt;&gt;&gt; secstr_list = [seconds_str(num, prefix=None) for num in num_list]</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;, &#39;.join(secstr_list))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        0.04 ns, 0.42 us, 4.20 ms, 0.04 ks, 0.42 Ms, 4.20 Gs, 42.00 Ts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">exponent_list</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
    <span class="n">small_prefix_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">]</span>
    <span class="c1"># large_prefix_list = [&#39;pico&#39;, &#39;nano&#39;, &#39;micro&#39;, &#39;mili&#39;, &#39;&#39;, &#39;kilo&#39;, &#39;mega&#39;,</span>
    <span class="c1"># &#39;giga&#39;, &#39;tera&#39;]</span>
    <span class="c1"># large_suffix = &#39;second&#39;</span>
    <span class="n">small_suffix</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">small_suffix</span>
    <span class="n">prefix_list</span> <span class="o">=</span> <span class="n">small_prefix_list</span>
    <span class="n">base</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">secstr</span> <span class="o">=</span> <span class="n">order_of_magnitude_str</span><span class="p">(</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">prefix_list</span><span class="p">,</span> <span class="n">exponent_list</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">secstr</span></div>


<div class="viewcode-block" id="order_of_magnitude_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.order_of_magnitude_str">[docs]</a><span class="k">def</span> <span class="nf">order_of_magnitude_str</span><span class="p">(</span>
    <span class="n">num</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">prefix_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exponent_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO: Rewrite byte_str to use this func</span>
<span class="sd">    Returns:</span>
<span class="sd">        str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">abs_num</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="c1"># Find the right magnidue</span>
    <span class="k">for</span> <span class="n">prefix_</span><span class="p">,</span> <span class="n">exponent</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">prefix_list</span><span class="p">,</span> <span class="n">exponent_list</span><span class="p">):</span>
        <span class="c1"># Let user request the prefix</span>
        <span class="n">requested</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">!=</span> <span class="n">prefix_</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">requested</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Otherwise find the best prefix</span>
        <span class="n">magnitude</span> <span class="o">=</span> <span class="n">base</span> <span class="o">**</span> <span class="n">exponent</span>
        <span class="c1"># Be less than this threshold to use this unit</span>
        <span class="n">thresh_mag</span> <span class="o">=</span> <span class="n">magnitude</span> <span class="o">*</span> <span class="n">base</span>
        <span class="k">if</span> <span class="n">requested</span> <span class="ow">or</span> <span class="n">abs_num</span> <span class="o">&lt;=</span> <span class="n">thresh_mag</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">unit_str</span> <span class="o">=</span> <span class="n">_magnitude_str</span><span class="p">(</span><span class="n">abs_num</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">prefix_</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unit_str</span></div>


<span class="k">def</span> <span class="nf">_magnitude_str</span><span class="p">(</span><span class="n">abs_num</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">prefix_</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
    <span class="n">scaled_num</span> <span class="o">=</span> <span class="n">abs_num</span> <span class="o">/</span> <span class="n">magnitude</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">prefix_</span> <span class="o">+</span> <span class="n">suffix</span>
    <span class="n">unit_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scaled_num</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unit_str</span>


<div class="viewcode-block" id="parse_bytes"><a class="viewcode-back" href="../../utool.html#utool.util_str.parse_bytes">[docs]</a><span class="k">def</span> <span class="nf">parse_bytes</span><span class="p">(</span><span class="n">bytes_str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse bytes from string</span>

<span class="sd">    Ignore:</span>
<span class="sd">        &gt;&gt;&gt; uint8_size = ut.parse_bytes(&#39;1B&#39;)</span>
<span class="sd">        &gt;&gt;&gt; image_size = ut.parse_bytes(&#39;3.5MB&#39;)</span>
<span class="sd">        &gt;&gt;&gt; float32_size = ut.parse_bytes(&#39;32bit&#39;)</span>
<span class="sd">        &gt;&gt;&gt; desc_size = 128 * uint8_size</span>
<span class="sd">        &gt;&gt;&gt; kpts_size = 6 * float32_size</span>
<span class="sd">        &gt;&gt;&gt; chip_size = ut.parse_bytes(&#39;400 KB&#39;)</span>
<span class="sd">        &gt;&gt;&gt; probchip_size = ut.parse_bytes(&#39;50 KB&#39;)</span>
<span class="sd">        &gt;&gt;&gt; nImgs = 80000 # 80,000</span>
<span class="sd">        &gt;&gt;&gt; nAnnots = nImgs * 2</span>
<span class="sd">        &gt;&gt;&gt; desc_per_img = 3000</span>
<span class="sd">        &gt;&gt;&gt; size_stats = {</span>
<span class="sd">        &gt;&gt;&gt;     &#39;image&#39;: nImgs * image_size,</span>
<span class="sd">        &gt;&gt;&gt;     &#39;chips&#39;: nAnnots * chip_size,</span>
<span class="sd">        &gt;&gt;&gt;     &#39;probchips&#39;: nAnnots * probchip_size,</span>
<span class="sd">        &gt;&gt;&gt;     &#39;desc&#39;: nAnnots * desc_size * desc_per_img,</span>
<span class="sd">        &gt;&gt;&gt;     &#39;kpts&#39;: nAnnots * kpts_size * desc_per_img,</span>
<span class="sd">        &gt;&gt;&gt; }</span>
<span class="sd">        &gt;&gt;&gt; print(ut.repr3(ut.map_dict_vals(ut.byte_str2, size_stats), align=True))</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;total = &#39; + ut.byte_str2(sum(size_stats.values())))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
    <span class="kn">import</span> <span class="nn">re</span>

    <span class="n">numstr</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">named_field</span><span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\d\.?\d*&#39;</span><span class="p">)</span>
    <span class="n">unitstr</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">named_field</span><span class="p">(</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;[a-zA-Z]+&#39;</span><span class="p">)</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">numstr</span> <span class="o">+</span> <span class="s1">&#39; *&#39;</span> <span class="o">+</span> <span class="n">unitstr</span><span class="p">,</span> <span class="n">bytes_str</span><span class="p">)</span>
    <span class="n">nUnits</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()[</span><span class="s1">&#39;num&#39;</span><span class="p">])</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">nBytes</span> <span class="o">=</span> <span class="n">get_bytes</span><span class="p">(</span><span class="n">nUnits</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nBytes</span></div>


<div class="viewcode-block" id="get_bytes"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_bytes">[docs]</a><span class="k">def</span> <span class="nf">get_bytes</span><span class="p">(</span><span class="n">nUnits</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
    <span class="n">unitdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TB&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;KB&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">0</span><span class="p">}</span>
    <span class="c1"># https://en.wikipedia.org/wiki/Units_of_information#Obsolete_and_unusual_units</span>
    <span class="n">unitdict</span><span class="p">[</span><span class="s1">&#39;BIT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span>
    <span class="n">unitdict</span><span class="p">[</span><span class="s1">&#39;CRUMB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span>
    <span class="n">unitdict</span><span class="p">[</span><span class="s1">&#39;NIBBLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">unitdict</span><span class="p">[</span><span class="s1">&#39;CHOMP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">unit_nBytes</span> <span class="o">=</span> <span class="n">unitdict</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
    <span class="n">nBytes</span> <span class="o">=</span> <span class="n">unit_nBytes</span> <span class="o">*</span> <span class="n">nUnits</span>
    <span class="k">return</span> <span class="n">nBytes</span></div>


<div class="viewcode-block" id="byte_str2"><a class="viewcode-back" href="../../utool.html#utool.util_str.byte_str2">[docs]</a><span class="k">def</span> <span class="nf">byte_str2</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Automatically chooses relevant unit (KB, MB, or GB) for displaying some</span>
<span class="sd">    number of bytes.</span>

<span class="sd">    Args:</span>
<span class="sd">        nBytes (int):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str:</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-byte_str2</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; nBytes_list = [1, 100, 1024,  1048576, 1073741824, 1099511627776]</span>
<span class="sd">        &gt;&gt;&gt; result = ut.list_str(list(map(byte_str2, nBytes_list)), nl=False)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [&#39;0.00 KB&#39;, &#39;0.10 KB&#39;, &#39;1.00 KB&#39;, &#39;1.00 MB&#39;, &#39;1.00 GB&#39;, &#39;1.00 TB&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nAbsBytes</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nBytes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nAbsBytes</span> <span class="o">&lt;</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">byte_str</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="s1">&#39;KB&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nAbsBytes</span> <span class="o">&lt;</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">byte_str</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="s1">&#39;KB&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nAbsBytes</span> <span class="o">&lt;</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="mi">30</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">byte_str</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nAbsBytes</span> <span class="o">&lt;</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="mi">40</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">byte_str</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">byte_str</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="s1">&#39;TB&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span></div>


<div class="viewcode-block" id="byte_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.byte_str">[docs]</a><span class="k">def</span> <span class="nf">byte_str</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;bytes&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    representing the number of bytes with the chosen unit</span>

<span class="sd">    Returns:</span>
<span class="sd">        str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># return (nBytes * ureg.byte).to(unit.upper())</span>
    <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">):</span>
        <span class="n">nUnit</span> <span class="o">=</span> <span class="n">nBytes</span>
    <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">):</span>
        <span class="n">nUnit</span> <span class="o">=</span> <span class="n">nBytes</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">):</span>
        <span class="n">nUnit</span> <span class="o">=</span> <span class="n">nBytes</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="mi">20</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">):</span>
        <span class="n">nUnit</span> <span class="o">=</span> <span class="n">nBytes</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="mi">30</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">):</span>
        <span class="n">nUnit</span> <span class="o">=</span> <span class="n">nBytes</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="mi">40</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;unknown nBytes=</span><span class="si">%r</span><span class="s1"> unit=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="n">unit</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">repr2</span><span class="p">(</span><span class="n">nUnit</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">unit</span></div>


<div class="viewcode-block" id="second_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.second_str">[docs]</a><span class="k">def</span> <span class="nf">second_str</span><span class="p">(</span><span class="n">nsecs</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">abbrev</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
    <span class="kn">import</span> <span class="nn">pint</span>

    <span class="n">ureg</span> <span class="o">=</span> <span class="n">pint</span><span class="o">.</span><span class="n">UnitRegistry</span><span class="p">()</span>
    <span class="n">sec_quant</span> <span class="o">=</span> <span class="n">nsecs</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">s</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">unit_quant</span> <span class="o">=</span> <span class="n">sec_quant</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unit_quant</span> <span class="o">=</span> <span class="n">sec_quant</span><span class="o">.</span><span class="n">to_compact</span><span class="p">()</span>
    <span class="n">unit_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">unit_quant</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">abbrev</span><span class="p">:</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;millisecond&#39;</span><span class="p">:</span> <span class="s1">&#39;ms&#39;</span><span class="p">,</span>
            <span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span>
            <span class="s1">&#39;nanosecond&#39;</span><span class="p">:</span> <span class="s1">&#39;ns&#39;</span><span class="p">,</span>
            <span class="s1">&#39;microsecond&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">unit_str</span> <span class="o">=</span> <span class="n">lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">unit_str</span><span class="p">,</span> <span class="n">unit_str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unit_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">pluralize</span><span class="p">(</span><span class="n">unit_str</span><span class="p">,</span> <span class="n">unit_quant</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>
    <span class="n">quant_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">unit_quant</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">unit_str</span>
    <span class="c1"># quant_str =  str(unit_quant)</span>
    <span class="k">return</span> <span class="n">quant_str</span></div>


<div class="viewcode-block" id="file_megabytes_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.file_megabytes_str">[docs]</a><span class="k">def</span> <span class="nf">file_megabytes_str</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_path</span>

    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1"> MB&#39;</span> <span class="o">%</span> <span class="n">util_path</span><span class="o">.</span><span class="n">file_megabytes</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span></div>


<div class="viewcode-block" id="func_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.func_str">[docs]</a><span class="k">def</span> <span class="nf">func_str</span><span class="p">(</span>
    <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">type_aliases</span><span class="o">=</span><span class="p">[],</span> <span class="n">packed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">packkw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    string representation of function definition</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: a representation of func with args, kwargs, and type_aliases</span>

<span class="sd">    Args:</span>
<span class="sd">        func (function):</span>
<span class="sd">        args (list): argument values (default = [])</span>
<span class="sd">        kwargs (dict): kwargs values (default = {})</span>
<span class="sd">        type_aliases (list): (default = [])</span>
<span class="sd">        packed (bool): (default = False)</span>
<span class="sd">        packkw (None): (default = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: func_str</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-func_str</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; func = byte_str</span>
<span class="sd">        &gt;&gt;&gt; args = [1024, &#39;MB&#39;]</span>
<span class="sd">        &gt;&gt;&gt; kwargs = dict(precision=2)</span>
<span class="sd">        &gt;&gt;&gt; type_aliases = []</span>
<span class="sd">        &gt;&gt;&gt; packed = False</span>
<span class="sd">        &gt;&gt;&gt; packkw = None</span>
<span class="sd">        &gt;&gt;&gt; _str = func_str(func, args, kwargs, type_aliases, packed, packkw)</span>
<span class="sd">        &gt;&gt;&gt; result = _str</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        byte_str(1024, &#39;MB&#39;, precision=2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="c1"># if truncate:</span>
    <span class="c1"># truncatekw = {&#39;maxlen&#39;: 20}</span>
    <span class="c1"># else:</span>
    <span class="n">truncatekw</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">argrepr_list</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[]</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_itemstr_list</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="n">truncate</span><span class="p">,</span> <span class="n">truncatekw</span><span class="o">=</span><span class="n">truncatekw</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">kwrepr_list</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[]</span>
        <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="n">ut</span><span class="o">.</span><span class="n">dict_itemstr_list</span><span class="p">(</span>
            <span class="n">kwargs</span><span class="p">,</span> <span class="n">explicit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="n">truncate</span><span class="p">,</span> <span class="n">truncatekw</span><span class="o">=</span><span class="n">truncatekw</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">repr_list</span> <span class="o">=</span> <span class="n">argrepr_list</span> <span class="o">+</span> <span class="n">kwrepr_list</span>

    <span class="n">argskwargs_str</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repr_list</span><span class="p">)</span>
    <span class="n">_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">meta_util_six</span><span class="o">.</span><span class="n">get_funcname</span><span class="p">(</span><span class="n">func</span><span class="p">),</span> <span class="n">argskwargs_str</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">packed</span><span class="p">:</span>
        <span class="n">packkw_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">textwidth</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">nlprefix</span><span class="o">=</span><span class="s1">&#39;    &#39;</span><span class="p">,</span> <span class="n">break_words</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">packkw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">packkw_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">packkw_</span><span class="p">)</span>
        <span class="n">_str</span> <span class="o">=</span> <span class="n">packstr</span><span class="p">(</span><span class="n">_str</span><span class="p">,</span> <span class="o">**</span><span class="n">packkw_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_str</span></div>


<div class="viewcode-block" id="func_defsig"><a class="viewcode-back" href="../../utool.html#utool.util_str.func_defsig">[docs]</a><span class="k">def</span> <span class="nf">func_defsig</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">with_name</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    String of function definition signature</span>

<span class="sd">    Args:</span>
<span class="sd">        func (function): live python function</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: defsig</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-func_defsig</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; func = func_str</span>
<span class="sd">        &gt;&gt;&gt; defsig = func_defsig(func)</span>
<span class="sd">        &gt;&gt;&gt; result = str(defsig)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        func_str(func, args=[], kwargs={}, type_aliases=[], packed=False, packkw=None, truncate=False)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">inspect</span>

    <span class="n">argspec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">varargs</span><span class="p">,</span> <span class="n">varkw</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span> <span class="o">=</span> <span class="n">argspec</span>
    <span class="n">defsig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">formatargspec</span><span class="p">(</span><span class="o">*</span><span class="n">argspec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">with_name</span><span class="p">:</span>
        <span class="n">defsig</span> <span class="o">=</span> <span class="n">get_callable_name</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="o">+</span> <span class="n">defsig</span>
    <span class="k">return</span> <span class="n">defsig</span></div>


<div class="viewcode-block" id="func_callsig"><a class="viewcode-back" href="../../utool.html#utool.util_str.func_callsig">[docs]</a><span class="k">def</span> <span class="nf">func_callsig</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">with_name</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    String of function call signature</span>

<span class="sd">    Args:</span>
<span class="sd">        func (function): live python function</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: callsig</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-func_callsig</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; func = func_str</span>
<span class="sd">        &gt;&gt;&gt; callsig = func_callsig(func)</span>
<span class="sd">        &gt;&gt;&gt; result = str(callsig)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        func_str(func, args, kwargs, type_aliases, packed, packkw, truncate)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">inspect</span>

    <span class="n">argspec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">varargs</span><span class="p">,</span> <span class="n">varkw</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span> <span class="o">=</span> <span class="n">argspec</span>
    <span class="n">callsig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">formatargspec</span><span class="p">(</span><span class="o">*</span><span class="n">argspec</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">with_name</span><span class="p">:</span>
        <span class="n">callsig</span> <span class="o">=</span> <span class="n">get_callable_name</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="o">+</span> <span class="n">callsig</span>
    <span class="k">return</span> <span class="n">callsig</span></div>


<span class="c1"># def array_repr2(arr, max_line_width=None, precision=None, suppress_small=None,</span>
<span class="c1">#                 force_dtype=False, with_dtype=None, **kwargs):</span>
<span class="c1">#     &quot;&quot;&quot; extended version of np.core.numeric.array_repr</span>

<span class="c1">#     ut.editfile(np.core.numeric.__file__)</span>

<span class="c1">#     On linux:</span>
<span class="c1">#     _typelessdata [numpy.int64, numpy.float64, numpy.complex128, numpy.int64]</span>

<span class="c1">#     On BakerStreet</span>
<span class="c1">#     _typelessdata [numpy.int32, numpy.float64, numpy.complex128, numpy.int32]</span>

<span class="c1">#     # WEIRD</span>
<span class="c1">#     np.int64 is np.int64</span>
<span class="c1">#     _typelessdata[0] is _typelessdata[-1]</span>
<span class="c1">#     _typelessdata[0] == _typelessdata[-1]</span>

<span class="c1">#     TODO:</span>
<span class="c1">#         replace force_dtype with with_dtype</span>


<span class="c1">#     id(_typelessdata[-1])</span>
<span class="c1">#     id(_typelessdata[0])</span>


<span class="c1">#     from numpy.core.numeric import _typelessdata</span>
<span class="c1">#     _typelessdata</span>

<span class="c1">#     References:</span>
<span class="c1">#         http://stackoverflow.com/questions/28455982/why-are-there-two-np-int64s</span>
<span class="c1">#         -in-numpy-core-numeric-typelessdata-why-is-numpy-in/28461928#28461928</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     data = arr</span>
<span class="c1">#     strvals = kwargs.get(&#39;strvals&#39;, False)</span>
<span class="c1">#     # precision = kwargs.get(&#39;precision&#39;, None)</span>
<span class="c1">#     # suppress_small = kwargs.get(&#39;supress_small&#39;, None)</span>
<span class="c1">#     # max_line_width = kwargs.get(&#39;max_line_width&#39;, None)</span>
<span class="c1">#     # with_dtype = kwargs.get(&#39;with_dtype&#39;, not strvals)</span>
<span class="c1">#     newlines = kwargs.pop(&#39;nl&#39;, kwargs.pop(&#39;newlines&#39;, 1))</span>

<span class="c1">#     # if with_dtype and strvals:</span>
<span class="c1">#     #     raise ValueError(&#39;cannot format with strvals and dtype&#39;)</span>

<span class="c1">#     separator = &#39; &#39;</span>

<span class="c1">#     if strvals:</span>
<span class="c1">#         prefix = &#39;&#39;</span>
<span class="c1">#         suffix = &#39;&#39;</span>
<span class="c1">#     else:</span>
<span class="c1">#         modname = type(data).__module__</span>
<span class="c1">#         # substitute shorthand for numpy module names</span>
<span class="c1">#         np_nice = &#39;np&#39;</span>
<span class="c1">#         modname = re.sub(&#39;\\bnumpy\\b&#39;, np_nice, modname)</span>
<span class="c1">#         modname = re.sub(&#39;\\bma.core\\b&#39;, &#39;ma&#39;, modname)</span>

<span class="c1">#         class_name = type(data).__name__</span>
<span class="c1">#         if class_name == &#39;ndarray&#39;:</span>
<span class="c1">#             class_name = &#39;array&#39;</span>

<span class="c1">#         prefix = class_name + &#39;(&#39;</span>

<span class="c1">#         if with_dtype:</span>
<span class="c1">#             dtype_repr = data.dtype.name</span>
<span class="c1">#             # dtype_repr = np.core.arrayprint.dtype_short_repr(data.dtype)</span>
<span class="c1">#             suffix = &#39;,{}dtype={}.{})&#39;.format(itemsep, np_nice, dtype_repr)</span>
<span class="c1">#         else:</span>
<span class="c1">#             suffix = &#39;)&#39;</span>

<span class="c1">#     if not strvals and data.size == 0 and data.shape != (0,):</span>
<span class="c1">#         # Special case for displaying empty data</span>
<span class="c1">#         prefix = modname + &#39;.empty(&#39;</span>
<span class="c1">#         body = repr(tuple(map(int, data.shape)))</span>
<span class="c1">#     else:</span>
<span class="c1">#         body = np.array2string(data, precision=precision,</span>
<span class="c1">#                                separator=separator,</span>
<span class="c1">#                                suppress_small=suppress_small,</span>
<span class="c1">#                                prefix=prefix,</span>
<span class="c1">#                                legacy=&#39;1.13&#39;,</span>
<span class="c1">#                                max_line_width=max_line_width)</span>
<span class="c1">#     if not newlines:</span>
<span class="c1">#         # remove newlines if we need to</span>
<span class="c1">#         body = re.sub(&#39;\n *&#39;, &#39;&#39;, body)</span>
<span class="c1">#     formatted = body</span>
<span class="c1">#     #+ suffix</span>
<span class="c1">#     return formatted</span>

<span class="c1"># the old way of doing this breaks</span>
<span class="c1"># import numpy as np</span>
<span class="c1"># from numpy.core.numeric import _typelessdata</span>

<span class="c1"># if arr.__class__ is not np.ndarray:</span>
<span class="c1">#     cName = arr.__class__.__name__</span>
<span class="c1"># else:</span>
<span class="c1">#     cName = &#39;array&#39;</span>

<span class="c1"># prefix = cName + &#39;(&#39;</span>

<span class="c1"># if arr.size &gt; 0 or arr.shape == (0,):</span>
<span class="c1">#     separator = &#39;, &#39;</span>
<span class="c1">#     lst = array2string2(</span>
<span class="c1">#         arr, max_line_width, precision, suppress_small, separator, prefix,</span>
<span class="c1">#         **kwargs)</span>
<span class="c1"># else:</span>
<span class="c1">#     # show zero-length shape unless it is (0,)</span>
<span class="c1">#     lst = &#39;[], shape=%s&#39; % (repr(arr.shape),)</span>

<span class="c1"># skipdtype = ((arr.dtype.type in _typelessdata) and arr.size &gt; 0)</span>

<span class="c1"># if with_dtype is None:</span>
<span class="c1">#     with_dtype = not (skipdtype and not (cName == &#39;array&#39; and force_dtype))</span>

<span class="c1"># if not with_dtype:</span>
<span class="c1">#     return &#39;%s(%s)&#39; % (cName, lst)</span>
<span class="c1"># else:</span>
<span class="c1">#     typename = arr.dtype.name</span>
<span class="c1">#     # Quote typename in the output if it is &#39;complex&#39;.</span>
<span class="c1">#     if typename and not (typename[0].isalpha() and typename.isalnum()):</span>
<span class="c1">#         typename = &#39;\&#39;%s\&#39;&#39; % typename</span>

<span class="c1">#     lf = &#39;&#39;</span>
<span class="c1">#     if issubclass(arr.dtype.type, np.flexible):</span>
<span class="c1">#         if arr.dtype.names:</span>
<span class="c1">#             typename = &#39;%s&#39; % six.text_type(arr.dtype)</span>
<span class="c1">#         else:</span>
<span class="c1">#             typename = &#39;\&#39;%s\&#39;&#39; % six.text_type(arr.dtype)</span>
<span class="c1">#         lf = &#39;\n&#39; + &#39; &#39; * len(prefix)</span>
<span class="c1">#     return cName + &#39;(%s, %sdtype=%s)&#39; % (lst, lf, typename)</span>


<span class="c1"># def array2string2(a, max_line_width=None, precision=None, suppress_small=None,</span>
<span class="c1">#                   separator=&#39; &#39;, prefix=&quot;&quot;, style=repr, formatter=None,</span>
<span class="c1">#                   threshold=None):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     expanded version of np.core.arrayprint.array2string</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     import numpy as np</span>

<span class="c1">#     if a.shape == ():</span>
<span class="c1">#         x = a.item()</span>
<span class="c1">#         try:</span>
<span class="c1">#             import warnings</span>
<span class="c1">#             lst = a._format(x)</span>
<span class="c1">#             msg = &quot;The `_format` attribute is deprecated in Numpy &quot; \</span>
<span class="c1">#                   &quot;2.0 and will be removed in 2.1. Use the &quot; \</span>
<span class="c1">#                   &quot;`formatter` kw instead.&quot;</span>
<span class="c1">#             warnings.warn(msg, DeprecationWarning)</span>
<span class="c1">#         except AttributeError:</span>
<span class="c1">#             if isinstance(x, tuple):</span>
<span class="c1">#                 x = np.core.arrayprint._convert_arrays(x)</span>
<span class="c1">#             lst = style(x)</span>
<span class="c1">#     elif reduce(np.core.arrayprint.product, a.shape) == 0:</span>
<span class="c1">#         # treat as a null array if any of shape elements == 0</span>
<span class="c1">#         lst = &quot;[]&quot;</span>
<span class="c1">#     else:</span>
<span class="c1">#         lst = _array2string2(</span>
<span class="c1">#             a, max_line_width, precision, suppress_small, separator, prefix,</span>
<span class="c1">#             formatter=formatter, threshold=threshold)</span>
<span class="c1">#     return lst</span>


<span class="c1"># def _array2string2(a, max_line_width, precision, suppress_small, separator=&#39; &#39;,</span>
<span class="c1">#                    prefix=&quot;&quot;, formatter=None, threshold=None):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     expanded version of np.core.arrayprint._array2string</span>
<span class="c1">#     TODO: make a numpy pull request with a fixed version</span>

<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     arrayprint = np.core.arrayprint</span>

<span class="c1">#     if max_line_width is None:</span>
<span class="c1">#         max_line_width = arrayprint._line_width</span>

<span class="c1">#     if precision is None:</span>
<span class="c1">#         precision = arrayprint._float_output_precision</span>

<span class="c1">#     if suppress_small is None:</span>
<span class="c1">#         suppress_small = arrayprint._float_output_suppress_small</span>

<span class="c1">#     if formatter is None:</span>
<span class="c1">#         formatter = arrayprint._formatter</span>

<span class="c1">#     if threshold is None:</span>
<span class="c1">#         threshold = arrayprint._summaryThreshold</span>

<span class="c1">#     if threshold &gt; 0 and a.size &gt; threshold:</span>
<span class="c1">#         summary_insert = &quot;..., &quot;</span>
<span class="c1">#         data = arrayprint._leading_trailing(a)</span>
<span class="c1">#     else:</span>
<span class="c1">#         summary_insert = &quot;&quot;</span>
<span class="c1">#         data = arrayprint.ravel(a)</span>

<span class="c1">#     formatdict = {&#39;bool&#39; : arrayprint._boolFormatter,</span>
<span class="c1">#                   &#39;int&#39; : arrayprint.IntegerFormat(data),</span>
<span class="c1">#                   &#39;float&#39; : arrayprint.FloatFormat(data, precision, suppress_small),</span>
<span class="c1">#                   &#39;longfloat&#39; : arrayprint.LongFloatFormat(precision),</span>
<span class="c1">#                   &#39;complexfloat&#39; : arrayprint.ComplexFormat(data, precision,</span>
<span class="c1">#                                                             suppress_small),</span>
<span class="c1">#                   &#39;longcomplexfloat&#39; : arrayprint.LongComplexFormat(precision),</span>
<span class="c1">#                   &#39;datetime&#39; : arrayprint.DatetimeFormat(data),</span>
<span class="c1">#                   &#39;timedelta&#39; : arrayprint.TimedeltaFormat(data),</span>
<span class="c1">#                   &#39;numpystr&#39; : arrayprint.repr_format,</span>
<span class="c1">#                   &#39;str&#39; : str}</span>

<span class="c1">#     if formatter is not None:</span>
<span class="c1">#         fkeys = [k for k in formatter.keys() if formatter[k] is not None]</span>
<span class="c1">#         if &#39;all&#39; in fkeys:</span>
<span class="c1">#             for key in formatdict.keys():</span>
<span class="c1">#                 formatdict[key] = formatter[&#39;all&#39;]</span>
<span class="c1">#         if &#39;int_kind&#39; in fkeys:</span>
<span class="c1">#             for key in [&#39;int&#39;]:</span>
<span class="c1">#                 formatdict[key] = formatter[&#39;int_kind&#39;]</span>
<span class="c1">#         if &#39;float_kind&#39; in fkeys:</span>
<span class="c1">#             for key in [&#39;float&#39;, &#39;longfloat&#39;]:</span>
<span class="c1">#                 formatdict[key] = formatter[&#39;float_kind&#39;]</span>
<span class="c1">#         if &#39;complex_kind&#39; in fkeys:</span>
<span class="c1">#             for key in [&#39;complexfloat&#39;, &#39;longcomplexfloat&#39;]:</span>
<span class="c1">#                 formatdict[key] = formatter[&#39;complex_kind&#39;]</span>
<span class="c1">#         if &#39;str_kind&#39; in fkeys:</span>
<span class="c1">#             for key in [&#39;numpystr&#39;, &#39;str&#39;]:</span>
<span class="c1">#                 formatdict[key] = formatter[&#39;str_kind&#39;]</span>
<span class="c1">#         for key in formatdict.keys():</span>
<span class="c1">#             if key in fkeys:</span>
<span class="c1">#                 formatdict[key] = formatter[key]</span>

<span class="c1">#     try:</span>
<span class="c1">#         format_function = a._format</span>
<span class="c1">#         msg = &quot;The `_format` attribute is deprecated in Numpy 2.0 and &quot; \</span>
<span class="c1">#               &quot;will be removed in 2.1. Use the `formatter` kw instead.&quot;</span>
<span class="c1">#         import warnings</span>
<span class="c1">#         warnings.warn(msg, DeprecationWarning)</span>
<span class="c1">#     except AttributeError:</span>
<span class="c1">#         # find the right formatting function for the array</span>
<span class="c1">#         dtypeobj = a.dtype.type</span>
<span class="c1">#         if issubclass(dtypeobj, np.core.arrayprint._nt.bool_):</span>
<span class="c1">#             format_function = formatdict[&#39;bool&#39;]</span>
<span class="c1">#         elif issubclass(dtypeobj, np.core.arrayprint._nt.integer):</span>
<span class="c1">#             if issubclass(dtypeobj, np.core.arrayprint._nt.timedelta64):</span>
<span class="c1">#                 format_function = formatdict[&#39;timedelta&#39;]</span>
<span class="c1">#             else:</span>
<span class="c1">#                 format_function = formatdict[&#39;int&#39;]</span>
<span class="c1">#         elif issubclass(dtypeobj, np.core.arrayprint._nt.floating):</span>
<span class="c1">#             if issubclass(dtypeobj, np.core.arrayprint._nt.longfloat):</span>
<span class="c1">#                 format_function = formatdict[&#39;longfloat&#39;]</span>
<span class="c1">#             else:</span>
<span class="c1">#                 format_function = formatdict[&#39;float&#39;]</span>
<span class="c1">#         elif issubclass(dtypeobj, np.core.arrayprint._nt.complexfloating):</span>
<span class="c1">#             if issubclass(dtypeobj, np.core.arrayprint._nt.clongfloat):</span>
<span class="c1">#                 format_function = formatdict[&#39;longcomplexfloat&#39;]</span>
<span class="c1">#             else:</span>
<span class="c1">#                 format_function = formatdict[&#39;complexfloat&#39;]</span>
<span class="c1">#         elif issubclass(dtypeobj, (np.core.arrayprint._nt.unicode_,</span>
<span class="c1">#                                    np.core.arrayprint._nt.string_)):</span>
<span class="c1">#             format_function = formatdict[&#39;numpystr&#39;]</span>
<span class="c1">#         elif issubclass(dtypeobj, np.core.arrayprint._nt.datetime64):</span>
<span class="c1">#             format_function = formatdict[&#39;datetime&#39;]</span>
<span class="c1">#         else:</span>
<span class="c1">#             format_function = formatdict[&#39;numpystr&#39;]</span>

<span class="c1">#     # skip over &quot;[&quot;</span>
<span class="c1">#     next_line_prefix = &quot; &quot;</span>
<span class="c1">#     # skip over array(</span>
<span class="c1">#     next_line_prefix += &quot; &quot; * len(prefix)</span>

<span class="c1">#     lst = np.core.arrayprint._formatArray(a, format_function, len(a.shape), max_line_width,</span>
<span class="c1">#                                           next_line_prefix, separator,</span>
<span class="c1">#                                           np.core.arrayprint._summaryEdgeItems, summary_insert)[:-1]</span>
<span class="c1">#     return lst</span>


<div class="viewcode-block" id="numpy_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.numpy_str">[docs]</a><span class="k">def</span> <span class="nf">numpy_str</span><span class="p">(</span>
    <span class="n">arr</span><span class="p">,</span>
    <span class="n">strvals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">force_dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">with_dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">suppress_small</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_line_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    suppress_small = False turns off scientific representation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># strvals = kwargs.get(&#39;strvals&#39;, False)</span>
    <span class="n">itemsep</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;itemsep&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="c1"># precision = kwargs.get(&#39;precision&#39;, None)</span>
    <span class="c1"># suppress_small = kwargs.get(&#39;supress_small&#39;, None)</span>
    <span class="c1"># max_line_width = kwargs.get(&#39;max_line_width&#39;, None)</span>
    <span class="c1"># with_dtype = kwargs.get(&#39;with_dtype&#39;, False)</span>
    <span class="n">newlines</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nl&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;newlines&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">arr</span>

    <span class="c1"># if with_dtype and strvals:</span>
    <span class="c1">#     raise ValueError(&#39;cannot format with strvals and dtype&#39;)</span>

    <span class="n">separator</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">itemsep</span>

    <span class="k">if</span> <span class="n">strvals</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="c1"># substitute shorthand for numpy module names</span>
        <span class="n">np_nice</span> <span class="o">=</span> <span class="s1">&#39;np&#39;</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">bnumpy</span><span class="se">\\</span><span class="s1">b&#39;</span><span class="p">,</span> <span class="n">np_nice</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">bma.core</span><span class="se">\\</span><span class="s1">b&#39;</span><span class="p">,</span> <span class="s1">&#39;ma&#39;</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>

        <span class="n">class_name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="n">class_name</span> <span class="o">==</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">:</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="s1">&#39;array&#39;</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">class_name</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>

        <span class="k">if</span> <span class="n">with_dtype</span><span class="p">:</span>
            <span class="n">dtype_repr</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span>
            <span class="c1"># dtype_repr = np.core.arrayprint.dtype_short_repr(data.dtype)</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;,</span><span class="si">{}</span><span class="s1">dtype=</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">itemsep</span><span class="p">,</span> <span class="n">np_nice</span><span class="p">,</span> <span class="n">dtype_repr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;)&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">strvals</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,):</span>
        <span class="c1"># Special case for displaying empty data</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.empty(&#39;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array2string</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
            <span class="n">separator</span><span class="o">=</span><span class="n">separator</span><span class="p">,</span>
            <span class="n">suppress_small</span><span class="o">=</span><span class="n">suppress_small</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span>
            <span class="n">max_line_width</span><span class="o">=</span><span class="n">max_line_width</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">newlines</span><span class="p">:</span>
        <span class="c1"># remove newlines if we need to</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> *&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
    <span class="n">formatted</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">body</span> <span class="o">+</span> <span class="n">suffix</span>
    <span class="k">return</span> <span class="n">formatted</span></div>

    <span class="c1"># kwargs = kwargs.copy()</span>
    <span class="c1"># if &#39;suppress&#39; in kwargs:</span>
    <span class="c1">#     suppress_small = kwargs[&#39;suppress&#39;]</span>
    <span class="c1"># if max_line_width is None and &#39;linewidth&#39; in kwargs:</span>
    <span class="c1">#     max_line_width = kwargs.pop(&#39;linewidth&#39;)</span>

    <span class="c1"># import ubelt as ub</span>
    <span class="c1"># return ub.repr2(arr, precision=precision, force_dtype=force_dtype,</span>
    <span class="c1">#                 with_dtype=with_dtype, suppress_small=suppress_small,</span>
    <span class="c1">#                 max_line_width=max_line_width, threshold=threshold,</span>
    <span class="c1">#                 **kwargs)</span>

    <span class="c1"># if pr is not None:</span>
    <span class="c1">#     precision = pr</span>
    <span class="c1"># # TODO: make this a util_str func for numpy reprs</span>
    <span class="c1"># if strvals:</span>
    <span class="c1">#     valstr = np.array_str(arr, precision=precision,</span>
    <span class="c1">#                           suppress_small=suppress_small, **kwargs)</span>
    <span class="c1"># else:</span>
    <span class="c1">#     #valstr = np.array_repr(arr, precision=precision)</span>
    <span class="c1">#     valstr = array_repr2(arr, precision=precision, force_dtype=force_dtype,</span>
    <span class="c1">#                          with_dtype=with_dtype,</span>
    <span class="c1">#                          suppress_small=suppress_small,</span>
    <span class="c1">#                          max_line_width=max_line_width,</span>
    <span class="c1">#                          threshold=threshold, **kwargs)</span>
    <span class="c1">#     numpy_vals = itertools.chain(util_type.NUMPY_SCALAR_NAMES, [&#39;array&#39;])</span>
    <span class="c1">#     for npval in numpy_vals:</span>
    <span class="c1">#         valstr = valstr.replace(npval, &#39;np.&#39; + npval)</span>
    <span class="c1">#     if valstr.find(&#39;\n&#39;) &gt;= 0:</span>
    <span class="c1">#         # Align multiline arrays</span>
    <span class="c1">#         valstr = valstr.replace(&#39;\n&#39;, &#39;\n   &#39;)</span>
    <span class="c1"># return valstr</span>


<div class="viewcode-block" id="reprfunc"><a class="viewcode-back" href="../../utool.html#utool.util_str.reprfunc">[docs]</a><span class="k">def</span> <span class="nf">reprfunc</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        val (?):</span>
<span class="sd">        precision (None): (default = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str:</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str reprfunc --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; #vals = [{&#39;foo&#39;: [1/3, 2]}, np.float64, 1/3, &#39;foo&#39;]</span>
<span class="sd">        &gt;&gt;&gt; vals = [{&#39;foo&#39;: [1, 2]}, np.float64, 1/3, &#39;foo&#39;]</span>
<span class="sd">        &gt;&gt;&gt; precision = 2</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr3([reprfunc(val, precision) for val in vals], nobr=True)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &quot;{u&#39;foo&#39;: [1, 2]}&quot;,</span>
<span class="sd">        &#39;numpy.float64&#39;,</span>
<span class="sd">        &#39;0.33&#39;,</span>
<span class="sd">        &quot;&#39;foo&#39;&quot;,</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">repr_</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">repr_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;u&#39;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">repr_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;u&quot;&#39;</span><span class="p">):</span>
            <span class="c1"># Remove unicode repr from python2 to agree with python3</span>
            <span class="c1"># output</span>
            <span class="n">repr_</span> <span class="o">=</span> <span class="n">repr_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">))</span> <span class="ow">or</span> <span class="n">util_type</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">val</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">scalar_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

        <span class="n">repr_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">type_str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># import utool as ut</span>
        <span class="c1"># print(&#39;val = %r&#39; % (val,))</span>
        <span class="c1"># ut.repr2(val)</span>
        <span class="n">repr_</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">repr_</span></div>


<div class="viewcode-block" id="list_str_summarized"><a class="viewcode-back" href="../../utool.html#utool.util_str.list_str_summarized">[docs]</a><span class="k">def</span> <span class="nf">list_str_summarized</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">list_name</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    prints the list members when the list is small and the length when it is</span>
<span class="sd">    large</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;len(</span><span class="si">%s</span><span class="s1">)=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">list_name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">list_name</span><span class="p">,</span> <span class="n">list_</span><span class="p">)</span></div>


<div class="viewcode-block" id="countdown_flag"><a class="viewcode-back" href="../../utool.html#utool.util_str.countdown_flag">[docs]</a><span class="k">def</span> <span class="nf">countdown_flag</span><span class="p">(</span><span class="n">count_or_bool</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">count_or_bool</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">count_or_bool</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    used by recrusive functions to specify which level to turn a bool on in</span>
<span class="sd">    counting down yeilds True, True, ..., False</span>
<span class="sd">    conting up yeilds False, False, False, ... True</span>

<span class="sd">    Args:</span>
<span class="sd">        count_or_bool (bool or int): if positive will count down, if negative</span>
<span class="sd">            will count up, if bool will remain same</span>

<span class="sd">    Returns:</span>
<span class="sd">        int or bool: count_or_bool_</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-_rectify_countdown_or_bool</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import _rectify_countdown_or_bool  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; count_or_bool = True</span>
<span class="sd">        &gt;&gt;&gt; a1 = (_rectify_countdown_or_bool(2))</span>
<span class="sd">        &gt;&gt;&gt; a2 = (_rectify_countdown_or_bool(1))</span>
<span class="sd">        &gt;&gt;&gt; a3 = (_rectify_countdown_or_bool(0))</span>
<span class="sd">        &gt;&gt;&gt; a4 = (_rectify_countdown_or_bool(-1))</span>
<span class="sd">        &gt;&gt;&gt; a5 = (_rectify_countdown_or_bool(-2))</span>
<span class="sd">        &gt;&gt;&gt; a6 = (_rectify_countdown_or_bool(True))</span>
<span class="sd">        &gt;&gt;&gt; a7 = (_rectify_countdown_or_bool(False))</span>
<span class="sd">        &gt;&gt;&gt; result = [a1, a2, a3, a4, a5, a6, a7]</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [1.0, 0.0, 0, 0.0, -1.0, True, False]</span>

<span class="sd">        [1.0, True, False, False, -1.0, True, False]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">count_or_bool</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">count_or_bool</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">count_or_bool_</span> <span class="o">=</span> <span class="n">count_or_bool</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count_or_bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">count_or_bool</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">sign_</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">count_or_bool</span><span class="p">)</span>
        <span class="n">count_or_bool_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count_or_bool</span> <span class="o">-</span> <span class="n">sign_</span><span class="p">)</span>
        <span class="c1"># if count_or_bool_ == 0:</span>
        <span class="c1">#    return sign_ == 1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">count_or_bool_</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">count_or_bool_</span>


<div class="viewcode-block" id="trunc_repr"><a class="viewcode-back" href="../../utool.html#utool.util_str.trunc_repr">[docs]</a><span class="k">def</span> <span class="nf">trunc_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">truncate_str</span><span class="p">(</span><span class="n">repr2</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">maxlen</span><span class="p">,</span> <span class="n">truncmsg</span><span class="o">=</span><span class="s1">&#39;~//~&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="repr2"><a class="viewcode-back" href="../../utool.html#utool.util_str.repr2">[docs]</a><span class="k">def</span> <span class="nf">repr2</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempt to replace repr more configurable</span>
<span class="sd">    pretty version that works the same in both 2 and 3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nl&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;newlines&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
    <span class="n">val_str</span> <span class="o">=</span> <span class="n">_make_valstr</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val_str</span><span class="p">(</span><span class="n">obj_</span><span class="p">)</span></div>


<div class="viewcode-block" id="repr2_json"><a class="viewcode-back" href="../../utool.html#utool.util_str.repr2_json">[docs]</a><span class="k">def</span> <span class="nf">repr2_json</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;hack for json reprs&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;trailing_sep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">json_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">json_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">json_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">))</span>
    <span class="n">json_str</span> <span class="o">=</span> <span class="n">json_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">)</span>
    <span class="n">json_str</span> <span class="o">=</span> <span class="n">json_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
    <span class="n">json_str</span> <span class="o">=</span> <span class="n">json_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json_str</span></div>


<div class="viewcode-block" id="repr3"><a class="viewcode-back" href="../../utool.html#utool.util_str.repr3">[docs]</a><span class="k">def</span> <span class="nf">repr3</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nl&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;newlines&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">repr2</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="repr4"><a class="viewcode-back" href="../../utool.html#utool.util_str.repr4">[docs]</a><span class="k">def</span> <span class="nf">repr4</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nl&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;newlines&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># kwargs[&#39;precision&#39;] = kwargs.pop(&#39;precision&#39;, 2)</span>
    <span class="k">return</span> <span class="n">repr2</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="dict_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.dict_str">[docs]</a><span class="k">def</span> <span class="nf">dict_str</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="o">**</span><span class="n">dictkw</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes a pretty printable / human-readable string representation of a</span>
<span class="sd">    dictionary. In most cases this string could be evaled.</span>

<span class="sd">    Args:</span>
<span class="sd">        dict\_ (dict):  a dictionary</span>
<span class="sd">        **dictkw: stritems, strkeys, strvals, nl, newlines, truncate, nobr,</span>
<span class="sd">            nobraces, align, trailing_sep, explicit, itemsep,</span>
<span class="sd">            truncatekw, sorted\_, indent\_, key_order, precision,</span>
<span class="sd">            with_comma, key_order_metric, maxlen, recursive, use_numpy,</span>
<span class="sd">            with_dtype, force_dtype, packed</span>
<span class="sd">        sorted\_ (None): returns str sorted by a metric (default = None)</span>
<span class="sd">        nl (int): prefered alias for newline. can be a coundown variable</span>
<span class="sd">            (default = None)</span>
<span class="sd">        key_order (None): overrides default ordering (default = None)</span>
<span class="sd">        key_order_metric (str): special sorting of items. Accepted values:</span>
<span class="sd">            None, &#39;strlen&#39;, &#39;val&#39;</span>
<span class="sd">        precision (int): (default = 8)</span>
<span class="sd">        explicit (int): can be a countdown variable. if True, uses</span>
<span class="sd">            dict(a=b) syntax instead of {&#39;a&#39;: b}</span>
<span class="sd">        nobr (bool): removes outer braces (default = False)</span>

<span class="sd">    Ignore:</span>
<span class="sd">        python -m utool.util_inspect recursive_parse_kwargs:2 --mod utool.util_str --func dict_str --verbinspect</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-dict_str:1</span>
<span class="sd">        python -m utool.util_str --test-dict_str --truncate=False --no-checkwant</span>
<span class="sd">        python -m utool.util_str --test-dict_str --truncate=1 --no-checkwant</span>
<span class="sd">        python -m utool.util_str --test-dict_str --truncate=2 --no-checkwant</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import dict_str, dict_itemstr_list</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;foo&#39;: {&#39;spam&#39;: &#39;barbarbarbarbar&#39; * 3, &#39;eggs&#39;: &#39;jam&#39;},</span>
<span class="sd">        &gt;&gt;&gt;          &#39;baz&#39;: &#39;barbarbarbarbar&#39; * 3}</span>
<span class="sd">        &gt;&gt;&gt; truncate = ut.get_argval(&#39;--truncate&#39;, type_=None, default=1)</span>
<span class="sd">        &gt;&gt;&gt; result = dict_str(dict_, strvals=True, truncate=truncate,</span>
<span class="sd">        &gt;&gt;&gt;                    truncatekw={&#39;maxlen&#39;: 20})</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {</span>
<span class="sd">            &#39;baz&#39;: barbarbarbarbarbarbarbarbarbarbarbarbarbarbar,</span>
<span class="sd">            &#39;foo&#39;: {</span>
<span class="sd">                &#39;eggs&#39;: jam,</span>
<span class="sd">                &#39;s ~~~TRUNCATED~~~ r,</span>
<span class="sd">            },</span>
<span class="sd">        }</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; a, b, c = &#39;a&#39;, &#39;b&#39;, &#39;c&#39;</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {</span>
<span class="sd">        &gt;&gt;&gt;     &#39;float&#39;: 2.3333,</span>
<span class="sd">        &gt;&gt;&gt;     &#39;slice&#39;: slice(1, 2, None),</span>
<span class="sd">        &gt;&gt;&gt;     &#39;arr&#39;: np.eye(3),</span>
<span class="sd">        &gt;&gt;&gt;     &#39;list1&#39;: [1, 2, 3, 2.3333, a, b, c],</span>
<span class="sd">        &gt;&gt;&gt;     &#39;dict1&#39;: {2.3333: 2.3333, a: b, c: [a, b]},</span>
<span class="sd">        &gt;&gt;&gt;     &#39;t&#39;: {c: {c: {c: {c : c}}}},</span>
<span class="sd">        &gt;&gt;&gt;     &#39;set1&#39;: {c, a, b},</span>
<span class="sd">        &gt;&gt;&gt;     &#39;set2&#39;: ut.oset([c, a, b]),</span>
<span class="sd">        &gt;&gt;&gt;     &#39;list2&#39;: [</span>
<span class="sd">        &gt;&gt;&gt;         {a: {c, a, b}, 1: slice(1, 2, 3)},</span>
<span class="sd">        &gt;&gt;&gt;         [1, 2, {c, a, 2.333}, {a: [b], b: {c}, c: 2.333}]</span>
<span class="sd">        &gt;&gt;&gt;     ],</span>
<span class="sd">        &gt;&gt;&gt; }</span>
<span class="sd">        &gt;&gt;&gt; dictkw = dict(stritems=True, itemsep=&#39;&#39;, precision=2, nl=1,</span>
<span class="sd">        &gt;&gt;&gt;               nobr=True, explicit=True)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.dict_str(dict_, **dictkw)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; dictkw = dict(stritems=0, precision=2, nl=True, nobr=False,</span>
<span class="sd">        &gt;&gt;&gt;                  explicit=0)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.dict_str(dict_, **dictkw)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">stritems</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;si&#39;</span><span class="p">,</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stritems&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">stritems</span><span class="p">:</span>
        <span class="n">dictkw</span><span class="p">[</span><span class="s1">&#39;strkeys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">dictkw</span><span class="p">[</span><span class="s1">&#39;strvals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">dictkw</span><span class="p">[</span><span class="s1">&#39;strkeys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sk&#39;</span><span class="p">,</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;strkeys&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
    <span class="n">dictkw</span><span class="p">[</span><span class="s1">&#39;strvals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sv&#39;</span><span class="p">,</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;strvals&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

    <span class="n">newlines</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nl&#39;</span><span class="p">,</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;newlines&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
    <span class="n">truncate</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;truncate&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">dictkw</span><span class="p">[</span><span class="s1">&#39;nl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">newlines</span><span class="p">)</span>
    <span class="n">dictkw</span><span class="p">[</span><span class="s1">&#39;truncate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">truncate</span><span class="p">)</span>

    <span class="n">nobraces</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nobr&#39;</span><span class="p">,</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nobraces&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
    <span class="n">align</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;align&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Doesn&#39;t actually put in trailing comma if on same line</span>
    <span class="n">trailing_sep</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;trailing_sep&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">explicit</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;explicit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">with_comma</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">itemsep</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;itemsep&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;dict()&#39;</span> <span class="k">if</span> <span class="n">explicit</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span>

    <span class="n">itemstr_list</span> <span class="o">=</span> <span class="n">dict_itemstr_list</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="o">**</span><span class="n">dictkw</span><span class="p">)</span>

    <span class="n">do_truncate</span> <span class="o">=</span> <span class="n">truncate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="p">(</span><span class="n">truncate</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">truncate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">do_truncate</span><span class="p">:</span>
        <span class="n">truncatekw</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;truncatekw&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">itemstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">truncate_str</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="o">**</span><span class="n">truncatekw</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itemstr_list</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">nobraces</span><span class="p">:</span>
        <span class="n">lbr</span><span class="p">,</span> <span class="n">rbr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">explicit</span><span class="p">:</span>
        <span class="n">lbr</span><span class="p">,</span> <span class="n">rbr</span> <span class="o">=</span> <span class="s1">&#39;dict(&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lbr</span><span class="p">,</span> <span class="n">rbr</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span>

    <span class="k">if</span> <span class="n">newlines</span><span class="p">:</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;,</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">with_comma</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">nobraces</span><span class="p">:</span>
            <span class="n">retstr</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trailing_sep</span><span class="p">:</span>
                <span class="n">retstr</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ut</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">itemstr</span><span class="p">,</span> <span class="s1">&#39;    &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">itemstr</span> <span class="ow">in</span> <span class="n">itemstr_list</span><span class="p">]</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trailing_sep</span><span class="p">:</span>
                <span class="n">body_str</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
            <span class="n">retstr</span> <span class="o">=</span> <span class="n">lbr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">body_str</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">rbr</span>
            <span class="k">if</span> <span class="n">align</span><span class="p">:</span>
                <span class="n">retstr</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">retstr</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">itemsep</span> <span class="k">if</span> <span class="n">with_comma</span> <span class="k">else</span> <span class="n">itemsep</span>
        <span class="c1"># hack away last trailing comma</span>
        <span class="n">sequence_str</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">)</span>
        <span class="n">retstr</span> <span class="o">=</span> <span class="n">lbr</span> <span class="o">+</span> <span class="n">sequence_str</span> <span class="o">+</span> <span class="n">rbr</span>
    <span class="c1"># Is there a way to make truncate for dict_str compatible with list_str?</span>
    <span class="k">return</span> <span class="n">retstr</span></div>


<div class="viewcode-block" id="dict_itemstr_list"><a class="viewcode-back" href="../../utool.html#utool.util_str.dict_itemstr_list">[docs]</a><span class="k">def</span> <span class="nf">dict_itemstr_list</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="o">**</span><span class="n">dictkw</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: a list of human-readable dictionary items</span>

<span class="sd">    Args:</span>
<span class="sd">        explicit : if True uses dict(key=val,...) format instead of {key:val,...}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">explicit</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;explicit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">dictkw</span><span class="p">[</span><span class="s1">&#39;explicit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">explicit</span><span class="p">)</span>

    <span class="n">dosort</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sorted_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dosort</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dosort</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">dosort</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">):</span>
        <span class="n">key_order</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key_order&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># specify order explicilty</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="c1"># catches case where keys are of different types</span>
                    <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Enforce specific key order</span>
                <span class="c1"># TODO: depricate and just use ordered dicts</span>
                <span class="n">unordered_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">other_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">unordered_keys</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">key_order</span><span class="p">)))</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="n">key_order</span> <span class="o">+</span> <span class="n">other_keys</span>
                <span class="k">return</span> <span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">iteritems</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span>

    <span class="n">_valstr</span> <span class="o">=</span> <span class="n">_make_valstr</span><span class="p">(</span><span class="o">**</span><span class="n">dictkw</span><span class="p">)</span>

    <span class="n">precision</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kvsep</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kvsep&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">explicit</span><span class="p">:</span>
        <span class="n">kvsep</span> <span class="o">=</span> <span class="s1">&#39;=&#39;</span>

    <span class="k">def</span> <span class="nf">make_item_str</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">explicit</span> <span class="ow">or</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strkeys&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">key_str</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key_str</span> <span class="o">=</span> <span class="n">repr2</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="n">key_str</span> <span class="o">+</span> <span class="n">kvsep</span>
        <span class="n">val_str</span> <span class="o">=</span> <span class="n">_valstr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="c1"># FIXME: get indentation right</span>
        <span class="k">if</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_NUMPY</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">item_str</span> <span class="o">=</span> <span class="n">hz_str</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">val_str</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># padded_indent = &#39; &#39; * min(len(indent_), len(prefix))</span>
            <span class="c1"># val_str = val_str.replace(&#39;\n&#39;, &#39;\n&#39; + padded_indent)</span>
            <span class="n">item_str</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">val_str</span>
        <span class="k">return</span> <span class="n">item_str</span>

    <span class="n">itemstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_item_str</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)]</span>

    <span class="n">reverse</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">key_order_metric</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key_order_metric&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">key_order_metric</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key_order_metric</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>
            <span class="n">key_order_metric</span> <span class="o">=</span> <span class="n">key_order_metric</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">key_order_metric</span> <span class="o">==</span> <span class="s1">&#39;strlen&#39;</span><span class="p">:</span>
        <span class="n">metric_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">itemstr</span><span class="p">)</span> <span class="k">for</span> <span class="n">itemstr</span> <span class="ow">in</span> <span class="n">itemstr_list</span><span class="p">]</span>
        <span class="n">itemstr_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">sortedby</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">,</span> <span class="n">metric_list</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">key_order_metric</span> <span class="o">==</span> <span class="s1">&#39;val&#39;</span><span class="p">:</span>
        <span class="n">metric_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)]</span>
        <span class="n">itemstr_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">sortedby</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">,</span> <span class="n">metric_list</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>

    <span class="n">maxlen</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maxlen&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">maxlen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
        <span class="n">itemstr_list</span> <span class="o">=</span> <span class="n">itemstr_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">maxlen</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">itemstr_list</span></div>


<div class="viewcode-block" id="list_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.list_str">[docs]</a><span class="k">def</span> <span class="nf">list_str</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="o">**</span><span class="n">listkw</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes a pretty list string</span>

<span class="sd">    Args:</span>
<span class="sd">        list\_ (list): input list</span>
<span class="sd">        **listkw: nl, newlines, packed, truncate, nobr, nobraces, itemsep,</span>
<span class="sd">                  trailing_sep, truncatekw, strvals, recursive,</span>
<span class="sd">                  indent\_, precision, use_numpy, with_dtype, force_dtype,</span>
<span class="sd">                  stritems, strkeys, align, explicit, sorted\_, key_order,</span>
<span class="sd">                  key_order_metric, maxlen</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: retstr</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-list_str</span>
<span class="sd">        python -m utool.util_str --exec-list_str --truncate=True</span>
<span class="sd">        python -m utool.util_str --exec-list_str --truncate=0</span>


<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; list_ = [[((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;),</span>
<span class="sd">        &gt;&gt;&gt;           ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;),</span>
<span class="sd">        &gt;&gt;&gt;           ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;),</span>
<span class="sd">        &gt;&gt;&gt;           ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;)],</span>
<span class="sd">        &gt;&gt;&gt;          [([&#39;--nodyn&#39;], 1, False, &#39;&#39;), ([&#39;--nodyn&#39;], 1, False, &#39;&#39;)]]</span>
<span class="sd">        &gt;&gt;&gt; listkw = {&#39;nl&#39;:  2}</span>
<span class="sd">        &gt;&gt;&gt; result = list_str(list_, **listkw)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [</span>
<span class="sd">            [</span>
<span class="sd">                ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;),</span>
<span class="sd">                ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;),</span>
<span class="sd">                ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;),</span>
<span class="sd">                ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;),</span>
<span class="sd">            ],</span>
<span class="sd">            [</span>
<span class="sd">                ([&#39;--nodyn&#39;], 1, False, &#39;&#39;),</span>
<span class="sd">                ([&#39;--nodyn&#39;], 1, False, &#39;&#39;),</span>
<span class="sd">            ],</span>
<span class="sd">        ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">newlines</span> <span class="o">=</span> <span class="n">listkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nl&#39;</span><span class="p">,</span> <span class="n">listkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;newlines&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">packed</span> <span class="o">=</span> <span class="n">listkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;packed&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">truncate</span> <span class="o">=</span> <span class="n">listkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;truncate&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">listkw</span><span class="p">[</span><span class="s1">&#39;nl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">newlines</span><span class="p">)</span>
    <span class="n">listkw</span><span class="p">[</span><span class="s1">&#39;truncate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">truncate</span><span class="p">)</span>
    <span class="n">listkw</span><span class="p">[</span><span class="s1">&#39;packed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">packed</span><span class="p">)</span>

    <span class="n">nobraces</span> <span class="o">=</span> <span class="n">listkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nobr&#39;</span><span class="p">,</span> <span class="n">listkw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nobraces&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

    <span class="n">itemsep</span> <span class="o">=</span> <span class="n">listkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;itemsep&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="c1"># Doesn&#39;t actually put in trailing comma if on same line</span>
    <span class="n">trailing_sep</span> <span class="o">=</span> <span class="n">listkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;trailing_sep&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">with_comma</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">itemstr_list</span> <span class="o">=</span> <span class="n">get_itemstr_list</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="o">**</span><span class="n">listkw</span><span class="p">)</span>
    <span class="n">is_tuple</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
    <span class="n">is_set</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">oset</span><span class="p">))</span>
    <span class="n">is_onetup</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">nobraces</span><span class="p">:</span>
        <span class="n">lbr</span><span class="p">,</span> <span class="n">rbr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">is_tuple</span><span class="p">:</span>
        <span class="n">lbr</span><span class="p">,</span> <span class="n">rbr</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span>
    <span class="k">elif</span> <span class="n">is_set</span><span class="p">:</span>
        <span class="n">lbr</span><span class="p">,</span> <span class="n">rbr</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lbr</span><span class="p">,</span> <span class="n">rbr</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newlines</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">newlines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="p">(</span><span class="n">newlines</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">newlines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;,</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">with_comma</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">nobraces</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trailing_sep</span><span class="p">:</span>
                <span class="n">body_str</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
            <span class="n">retstr</span> <span class="o">=</span> <span class="n">body_str</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">packed</span><span class="p">:</span>
                <span class="c1"># DEPRICATE?</span>
                <span class="n">joinstr</span> <span class="o">=</span> <span class="n">sep</span> <span class="o">+</span> <span class="n">itemsep</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbr</span><span class="p">)</span>
                <span class="n">body_str</span> <span class="o">=</span> <span class="n">joinstr</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">itemstr</span> <span class="k">for</span> <span class="n">itemstr</span> <span class="ow">in</span> <span class="n">itemstr_list</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">trailing_sep</span><span class="p">:</span>
                    <span class="n">body_str</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
                <span class="n">braced_body_str</span> <span class="o">=</span> <span class="n">lbr</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="n">body_str</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="n">rbr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">body_str</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ut</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">itemstr</span><span class="p">)</span> <span class="k">for</span> <span class="n">itemstr</span> <span class="ow">in</span> <span class="n">itemstr_list</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">trailing_sep</span><span class="p">:</span>
                    <span class="n">body_str</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
                <span class="n">braced_body_str</span> <span class="o">=</span> <span class="n">lbr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">body_str</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">rbr</span>
            <span class="n">retstr</span> <span class="o">=</span> <span class="n">braced_body_str</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">itemsep</span> <span class="k">if</span> <span class="n">with_comma</span> <span class="k">else</span> <span class="n">itemsep</span>
        <span class="n">body_str</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_onetup</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
        <span class="n">retstr</span> <span class="o">=</span> <span class="n">lbr</span> <span class="o">+</span> <span class="n">body_str</span> <span class="o">+</span> <span class="n">rbr</span>

    <span class="c1"># TODO: rectify with dict_truncate</span>
    <span class="n">do_truncate</span> <span class="o">=</span> <span class="n">truncate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="p">(</span><span class="n">truncate</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">truncate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">do_truncate</span><span class="p">:</span>
        <span class="n">truncatekw</span> <span class="o">=</span> <span class="n">listkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;truncatekw&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">retstr</span> <span class="o">=</span> <span class="n">truncate_str</span><span class="p">(</span><span class="n">retstr</span><span class="p">,</span> <span class="o">**</span><span class="n">truncatekw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">retstr</span></div>


<span class="k">def</span> <span class="nf">_make_valstr</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">stritems</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;si&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stritems&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
    <span class="n">strvals</span> <span class="o">=</span> <span class="n">stritems</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sv&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strvals&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
    <span class="n">valfunc</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span> <span class="k">if</span> <span class="n">strvals</span> <span class="k">else</span> <span class="n">reprfunc</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recursive&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">valfunc</span>

    <span class="n">indent_</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;indent_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">new_indent</span> <span class="o">=</span> <span class="n">indent_</span> <span class="o">+</span> <span class="s1">&#39;    &#39;</span>

    <span class="k">def</span> <span class="nf">recursive_valfunc</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">dict_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">indent_</span><span class="o">=</span><span class="n">new_indent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">oset</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">list_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">indent_</span><span class="o">=</span><span class="n">new_indent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_PANDAS</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">list_str</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">indent_</span><span class="o">=</span><span class="n">new_indent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_NUMPY</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_numpy&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="n">with_dtype</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;with_dtype&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">strvals</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strvals&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">precision</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">max_line_width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_line_width&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">linewidth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="n">max_line_width</span><span class="p">)</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">numpy_str</span><span class="p">(</span>
                    <span class="n">val</span><span class="p">,</span>
                    <span class="n">strvals</span><span class="o">=</span><span class="n">strvals</span><span class="p">,</span>
                    <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
                    <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                    <span class="n">with_dtype</span><span class="o">=</span><span class="n">with_dtype</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">list_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">))</span> <span class="ow">or</span> <span class="n">util_type</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">scalar_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;itemsep&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;slice(</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">,</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">valfunc</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># base case</span>
            <span class="k">return</span> <span class="n">valfunc</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">recursive_valfunc</span>


<span class="k">def</span> <span class="nf">_peek_isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">types</span><span class="p">)</span>


<div class="viewcode-block" id="get_itemstr_list"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_itemstr_list">[docs]</a><span class="k">def</span> <span class="nf">get_itemstr_list</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="o">**</span><span class="n">listkw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO: have this replace dict_itemstr list or at least most functionality in</span>
<span class="sd">    it. have it make two itemstr lists over keys and values and then combine</span>
<span class="sd">    them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">_valstr</span> <span class="o">=</span> <span class="n">_make_valstr</span><span class="p">(</span><span class="o">**</span><span class="n">listkw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_item_str</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">item_str</span> <span class="o">=</span> <span class="n">_valstr</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item_str</span>

    <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span>
    <span class="n">itemstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_item_str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>

    <span class="n">dosort</span> <span class="o">=</span> <span class="n">listkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sorted_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dosort</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Force orderings on sets.</span>
        <span class="n">dosort</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">dosort</span><span class="p">:</span>
        <span class="c1"># First try to sort items by their normal values</span>
        <span class="c1"># If that doesnt work, then sort by their string values</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Set ordering is not unique. Sort by strings values instead.</span>
            <span class="k">if</span> <span class="n">_peek_isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">Exception</span>
            <span class="n">sortx</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">argsort2</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">sortx</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">argsort2</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">)</span>
        <span class="n">itemstr_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">,</span> <span class="n">sortx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">itemstr_list</span></div>


<div class="viewcode-block" id="utf8_len"><a class="viewcode-back" href="../../utool.html#utool.util_str.utf8_len">[docs]</a><span class="k">def</span> <span class="nf">utf8_len</span><span class="p">(</span><span class="n">str_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns num printed characters in utf8</span>

<span class="sd">    Returns:</span>
<span class="sd">        http://stackoverflow.com/questions/2247205/python-returning-the-wrong-length-of-string-when-using-special-characters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">unicodedata</span>

    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFC&#39;</span><span class="p">,</span> <span class="n">ensure_unicode</span><span class="p">(</span><span class="n">str_</span><span class="p">)))</span></div>


<div class="viewcode-block" id="horiz_string"><a class="viewcode-back" href="../../utool.html#utool.util_str.horiz_string">[docs]</a><span class="k">def</span> <span class="nf">horiz_string</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Horizontally concatenates strings reprs preserving indentation</span>

<span class="sd">    Concats a list of objects ensuring that the next item in the list</span>
<span class="sd">    is all the way to the right of any previous items.</span>

<span class="sd">    Args:</span>
<span class="sd">        *args: list of strings to concat</span>
<span class="sd">        **kwargs: precision, sep</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-horiz_string</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # Pretty printing of matrices demo / test</span>
<span class="sd">        &gt;&gt;&gt; import utool</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; # Wouldn&#39;t it be nice if we could print this operation easily?</span>
<span class="sd">        &gt;&gt;&gt; B = np.array(((1, 2), (3, 4)))</span>
<span class="sd">        &gt;&gt;&gt; C = np.array(((5, 6), (7, 8)))</span>
<span class="sd">        &gt;&gt;&gt; A = B.dot(C)</span>
<span class="sd">        &gt;&gt;&gt; # Eg 1:</span>
<span class="sd">        &gt;&gt;&gt; result = (utool.hz_str(&#39;A = &#39;, A, &#39; = &#39;, B, &#39; * &#39;, C))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        A = [[19 22]  = [[1 2]  * [[5 6]</span>
<span class="sd">             [43 50]]    [3 4]]    [7 8]]</span>

<span class="sd">    Exam2:</span>
<span class="sd">        &gt;&gt;&gt; # Eg 2:</span>
<span class="sd">        &gt;&gt;&gt; str_list = [&#39;A = &#39;, str(B), &#39; * &#39;, str(C)]</span>
<span class="sd">        &gt;&gt;&gt; horizstr = (utool.horiz_string(*str_list))</span>
<span class="sd">        &gt;&gt;&gt; result = (horizstr)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        A = [[1 2]  * [[5 6]</span>
<span class="sd">             [3 4]]    [7 8]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">unicodedata</span>

    <span class="n">precision</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sep&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="n">args</span>

    <span class="n">val_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFC&#39;</span><span class="p">,</span> <span class="n">ensure_unicode</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">val_list</span><span class="p">]</span>
    <span class="n">all_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hpos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># for each value in the list or args</span>
    <span class="k">for</span> <span class="n">sx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val_list</span><span class="p">)):</span>
        <span class="c1"># Ensure value is a string</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">val_list</span><span class="p">[</span><span class="n">sx</span><span class="p">]</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Hack in numpy precision</span>
            <span class="k">if</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_NUMPY</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                        <span class="n">str_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">suppress_small</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">if</span> <span class="n">str_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">str_</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">val_list</span><span class="p">[</span><span class="n">sx</span><span class="p">])</span>
        <span class="c1"># continue with formating</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">str_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">line_diff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_lines</span><span class="p">)</span>
        <span class="c1"># Vertical padding</span>
        <span class="k">if</span> <span class="n">line_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">all_lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">hpos</span><span class="p">]</span> <span class="o">*</span> <span class="n">line_diff</span>
        <span class="c1"># Add strings</span>
        <span class="k">for</span> <span class="n">lx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">all_lines</span><span class="p">[</span><span class="n">lx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">line</span>
            <span class="n">hpos</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">hpos</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_lines</span><span class="p">[</span><span class="n">lx</span><span class="p">]))</span>
        <span class="c1"># Horizontal padding</span>
        <span class="k">for</span> <span class="n">lx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_lines</span><span class="p">)):</span>
            <span class="n">hpos_diff</span> <span class="o">=</span> <span class="n">hpos</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_lines</span><span class="p">[</span><span class="n">lx</span><span class="p">])</span>
            <span class="n">all_lines</span><span class="p">[</span><span class="n">lx</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">hpos_diff</span> <span class="o">+</span> <span class="n">sep</span>
    <span class="n">all_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">all_lines</span><span class="p">]</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">all_lines</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<span class="c1"># Alias</span>
<span class="n">hz_str</span> <span class="o">=</span> <span class="n">horiz_string</span>


<div class="viewcode-block" id="str_between"><a class="viewcode-back" href="../../utool.html#utool.util_str.str_between">[docs]</a><span class="k">def</span> <span class="nf">str_between</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">startstr</span><span class="p">,</span> <span class="n">endstr</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    gets substring between two sentianl strings</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; str_ = &#39;\n        INSERT INTO vsone(\n&#39;</span>
<span class="sd">        &gt;&gt;&gt; startstr = &#39;INSERT&#39;</span>
<span class="sd">        &gt;&gt;&gt; endstr = &#39;(&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = str_between(str_, startstr, endstr)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">startstr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">startpos</span> <span class="o">=</span> <span class="n">str_</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">startstr</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">startstr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">endstr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">endpos</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">endpos</span> <span class="o">=</span> <span class="n">str_</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">endstr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">endpos</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">endpos</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">newstr</span> <span class="o">=</span> <span class="n">str_</span><span class="p">[</span><span class="n">startpos</span><span class="p">:</span><span class="n">endpos</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">newstr</span></div>


<div class="viewcode-block" id="get_callable_name"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_callable_name">[docs]</a><span class="k">def</span> <span class="nf">get_callable_name</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Works on must functionlike objects including str, which has no func_name</span>

<span class="sd">    Args:</span>
<span class="sd">        func (function):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str:</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-get_callable_name</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; func = len</span>
<span class="sd">        &gt;&gt;&gt; result = get_callable_name(func)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        len</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">meta_util_six</span><span class="o">.</span><span class="n">get_funcname</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;type &#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&gt;&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;cannot get func_name of func=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="s1">&#39;type(func)=</span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="align"><a class="viewcode-back" href="../../utool.html#utool.util_str.align">[docs]</a><span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">replchar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Left justifies text on the left side of character</span>

<span class="sd">    align</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to align</span>
<span class="sd">        character (str): character to align at</span>
<span class="sd">        replchar (str): replacement character (default=None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: new_text</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-align:0</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; character = &#39;=&#39;</span>
<span class="sd">        &gt;&gt;&gt; text = &#39;a = b=\none = two\nthree = fish\n&#39;</span>
<span class="sd">        &gt;&gt;&gt; print(text)</span>
<span class="sd">        &gt;&gt;&gt; result = (align(text, &#39;=&#39;))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        a     = b=</span>
<span class="sd">        one   = two</span>
<span class="sd">        three = fish</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line_list</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">new_lines</span> <span class="o">=</span> <span class="n">align_lines</span><span class="p">(</span><span class="n">line_list</span><span class="p">,</span> <span class="n">character</span><span class="p">,</span> <span class="n">replchar</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_lines</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_text</span></div>


<div class="viewcode-block" id="align_lines"><a class="viewcode-back" href="../../utool.html#utool.util_str.align_lines">[docs]</a><span class="k">def</span> <span class="nf">align_lines</span><span class="p">(</span><span class="n">line_list</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">replchar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Left justifies text on the left side of character</span>

<span class="sd">    align_lines</span>

<span class="sd">    TODO:</span>
<span class="sd">        clean up and move to ubelt?</span>

<span class="sd">    Args:</span>
<span class="sd">        line_list (list of strs):</span>
<span class="sd">        character (str):</span>
<span class="sd">        pos (int or list or None): does one alignment for all chars beyond this</span>
<span class="sd">            column position. If pos is None, then all chars are aligned.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: new_lines</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-align_lines:0</span>
<span class="sd">        python -m utool.util_str --test-align_lines:1</span>
<span class="sd">        python -m utool.util_str --test-align_lines:2</span>
<span class="sd">        python -m utool.util_str --test-align_lines:3</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; line_list = &#39;a = b\none = two\nthree = fish&#39;.split(&#39;\n&#39;)</span>
<span class="sd">        &gt;&gt;&gt; character = &#39;=&#39;</span>
<span class="sd">        &gt;&gt;&gt; new_lines = align_lines(line_list, character)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;\n&#39;.join(new_lines))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        a     = b</span>
<span class="sd">        one   = two</span>
<span class="sd">        three = fish</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; line_list = &#39;foofish:\n    a = b\n    one    = two\n    three    = fish&#39;.split(&#39;\n&#39;)</span>
<span class="sd">        &gt;&gt;&gt; character = &#39;=&#39;</span>
<span class="sd">        &gt;&gt;&gt; new_lines = align_lines(line_list, character)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;\n&#39;.join(new_lines))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        foofish:</span>
<span class="sd">            a        = b</span>
<span class="sd">            one      = two</span>
<span class="sd">            three    = fish</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; character = &#39;:&#39;</span>
<span class="sd">        &gt;&gt;&gt; text = ut.codeblock(&#39;&#39;&#39;</span>
<span class="sd">            {&#39;max&#39;: &#39;1970/01/01 02:30:13&#39;,</span>
<span class="sd">             &#39;mean&#39;: &#39;1970/01/01 01:10:15&#39;,</span>
<span class="sd">             &#39;min&#39;: &#39;1970/01/01 00:01:41&#39;,</span>
<span class="sd">             &#39;range&#39;: &#39;2:28:32&#39;,</span>
<span class="sd">             &#39;std&#39;: &#39;1:13:57&#39;,}&#39;&#39;&#39;).split(&#39;\n&#39;)</span>
<span class="sd">        &gt;&gt;&gt; new_lines = align_lines(text, &#39;:&#39;, &#39; :&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = &#39;\n&#39;.join(new_lines)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;max&#39;   : &#39;1970/01/01 02:30:13&#39;,</span>
<span class="sd">         &#39;mean&#39;  : &#39;1970/01/01 01:10:15&#39;,</span>
<span class="sd">         &#39;min&#39;   : &#39;1970/01/01 00:01:41&#39;,</span>
<span class="sd">         &#39;range&#39; : &#39;2:28:32&#39;,</span>
<span class="sd">         &#39;std&#39;   : &#39;1:13:57&#39;,}</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; line_list = &#39;foofish:\n a = b = c\n one = two = three\nthree=4= fish&#39;.split(&#39;\n&#39;)</span>
<span class="sd">        &gt;&gt;&gt; character = &#39;=&#39;</span>
<span class="sd">        &gt;&gt;&gt; # align the second occurence of a character</span>
<span class="sd">        &gt;&gt;&gt; new_lines = align_lines(line_list, character, pos=None)</span>
<span class="sd">        &gt;&gt;&gt; print((&#39;\n&#39;.join(line_list)))</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;\n&#39;.join(new_lines))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        foofish:</span>
<span class="sd">         a   = b   = c</span>
<span class="sd">         one = two = three</span>
<span class="sd">        three=4    = fish</span>

<span class="sd">    Ignore:</span>
<span class="sd">        # use this as test case</span>
<span class="sd">        \begin{tabular}{lrrll}</span>
<span class="sd">        \toprule</span>
<span class="sd">        {} &amp;  Names &amp;  Annots &amp; Annots size &amp; Training Edges \\</span>
<span class="sd">        \midrule</span>
<span class="sd">        training &amp;    390 &amp;    1164 &amp;   2.98\pm2.83 &amp;           9360 \\</span>
<span class="sd">        testing  &amp;    363 &amp;    1119 &amp;   3.08\pm2.82 &amp;              - \\</span>
<span class="sd">        \bottomrule</span>
<span class="sd">        \end{tabular}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># FIXME: continue to fix ansi</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Align all occurences</span>
        <span class="n">num_pos</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">character</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">])</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_pos</span><span class="p">))</span>

    <span class="c1"># Allow multiple alignments</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">pos_list</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="c1"># recursive calls</span>
        <span class="n">new_lines</span> <span class="o">=</span> <span class="n">line_list</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">pos_list</span><span class="p">:</span>
            <span class="n">new_lines</span> <span class="o">=</span> <span class="n">align_lines</span><span class="p">(</span>
                <span class="n">new_lines</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="n">character</span><span class="p">,</span> <span class="n">replchar</span><span class="o">=</span><span class="n">replchar</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_lines</span>

    <span class="c1"># base case</span>
    <span class="k">if</span> <span class="n">replchar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">replchar</span> <span class="o">=</span> <span class="n">character</span>

    <span class="c1"># the pos-th character to align</span>
    <span class="n">lpos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">rpos</span> <span class="o">=</span> <span class="n">lpos</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">tup_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">character</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">]</span>

    <span class="n">handle_ansi</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">handle_ansi</span><span class="p">:</span>
        <span class="c1"># Remove ansi from length calculation</span>
        <span class="c1"># References: http://stackoverflow.com/questions/14693701remove-ansi</span>
        <span class="n">ansi_escape</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\x1b[^m]*m&#39;</span><span class="p">)</span>

    <span class="c1"># Find how much padding is needed</span>
    <span class="n">maxlen</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">tup_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">rpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">handle_ansi</span><span class="p">:</span>
                <span class="n">tup</span> <span class="o">=</span> <span class="p">[</span><span class="n">ansi_escape</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tup</span><span class="p">]</span>
            <span class="n">left_lenlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">rpos</span><span class="p">]))</span>
            <span class="n">left_len</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">left_lenlist</span><span class="p">)</span> <span class="o">+</span> <span class="n">lpos</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">replchar</span><span class="p">)</span>
            <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="n">left_len</span><span class="p">)</span>

    <span class="c1"># Pad each line to align the pos-th occurence of the chosen character</span>
    <span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">tup_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">rpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lhs</span> <span class="o">=</span> <span class="n">character</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">rpos</span><span class="p">])</span>
            <span class="n">rhs</span> <span class="o">=</span> <span class="n">character</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="n">rpos</span><span class="p">:])</span>
            <span class="c1"># pad the new line with requested justification</span>
            <span class="n">newline</span> <span class="o">=</span> <span class="n">lhs</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">maxlen</span><span class="p">)</span> <span class="o">+</span> <span class="n">replchar</span> <span class="o">+</span> <span class="n">rhs</span>
            <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newline</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">replchar</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tup</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">new_lines</span></div>


<div class="viewcode-block" id="strip_ansi"><a class="viewcode-back" href="../../utool.html#utool.util_str.strip_ansi">[docs]</a><span class="k">def</span> <span class="nf">strip_ansi</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes all ansi directives from the string</span>
<span class="sd">    Helper to remove ansi from length calculation</span>
<span class="sd">    References: http://stackoverflow.com/questions/14693701remove-ansi</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ansi_escape</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\x1b[^m]*m&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ansi_escape</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span></div>


<span class="c1"># FIXME: HASHLEN is a global var in util_hash</span>
<div class="viewcode-block" id="long_fname_format"><a class="viewcode-back" href="../../utool.html#utool.util_str.long_fname_format">[docs]</a><span class="k">def</span> <span class="nf">long_fname_format</span><span class="p">(</span>
    <span class="n">fmt_str</span><span class="p">,</span>
    <span class="n">fmt_dict</span><span class="p">,</span>
    <span class="n">hashable_keys</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">max_len</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">hashlen</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
    <span class="n">ABS_MAX_LEN</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
    <span class="n">hack27</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DEPRICATE</span>

<span class="sd">    Formats a string and hashes certain parts if the resulting string becomes</span>
<span class="sd">    too long. Used for making filenames fit onto disk.</span>

<span class="sd">    Args:</span>
<span class="sd">        fmt_str (str): format of fname</span>
<span class="sd">        fmt_dict (str): dict to format fname with</span>
<span class="sd">        hashable_keys (list): list of dict keys you are willing to have hashed</span>
<span class="sd">        max_len (int): tries to fit fname into this length</span>
<span class="sd">        ABS_MAX_LEN (int): throws AssertionError if fname over this length</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-long_fname_format</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTET</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; fmt_str = &#39;qaid={qaid}_res_{cfgstr}_quuid={quuid}&#39;</span>
<span class="sd">        &gt;&gt;&gt; quuid_str = &#39;blahblahblahblahblahblah&#39;</span>
<span class="sd">        &gt;&gt;&gt; cfgstr = &#39;big_long_string__________________________________&#39;</span>
<span class="sd">        &gt;&gt;&gt; qaid = 5</span>
<span class="sd">        &gt;&gt;&gt; fmt_dict = dict(cfgstr=cfgstr, qaid=qaid, quuid=quuid_str)</span>
<span class="sd">        &gt;&gt;&gt; hashable_keys = [&#39;cfgstr&#39;, &#39;quuid&#39;]</span>
<span class="sd">        &gt;&gt;&gt; max_len = 64</span>
<span class="sd">        &gt;&gt;&gt; hashlen = 8</span>
<span class="sd">        &gt;&gt;&gt; fname0 = ut.long_fname_format(fmt_str, fmt_dict, max_len=None)</span>
<span class="sd">        &gt;&gt;&gt; fname1 = ut.long_fname_format(fmt_str, fmt_dict, hashable_keys,</span>
<span class="sd">        &gt;&gt;&gt;                                  max_len=64, hashlen=8)</span>
<span class="sd">        &gt;&gt;&gt; fname2 = ut.long_fname_format(fmt_str, fmt_dict, hashable_keys, max_len=42,</span>
<span class="sd">        &gt;&gt;&gt;                         hashlen=8)</span>
<span class="sd">        &gt;&gt;&gt; result = fname0 + &#39;\n&#39; + fname1 + &#39;\n&#39; + fname2</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        qaid=5_res_big_long_string___________________________________quuid=blahblahblahblahblahblah</span>
<span class="sd">        qaid=5_res_racfntgq_quuid=blahblahblahblahblahblah</span>
<span class="sd">        qaid=5_res_racfntgq_quuid=yvuaffrp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_hash</span>

    <span class="n">fname</span> <span class="o">=</span> <span class="n">fmt_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">fmt_dict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_len</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fname</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">:</span>
        <span class="c1"># Copy because we will overwrite fmt_dict values with hashed values</span>
        <span class="n">fmt_dict_</span> <span class="o">=</span> <span class="n">fmt_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">hashable_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hack27</span><span class="p">:</span>
                <span class="n">fmt_dict_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">util_hash</span><span class="o">.</span><span class="n">hashstr27</span><span class="p">(</span><span class="n">fmt_dict_</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">hashlen</span><span class="o">=</span><span class="n">hashlen</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmt_dict_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">util_hash</span><span class="o">.</span><span class="n">hashstr</span><span class="p">(</span><span class="n">fmt_dict_</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">hashlen</span><span class="o">=</span><span class="n">hashlen</span><span class="p">)</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">fmt_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">fmt_dict_</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_len</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">:</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">-</span> <span class="n">max_len</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;[util_str] Warning: Too big by </span><span class="si">%d</span><span class="s1"> chars. Exausted all options&#39;</span>
                <span class="s1">&#39;to make fname fit into size. &#39;</span>
            <span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">diff</span><span class="p">,)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* len(fname) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* fname = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ABS_MAX_LEN</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">ABS_MAX_LEN</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="multi_replace"><a class="viewcode-back" href="../../utool.html#utool.util_str.multi_replace">[docs]</a><span class="k">def</span> <span class="nf">multi_replace</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">search_list</span><span class="p">,</span> <span class="n">repl_list</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs multiple replace functions foreach item in search_list and</span>
<span class="sd">    repl_list.</span>

<span class="sd">    Args:</span>
<span class="sd">        str\_ (str): string to search</span>
<span class="sd">        search_list (list): list of search strings</span>
<span class="sd">        repl_list (list or str): one or multiple replace strings</span>

<span class="sd">    Returns:</span>
<span class="sd">        str</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-multi_replace</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; str_ = &#39;foo. bar: baz; spam-eggs --- eggs+spam&#39;</span>
<span class="sd">        &gt;&gt;&gt; search_list = [&#39;.&#39;, &#39;:&#39;, &#39;---&#39;]</span>
<span class="sd">        &gt;&gt;&gt; repl_list = &#39;@&#39;</span>
<span class="sd">        &gt;&gt;&gt; str_ = multi_replace(str_, search_list, repl_list)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;str_ = %s&#39; % (str(str_),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        str_ = foo@ bar@ baz; spam-eggs @ eggs+spam</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">repl_list</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">repl_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">repl_list</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">repl_list_</span> <span class="o">=</span> <span class="n">repl_list</span>
    <span class="n">newstr</span> <span class="o">=</span> <span class="n">str_</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">repl_list_</span><span class="p">),</span> <span class="s1">&#39;bad lens&#39;</span>
    <span class="k">for</span> <span class="n">search</span><span class="p">,</span> <span class="n">repl</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">search_list</span><span class="p">,</span> <span class="n">repl_list_</span><span class="p">):</span>
        <span class="n">newstr</span> <span class="o">=</span> <span class="n">newstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">repl</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newstr</span></div>


<div class="viewcode-block" id="pluralize"><a class="viewcode-back" href="../../utool.html#utool.util_str.pluralize">[docs]</a><span class="k">def</span> <span class="nf">pluralize</span><span class="p">(</span><span class="n">wordtext</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">plural_suffix</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Heuristically changes a word to its plural form if `num` is not 1</span>

<span class="sd">    Args:</span>
<span class="sd">        wordtext (str): word in singular form</span>
<span class="sd">        num (int): a length of an associated list if applicable (default = 2)</span>
<span class="sd">        plural_suffix (str): heurstic plural form (default = &#39;s&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: pluralized form. Can handle some genitive cases</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str pluralize</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; wordtext = &#39;foo&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = pluralize(wordtext)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        foos</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wordtext</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">wordtext</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;&#39;s&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">wordtext</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;s&#39;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wordtext</span> <span class="o">+</span> <span class="n">plural_suffix</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">wordtext</span> <span class="o">+</span> <span class="n">plural_suffix</span><span class="p">)</span> <span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">wordtext</span></div>


<div class="viewcode-block" id="quantstr"><a class="viewcode-back" href="../../utool.html#utool.util_str.quantstr">[docs]</a><span class="k">def</span> <span class="nf">quantstr</span><span class="p">(</span><span class="n">typestr</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">plural_suffix</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Heuristically generates an english phrase relating to the quantity of</span>
<span class="sd">    something.  This is useful for writing user messages.</span>

<span class="sd">    Args:</span>
<span class="sd">        typestr (str): singular form of the word</span>
<span class="sd">        num (int): quanity of the type</span>
<span class="sd">        plural_suffix (str): heurstic plural form (default = &#39;s&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: quantity phrase</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str quantity_str</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; items = [1, 2, 3]</span>
<span class="sd">        &gt;&gt;&gt; result = &#39;The list contains &#39; + (quantstr(&#39;item&#39;, len(items)))</span>
<span class="sd">        &gt;&gt;&gt; items = [1]</span>
<span class="sd">        &gt;&gt;&gt; result += &#39;\nThe list contains &#39; + (quantstr(&#39;item&#39;, len(items)))</span>
<span class="sd">        &gt;&gt;&gt; items = []</span>
<span class="sd">        &gt;&gt;&gt; result += &#39;\nThe list contains &#39; + (quantstr(&#39;item&#39;, len(items)))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        The list contains 3 items</span>
<span class="sd">        The list contains 1 item</span>
<span class="sd">        The list contains 0 items</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">pluralize</span><span class="p">(</span><span class="n">typestr</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">plural_suffix</span><span class="p">)</span></div>


<div class="viewcode-block" id="msgblock"><a class="viewcode-back" href="../../utool.html#utool.util_str.msgblock">[docs]</a><span class="k">def</span> <span class="nf">msgblock</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;puts text inside a visual ascii block&quot;&quot;&quot;</span>
    <span class="n">blocked_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39; + --- &#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39; ---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="o">+</span> <span class="p">[</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">side</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]</span>
        <span class="o">+</span> <span class="p">[</span><span class="s1">&#39; L ___ &#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39; ___</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">blocked_text</span></div>


<div class="viewcode-block" id="number_text_lines"><a class="viewcode-back" href="../../utool.html#utool.util_str.number_text_lines">[docs]</a><span class="k">def</span> <span class="nf">number_text_lines</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        text (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: text_with_lineno - string with numbered lines</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">numbered_linelist</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(((</span><span class="s1">&#39;</span><span class="si">%2d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="s1">&#39; &gt;&gt;&gt; &#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
    <span class="p">]</span>
    <span class="n">text_with_lineno</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">numbered_linelist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text_with_lineno</span></div>


<div class="viewcode-block" id="get_textdiff"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_textdiff">[docs]</a><span class="k">def</span> <span class="nf">get_textdiff</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">num_context_lines</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_whitespace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses difflib to return a difference string between two similar texts</span>

<span class="sd">    Args:</span>
<span class="sd">        text1 (str):</span>
<span class="sd">        text2 (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: formatted difference text message</span>

<span class="sd">    SeeAlso:</span>
<span class="sd">        ut.color_diff_text</span>

<span class="sd">    References:</span>
<span class="sd">        http://www.java2s.com/Code/Python/Utility/IntelligentdiffbetweentextfilesTimPeters.htm</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-get_textdiff:1</span>
<span class="sd">        python -m utool.util_str --test-get_textdiff:0</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; text1 = &#39;one\ntwo\nthree&#39;</span>
<span class="sd">        &gt;&gt;&gt; text2 = &#39;one\ntwo\nfive&#39;</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; result = get_textdiff(text1, text2)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        - three</span>
<span class="sd">        + five</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; text1 = &#39;one\ntwo\nthree\n3.1\n3.14\n3.1415\npi\n3.4\n3.5\n4&#39;</span>
<span class="sd">        &gt;&gt;&gt; text2 = &#39;one\ntwo\nfive\n3.1\n3.14\n3.1415\npi\n3.4\n4&#39;</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; num_context_lines = 1</span>
<span class="sd">        &gt;&gt;&gt; result = get_textdiff(text1, text2, num_context_lines)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">difflib</span>

    <span class="n">text1</span> <span class="o">=</span> <span class="n">ensure_unicode</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
    <span class="n">text2</span> <span class="o">=</span> <span class="n">ensure_unicode</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
    <span class="n">text1_lines</span> <span class="o">=</span> <span class="n">text1</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">text2_lines</span> <span class="o">=</span> <span class="n">text2</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ignore_whitespace</span><span class="p">:</span>
        <span class="n">text1_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">text1_lines</span><span class="p">]</span>
        <span class="n">text2_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">text2_lines</span><span class="p">]</span>
        <span class="n">ndiff_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">linejunk</span><span class="o">=</span><span class="n">difflib</span><span class="o">.</span><span class="n">IS_LINE_JUNK</span><span class="p">,</span> <span class="n">charjunk</span><span class="o">=</span><span class="n">difflib</span><span class="o">.</span><span class="n">IS_CHARACTER_JUNK</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ndiff_kw</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">all_diff_lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">text1_lines</span><span class="p">,</span> <span class="n">text2_lines</span><span class="p">,</span> <span class="o">**</span><span class="n">ndiff_kw</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">num_context_lines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">diff_lines</span> <span class="o">=</span> <span class="n">all_diff_lines</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_list</span>

        <span class="c1"># boolean for every line if it is marked or not</span>
        <span class="n">ismarked_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;+-?&#39;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">all_diff_lines</span><span class="p">]</span>
        <span class="c1"># flag lines that are within num_context_lines away from a diff line</span>
        <span class="n">isvalid_list</span> <span class="o">=</span> <span class="n">ismarked_list</span><span class="p">[:]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_context_lines</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">isvalid_list</span><span class="p">[:</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">util_list</span><span class="o">.</span><span class="n">or_lists</span><span class="p">(</span><span class="n">isvalid_list</span><span class="p">[:</span><span class="o">-</span><span class="n">i</span><span class="p">],</span> <span class="n">ismarked_list</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
            <span class="n">isvalid_list</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span> <span class="o">=</span> <span class="n">util_list</span><span class="o">.</span><span class="n">or_lists</span><span class="p">(</span><span class="n">isvalid_list</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="n">ismarked_list</span><span class="p">[:</span><span class="o">-</span><span class="n">i</span><span class="p">])</span>
        <span class="n">USE_BREAK_LINE</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">USE_BREAK_LINE</span><span class="p">:</span>
            <span class="c1"># insert a visual break when there is a break in context</span>
            <span class="n">diff_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">visual_break</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> &lt;... FILTERED CONTEXT ...&gt; </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="c1"># print(isvalid_list)</span>
            <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">valid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_diff_lines</span><span class="p">,</span> <span class="n">isvalid_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
                    <span class="n">diff_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">prev</span><span class="p">:</span>
                    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">diff_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">visual_break</span><span class="p">)</span>
                <span class="n">prev</span> <span class="o">=</span> <span class="n">valid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">diff_lines</span> <span class="o">=</span> <span class="n">util_list</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">all_diff_lines</span><span class="p">,</span> <span class="n">isvalid_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff_lines</span><span class="p">)</span></div>


<span class="n">difftext</span> <span class="o">=</span> <span class="n">get_textdiff</span>


<div class="viewcode-block" id="conj_phrase"><a class="viewcode-back" href="../../utool.html#utool.util_str.conj_phrase">[docs]</a><span class="k">def</span> <span class="nf">conj_phrase</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">cond</span><span class="o">=</span><span class="s1">&#39;or&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Joins a list of words using English conjunction rules</span>

<span class="sd">    Args:</span>
<span class="sd">        list\_ (list):  of strings</span>
<span class="sd">        cond (str): a conjunction (or, and, but)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: the joined cconjunction phrase</span>

<span class="sd">    References:</span>
<span class="sd">        http://en.wikipedia.org/wiki/Conjunction_(grammar)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; list_ = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">        &gt;&gt;&gt; result = conj_phrase(list_, &#39;or&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        a, b, or c</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; list_ = [&#39;a&#39;, &#39;b&#39;]</span>
<span class="sd">        &gt;&gt;&gt; result = conj_phrase(list_, &#39;and&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        a and b</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">list_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">list_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cond</span><span class="p">,</span> <span class="n">list_</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">condstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">cond</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">condstr</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])))</span></div>


<div class="viewcode-block" id="doctest_code_line"><a class="viewcode-back" href="../../utool.html#utool.util_str.doctest_code_line">[docs]</a><span class="k">def</span> <span class="nf">doctest_code_line</span><span class="p">(</span><span class="n">line_str</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">varprefix</span> <span class="o">=</span> <span class="n">varname</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span> <span class="k">if</span> <span class="n">varname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
    <span class="n">prefix1</span> <span class="o">=</span> <span class="s1">&#39;&gt;&gt;&gt; &#39;</span> <span class="o">+</span> <span class="n">varprefix</span>
    <span class="n">prefix2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">... &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">varprefix</span><span class="p">))</span>
    <span class="n">doctest_line_str</span> <span class="o">=</span> <span class="n">prefix1</span> <span class="o">+</span> <span class="n">prefix2</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">doctest_line_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">doctest_line_str</span></div>


<div class="viewcode-block" id="doctest_repr"><a class="viewcode-back" href="../../utool.html#utool.util_str.doctest_repr">[docs]</a><span class="k">def</span> <span class="nf">doctest_repr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">varname_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_varname_from_stack</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">varname</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">varname</span>
    <span class="k">if</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_NUMPY</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">line_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">numpy_str</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">suppress_small</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_str</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="n">doctest_line_str</span> <span class="o">=</span> <span class="n">doctest_code_line</span><span class="p">(</span><span class="n">line_str</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="n">varname_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">doctest_line_str</span></div>


<div class="viewcode-block" id="format_text_as_docstr"><a class="viewcode-back" href="../../utool.html#utool.util_str.format_text_as_docstr">[docs]</a><span class="k">def</span> <span class="nf">format_text_as_docstr</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python  ~/local/vim/rc/pyvim_funcs.py  --test-format_text_as_docstr</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from pyvim_funcs import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; text = testdata_text()</span>
<span class="sd">        &gt;&gt;&gt; formated_text = format_text_as_docstr(text)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;formated_text = \n%s&#39; % (str(formated_text),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
    <span class="kn">import</span> <span class="nn">re</span>

    <span class="n">min_indent</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_minimum_indentation</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">indent_</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">min_indent</span>
    <span class="n">formated_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="n">indent_</span><span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="n">indent_</span> <span class="o">+</span> <span class="s1">&#39;&gt;&gt;&gt; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="n">formated_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
        <span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="n">indent_</span> <span class="o">+</span> <span class="s1">&#39;&gt;&gt;&gt; #&#39;</span><span class="p">,</span> <span class="n">formated_text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">formated_text</span></div>


<div class="viewcode-block" id="unformat_text_as_docstr"><a class="viewcode-back" href="../../utool.html#utool.util_str.unformat_text_as_docstr">[docs]</a><span class="k">def</span> <span class="nf">unformat_text_as_docstr</span><span class="p">(</span><span class="n">formated_text</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python  ~/local/vim/rc/pyvim_funcs.py  --test-unformat_text_as_docstr</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from pyvim_funcs import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; text = testdata_text()</span>
<span class="sd">        &gt;&gt;&gt; formated_text = format_text_as_docstr(text)</span>
<span class="sd">        &gt;&gt;&gt; unformated_text = unformat_text_as_docstr(formated_text)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;unformated_text = \n%s&#39; % (str(unformated_text),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
    <span class="kn">import</span> <span class="nn">re</span>

    <span class="n">min_indent</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_minimum_indentation</span><span class="p">(</span><span class="n">formated_text</span><span class="p">)</span>
    <span class="n">indent_</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">min_indent</span>
    <span class="n">unformated_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
        <span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="n">indent_</span> <span class="o">+</span> <span class="s1">&#39;&gt;&gt;&gt; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="n">indent_</span><span class="p">,</span> <span class="n">formated_text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">unformated_text</span></div>


<div class="viewcode-block" id="lorium_ipsum"><a class="viewcode-back" href="../../utool.html#utool.util_str.lorium_ipsum">[docs]</a><span class="k">def</span> <span class="nf">lorium_ipsum</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Standard testing string&quot;&quot;&quot;</span>
    <span class="n">ipsum_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed</span>
<span class="s2">    do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad</span>
<span class="s2">    minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex</span>
<span class="s2">    ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate</span>
<span class="s2">    velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat</span>
<span class="s2">    cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id</span>
<span class="s2">    est laborum.</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ipsum_str</span></div>


<div class="viewcode-block" id="bubbletext"><a class="viewcode-back" href="../../utool.html#utool.util_str.bubbletext">[docs]</a><span class="k">def</span> <span class="nf">bubbletext</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s1">&#39;cybermedium&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses pyfiglet to create bubble text.</span>

<span class="sd">    Args:</span>
<span class="sd">        font (str): default=cybermedium, other fonts include: cybersmall and</span>
<span class="sd">            cyberlarge.</span>

<span class="sd">    References:</span>
<span class="sd">        http://www.figlet.org/</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; bubble_text = ut.bubbletext(&#39;TESTING BUBBLE TEXT&#39;, font=&#39;cybermedium&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(bubble_text)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">pyfiglet</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">tryimport</span><span class="p">(</span><span class="s1">&#39;pyfiglet&#39;</span><span class="p">,</span> <span class="s1">&#39;git+https://github.com/pwaller/pyfiglet&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pyfiglet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bubble_text</span> <span class="o">=</span> <span class="n">pyfiglet</span><span class="o">.</span><span class="n">figlet_format</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bubble_text</span></div>


<div class="viewcode-block" id="closet_words"><a class="viewcode-back" href="../../utool.html#utool.util_str.closet_words">[docs]</a><span class="k">def</span> <span class="nf">closet_words</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">ranked_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">subset</span><span class="p">:</span>
        <span class="n">query_</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">superset</span> <span class="o">=</span> <span class="p">[</span><span class="n">opt</span> <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">options</span> <span class="k">if</span> <span class="n">query_</span> <span class="ow">in</span> <span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="n">ranked_list</span> <span class="o">=</span> <span class="n">superset</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">num</span><span class="p">]</span>
        <span class="n">num</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ranked_list</span><span class="p">)</span>
    <span class="n">dist_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">edit_distance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="n">ranked_list</span> <span class="o">=</span> <span class="n">ranked_list</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">sortedby</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">dist_list</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">num</span><span class="p">]</span>
    <span class="n">ranked_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ranked_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ranked_list</span></div>


<div class="viewcode-block" id="to_title_caps"><a class="viewcode-back" href="../../utool.html#utool.util_str.to_title_caps">[docs]</a><span class="k">def</span> <span class="nf">to_title_caps</span><span class="p">(</span><span class="n">underscore_case</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        underscore_case (?):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: title_str</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-to_title_caps</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; underscore_case = &#39;the_foo_bar_func&#39;</span>
<span class="sd">        &gt;&gt;&gt; title_str = to_title_caps(underscore_case)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;title_str = %s&#39; % (str(title_str),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        title_str = The Foo Bar Func</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">underscore_case</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">words2</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">)]</span>
    <span class="n">title_str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">title_str</span></div>


<div class="viewcode-block" id="to_underscore_case"><a class="viewcode-back" href="../../utool.html#utool.util_str.to_underscore_case">[docs]</a><span class="k">def</span> <span class="nf">to_underscore_case</span><span class="p">(</span><span class="n">camelcase_str</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/1175208/convert-camelcase</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; camelcase_str = &#39;UnderscoreFuncname&#39;</span>
<span class="sd">        &gt;&gt;&gt; camel_case_str = to_underscore_case(camelcase_str)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;underscore_str = %s&#39; % (str(camel_case_str),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        underscore_str = underscore_funcname</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;(.)([A-Z][a-z]+)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1_\2&#39;</span><span class="p">,</span> <span class="n">camelcase_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;([a-z0-9])([A-Z])&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1_\2&#39;</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span></div>


<div class="viewcode-block" id="to_camel_case"><a class="viewcode-back" href="../../utool.html#utool.util_str.to_camel_case">[docs]</a><span class="k">def</span> <span class="nf">to_camel_case</span><span class="p">(</span><span class="n">underscore_case</span><span class="p">,</span> <span class="n">mixed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        underscore_case (?):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: camel_case_str</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-to_camel_case</span>

<span class="sd">    References:</span>
<span class="sd">        https://en.wikipedia.org/wiki/CamelCase</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; underscore_case = &#39;underscore_funcname&#39;</span>
<span class="sd">        &gt;&gt;&gt; camel_case_str = to_camel_case(underscore_case)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;camel_case_str = %s&#39; % (str(camel_case_str),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        camel_case_str = UnderscoreFuncname</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">mixed</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">underscore_case</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">words2</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">thresh</span> <span class="k">else</span> <span class="n">word</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">camel_case_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">camel_case_str</span></div>


<div class="viewcode-block" id="is_url"><a class="viewcode-back" href="../../utool.html#utool.util_str.is_url">[docs]</a><span class="k">def</span> <span class="nf">is_url</span><span class="p">(</span><span class="n">str_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;heuristic check if str is url formatted&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">str_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">),</span>
            <span class="n">str_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;https://&#39;</span><span class="p">),</span>
            <span class="n">str_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;www.&#39;</span><span class="p">),</span>
            <span class="s1">&#39;.org/&#39;</span> <span class="ow">in</span> <span class="n">str_</span><span class="p">,</span>
            <span class="s1">&#39;.com/&#39;</span> <span class="ow">in</span> <span class="n">str_</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="autoformat_pep8"><a class="viewcode-back" href="../../utool.html#utool.util_str.autoformat_pep8">[docs]</a><span class="k">def</span> <span class="nf">autoformat_pep8</span><span class="p">(</span><span class="n">sourcecode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        code (str):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-autoformat_pep8</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        &#39;aggressive&#39;: 0,</span>
<span class="sd">        &#39;diff&#39;: False,</span>
<span class="sd">        &#39;exclude&#39;: [],</span>
<span class="sd">        &#39;experimental&#39;: False,</span>
<span class="sd">        &#39;files&#39;: [u&#39;&#39;],</span>
<span class="sd">        &#39;global_config&#39;: ~/.config/pep8,</span>
<span class="sd">        &#39;ignore&#39;: set([u&#39;E24&#39;]),</span>
<span class="sd">        &#39;ignore_local_config&#39;: False,</span>
<span class="sd">        &#39;in_place&#39;: False,</span>
<span class="sd">        &#39;indent_size&#39;: 4,</span>
<span class="sd">        &#39;jobs&#39;: 1,</span>
<span class="sd">        &#39;line_range&#39;: None,</span>
<span class="sd">        &#39;list_fixes&#39;: False,</span>
<span class="sd">        &#39;max_line_length&#39;: 79,</span>
<span class="sd">        &#39;pep8_passes&#39;: -1,</span>
<span class="sd">        &#39;recursive&#39;: False,</span>
<span class="sd">        &#39;select&#39;: ,</span>
<span class="sd">        &#39;verbose&#39;: 0,</span>

<span class="sd">    Ignore:</span>
<span class="sd">        autopep8 --recursive --in-place --ignore E126,E127,E201,E202,E203,E221,E222,E241,E265,E271,E272,E301,E501,W602,E266,N801,N802,N803,N805,N806,N811,N813 .</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">autopep8</span>

    <span class="n">default_ignore</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;E126&#39;</span><span class="p">,</span>  <span class="c1"># continuation line hanging-indent</span>
        <span class="s1">&#39;E127&#39;</span><span class="p">,</span>  <span class="c1"># continuation line over-indented for visual indent</span>
        <span class="s1">&#39;E201&#39;</span><span class="p">,</span>  <span class="c1"># whitespace after &#39;(&#39;</span>
        <span class="s1">&#39;E202&#39;</span><span class="p">,</span>  <span class="c1"># whitespace before &#39;]&#39;</span>
        <span class="s1">&#39;E203&#39;</span><span class="p">,</span>  <span class="c1"># whitespace before &#39;, &#39;</span>
        <span class="s1">&#39;E221&#39;</span><span class="p">,</span>  <span class="c1"># multiple spaces before operator</span>
        <span class="s1">&#39;E222&#39;</span><span class="p">,</span>  <span class="c1"># multiple spaces after operator</span>
        <span class="s1">&#39;E241&#39;</span><span class="p">,</span>  <span class="c1"># multiple spaces after ,</span>
        <span class="s1">&#39;E265&#39;</span><span class="p">,</span>  <span class="c1"># block comment should start with &quot;# &quot;</span>
        <span class="s1">&#39;E271&#39;</span><span class="p">,</span>  <span class="c1"># multiple spaces after keyword</span>
        <span class="s1">&#39;E272&#39;</span><span class="p">,</span>  <span class="c1"># multiple spaces before keyword</span>
        <span class="s1">&#39;E301&#39;</span><span class="p">,</span>  <span class="c1"># expected 1 blank line, found 0</span>
        <span class="s1">&#39;E501&#39;</span><span class="p">,</span>  <span class="c1"># line length &gt; 79</span>
        <span class="s1">&#39;W602&#39;</span><span class="p">,</span>  <span class="c1"># Old reraise syntax</span>
        <span class="s1">&#39;E266&#39;</span><span class="p">,</span>  <span class="c1"># too many leading &#39;#&#39; for block comment</span>
        <span class="s1">&#39;N801&#39;</span><span class="p">,</span>  <span class="c1"># function name should be lowercase [N806]</span>
        <span class="s1">&#39;N802&#39;</span><span class="p">,</span>  <span class="c1"># function name should be lowercase [N806]</span>
        <span class="s1">&#39;N803&#39;</span><span class="p">,</span>  <span class="c1"># argument should be lowercase [N806]</span>
        <span class="s1">&#39;N805&#39;</span><span class="p">,</span>  <span class="c1"># first argument of a method should be named &#39;self&#39;</span>
        <span class="s1">&#39;N806&#39;</span><span class="p">,</span>  <span class="c1"># variable in function should be lowercase [N806]</span>
        <span class="s1">&#39;N811&#39;</span><span class="p">,</span>  <span class="c1"># constant name imported as non constant</span>
        <span class="s1">&#39;N813&#39;</span><span class="p">,</span>  <span class="c1"># camel case</span>
    <span class="p">}</span>
    <span class="c1"># My defaults</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ignore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">default_ignore</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;aggressive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aggressive&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pep8_options</span> <span class="o">=</span> <span class="n">autopep8</span><span class="o">.</span><span class="n">_get_options</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">new_source</span> <span class="o">=</span> <span class="n">autopep8</span><span class="o">.</span><span class="n">fix_code</span><span class="p">(</span><span class="n">sourcecode</span><span class="p">,</span> <span class="n">pep8_options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_source</span></div>


<span class="n">autopep8_format</span> <span class="o">=</span> <span class="n">autoformat_pep8</span>


<div class="viewcode-block" id="filtered_infostr"><a class="viewcode-back" href="../../utool.html#utool.util_str.filtered_infostr">[docs]</a><span class="k">def</span> <span class="nf">filtered_infostr</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
    <span class="n">removed</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
    <span class="n">reasonstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">reason</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39; based on </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reason</span><span class="p">,)</span>
    <span class="n">percent</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">removed</span> <span class="o">/</span> <span class="n">total</span>
    <span class="n">str_</span> <span class="o">=</span> <span class="s1">&#39;Removing </span><span class="si">%d</span><span class="s1"> / </span><span class="si">%d</span><span class="s1"> (</span><span class="si">%.2f%%</span><span class="s1">) </span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">removed</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">percent</span><span class="p">,</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">reasonstr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">str_</span></div>


<div class="viewcode-block" id="chr_range"><a class="viewcode-back" href="../../utool.html#utool.util_str.chr_range">[docs]</a><span class="k">def</span> <span class="nf">chr_range</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Like range but returns characters</span>

<span class="sd">    Args:</span>
<span class="sd">        start (None): (default = None)</span>
<span class="sd">        stop (None): (default = None)</span>
<span class="sd">        step (None): (default = None)</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        base (str): charater to start with (default=&#39;a&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: list of characters</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-chr_range</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; args = (5,)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(chr_range(2, base=&#39;a&#39;))</span>
<span class="sd">        &gt;&gt;&gt; print(chr_range(0, 5))</span>
<span class="sd">        &gt;&gt;&gt; print(chr_range(0, 50))</span>
<span class="sd">        &gt;&gt;&gt; print(chr_range(0, 5, 2))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [&#39;a&#39;, &#39;b&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="p">(</span><span class="n">stop</span><span class="p">,)</span> <span class="o">=</span> <span class="n">args</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">args</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;incorrect args&#39;</span><span class="p">)</span>

    <span class="n">chr_</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">unichr</span>

    <span class="n">base</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">start</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stop</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">stop</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stop</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">list_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">chr_</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">list_</span></div>


<div class="viewcode-block" id="color_diff_text"><a class="viewcode-back" href="../../utool.html#utool.util_str.color_diff_text">[docs]</a><span class="k">def</span> <span class="nf">color_diff_text</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">highlight_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer_name</span><span class="o">=</span><span class="s1">&#39;diff&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="highlight_code"><a class="viewcode-back" href="../../utool.html#utool.util_str.highlight_code">[docs]</a><span class="k">def</span> <span class="nf">highlight_code</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer_name</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">highlight_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="highlight_text"><a class="viewcode-back" href="../../utool.html#utool.util_str.highlight_text">[docs]</a><span class="k">def</span> <span class="nf">highlight_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer_name</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SeeAlso:</span>
<span class="sd">        color_text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Resolve extensions to languages</span>
    <span class="n">lexer_name</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;py&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="s1">&#39;cpp&#39;</span><span class="p">,</span> <span class="s1">&#39;cpp&#39;</span><span class="p">:</span> <span class="s1">&#39;cpp&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;cpp&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">lexer_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">lexer_name</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">lexer_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]:</span>
        <span class="c1"># hack for coloring</span>
        <span class="k">return</span> <span class="n">color_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer_name</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="k">if</span> <span class="n">ENABLE_COLORS</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pygments</span>
            <span class="kn">import</span> <span class="nn">pygments.lexers</span>
            <span class="kn">import</span> <span class="nn">pygments.formatters</span>

            <span class="c1"># from pygments import highlight</span>
            <span class="c1"># from pygments.lexers import get_lexer_by_name</span>
            <span class="c1"># from pygments.formatters import TerminalFormatter</span>
            <span class="c1"># if ut.WIN32:</span>
            <span class="c1">#    assert False</span>
            <span class="c1">#    #formater = pygments.formatters.terminal256.Terminal256Formatter()</span>
            <span class="c1">#    import pygments.formatters.terminal256</span>
            <span class="c1">#    formater = pygments.formatters.terminal256.Terminal256Formatter()</span>
            <span class="c1"># else:</span>
            <span class="kn">import</span> <span class="nn">pygments.formatters.terminal</span>

            <span class="n">formater</span> <span class="o">=</span> <span class="n">pygments</span><span class="o">.</span><span class="n">formatters</span><span class="o">.</span><span class="n">terminal</span><span class="o">.</span><span class="n">TerminalFormatter</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="p">)</span>
            <span class="n">lexer</span> <span class="o">=</span> <span class="n">pygments</span><span class="o">.</span><span class="n">lexers</span><span class="o">.</span><span class="n">get_lexer_by_name</span><span class="p">(</span><span class="n">lexer_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pygments</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span> <span class="n">formater</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">SUPER_STRICT</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">return</span> <span class="n">text</span>
    <span class="k">return</span> <span class="n">text</span></div>


<div class="viewcode-block" id="color_text"><a class="viewcode-back" href="../../utool.html#utool.util_str.color_text">[docs]</a><span class="k">def</span> <span class="nf">color_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SeeAlso:</span>
<span class="sd">        highlight_text</span>
<span class="sd">        lexer_shortnames = sorted(ut.flatten(ut.take_column(pygments.lexers.LEXERS.values(), 2)))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Depricated color codes for Pygments 2.2, changed in 2.4</span>
    <span class="n">backup_color_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;darkred&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
        <span class="s1">&#39;darkgreen&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
        <span class="s1">&#39;brown&#39;</span><span class="p">:</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
        <span class="s1">&#39;darkblue&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;purple&#39;</span><span class="p">:</span> <span class="s1">&#39;magenta&#39;</span><span class="p">,</span>
        <span class="s1">&#39;teal&#39;</span><span class="p">:</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lightgray&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span>
        <span class="s1">&#39;darkgray&#39;</span><span class="p">:</span> <span class="s1">&#39;brightblack&#39;</span><span class="p">,</span>
        <span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="s1">&#39;brightred&#39;</span><span class="p">,</span>
        <span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="s1">&#39;brightgreen&#39;</span><span class="p">,</span>
        <span class="s1">&#39;yellow&#39;</span><span class="p">:</span> <span class="s1">&#39;brightyellow&#39;</span><span class="p">,</span>
        <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="s1">&#39;brightblue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fuchsia&#39;</span><span class="p">:</span> <span class="s1">&#39;brightmagenta&#39;</span><span class="p">,</span>
        <span class="s1">&#39;turquoise&#39;</span><span class="p">:</span> <span class="s1">&#39;brightcyan&#39;</span><span class="p">,</span>
        <span class="s1">&#39;darkyellow&#39;</span><span class="p">:</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
        <span class="s1">&#39;darkteal&#39;</span><span class="p">:</span> <span class="s1">&#39;brightcyan&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fuscia&#39;</span><span class="p">:</span> <span class="s1">&#39;brightmagenta&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ENABLE_COLORS</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;python&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">highlight_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;sql&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">highlight_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;sql&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">pygments</span>
        <span class="kn">import</span> <span class="nn">pygments.console</span>

        <span class="c1"># if color == &#39;guess&#39;:</span>
        <span class="c1">#     import linguist  # NOQA</span>
        <span class="c1">#     pygments.lexers.guess_lexer(text)</span>
        <span class="c1">#     return highlight_text(text, color)</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pygments</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">codes</span><span class="p">:</span>
            <span class="n">color_</span> <span class="o">=</span> <span class="n">backup_color_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">color_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Color </span><span class="si">%r</span><span class="s1"> could not be found in pygments&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">color</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">color_</span>
        <span class="n">ansi_text</span> <span class="o">=</span> <span class="n">pygments</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">WIN32</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">colorama</span>

            <span class="n">ansi_reset</span> <span class="o">=</span> <span class="n">colorama</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ansi_reset</span> <span class="o">=</span> <span class="n">pygments</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ansi_text</span> <span class="o">=</span> <span class="n">ansi_text</span> <span class="o">+</span> <span class="n">ansi_reset</span>
        <span class="k">return</span> <span class="n">ansi_text</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span></div>


<div class="viewcode-block" id="highlight_regex"><a class="viewcode-back" href="../../utool.html#utool.util_str.highlight_regex">[docs]</a><span class="k">def</span> <span class="nf">highlight_regex</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">pat</span><span class="p">,</span> <span class="n">reflags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FIXME Use pygments instead</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># import colorama</span>
    <span class="c1"># from colorama import Fore, Style</span>
    <span class="c1"># color = Fore.MAGENTA</span>
    <span class="c1"># color = Fore.RED</span>
    <span class="c1"># match = re.search(pat, str_, flags=reflags)</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">str_</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">reflags</span><span class="p">))</span>

    <span class="n">colored</span> <span class="o">=</span> <span class="n">str_</span>

    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
        <span class="c1"># pass</span>
        <span class="c1"># if match is None:</span>
        <span class="c1">#    return str_</span>
        <span class="c1"># else:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
        <span class="c1"># colorama.init()</span>
        <span class="n">colored_part</span> <span class="o">=</span> <span class="n">color_text</span><span class="p">(</span><span class="n">colored</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">colored</span> <span class="o">=</span> <span class="n">colored</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">colored_part</span> <span class="o">+</span> <span class="n">colored</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span>
        <span class="c1"># colored = (colored[:start] + color + colored[start:end] +</span>
        <span class="c1">#            Style.RESET_ALL + colored[end:])</span>
        <span class="c1"># colorama.deinit()</span>
    <span class="k">return</span> <span class="n">colored</span></div>


<div class="viewcode-block" id="highlight_multi_regex"><a class="viewcode-back" href="../../utool.html#utool.util_str.highlight_multi_regex">[docs]</a><span class="k">def</span> <span class="nf">highlight_multi_regex</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">pat_to_color</span><span class="p">,</span> <span class="n">reflags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FIXME Use pygments instead. must be mututally exclusive</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># import colorama</span>
    <span class="c1"># from colorama import Fore, Style</span>
    <span class="c1"># color = Fore.MAGENTA</span>
    <span class="c1"># color = Fore.RED</span>
    <span class="c1"># match = re.search(pat, str_, flags=reflags)</span>

    <span class="n">colored</span> <span class="o">=</span> <span class="n">str_</span>

    <span class="n">to_replace</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pat</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">pat_to_color</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">str_</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">reflags</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
            <span class="n">to_replace</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">end</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">color</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">to_replace</span><span class="p">)):</span>
        <span class="n">end</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">tup</span>
        <span class="n">colored_part</span> <span class="o">=</span> <span class="n">color_text</span><span class="p">(</span><span class="n">colored</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">colored</span> <span class="o">=</span> <span class="n">colored</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">colored_part</span> <span class="o">+</span> <span class="n">colored</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">colored</span></div>


<div class="viewcode-block" id="varinfo_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.varinfo_str">[docs]</a><span class="k">def</span> <span class="nf">varinfo_str</span><span class="p">(</span>
    <span class="n">varval</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">onlyrepr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">canshowrepr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">varcolor</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">colored</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="c1"># varval = getattr(cm, varname.replace(&#39;cm.&#39;, &#39;&#39;))</span>
    <span class="n">varinfo_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">print_summary</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">onlyrepr</span> <span class="ow">and</span> <span class="n">ut</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">varval</span><span class="p">)</span>
    <span class="n">show_repr</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">show_repr</span> <span class="o">=</span> <span class="n">show_repr</span> <span class="ow">or</span> <span class="p">(</span><span class="n">onlyrepr</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">print_summary</span><span class="p">)</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
    <span class="k">if</span> <span class="n">colored</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">ut</span><span class="o">.</span><span class="n">util_dbg</span><span class="o">.</span><span class="n">COLORED_EXCEPTIONS</span><span class="p">:</span>
        <span class="n">varname</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">color_text</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">varcolor</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_repr</span><span class="p">:</span>
        <span class="n">varval_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">varval</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varval_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">varval_str</span> <span class="o">=</span> <span class="s1">&#39;&lt;omitted&gt;&#39;</span>
        <span class="n">varval_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truncate_str</span><span class="p">(</span><span class="n">varval_str</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">varinfo_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;    * </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">varval_str</span><span class="p">)]</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
    <span class="k">if</span> <span class="n">print_summary</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">varval</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">varval</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">depth_profile</span><span class="p">(</span><span class="n">varval</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">show_repr</span><span class="p">:</span>
            <span class="n">varinfo_list</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="c1"># &#39;    %s varinfo(%s):&#39; % (symbol, varname,),</span>
                <span class="s1">&#39;    </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> = &lt;not shown!&gt;&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">varname</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="n">varinfo_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;          len = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">varval</span><span class="p">),)]</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">varval</span><span class="p">):</span>
            <span class="n">depth_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truncate_str</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">depth</span><span class="p">),</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
            <span class="n">varinfo_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;          depth = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">depth_str</span><span class="p">,)]</span>
        <span class="n">varinfo_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;          types = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">list_type_profile</span><span class="p">(</span><span class="n">varval</span><span class="p">),)]</span>
        <span class="c1"># varinfo = &#39;\n&#39;.join(ut.align_lines(varinfo_list, &#39;=&#39;))</span>
    <span class="n">aligned_varinfo_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">align_lines</span><span class="p">(</span><span class="n">varinfo_list</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
    <span class="n">varinfo</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aligned_varinfo_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">varinfo</span></div>


<div class="viewcode-block" id="testdata_text"><a class="viewcode-back" href="../../utool.html#utool.util_str.testdata_text">[docs]</a><span class="k">def</span> <span class="nf">testdata_text</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="c1"># ut.util_dbg.COLORED_EXCEPTIONS = False</span>
    <span class="n">text</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        % COMMENT</span>
<span class="sd">        Image matching relies on finding similar features between query and</span>
<span class="sd">        database images, and there are many factors that can cause this to be</span>
<span class="sd">        difficult.</span>
<span class="sd">        % TALK ABOUT APPEARANCE HERE</span>
<span class="sd">        Similar to issues seen in (1) instance and (2) face recognition,</span>
<span class="sd">        images of animals taken ``in the wild&#39;&#39; contain many challenges</span>
<span class="sd">        such as occlusion, distractors and variations in viewpoint,</span>
<span class="sd">        pose, illumination, quality, and camera parameters.  We start</span>
<span class="sd">        the discussion of the problem addressed in this thesis by</span>
<span class="sd">        considering examples of these challenges.</span>

<span class="sd">        \distractorexample</span>

<span class="sd">        \paragraph{foobar}</span>
<span class="sd">        Occluders are objects in the foreground of an image that impact the</span>
<span class="sd">        visibility of the features on the subject animal.</span>
<span class="sd">         Both scenery and other animals are the main contributors of occlusion in</span>
<span class="sd">        our dataset.</span>
<span class="sd">         Occlusion from other animals is especially challenging because not only</span>

<span class="sd">        \begin{enumerate} % Affine Adaptation Procedure</span>
<span class="sd">           \item Compute the second moment matrix at the warped image patch defined by $\ellmat_i$.</span>

<span class="sd">           \item If the keypoint is stable, stop.  If convergence has not been reached in</span>
<span class="sd">                some number of iterations stop and discard the keypoint.</span>

<span class="sd">           \item</span>
<span class="sd">                  Update the affine shape  using the rule $\ellmat_{i + 1} =</span>
<span class="sd">                \sqrtm{\momentmat} \ellmat_i$.</span>
<span class="sd">                  This ensures the eigenvalues at the previously detected point</span>
<span class="sd">                are equal in the new frame.</span>
<span class="sd">                  If the keypoint is stable, it should be re-detected close to</span>
<span class="sd">                the same location.</span>
<span class="sd">                  (The square root of a matrix defined as:</span>
<span class="sd">                $\sqrtm{\momentmatNOARG} \equiv \mat{X} \where \mat{X}^T\mat{X}</span>
<span class="sd">                = \momentmatNOARG$.</span>
<span class="sd">                  If $\momentmatNOARG$ is degenerate than $\mat{X}$ does not</span>
<span class="sd">                exist.)</span>
<span class="sd">        \end{enumerate}</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="p">)</span>
        <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="p">)</span>

    <span class="n">text2</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        \begin{comment}</span>
<span class="sd">        python -m wbia -e rank_cmc -t invar -a viewdiff --test_cfgx_slice=6: --db PZ_Master1 --hargv=expt --prefix &quot;Invariance+View Experiment &quot;  # NOQA</span>
<span class="sd">        \end{comment}</span>
<span class="sd">        \ImageCommand{figuresX/expt_rank_cmc_PZ_Master1_a_viewdiff_t_invar.png}{\textwidth}{</span>
<span class="sd">        Results of the invariance experiment with different viewpoints for plains</span>
<span class="sd">        zebras.  Only the results with different viewpoints are shown.  The query and</span>
<span class="sd">        database annotations are the same as those in the viewpoint experiment.  Thre</span>
<span class="sd">        is less than a $2\percent$ gap between the best results with keypoint</span>
<span class="sd">        invariance and the results without any keypoint invariance.  (Note that</span>
<span class="sd">        invariance we we discuss here only refers to keypoint shape and not the</span>
<span class="sd">        invariance that is implicit in the SIFT descriptor).</span>
<span class="sd">        }{PZInvarViewExpt}</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> foobar foobar fooo. hwodefoobardoo</span><span class="se">\n\n</span><span class="s1">&#39;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span> <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">text2</span></div>


<div class="viewcode-block" id="regex_reconstruct_split"><a class="viewcode-back" href="../../utool.html#utool.util_str.regex_reconstruct_split">[docs]</a><span class="k">def</span> <span class="nf">regex_reconstruct_split</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">re</span>

    <span class="c1"># separators = re.findall(pattern, text)</span>
    <span class="n">separators</span> <span class="o">=</span> <span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)]</span>
    <span class="c1"># separators = [match.group() for match in re.finditer(pattern, text, flags=re.MULTILINE)]</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="s1">&#39;[recon] separators = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">separators</span><span class="p">),</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>

    <span class="n">remaining</span> <span class="o">=</span> <span class="n">text</span>
    <span class="n">block_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sep</span> <span class="ow">in</span> <span class="n">separators</span><span class="p">:</span>
        <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">remaining</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">block_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="n">tail</span>
    <span class="n">block_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remaining</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="s1">&#39;[recon] block_list = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">block_list</span><span class="p">),</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">block_list</span><span class="p">,</span> <span class="n">separators</span></div>


<div class="viewcode-block" id="format_multiple_paragraph_sentences"><a class="viewcode-back" href="../../utool.html#utool.util_str.format_multiple_paragraph_sentences">[docs]</a><span class="k">def</span> <span class="nf">format_multiple_paragraph_sentences</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FIXME: funky things happen when multiple newlines in the middle of</span>
<span class="sd">    paragraphs</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python ~/local/vim/rc/pyvim_funcs.py --test-format_multiple_paragraph_sentences</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-format_multiple_paragraph_sentences --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import os, sys</span>
<span class="sd">        &gt;&gt;&gt; #sys.path.append(os.path.expanduser(&#39;~/local/vim/rc&#39;))</span>
<span class="sd">        &gt;&gt;&gt; text = testdata_text(2)</span>
<span class="sd">        &gt;&gt;&gt; formated_text = format_multiple_paragraph_sentences(text, debug=True)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;+--- Text ---&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(text)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;+--- Formated Text ---&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(formated_text)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;L_____&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="c1"># Hack</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;^ *$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="n">msgblock</span><span class="p">(</span><span class="s1">&#39;[fmt] text&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">),</span> <span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
    <span class="c1"># print(text.replace(&#39; &#39;, &#39;_&#39;))</span>
    <span class="c1"># ut.util_dbg.COLORED_EXCEPTIONS = False</span>
    <span class="c1"># Patterns that define separations between paragraphs in latex</span>
    <span class="n">pattern_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;</span><span class="se">\n\n\n</span><span class="s1">*&#39;</span><span class="p">,</span>  <span class="c1"># newlines</span>
        <span class="c1">#&#39;\n\n*$&#39;,     # newlines</span>
        <span class="c1">#&#39;^\n\n*&#39;,     # newlines</span>
        <span class="c1">#&#39;\n\n*&#39;,     # newlines</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *%.*</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>  <span class="c1"># comments</span>
        <span class="c1"># paragraph commands</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">paragraph{[^}]*}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;\n? *\\\\item \\\\textbf{[^}]*}: *\n&#39;,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">item </span><span class="se">\\\\</span><span class="s1">textbf{[^:]*}: *</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">section{[^}]*}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">section{[^}]*}</span><span class="se">\\\\</span><span class="s1">label{[^}]*}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">section{[^}]*}</span><span class="se">\\</span><span class="s1">~?</span><span class="se">\\\\</span><span class="s1">label{[^}]*}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">subsection{[^}]*}</span><span class="se">\\</span><span class="s1">~?</span><span class="se">\\\\</span><span class="s1">label{[^}]*}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">subsection{[^~]*}</span><span class="se">\\</span><span class="s1">~?</span><span class="se">\\\\</span><span class="s1">label{[^}]*}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">subsection{[^}]*}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">subsubsection{[^~]*}</span><span class="se">\\</span><span class="s1">~?</span><span class="se">\\\\</span><span class="s1">label{[^}]*}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">subsubsection{[^}]*}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">----*</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;##* .*</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">?}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">newcommand{[^}]*}.*</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="c1"># generic multiline commands with text inside (like devcomment)</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">[a-zA-Z]+{ *</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">begin{[^}]*}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">item *</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">noindent *</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;\n? *</span><span class="se">\\\\</span><span class="s1">ImageCommand[^}]*}[^}]*}{\n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *</span><span class="se">\\\\</span><span class="s1">end{[^}]*}</span><span class="se">\n</span><span class="s1">?&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">}{&#39;</span><span class="p">,</span>
        <span class="c1"># docstr stuff</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">TRIPLE_DOUBLE_QUOTE</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">? *Args: *</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="c1">#&#39;\n? [A-Za-z_]*[0-9A-Za-z_]* (.*?) *:&#39;,</span>
    <span class="p">]</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pat</span><span class="p">,)</span> <span class="k">for</span> <span class="n">pat</span> <span class="ow">in</span> <span class="n">pattern_list</span><span class="p">])</span>
    <span class="c1"># break into paragraph blocks</span>
    <span class="n">block_list</span><span class="p">,</span> <span class="n">separators</span> <span class="o">=</span> <span class="n">regex_reconstruct_split</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">collapse_pos_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Dont format things within certain block types</span>
    <span class="n">_iter</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">iter_window</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">separators</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">block_list</span><span class="p">,</span> <span class="n">_iter</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="sa">r</span><span class="s1">&#39;\begin</span><span class="si">{comment}</span><span class="s1">&#39;</span>
            <span class="ow">and</span> <span class="n">window</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="sa">r</span><span class="s1">&#39;\end</span><span class="si">{comment}</span><span class="s1">&#39;</span>
        <span class="p">):</span>
            <span class="n">collapse_pos_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

    <span class="n">tofmt_block_list</span> <span class="o">=</span> <span class="n">block_list</span><span class="p">[:]</span>

    <span class="n">collapse_pos_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">collapse_pos_list</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">collapse_pos_list</span><span class="p">:</span>
        <span class="n">collapsed_sep</span> <span class="o">=</span> <span class="n">separators</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tofmt_block_list</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">separators</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
        <span class="n">separators</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">collapsed_sep</span>
        <span class="k">del</span> <span class="n">separators</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">tofmt_block_list</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="s1">&#39;[fmt] tofmt_block_list = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">tofmt_block_list</span><span class="p">),</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span>

    <span class="c1"># apply formatting</span>
    <span class="c1"># if debug:</span>
    <span class="c1">#    ut.colorprint(&#39;--- FORMAT SENTENCE --- &#39;, &#39;white&#39;)</span>
    <span class="n">formated_block_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">tofmt_block_list</span><span class="p">:</span>
        <span class="n">fmtblock</span> <span class="o">=</span> <span class="n">format_single_paragraph_sentences</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">formated_block_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fmtblock</span><span class="p">)</span>
        <span class="c1"># ut.colorprint(&#39;---------- &#39;, &#39;white&#39;)</span>
    <span class="c1"># if debug:</span>
    <span class="c1">#    ut.colorprint(&#39;--- / FORMAT SENTENCE --- &#39;, &#39;white&#39;)</span>
    <span class="n">rejoined_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">interleave</span><span class="p">((</span><span class="n">formated_block_list</span><span class="p">,</span> <span class="n">separators</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span>
            <span class="s1">&#39;[fmt] formated_block_list = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">formated_block_list</span><span class="p">),</span> <span class="s1">&#39;turquoise&#39;</span>
        <span class="p">)</span>
        <span class="c1"># print(rejoined_list)</span>
    <span class="n">formated_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rejoined_list</span><span class="p">)</span>
    <span class="c1"># ut.colorprint(formated_text.replace(&#39; &#39;, &#39;_&#39;), &#39;red&#39;)</span>
    <span class="k">return</span> <span class="n">formated_text</span></div>


<span class="n">format_multi_paragraphs</span> <span class="o">=</span> <span class="n">format_multiple_paragraph_sentences</span>


<div class="viewcode-block" id="split_sentences2"><a class="viewcode-back" href="../../utool.html#utool.util_str.split_sentences2">[docs]</a><span class="k">def</span> <span class="nf">split_sentences2</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">raw_sep_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="n">USE_REGEX_SPLIT</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">text_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">remove_doublspaces</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="c1"># TODO: more intelligent sentence parsing</span>
    <span class="n">text_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten_textlines</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">USE_REGEX_SPLIT</span><span class="p">:</span>
        <span class="c1"># Old way that just handled periods</span>
        <span class="n">sentence_list</span> <span class="o">=</span> <span class="n">text_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;. &#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># ******* #</span>
        <span class="c1"># SPLITS line endings based on regular expressions.</span>
        <span class="n">esc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span>
        <span class="c1"># Define separation patterns</span>
        <span class="n">regex_sep_chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">,</span> <span class="n">raw_sep_chars</span><span class="p">))</span>
        <span class="n">regex_sep_prefix</span> <span class="o">=</span> <span class="p">[</span><span class="n">esc</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\d&#39;</span> <span class="o">+</span> <span class="n">esc</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)]</span>
        <span class="n">regex_sep_list</span> <span class="o">=</span> <span class="n">regex_sep_chars</span> <span class="o">+</span> <span class="n">regex_sep_prefix</span>
        <span class="c1"># Combine into a full regex</span>
        <span class="n">sep_pattern</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">regex_or</span><span class="p">(</span><span class="n">regex_sep_list</span><span class="p">)</span>
        <span class="n">full_pattern</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">sep_pattern</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;+\s)&#39;</span>
        <span class="n">full_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">full_pattern</span><span class="p">)</span>
        <span class="c1"># Make the splits</span>
        <span class="n">num_groups</span> <span class="o">=</span> <span class="n">full_regex</span><span class="o">.</span><span class="n">groups</span>  <span class="c1"># num groups in the regex</span>
        <span class="n">split_list</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">full_pattern</span><span class="p">,</span> <span class="n">text_</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">num_bins</span> <span class="o">=</span> <span class="n">num_groups</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">sentence_list</span> <span class="o">=</span> <span class="n">split_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">num_bins</span><span class="p">]</span>
            <span class="n">sep_list_group1</span> <span class="o">=</span> <span class="n">split_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="n">num_bins</span><span class="p">]</span>
            <span class="n">sep_list</span> <span class="o">=</span> <span class="n">sep_list_group1</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;SPLIT DBG&gt;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;num_groups = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_groups</span><span class="p">,))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;len(split_list) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">split_list</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;len(split_list) / len(sentence_list) = </span><span class="si">%r</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">split_list</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;len(sentence_list) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">),))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;len(sep_list_group1) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sep_list_group1</span><span class="p">),))</span>
            <span class="c1"># print(&#39;len(sep_list_group2) = %r&#39; % (len(sep_list_group2),))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;full_pattern = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">full_pattern</span><span class="p">,))</span>
            <span class="c1"># print(&#39;split_list = %r&#39; % (split_list,))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sentence_list = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">),))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sep_list = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="n">sep_list</span><span class="p">),))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;/SPLIT DBG&gt;&#39;</span><span class="p">)</span>
        <span class="c1"># ******* #</span>
        <span class="c1"># FIXME: Place the separators either before or after a sentence</span>
        <span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="n">zip_longest</span>

        <span class="n">sentence_list2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="n">_iter</span> <span class="o">=</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">,</span> <span class="n">sep_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_iter</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sentence_list2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sentence</span>
                <span class="k">continue</span>
            <span class="n">sepchars</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sepchars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">sepchars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">raw_sep_chars</span><span class="p">:</span>
                <span class="n">sentence_list2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sentence</span> <span class="o">+</span> <span class="p">(</span><span class="n">sep</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">sentence_list2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Place before next</span>
                <span class="n">sentence_list2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sentence</span>
                <span class="n">sentence_list2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>

        <span class="n">sentence_list2</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sentence_list2</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sentence_list2</span></div>


<div class="viewcode-block" id="format_single_paragraph_sentences"><a class="viewcode-back" href="../../utool.html#utool.util_str.format_single_paragraph_sentences">[docs]</a><span class="k">def</span> <span class="nf">format_single_paragraph_sentences</span><span class="p">(</span>
    <span class="n">text</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">myprefix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sentence_break</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="mi">73</span><span class="p">,</span> <span class="n">sepcolon</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    helps me separatate sentences grouped in paragraphs that I have a</span>
<span class="sd">    difficult time reading due to dyslexia</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: wrapped_text</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-format_single_paragraph_sentences --show</span>
<span class="sd">        python -m utool.util_str --exec-format_single_paragraph_sentences --show --nobreak</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; text = &#39;     lorium ipsum doloar dolar dolar dolar erata man foobar is this there yet almost man not quit ate 80 chars yet hold out almost there? dolar erat. sau.ltum. fds.fd... . . fd oob fd. list: (1) abcd, (2) foobar (4) 123456789 123456789 123456789 123456789 123 123 123 123 123456789 123 123 123 123 123456789 123456789 123456789 123456789 123456789 123 123 123 123 123 123456789 123456789 123456789 123456789 123456789 123456789 (3) spam.&#39;</span>
<span class="sd">        &gt;&gt;&gt; #text = &#39;list: (1) abcd, (2) foobar (3) spam.&#39;</span>
<span class="sd">        &gt;&gt;&gt; #text = &#39;foo. when: (1) there is a new individual,&#39;</span>
<span class="sd">        &gt;&gt;&gt; #text = &#39;when: (1) there is a new individual,&#39;</span>
<span class="sd">        &gt;&gt;&gt; #text = &#39;? ? . lorium. ipsum? dolar erat. saultum. fds.fd...  fd oob fd. ? &#39;  # causes breakdown</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;text = %r&#39; % (text,))</span>
<span class="sd">        &gt;&gt;&gt; sentence_break = not ut.get_argflag(&#39;--nobreak&#39;)</span>
<span class="sd">        &gt;&gt;&gt; wrapped_text = format_single_paragraph_sentences(text, debug=True, sentence_break=sentence_break)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;wrapped_text =\n%s&#39; % (str(wrapped_text),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="c1"># ut.util_dbg.COLORED_EXCEPTIONS = False</span>
    <span class="kn">import</span> <span class="nn">textwrap</span>
    <span class="kn">import</span> <span class="nn">re</span>

    <span class="c1"># ut.rrrr(verbose=False)</span>
    <span class="c1"># max_width = 73  # 79  # 80</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span>
    <span class="n">min_indent</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_minimum_indentation</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">min_indent</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_indent</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="n">msgblock</span><span class="p">(</span><span class="s1">&#39;preflat&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">)),</span> <span class="s1">&#39;darkyellow&#39;</span><span class="p">))</span>
    <span class="n">text_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">remove_doublspaces</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="c1"># TODO: more intelligent sentence parsing</span>
    <span class="n">text_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten_textlines</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="n">msgblock</span><span class="p">(</span><span class="s1">&#39;postflat&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text_</span><span class="p">)),</span> <span class="s1">&#39;yellow&#39;</span><span class="p">))</span>

    <span class="n">raw_sep_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sepcolon</span><span class="p">:</span>
        <span class="n">raw_sep_chars</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

    <span class="n">USE_REGEX_SPLIT</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">split_sentences</span><span class="p">(</span><span class="n">text_</span><span class="p">):</span>
        <span class="c1"># TODO: rectify with split_sentences2</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">USE_REGEX_SPLIT</span><span class="p">:</span>
            <span class="c1"># Old way that just handled periods</span>
            <span class="n">sentence_list</span> <span class="o">=</span> <span class="n">text_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;. &#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ******* #</span>
            <span class="c1"># SPLITS line endings based on regular expressions.</span>
            <span class="n">esc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span>
            <span class="c1"># Define separation patterns</span>
            <span class="n">regex_sep_chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">,</span> <span class="n">raw_sep_chars</span><span class="p">))</span>
            <span class="n">regex_sep_prefix</span> <span class="o">=</span> <span class="p">[</span><span class="n">esc</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\d&#39;</span> <span class="o">+</span> <span class="n">esc</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)]</span>
            <span class="n">regex_sep_list</span> <span class="o">=</span> <span class="n">regex_sep_chars</span> <span class="o">+</span> <span class="n">regex_sep_prefix</span>
            <span class="c1"># Combine into a full regex</span>
            <span class="n">sep_pattern</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">regex_or</span><span class="p">(</span><span class="n">regex_sep_list</span><span class="p">)</span>
            <span class="n">full_pattern</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">sep_pattern</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;+\s)&#39;</span>
            <span class="n">full_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">full_pattern</span><span class="p">)</span>
            <span class="c1"># Make the splits</span>
            <span class="n">num_groups</span> <span class="o">=</span> <span class="n">full_regex</span><span class="o">.</span><span class="n">groups</span>  <span class="c1"># num groups in the regex</span>
            <span class="n">split_list</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">full_pattern</span><span class="p">,</span> <span class="n">text_</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">num_bins</span> <span class="o">=</span> <span class="n">num_groups</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">sentence_list</span> <span class="o">=</span> <span class="n">split_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">num_bins</span><span class="p">]</span>
                <span class="n">sep_list_group1</span> <span class="o">=</span> <span class="n">split_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="n">num_bins</span><span class="p">]</span>
                <span class="n">sep_list</span> <span class="o">=</span> <span class="n">sep_list_group1</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;SPLIT DBG&gt;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;num_groups = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_groups</span><span class="p">,))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;len(split_list) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">split_list</span><span class="p">)))</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;len(split_list) / len(sentence_list) = </span><span class="si">%r</span><span class="s1">&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">split_list</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;len(sentence_list) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">),))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;len(sep_list_group1) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sep_list_group1</span><span class="p">),))</span>
                <span class="c1"># print(&#39;len(sep_list_group2) = %r&#39; % (len(sep_list_group2),))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;full_pattern = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">full_pattern</span><span class="p">,))</span>
                <span class="c1"># print(&#39;split_list = %r&#39; % (split_list,))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sentence_list = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">),))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sep_list = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="n">sep_list</span><span class="p">),))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;/SPLIT DBG&gt;&#39;</span><span class="p">)</span>
            <span class="c1"># ******* #</span>
            <span class="k">return</span> <span class="n">sentence_list</span><span class="p">,</span> <span class="n">sep_list</span>

    <span class="k">def</span> <span class="nf">wrap_sentences</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">,</span> <span class="n">min_indent</span><span class="p">,</span> <span class="n">max_width</span><span class="p">):</span>
        <span class="c1"># prefix for continuations of a sentence</span>
        <span class="k">if</span> <span class="n">myprefix</span><span class="p">:</span>
            <span class="c1"># helps me read LaTeX</span>
            <span class="n">sentence_prefix</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sentence_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">text_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">):</span>
            <span class="c1"># Hack to do docstrings</span>
            <span class="c1"># TODO: make actualy docstring reformater</span>
            <span class="n">sentence_prefix</span> <span class="o">=</span> <span class="s1">&#39;...     &#39;</span>

        <span class="k">if</span> <span class="n">max_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">max_width</span> <span class="o">-</span> <span class="n">min_indent</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence_prefix</span><span class="p">)</span>

            <span class="n">wrapkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">break_on_hyphens</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">break_long_words</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># wrapped_lines_list = [textwrap.wrap(sentence_prefix + line, **wrapkw)</span>
            <span class="c1">#                      for line in sentence_list]</span>
            <span class="n">wrapped_lines_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">):</span>
                <span class="n">wrapped_lines</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="o">**</span><span class="n">wrapkw</span><span class="p">)</span>
                <span class="n">wrapped_lines</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">line_</span> <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">sentence_prefix</span> <span class="o">+</span> <span class="n">line_</span>
                    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">line_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wrapped_lines</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">wrapped_lines_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wrapped_lines</span><span class="p">)</span>

            <span class="n">wrapped_sentences</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">wrapped_lines_list</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wrapped_sentences</span> <span class="o">=</span> <span class="n">sentence_list</span><span class="p">[:]</span>
        <span class="k">return</span> <span class="n">wrapped_sentences</span>

    <span class="k">def</span> <span class="nf">rewrap_sentences2</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">,</span> <span class="n">sep_list</span><span class="p">):</span>
        <span class="c1"># FIXME: probably where nl error is</span>
        <span class="c1"># ******* #</span>
        <span class="c1"># put the newline before or after the sep depending on if it is</span>
        <span class="c1"># supposed to prefix or suffix the sentence.</span>
        <span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="n">zip_longest</span>

        <span class="c1"># FIXME: Place the separators either before or after a sentence</span>
        <span class="n">sentence_list2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="n">_iter</span> <span class="o">=</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">,</span> <span class="n">sep_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_iter</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sentence_list2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sentence</span>
                <span class="k">continue</span>
            <span class="n">sepchars</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sepchars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">sepchars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">raw_sep_chars</span><span class="p">:</span>
                <span class="n">sentence_list2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sentence</span> <span class="o">+</span> <span class="p">(</span><span class="n">sep</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">sentence_list2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Place before next</span>
                <span class="n">sentence_list2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sentence</span>
                <span class="n">sentence_list2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">sentence_list2</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sentence_list2</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sentence_list2</span>

    <span class="c1"># New way</span>
    <span class="c1"># print(&#39;last_is_nl = %r&#39; % (last_is_nl,))</span>
    <span class="k">if</span> <span class="n">sentence_break</span><span class="p">:</span>
        <span class="c1"># Break at sentences</span>
        <span class="n">sentence_list</span><span class="p">,</span> <span class="n">sep_list</span> <span class="o">=</span> <span class="n">split_sentences</span><span class="p">(</span><span class="n">text_</span><span class="p">)</span>
        <span class="c1"># FIXME: probably where nl error is</span>
        <span class="n">sentence_list2</span> <span class="o">=</span> <span class="n">rewrap_sentences2</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">,</span> <span class="n">sep_list</span><span class="p">)</span>
        <span class="n">wrapped_sentences</span> <span class="o">=</span> <span class="n">wrap_sentences</span><span class="p">(</span><span class="n">sentence_list2</span><span class="p">,</span> <span class="n">min_indent</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span>
        <span class="n">wrapped_block</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrapped_sentences</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Break anywhere</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">max_width</span> <span class="o">-</span> <span class="n">min_indent</span>
        <span class="n">wrapkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">break_on_hyphens</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">break_long_words</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">wrapped_block</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">text_</span><span class="p">,</span> <span class="o">**</span><span class="n">wrapkw</span><span class="p">))</span>

        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># for a one-time purpose</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HACKING&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;width = </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
            <span class="c1"># HACK</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">text_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, (&#39;</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">w1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">_</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">w1</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">w1</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="n">w1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">width</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="n">w1</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">wrapped_block</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="c1"># HACK for last nl (seems to only happen if nl follows a seperator)</span>
    <span class="n">last_is_nl</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">wrapped_block</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">first_is_nl</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">wrapped_block</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># if last_is_nl and wrapped_block.strip().endswith(&#39;.&#39;):</span>
    <span class="k">if</span> <span class="n">last_is_nl</span><span class="p">:</span>
        <span class="n">wrapped_block</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="n">first_is_nl</span><span class="p">:</span>
        <span class="n">wrapped_block</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">wrapped_block</span>
    <span class="c1"># Do the final indentation</span>
    <span class="n">wrapped_text</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">wrapped_block</span><span class="p">,</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">min_indent</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapped_text</span></div>


<div class="viewcode-block" id="find_block_end"><a class="viewcode-back" href="../../utool.html#utool.util_str.find_block_end">[docs]</a><span class="k">def</span> <span class="nf">find_block_end</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">line_list</span><span class="p">,</span> <span class="n">sentinal</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Searches up and down until it finds the endpoints of a block Rectify</span>
<span class="sd">    with find_paragraph_end in pyvim_funcs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">re</span>

    <span class="n">row_</span> <span class="o">=</span> <span class="n">row</span>
    <span class="n">line_</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="n">row_</span><span class="p">]</span>
    <span class="n">flag1</span> <span class="o">=</span> <span class="n">row_</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">row_</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">flag2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sentinal</span><span class="p">,</span> <span class="n">line_</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">flag1</span> <span class="ow">or</span> <span class="n">flag2</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row_</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">row_</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">line_</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="n">row_</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sentinal</span><span class="p">,</span> <span class="n">line_</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">row_</span> <span class="o">+=</span> <span class="n">direction</span>
    <span class="k">return</span> <span class="n">row_</span></div>


<div class="viewcode-block" id="insert_block_between_lines"><a class="viewcode-back" href="../../utool.html#utool.util_str.insert_block_between_lines">[docs]</a><span class="k">def</span> <span class="nf">insert_block_between_lines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">row1</span><span class="p">,</span> <span class="n">row2</span><span class="p">,</span> <span class="n">line_list</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
        <span class="n">buffer_tail</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="n">row2</span><span class="p">:]</span>  <span class="c1"># Original end of the file</span>
        <span class="n">new_tail</span> <span class="o">=</span> <span class="n">lines</span> <span class="o">+</span> <span class="n">buffer_tail</span>
        <span class="k">del</span> <span class="n">line_list</span><span class="p">[</span><span class="n">row1</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:]</span>  <span class="c1"># delete old data</span>
        <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_tail</span><span class="p">)</span>  <span class="c1"># append new data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[:</span> <span class="n">row1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lines</span> <span class="o">+</span> <span class="n">line_list</span><span class="p">[</span><span class="n">row2</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">line_list</span></div>


<div class="viewcode-block" id="toggle_comment_lines"><a class="viewcode-back" href="../../utool.html#utool.util_str.toggle_comment_lines">[docs]</a><span class="k">def</span> <span class="nf">toggle_comment_lines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">char</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
    <span class="c1"># TODO: respect indentation</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">char</span> <span class="o">+</span> <span class="n">line</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">else</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">else</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span>
        <span class="p">]</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_text</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -c &quot;import utool, utool.util_str; utool.doctest_funcs(utool.util_str)&quot;</span>
<span class="sd">        python -m utool.util_str</span>
<span class="sd">        python -m utool.util_str --allexamples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>

    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c1"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>  <span class="c1"># NOQA</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">wbia-vtool</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../utool.html">utool package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../utool.html">utool</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Wild Me.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>