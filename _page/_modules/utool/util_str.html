

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>utool.util_str &mdash; utool 1.1.2.dev1 documentation</title>















    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />





    <link rel="top" title="utool 1.1.2.dev1 documentation" href="../../index.html"/>
        <link rel="up" title="utool" href="../utool.html"/>


  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">


    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">



            <a href="../../index.html" class="icon icon-home"> utool



          </a>




              <div class="version">
                1.1.2.dev1
              </div>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">



                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../utool.html">utool package</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">


      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">utool</a>
      </nav>



      <div class="wy-nav-content">
        <div class="rst-content">






<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>

          <li><a href="../index.html">Module code</a> &raquo;</li>

          <li><a href="../utool.html">utool</a> &raquo;</li>

    <li>utool.util_str</li>
      <li class="wy-breadcrumbs-aside">



      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <h1>Source code for utool.util_str</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">Module that handles string formating and manipulation of varoius data</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">reduce</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">split</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_type</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_time</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_cplat</span>
<span class="kn">from</span> <span class="nn">utool._internal</span> <span class="kn">import</span> <span class="n">meta_util_six</span>
<span class="kn">from</span> <span class="nn">utool._internal</span> <span class="kn">import</span> <span class="n">meta_util_arg</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_inject</span>
<span class="k">print</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">util_inject</span><span class="o">.</span><span class="n">inject2</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;[str]&#39;</span><span class="p">)</span>

<span class="n">ENABLE_COLORS</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">util_cplat</span><span class="o">.</span><span class="n">WIN32</span> <span class="ow">and</span>
                 <span class="ow">not</span> <span class="n">meta_util_arg</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--nopygments&#39;</span><span class="p">))</span>

<span class="k">if</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_NUMPY</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">TAU</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>  <span class="c"># References: tauday.com</span>

<span class="n">NO_TRUNCATE</span> <span class="o">=</span> <span class="s">&#39;--no-truncate&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>

<span class="n">TRIPLE_DOUBLE_QUOTE</span> <span class="o">=</span> <span class="s">r&#39;&quot;&#39;</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">TRIPLE_SINGLE_QUOTE</span> <span class="o">=</span> <span class="s">r&quot;&#39;&quot;</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">SINGLE_QUOTE</span> <span class="o">=</span> <span class="s">r&quot;&#39;&quot;</span>
<span class="n">DOUBLE_QUOTE</span> <span class="o">=</span> <span class="s">r&#39;&quot;&#39;</span>
<span class="n">BACKSLASH</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span>
<span class="n">NEWLINE</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

<span class="n">TAUFMTSTR</span> <span class="o">=</span> <span class="s">&#39;{coeff:,.1f}{taustr}&#39;</span>
<span class="k">if</span> <span class="s">&#39;--myway&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
    <span class="n">TAUSTR</span> <span class="o">=</span> <span class="s">&#39;*2pi&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">TAUSTR</span> <span class="o">=</span> <span class="s">&#39;tau&#39;</span>


<div class="viewcode-block" id="is_byte_encoded_unicode"><a class="viewcode-back" href="../../utool.html#utool.util_str.is_byte_encoded_unicode">[docs]</a><span class="k">def</span> <span class="nf">is_byte_encoded_unicode</span><span class="p">(</span><span class="n">str_</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">r&#39;\x&#39;</span> <span class="ow">in</span> <span class="nb">repr</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span>

</div>
<span class="n">ensure_unicode</span> <span class="o">=</span> <span class="n">meta_util_six</span><span class="o">.</span><span class="n">ensure_unicode</span>


<div class="viewcode-block" id="ensure_ascii"><a class="viewcode-back" href="../../utool.html#utool.util_str.ensure_ascii">[docs]</a><span class="k">def</span> <span class="nf">ensure_ascii</span><span class="p">(</span><span class="n">str_</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">str_</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;it was not a ascii-encoded unicode string&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;It may have been an ascii-encoded unicode string&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">str_</span>

</div>
<div class="viewcode-block" id="ensure_unicode_strlist"><a class="viewcode-back" href="../../utool.html#utool.util_str.ensure_unicode_strlist">[docs]</a><span class="k">def</span> <span class="nf">ensure_unicode_strlist</span><span class="p">(</span><span class="n">str_list</span><span class="p">):</span>
    <span class="n">__STR__</span> <span class="o">=</span> <span class="n">util_type</span><span class="o">.</span><span class="n">__STR__</span>
    <span class="n">flag_list</span> <span class="o">=</span> <span class="p">[</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">__STR__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_byte_encoded_unicode</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">str_</span> <span class="ow">in</span> <span class="n">str_list</span><span class="p">]</span>
    <span class="n">new_str_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">str_</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span> <span class="k">else</span> <span class="n">__STR__</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">str_</span><span class="p">,</span> <span class="n">flag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">str_list</span><span class="p">,</span> <span class="n">flag_list</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">new_str_list</span>

</div>
<div class="viewcode-block" id="insert_before_sentinal"><a class="viewcode-back" href="../../utool.html#utool.util_str.insert_before_sentinal">[docs]</a><span class="k">def</span> <span class="nf">insert_before_sentinal</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">repl_</span><span class="p">,</span> <span class="n">sentinal</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">sentinal</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">repl_</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="replace_between_tags"><a class="viewcode-back" href="../../utool.html#utool.util_str.replace_between_tags">[docs]</a><span class="k">def</span> <span class="nf">replace_between_tags</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">repl_</span><span class="p">,</span> <span class="n">start_tag</span><span class="p">,</span> <span class="n">end_tag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Replaces text between sentinal lines in a block of text.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str):</span>
<span class="sd">        repl_ (str):</span>
<span class="sd">        start_tag (str):</span>
<span class="sd">        end_tag (str): (default=None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: new_text</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-replace_between_tags</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; text = ut.codeblock(</span>
<span class="sd">            &#39;&#39;&#39;</span>
<span class="sd">            class:</span>
<span class="sd">                # &lt;FOO&gt;</span>
<span class="sd">                bar</span>
<span class="sd">                # &lt;/FOO&gt;</span>
<span class="sd">                baz</span>
<span class="sd">            &#39;&#39;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; repl_ = &#39;spam&#39;</span>
<span class="sd">        &gt;&gt;&gt; start_tag = &#39;# &lt;FOO&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; end_tag = &#39;# &lt;/FOO&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; new_text = replace_between_tags(text, repl_, start_tag, end_tag)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;new_text =\n%s&#39; % (str(new_text),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        new_text =</span>
<span class="sd">        class:</span>
<span class="sd">            # &lt;FOO&gt;</span>
<span class="sd">        spam</span>
<span class="sd">            # &lt;/FOO&gt;</span>
<span class="sd">            baz</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">editing</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">editing</span><span class="p">:</span>
            <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">start_tag</span><span class="p">):</span>
            <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">repl_</span><span class="p">)</span>
            <span class="n">editing</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">end_tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">end_tag</span><span class="p">):</span>
            <span class="n">editing</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_lines</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_text</span>

</div>
<div class="viewcode-block" id="theta_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.theta_str">[docs]</a><span class="k">def</span> <span class="nf">theta_str</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">taustr</span><span class="o">=</span><span class="n">TAUSTR</span><span class="p">,</span> <span class="n">fmtstr</span><span class="o">=</span><span class="s">&#39;{coeff:,.1f}{taustr}&#39;</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Format theta so it is interpretable in base 10</span>

<span class="sd">    Args:</span>
<span class="sd">        theta (float) angle in radians</span>
<span class="sd">        taustr (str): default 2pi</span>

<span class="sd">    Returns:</span>
<span class="sd">        str : theta_str - the angle in tau units</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; theta = 3.1415</span>
<span class="sd">        &gt;&gt;&gt; result = theta_str(theta)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        0.5*2pi</span>

<span class="sd">    Example2:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; theta = 6.9932</span>
<span class="sd">        &gt;&gt;&gt; taustr = &#39;tau&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = theta_str(theta, taustr)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        1.1tau</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">coeff</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">/</span> <span class="n">TAU</span>
    <span class="n">theta_str</span> <span class="o">=</span> <span class="n">fmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">coeff</span><span class="p">,</span> <span class="n">taustr</span><span class="o">=</span><span class="n">taustr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">theta_str</span>

</div>
<div class="viewcode-block" id="bbox_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.bbox_str">[docs]</a><span class="k">def</span> <span class="nf">bbox_str</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;, &#39;</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot; makes a string from an integer bounding box &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;None&#39;</span>
    <span class="n">fmtstr</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;%&#39;</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;d&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">fmtstr</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>

</div>
<div class="viewcode-block" id="verts_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.verts_str">[docs]</a><span class="k">def</span> <span class="nf">verts_str</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot; makes a string from a list of integer verticies &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;None&#39;</span>
    <span class="n">fmtstr</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;%&#39;</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;d&#39;</span> <span class="o">+</span>
                        <span class="s">&#39;, %&#39;</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;d&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">fmtstr</span> <span class="o">%</span> <span class="n">vert</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span> <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="n">verts</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="percent_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.percent_str">[docs]</a><span class="k">def</span> <span class="nf">percent_str</span><span class="p">(</span><span class="n">pcnt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Depricate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s">&#39;undef&#39;</span> <span class="k">if</span> <span class="n">pcnt</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&#39;</span><span class="si">%06.2f</span><span class="s"> </span><span class="si">%%</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pcnt</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,)</span>

</div>
<div class="viewcode-block" id="tupstr"><a class="viewcode-back" href="../../utool.html#utool.util_str.tupstr">[docs]</a><span class="k">def</span> <span class="nf">tupstr</span><span class="p">(</span><span class="n">tuple_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; maps each item in tuple to a string and doesnt include parens &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">,</span> <span class="n">tuple_</span><span class="p">)))</span>

<span class="c"># --- Strings ----</span>

</div>
<div class="viewcode-block" id="scalar_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.scalar_str">[docs]</a><span class="k">def</span> <span class="nf">scalar_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_precision</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">isfloat</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">))</span> <span class="ow">or</span> <span class="n">util_type</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">isfloat</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&#39;%.&#39;</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;f&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="p">,)</span>
    <span class="k">elif</span> <span class="n">max_precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">isfloat</span><span class="p">:</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;%.&#39;</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">max_precision</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;f&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="p">,)</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="n">str_</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;0.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">str_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="remove_chars"><a class="viewcode-back" href="../../utool.html#utool.util_str.remove_chars">[docs]</a><span class="k">def</span> <span class="nf">remove_chars</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">char_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    removes all chars in char_list from str_</span>

<span class="sd">    Args:</span>
<span class="sd">        str_ (str):</span>
<span class="sd">        char_list (list):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: outstr</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; str_ = &#39;1, 2, 3, 4&#39;</span>
<span class="sd">        &gt;&gt;&gt; char_list = [&#39;,&#39;]</span>
<span class="sd">        &gt;&gt;&gt; result = remove_chars(str_, char_list)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        1 2 3 4</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outstr</span> <span class="o">=</span> <span class="n">str_</span><span class="p">[:]</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">char_list</span><span class="p">:</span>
        <span class="n">outstr</span> <span class="o">=</span> <span class="n">outstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outstr</span>

</div>
<div class="viewcode-block" id="get_indentation"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_indentation">[docs]</a><span class="k">def</span> <span class="nf">get_indentation</span><span class="p">(</span><span class="n">line_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns the number of preceding spaces</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="get_minimum_indentation"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_minimum_indentation">[docs]</a><span class="k">def</span> <span class="nf">get_minimum_indentation</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns the number of preceding spaces</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): unicode text</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: indentation</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-get_minimum_indentation --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; text = &#39;    foo\n   bar&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = get_minimum_indentation(text)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">indentations</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_indentation</span><span class="p">(</span><span class="n">line_</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">line_</span> <span class="ow">in</span> <span class="n">lines</span>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indentations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">indentations</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="unindent"><a class="viewcode-back" href="../../utool.html#utool.util_str.unindent">[docs]</a><span class="k">def</span> <span class="nf">unindent</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unindent a block of text</span>

<span class="sd">    Alias for textwrap.dedent</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="codeblock"><a class="viewcode-back" href="../../utool.html#utool.util_str.codeblock">[docs]</a><span class="k">def</span> <span class="nf">codeblock</span><span class="p">(</span><span class="n">block_str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convinience function for defining code strings. Esspecially useful for</span>
<span class="sd">    templated code.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">unindent</span><span class="p">(</span><span class="n">block_str</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="flatten_textlines"><a class="viewcode-back" href="../../utool.html#utool.util_str.flatten_textlines">[docs]</a><span class="k">def</span> <span class="nf">flatten_textlines</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; *</span><span class="se">\n</span><span class="s"> *&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_text</span>

</div>
<div class="viewcode-block" id="remove_doublspaces"><a class="viewcode-back" href="../../utool.html#utool.util_str.remove_doublspaces">[docs]</a><span class="k">def</span> <span class="nf">remove_doublspaces</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;  *&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>
    <span class="c">#, flags=re.MULTILINE)</span>
    <span class="k">return</span> <span class="n">new_text</span>

</div>
<div class="viewcode-block" id="textblock"><a class="viewcode-back" href="../../utool.html#utool.util_str.textblock">[docs]</a><span class="k">def</span> <span class="nf">textblock</span><span class="p">(</span><span class="n">multiline_text</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        block_str (str):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-textblock</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; multiline_text = &#39;&#39;&#39; a big string</span>
<span class="sd">            that should be layed out flat</span>
<span class="sd">            yet still provide nice python</span>
<span class="sd">            code that doesnt go too far over</span>
<span class="sd">            80 characters.</span>

<span class="sd">            Two newlines should be respected though</span>
<span class="sd">            &#39;&#39;&#39;</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; new_text = textblock(multiline_text)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; result = new_text</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">flatten_textlines</span><span class="p">,</span> <span class="n">multiline_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)))</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_lines</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_text</span>

</div>
<div class="viewcode-block" id="indent"><a class="viewcode-back" href="../../utool.html#utool.util_str.indent">[docs]</a><span class="k">def</span> <span class="nf">indent</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s">&#39;    &#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Indents a block of text</span>

<span class="sd">    Args:</span>
<span class="sd">        str_ (str):</span>
<span class="sd">        indent (str): (default = &#39;    &#39;) TODO rename to indent_ or rename func</span>

<span class="sd">    Returns:</span>
<span class="sd">        str:</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-indent</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; str_ = &#39;foobar\nbazbiz&#39;</span>
<span class="sd">        &gt;&gt;&gt; indent = &#39;    &#39;</span>
<span class="sd">        &gt;&gt;&gt; result = indent(str_, indent)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">indent_rest</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="indent_rest"><a class="viewcode-back" href="../../utool.html#utool.util_str.indent_rest">[docs]</a><span class="k">def</span> <span class="nf">indent_rest</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s">&#39;    &#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; TODO fix name Indents every part of the string except the beginning</span>
<span class="sd">    SeeAlso: ibeis/templates/generate_notebook.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">str_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">indent</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="indentcat"><a class="viewcode-back" href="../../utool.html#utool.util_str.indentcat">[docs]</a><span class="k">def</span> <span class="nf">indentcat</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s">&#39;    &#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">str1</span>  <span class="o">+</span> <span class="n">str2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">indent</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="indentjoin"><a class="viewcode-back" href="../../utool.html#utool.util_str.indentjoin">[docs]</a><span class="k">def</span> <span class="nf">indentjoin</span><span class="p">(</span><span class="n">strlist</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Convineince indentjoin</span>

<span class="sd">    similar to &#39;\n    &#39;.join(strlist) but indent is also prefixed</span>

<span class="sd">    Args:</span>
<span class="sd">        strlist (?):</span>
<span class="sd">        indent  (str):</span>
<span class="sd">        suffix  (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: joined list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indent_</span> <span class="o">=</span> <span class="n">indent</span>
    <span class="n">strlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">strlist</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">indent_</span> <span class="o">+</span> <span class="n">indent_</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span> <span class="o">+</span> <span class="n">suffix</span>
                                   <span class="k">for</span> <span class="n">str_</span> <span class="ow">in</span> <span class="n">strlist</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="truncate_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.truncate_str">[docs]</a><span class="k">def</span> <span class="nf">truncate_str</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span> <span class="n">truncmsg</span><span class="o">=</span><span class="s">&#39; ~~~TRUNCATED~~~ &#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes the middle part of any string over maxlen characters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">NO_TRUNCATE</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">str_</span>
    <span class="k">if</span> <span class="n">maxlen</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">maxlen</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxlen</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">str_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">maxlen_</span> <span class="o">=</span> <span class="n">maxlen</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">truncmsg</span><span class="p">)</span>
        <span class="n">lowerb</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">maxlen_</span> <span class="o">*</span> <span class="o">.</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">upperb</span>  <span class="o">=</span> <span class="n">maxlen_</span> <span class="o">-</span> <span class="n">lowerb</span>
        <span class="n">tup</span> <span class="o">=</span> <span class="p">(</span><span class="n">str_</span><span class="p">[:</span><span class="n">lowerb</span><span class="p">],</span> <span class="n">truncmsg</span><span class="p">,</span> <span class="n">str_</span><span class="p">[</span><span class="o">-</span><span class="n">upperb</span><span class="p">:])</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">__OLD_pack_into</span><span class="p">(</span><span class="n">instr</span><span class="p">,</span> <span class="n">textwidth</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span> <span class="n">breakchars</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">break_words</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">newline_prefix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">wordsep</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    BROKEN DO NOT USE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">textwidth_</span> <span class="o">=</span> <span class="n">textwidth</span>
    <span class="n">line_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>
    <span class="n">word_list</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">breakchars</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">textwidth_</span><span class="p">:</span>
            <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">textwidth_</span> <span class="o">=</span> <span class="n">textwidth</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">newline_prefix</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">break_words</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">textwidth_</span><span class="p">:</span>
            <span class="n">line_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">word</span><span class="p">[:</span><span class="n">textwidth_</span><span class="p">]</span>
            <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">textwidth_</span><span class="p">:]</span>
        <span class="n">line_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">word</span> <span class="o">+</span> <span class="n">wordsep</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">newline_prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span>


<div class="viewcode-block" id="pack_into"><a class="viewcode-back" href="../../utool.html#utool.util_str.pack_into">[docs]</a><span class="k">def</span> <span class="nf">pack_into</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">textwidth</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span> <span class="n">breakchars</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">break_words</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">newline_prefix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">wordsep</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">remove_newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>

<span class="sd">    DEPRICATE IN FAVOR OF textwrap.wrap</span>

<span class="sd">    TODO: Look into textwrap.wrap</span>

<span class="sd">    Inserts newlines into a string enforcing a maximum textwidth.</span>
<span class="sd">    Similar to vim&#39;s gq command in visual select mode.</span>

<span class="sd">    breakchars is a string containing valid characters to insert a newline</span>
<span class="sd">    before or after.</span>

<span class="sd">    break_words is True if words are allowed to be split over multiple lines.</span>

<span class="sd">    all inserted newlines are prefixed with newline_prefix</span>

<span class="sd">    #FIXME:</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; text = &quot;set_image_uris(ibs&lt;139684018194000&gt;, [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13], [u&#39;66ec193a-1619-b3b6-216d-1784b4833b61.jpg&#39;, u&#39;d8903434-942f-e0f5-d6c2-0dcbe3137bf7.jpg&#39;, u&#39;b73b72f4-4acb-c445-e72c-05ce02719d3d.jpg&#39;, u&#39;0cd05978-3d83-b2ee-2ac9-798dd571c3b3.jpg&#39;, u&#39;0a9bc03d-a75e-8d14-0153-e2949502aba7.jpg&#39;, u&#39;2deeff06-5546-c752-15dc-2bd0fdb1198a.jpg&#39;, u&#39;a9b70278-a936-c1dd-8a3b-bc1e9a998bf0.png&#39;, u&#39;42fdad98-369a-2cbc-67b1-983d6d6a3a60.jpg&#39;, u&#39;c459d381-fd74-1d99-6215-e42e3f432ea9.jpg&#39;, u&#39;33fd9813-3a2b-774b-3fcc-4360d1ae151b.jpg&#39;, u&#39;97e8ea74-873f-2092-b372-f928a7be30fa.jpg&#39;, u&#39;588bc218-83a5-d400-21aa-d499832632b0.jpg&#39;, u&#39;163a890c-36f2-981e-3529-c552b6d668a3.jpg&#39;], ) &quot;  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; textwidth = 160</span>
<span class="sd">        &gt;&gt;&gt; breakchars = &#39; &#39;</span>
<span class="sd">        &gt;&gt;&gt; break_words = True</span>
<span class="sd">        &gt;&gt;&gt; newline_prefix = &#39;    &#39;</span>
<span class="sd">        &gt;&gt;&gt; wordsep = &#39; &#39;</span>
<span class="sd">        &gt;&gt;&gt; packstr1 = pack_into(text, textwidth, breakchars, break_words, newline_prefix, wordsep)</span>
<span class="sd">        &gt;&gt;&gt; break_words = False</span>
<span class="sd">        &gt;&gt;&gt; packstr2 = pack_into(text, textwidth, breakchars, break_words, newline_prefix, wordsep)</span>
<span class="sd">        &gt;&gt;&gt; print(packstr1)</span>
<span class="sd">        &gt;&gt;&gt; print(packstr2)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -c &quot;import utool&quot; --dump-utool-init</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#FIXME: messy code</span>
    <span class="n">textwidth_</span> <span class="o">=</span> <span class="n">textwidth</span>
    <span class="c"># Accumulate a list of lines</span>
    <span class="n">line_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>
    <span class="c"># Split text into list of words</span>
    <span class="n">word_list</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">breakchars</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">remove_newlines</span><span class="p">:</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
        <span class="n">available</span> <span class="o">=</span> <span class="n">textwidth_</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c"># Check to see if we need to make a new line</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">available</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">break_words</span><span class="p">:</span>
                <span class="c"># If we are allowed to break words over multiple lines</span>
                <span class="c"># Fill the rest of the available textwidth with part of the</span>
                <span class="c"># word</span>
                <span class="n">line_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">word</span><span class="p">[:</span><span class="n">available</span><span class="p">]</span>
                <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">available</span><span class="p">:]</span>
            <span class="c"># Append a new line to the list</span>
            <span class="c"># Reset the avaiablable textwidth for new line</span>
            <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">textwidth_</span> <span class="o">=</span> <span class="n">textwidth</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">newline_prefix</span><span class="p">)</span>
            <span class="n">available</span> <span class="o">=</span> <span class="n">textwidth_</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">break_words</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="c"># Append the word and a separator to the current line.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># Weird if statement. Probably bug somewhere.</span>
            <span class="n">textwidth_</span> <span class="o">=</span> <span class="n">textwidth</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">newline_prefix</span><span class="p">)</span>
        <span class="n">line_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">word</span> <span class="o">+</span> <span class="n">wordsep</span>
    <span class="n">packed_str</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">newline_prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">packed_str</span>

</div>
<div class="viewcode-block" id="packstr"><a class="viewcode-back" href="../../utool.html#utool.util_str.packstr">[docs]</a><span class="k">def</span> <span class="nf">packstr</span><span class="p">(</span><span class="n">instr</span><span class="p">,</span> <span class="n">textwidth</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span> <span class="n">breakchars</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">break_words</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">newline_prefix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">indentation</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">nlprefix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">wordsep</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span>
            <span class="n">remove_newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; alias for pack_into. has more up to date kwargs &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instr</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">instr</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">instr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nlprefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">newline_prefix</span> <span class="o">=</span> <span class="n">nlprefix</span>
    <span class="n">str_</span> <span class="o">=</span> <span class="n">pack_into</span><span class="p">(</span><span class="n">instr</span><span class="p">,</span> <span class="n">textwidth</span><span class="p">,</span> <span class="n">breakchars</span><span class="p">,</span> <span class="n">break_words</span><span class="p">,</span> <span class="n">newline_prefix</span><span class="p">,</span>
                     <span class="n">wordsep</span><span class="p">,</span> <span class="n">remove_newlines</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">indentation</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="n">indent</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">indentation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">str_</span>

</div>
<div class="viewcode-block" id="packtext"><a class="viewcode-back" href="../../utool.html#utool.util_str.packtext">[docs]</a><span class="k">def</span> <span class="nf">packtext</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        text (str):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-pack_paragraph --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; width = 80</span>
<span class="sd">        &gt;&gt;&gt; text = lorium_ipsum()</span>
<span class="sd">        &gt;&gt;&gt; result = packtext(text)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="kn">import</span> <span class="nn">textwrap</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">remove_doublspaces</span><span class="p">(</span><span class="n">new_text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">new_text</span>

</div>
<div class="viewcode-block" id="joins"><a class="viewcode-back" href="../../utool.html#utool.util_str.joins">[docs]</a><span class="k">def</span> <span class="nf">joins</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">list_</span><span class="p">,</span> <span class="n">with_head</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_tail</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">tostrip</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
    <span class="n">head</span> <span class="o">=</span> <span class="n">string</span> <span class="k">if</span> <span class="n">with_head</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    <span class="n">tail</span> <span class="o">=</span> <span class="n">string</span> <span class="k">if</span> <span class="n">with_tail</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    <span class="n">to_return</span> <span class="o">=</span> <span class="n">head</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">,</span> <span class="n">list_</span><span class="p">))</span> <span class="o">+</span> <span class="n">tail</span>
    <span class="n">to_return</span> <span class="o">=</span> <span class="n">to_return</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">tostrip</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">to_return</span>

</div>
<div class="viewcode-block" id="indent_list"><a class="viewcode-back" href="../../utool.html#utool.util_str.indent_list">[docs]</a><span class="k">def</span> <span class="nf">indent_list</span><span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="n">list_</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="n">list_</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="filesize_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.filesize_str">[docs]</a><span class="k">def</span> <span class="nf">filesize_str</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="n">mb_str</span> <span class="o">=</span> <span class="n">file_megabytes_str</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;filesize(</span><span class="si">%r</span><span class="s">)=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mb_str</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="seconds_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.seconds_str">[docs]</a><span class="k">def</span> <span class="nf">seconds_str</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        str</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; num_list = sorted([4.2 / (10.0 ** exp_)</span>
<span class="sd">        &gt;&gt;&gt;                    for exp_ in range(-13, 13, 4)])</span>
<span class="sd">        &gt;&gt;&gt; secstr_list = [seconds_str(num, prefix=None) for num in num_list]</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;, &#39;.join(secstr_list))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        0.04 ns, 0.42 us, 4.20 ms, 0.04 ks, 0.42 Ms, 4.20 Gs, 42.00 Ts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">exponent_list</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
    <span class="n">small_prefix_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="s">&#39;n&#39;</span><span class="p">,</span> <span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="s">&#39;M&#39;</span><span class="p">,</span> <span class="s">&#39;G&#39;</span><span class="p">,</span> <span class="s">&#39;T&#39;</span><span class="p">]</span>
    <span class="c">#large_prefix_list = [&#39;pico&#39;, &#39;nano&#39;, &#39;micro&#39;, &#39;mili&#39;, &#39;&#39;, &#39;kilo&#39;, &#39;mega&#39;,</span>
    <span class="c"># &#39;giga&#39;, &#39;tera&#39;]</span>
    <span class="c">#large_suffix = &#39;second&#39;</span>
    <span class="n">small_suffix</span> <span class="o">=</span> <span class="s">&#39;s&#39;</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">small_suffix</span>
    <span class="n">prefix_list</span> <span class="o">=</span> <span class="n">small_prefix_list</span>
    <span class="n">base</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">secstr</span> <span class="o">=</span> <span class="n">order_of_magnitude_str</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">prefix_list</span><span class="p">,</span> <span class="n">exponent_list</span><span class="p">,</span>
                                    <span class="n">suffix</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">secstr</span>

</div>
<div class="viewcode-block" id="order_of_magnitude_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.order_of_magnitude_str">[docs]</a><span class="k">def</span> <span class="nf">order_of_magnitude_str</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
                           <span class="n">prefix_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="n">exponent_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="n">suffix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO: Rewrite byte_str to use this func</span>
<span class="sd">    Returns:</span>
<span class="sd">        str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">abs_num</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="c"># Find the right magnidue</span>
    <span class="k">for</span> <span class="n">prefix_</span><span class="p">,</span> <span class="n">exponent</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">prefix_list</span><span class="p">,</span> <span class="n">exponent_list</span><span class="p">):</span>
        <span class="c"># Let user request the prefix</span>
        <span class="n">requested</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">!=</span> <span class="n">prefix_</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">requested</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c"># Otherwise find the best prefix</span>
        <span class="n">magnitude</span> <span class="o">=</span> <span class="n">base</span> <span class="o">**</span> <span class="n">exponent</span>
        <span class="c"># Be less than this threshold to use this unit</span>
        <span class="n">thresh_mag</span> <span class="o">=</span> <span class="n">magnitude</span> <span class="o">*</span> <span class="n">base</span>
        <span class="k">if</span> <span class="n">requested</span> <span class="ow">or</span> <span class="n">abs_num</span> <span class="o">&lt;=</span> <span class="n">thresh_mag</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">unit_str</span> <span class="o">=</span> <span class="n">_magnitude_str</span><span class="p">(</span><span class="n">abs_num</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">prefix_</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unit_str</span>

</div>
<span class="k">def</span> <span class="nf">_magnitude_str</span><span class="p">(</span><span class="n">abs_num</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">prefix_</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
    <span class="n">scaled_num</span> <span class="o">=</span> <span class="n">abs_num</span> <span class="o">/</span> <span class="n">magnitude</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">prefix_</span> <span class="o">+</span> <span class="n">suffix</span>
    <span class="n">unit_str</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%.2f</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scaled_num</span><span class="p">,</span> <span class="n">unit</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">unit_str</span>


<div class="viewcode-block" id="parse_bytes"><a class="viewcode-back" href="../../utool.html#utool.util_str.parse_bytes">[docs]</a><span class="k">def</span> <span class="nf">parse_bytes</span><span class="p">(</span><span class="n">bytes_str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    uint8_size = ut.parse_bytes(&#39;1B&#39;)</span>
<span class="sd">    image_size = ut.parse_bytes(&#39;3.5MB&#39;)</span>
<span class="sd">    float32_size = ut.parse_bytes(&#39;32bit&#39;)</span>
<span class="sd">    desc_size = 128 * uint8_size</span>
<span class="sd">    kpts_size = 6 * float32_size</span>
<span class="sd">    chip_size = ut.parse_bytes(&#39;400 KB&#39;)</span>
<span class="sd">    probchip_size = ut.parse_bytes(&#39;50 KB&#39;)</span>
<span class="sd">    nImgs = 80000 # 80,000</span>
<span class="sd">    nAnnots = nImgs * 2</span>
<span class="sd">    desc_per_img = 3000</span>
<span class="sd">    size_stats = {</span>
<span class="sd">        &#39;image&#39;: nImgs * image_size,</span>
<span class="sd">        &#39;chips&#39;: nAnnots * chip_size,</span>
<span class="sd">        &#39;probchips&#39;: nAnnots * probchip_size,</span>
<span class="sd">        &#39;desc&#39;: nAnnots * desc_size * desc_per_img,</span>
<span class="sd">        &#39;kpts&#39;: nAnnots * kpts_size * desc_per_img,</span>
<span class="sd">    }</span>
<span class="sd">    print(ut.repr3(ut.map_dict_vals(ut.byte_str2, size_stats), align=True))</span>
<span class="sd">    print(&#39;total = &#39; + ut.byte_str2(sum(size_stats.values())))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="n">numstr</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">named_field</span><span class="p">(</span><span class="s">&#39;num&#39;</span><span class="p">,</span> <span class="s">r&#39;\d\.?\d*&#39;</span><span class="p">)</span>
    <span class="n">unitstr</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">named_field</span><span class="p">(</span><span class="s">&#39;unit&#39;</span><span class="p">,</span> <span class="s">r&#39;[a-zA-Z]+&#39;</span><span class="p">)</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">numstr</span> <span class="o">+</span> <span class="s">&#39; *&#39;</span> <span class="o">+</span> <span class="n">unitstr</span><span class="p">,</span> <span class="n">bytes_str</span><span class="p">)</span>
    <span class="n">nUnits</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()[</span><span class="s">&#39;num&#39;</span><span class="p">])</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()[</span><span class="s">&#39;unit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">nBytes</span> <span class="o">=</span> <span class="n">get_bytes</span><span class="p">(</span><span class="n">nUnits</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nBytes</span>

</div>
<div class="viewcode-block" id="get_bytes"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_bytes">[docs]</a><span class="k">def</span> <span class="nf">get_bytes</span><span class="p">(</span><span class="n">nUnits</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
    <span class="n">unitdict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;TB&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">40</span><span class="p">,</span> <span class="s">&#39;GB&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">30</span><span class="p">,</span> <span class="s">&#39;MB&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">20</span><span class="p">,</span> <span class="s">&#39;KB&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">0</span><span class="p">}</span>
    <span class="c"># https://en.wikipedia.org/wiki/Units_of_information#Obsolete_and_unusual_units</span>
    <span class="n">unitdict</span><span class="p">[</span><span class="s">&#39;BIT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span>
    <span class="n">unitdict</span><span class="p">[</span><span class="s">&#39;CRUMB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span>
    <span class="n">unitdict</span><span class="p">[</span><span class="s">&#39;NIBBLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">unitdict</span><span class="p">[</span><span class="s">&#39;CHOMP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">unit_nBytes</span> <span class="o">=</span> <span class="n">unitdict</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
    <span class="n">nBytes</span> <span class="o">=</span> <span class="n">unit_nBytes</span> <span class="o">*</span> <span class="n">nUnits</span>
    <span class="k">return</span> <span class="n">nBytes</span>

</div>
<div class="viewcode-block" id="byte_str2"><a class="viewcode-back" href="../../utool.html#utool.util_str.byte_str2">[docs]</a><span class="k">def</span> <span class="nf">byte_str2</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Automatically chooses relevant unit (KB, MB, or GB) for displaying some</span>
<span class="sd">    number of bytes.</span>

<span class="sd">    Args:</span>
<span class="sd">        nBytes (int):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str:</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-byte_str2</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; nBytes_list = [1, 100, 1024,  1048576, 1073741824, 1099511627776]</span>
<span class="sd">        &gt;&gt;&gt; result = ut.list_str(list(map(byte_str2, nBytes_list)), nl=False)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [&#39;0.00 KB&#39;, &#39;0.10 KB&#39;, &#39;1.00 KB&#39;, &#39;1.00 MB&#39;, &#39;1.00 GB&#39;, &#39;1.00 TB&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nAbsBytes</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nBytes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nAbsBytes</span> <span class="o">&lt;</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">byte_str</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="s">&#39;KB&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nAbsBytes</span> <span class="o">&lt;</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">byte_str</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="s">&#39;KB&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nAbsBytes</span> <span class="o">&lt;</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="mi">30</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">byte_str</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="s">&#39;MB&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nAbsBytes</span> <span class="o">&lt;</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="mi">40</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">byte_str</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="s">&#39;GB&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">byte_str</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="s">&#39;TB&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="byte_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.byte_str">[docs]</a><span class="k">def</span> <span class="nf">byte_str</span><span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;bytes&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    representing the number of bytes with the chosen unit</span>

<span class="sd">    Returns:</span>
<span class="sd">        str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">):</span>
        <span class="n">nUnit</span> <span class="o">=</span> <span class="n">nBytes</span>
    <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">):</span>
        <span class="n">nUnit</span> <span class="o">=</span>  <span class="n">nBytes</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">):</span>
        <span class="n">nUnit</span> <span class="o">=</span>  <span class="n">nBytes</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="mi">20</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">):</span>
        <span class="n">nUnit</span> <span class="o">=</span> <span class="n">nBytes</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="mi">30</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">):</span>
        <span class="n">nUnit</span> <span class="o">=</span> <span class="n">nBytes</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="mi">40</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;unknown nBytes=</span><span class="si">%r</span><span class="s"> unit=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nBytes</span><span class="p">,</span> <span class="n">unit</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">scalar_str</span><span class="p">(</span><span class="n">nUnit</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">unit</span>
    <span class="c">#fmtstr = (&#39;%.&#39;</span>
    <span class="c">#return (&#39;%.&#39; + str(precision) + &#39;f %s&#39;) % (nUnit, unit)</span>

</div>
<div class="viewcode-block" id="file_megabytes_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.file_megabytes_str">[docs]</a><span class="k">def</span> <span class="nf">file_megabytes_str</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_path</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%.2f</span><span class="s"> MB&#39;</span> <span class="o">%</span> <span class="n">util_path</span><span class="o">.</span><span class="n">file_megabytes</span><span class="p">(</span><span class="n">fpath</span><span class="p">))</span>


<span class="c"># &lt;Alias repr funcs&gt;</span>
<span class="c"># TODO: Remove any type of global information</span>
</div>
<span class="n">USE_GLOBAL_INFO</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">if</span> <span class="n">USE_GLOBAL_INFO</span><span class="p">:</span>

    <span class="n">GLOBAL_TYPE_ALIASES</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">extend_global_aliases</span><span class="p">(</span><span class="n">type_aliases</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        State function for aliased_repr calls</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">GLOBAL_TYPE_ALIASES</span>
        <span class="n">GLOBAL_TYPE_ALIASES</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">type_aliases</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">var_aliased_repr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">type_aliases</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replaces unweildy type strings with predefined more human-readable</span>
<span class="sd">        aliases</span>

<span class="sd">        Args:</span>
<span class="sd">            var: some object</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: an &quot;intelligently&quot; chosen string representation of var</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">GLOBAL_TYPE_ALIASES</span>
        <span class="c"># Replace aliased values</span>
        <span class="k">for</span> <span class="n">alias_type</span><span class="p">,</span> <span class="n">alias_name</span> <span class="ow">in</span> <span class="p">(</span><span class="n">type_aliases</span> <span class="o">+</span> <span class="n">GLOBAL_TYPE_ALIASES</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">alias_type</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">alias_name</span> <span class="o">+</span> <span class="s">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">var</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_aliased_repr</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">type_aliases</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replaces unweildy type strings with predefined more human-readable</span>
<span class="sd">        aliases</span>

<span class="sd">        Args:</span>
<span class="sd">            list_ (list): ``list`` to get repr</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: string representation of ``list_``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">var_aliased_repr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">type_aliases</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">dict_aliased_repr</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">type_aliases</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replaces unweildy type strings with predefined more human-readable</span>
<span class="sd">        aliases</span>

<span class="sd">        Args:</span>
<span class="sd">            dict_ (dict): dictionary to get repr</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: string representation of ``dict_``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> : </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">var_aliased_repr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">type_aliases</span><span class="p">))</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)]</span>

<span class="c"># &lt;/Alias repr funcs&gt;</span>


<div class="viewcode-block" id="newlined_list"><a class="viewcode-back" href="../../utool.html#utool.util_str.newlined_list">[docs]</a><span class="k">def</span> <span class="nf">newlined_list</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">joinstr</span><span class="o">=</span><span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="n">textwidth</span><span class="o">=</span><span class="mi">160</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a list to a string but inserts a new line after textwidth chars</span>
<span class="sd">    DEPRICATE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newlines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newlines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">textwidth</span><span class="p">:</span>
            <span class="n">newlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">newlines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">word</span> <span class="o">+</span> <span class="n">joinstr</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">newlines</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="func_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.func_str">[docs]</a><span class="k">def</span> <span class="nf">func_str</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">type_aliases</span><span class="o">=</span><span class="p">[],</span> <span class="n">packed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">packkw</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    string representation of function definition</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: a representation of func with args, kwargs, and type_aliases</span>

<span class="sd">    Args:</span>
<span class="sd">        func (function):</span>
<span class="sd">        args (list): argument values (default = [])</span>
<span class="sd">        kwargs (dict): kwargs values (default = {})</span>
<span class="sd">        type_aliases (list): (default = [])</span>
<span class="sd">        packed (bool): (default = False)</span>
<span class="sd">        packkw (None): (default = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: func_str</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-func_str</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; func = byte_str</span>
<span class="sd">        &gt;&gt;&gt; args = [1024, &#39;MB&#39;]</span>
<span class="sd">        &gt;&gt;&gt; kwargs = dict(precision=2)</span>
<span class="sd">        &gt;&gt;&gt; type_aliases = []</span>
<span class="sd">        &gt;&gt;&gt; packed = False</span>
<span class="sd">        &gt;&gt;&gt; packkw = None</span>
<span class="sd">        &gt;&gt;&gt; _str = func_str(func, args, kwargs, type_aliases, packed, packkw)</span>
<span class="sd">        &gt;&gt;&gt; result = _str</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        byte_str(1024, &#39;MB&#39;, precision=2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#repr_list = list_aliased_repr(args, type_aliases) + dict_aliased_repr(kwargs)</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="n">argrepr_list</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span>
                    <span class="n">ut</span><span class="o">.</span><span class="n">get_itemstr_list</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">with_comma</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
    <span class="n">kwrepr_list</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span>
                   <span class="n">ut</span><span class="o">.</span><span class="n">dict_itemstr_list</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">explicit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                        <span class="n">with_comma</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
    <span class="n">repr_list</span> <span class="o">=</span> <span class="n">argrepr_list</span> <span class="o">+</span> <span class="n">kwrepr_list</span>
    <span class="c">#argskwargs_str = newlined_list(repr_list, &#39;, &#39;, textwidth=80)</span>
    <span class="n">argskwargs_str</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repr_list</span><span class="p">)</span>
    <span class="n">_str</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">meta_util_six</span><span class="o">.</span><span class="n">get_funcname</span><span class="p">(</span><span class="n">func</span><span class="p">),</span> <span class="n">argskwargs_str</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">packed</span><span class="p">:</span>
        <span class="n">packkw_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">textwidth</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">nlprefix</span><span class="o">=</span><span class="s">&#39;    &#39;</span><span class="p">,</span> <span class="n">break_words</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">packkw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">packkw_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">packkw_</span><span class="p">)</span>
        <span class="n">_str</span> <span class="o">=</span> <span class="n">packstr</span><span class="p">(</span><span class="n">_str</span><span class="p">,</span> <span class="o">**</span><span class="n">packkw_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_str</span>

</div>
<div class="viewcode-block" id="func_defsig"><a class="viewcode-back" href="../../utool.html#utool.util_str.func_defsig">[docs]</a><span class="k">def</span> <span class="nf">func_defsig</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">with_name</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    String of function definition signature</span>

<span class="sd">    Args:</span>
<span class="sd">        func (function): live python function</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: defsig</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-func_defsig</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; func = func_str</span>
<span class="sd">        &gt;&gt;&gt; defsig = func_defsig(func)</span>
<span class="sd">        &gt;&gt;&gt; result = str(defsig)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        func_str(func, args=[], kwargs={}, type_aliases=[], packed=False, packkw=None)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">inspect</span>
    <span class="n">argspec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">varargs</span><span class="p">,</span> <span class="n">varkw</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span> <span class="o">=</span> <span class="n">argspec</span>
    <span class="n">defsig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">formatargspec</span><span class="p">(</span><span class="o">*</span><span class="n">argspec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">with_name</span><span class="p">:</span>
        <span class="n">defsig</span> <span class="o">=</span> <span class="n">get_callable_name</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="o">+</span> <span class="n">defsig</span>
    <span class="k">return</span> <span class="n">defsig</span>

</div>
<div class="viewcode-block" id="func_callsig"><a class="viewcode-back" href="../../utool.html#utool.util_str.func_callsig">[docs]</a><span class="k">def</span> <span class="nf">func_callsig</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">with_name</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    String of function call signature</span>

<span class="sd">    Args:</span>
<span class="sd">        func (function): live python function</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: callsig</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-func_callsig</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; func = func_str</span>
<span class="sd">        &gt;&gt;&gt; callsig = func_callsig(func)</span>
<span class="sd">        &gt;&gt;&gt; result = str(callsig)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        func_str(func, args, kwargs, type_aliases, packed, packkw)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">inspect</span>
    <span class="n">argspec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">varargs</span><span class="p">,</span> <span class="n">varkw</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span> <span class="o">=</span> <span class="n">argspec</span>
    <span class="n">callsig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">formatargspec</span><span class="p">(</span><span class="o">*</span><span class="n">argspec</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">with_name</span><span class="p">:</span>
        <span class="n">callsig</span> <span class="o">=</span> <span class="n">get_callable_name</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="o">+</span> <span class="n">callsig</span>
    <span class="k">return</span> <span class="n">callsig</span>

</div>
<div class="viewcode-block" id="array_repr2"><a class="viewcode-back" href="../../utool.html#utool.util_str.array_repr2">[docs]</a><span class="k">def</span> <span class="nf">array_repr2</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">max_line_width</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">suppress_small</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">force_dtype</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">with_dtype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; extended version of np.core.numeric.array_repr</span>

<span class="sd">    ut.editfile(np.core.numeric.__file__)</span>

<span class="sd">    On linux:</span>
<span class="sd">    _typelessdata [numpy.int64, numpy.float64, numpy.complex128, numpy.int64]</span>

<span class="sd">    On BakerStreet</span>
<span class="sd">    _typelessdata [numpy.int32, numpy.float64, numpy.complex128, numpy.int32]</span>

<span class="sd">    # WEIRD</span>
<span class="sd">    np.int64 is np.int64</span>
<span class="sd">    _typelessdata[0] is _typelessdata[-1]</span>
<span class="sd">    _typelessdata[0] == _typelessdata[-1]</span>

<span class="sd">    TODO:</span>
<span class="sd">        replace force_dtype with with_dtype</span>


<span class="sd">    id(_typelessdata[-1])</span>
<span class="sd">    id(_typelessdata[0])</span>


<span class="sd">    from numpy.core.numeric import _typelessdata</span>
<span class="sd">    _typelessdata</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/28455982/why-are-there-two-np-int64s</span>
<span class="sd">        -in-numpy-core-numeric-typelessdata-why-is-numpy-in/28461928#28461928</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">numpy.core.numeric</span> <span class="kn">import</span> <span class="n">_typelessdata</span>

    <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">cName</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cName</span> <span class="o">=</span> <span class="s">&#39;array&#39;</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="n">cName</span> <span class="o">+</span> <span class="s">&#39;(&#39;</span>

    <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,):</span>
        <span class="n">separator</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="n">array2string2</span><span class="p">(</span>
            <span class="n">arr</span><span class="p">,</span> <span class="n">max_line_width</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">suppress_small</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># show zero-length shape unless it is (0,)</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="s">&#39;[], shape=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">),)</span>

    <span class="n">skipdtype</span> <span class="o">=</span> <span class="p">((</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">_typelessdata</span><span class="p">)</span> <span class="ow">and</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">with_dtype</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">with_dtype</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">skipdtype</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cName</span> <span class="o">==</span> <span class="s">&#39;array&#39;</span> <span class="ow">and</span> <span class="n">force_dtype</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">with_dtype</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cName</span><span class="p">,</span> <span class="n">lst</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">typename</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span>
        <span class="c"># Quote typename in the output if it is &#39;complex&#39;.</span>
        <span class="k">if</span> <span class="n">typename</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">typename</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="ow">and</span> <span class="n">typename</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()):</span>
            <span class="n">typename</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">typename</span>

        <span class="n">lf</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flexible</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="n">typename</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">typename</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">lf</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cName</span> <span class="o">+</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">dtype=</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">lf</span><span class="p">,</span> <span class="n">typename</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="array2string2"><a class="viewcode-back" href="../../utool.html#utool.util_str.array2string2">[docs]</a><span class="k">def</span> <span class="nf">array2string2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">max_line_width</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">suppress_small</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">separator</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="nb">repr</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">threshold</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    expanded version of np.core.arrayprint.array2string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">warnings</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">_format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;The `_format` attribute is deprecated in Numpy &quot;</span> \
                  <span class="s">&quot;2.0 and will be removed in 2.1. Use the &quot;</span> \
                  <span class="s">&quot;`formatter` kw instead.&quot;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_convert_arrays</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="n">style</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">product</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># treat as a null array if any of shape elements == 0</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="s">&quot;[]&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="n">_array2string2</span><span class="p">(</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">max_line_width</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">suppress_small</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="n">formatter</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lst</span>

</div>
<span class="k">def</span> <span class="nf">_array2string2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">max_line_width</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">suppress_small</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span>
                   <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    expanded version of np.core.arrayprint._array2string</span>
<span class="sd">    TODO: make a numpy pull request with a fixed version</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">arrayprint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span>

    <span class="k">if</span> <span class="n">max_line_width</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">max_line_width</span> <span class="o">=</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">_line_width</span>

    <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">_float_output_precision</span>

    <span class="k">if</span> <span class="n">suppress_small</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">suppress_small</span> <span class="o">=</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">_float_output_suppress_small</span>

    <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">_formatter</span>

    <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">_summaryThreshold</span>

    <span class="k">if</span> <span class="n">threshold</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="n">summary_insert</span> <span class="o">=</span> <span class="s">&quot;..., &quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">_leading_trailing</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">summary_insert</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="n">formatdict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;bool&#39;</span> <span class="p">:</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">_boolFormatter</span><span class="p">,</span>
                  <span class="s">&#39;int&#39;</span> <span class="p">:</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">IntegerFormat</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                  <span class="s">&#39;float&#39;</span> <span class="p">:</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">FloatFormat</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">suppress_small</span><span class="p">),</span>
                  <span class="s">&#39;longfloat&#39;</span> <span class="p">:</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">LongFloatFormat</span><span class="p">(</span><span class="n">precision</span><span class="p">),</span>
                  <span class="s">&#39;complexfloat&#39;</span> <span class="p">:</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">ComplexFormat</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span>
                                                            <span class="n">suppress_small</span><span class="p">),</span>
                  <span class="s">&#39;longcomplexfloat&#39;</span> <span class="p">:</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">LongComplexFormat</span><span class="p">(</span><span class="n">precision</span><span class="p">),</span>
                  <span class="s">&#39;datetime&#39;</span> <span class="p">:</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">DatetimeFormat</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                  <span class="s">&#39;timedelta&#39;</span> <span class="p">:</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">TimedeltaFormat</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                  <span class="s">&#39;numpystr&#39;</span> <span class="p">:</span> <span class="n">arrayprint</span><span class="o">.</span><span class="n">repr_format</span><span class="p">,</span>
                  <span class="s">&#39;str&#39;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">formatter</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">formatter</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">fkeys</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">formatdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">formatdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatter</span><span class="p">[</span><span class="s">&#39;all&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;int_kind&#39;</span> <span class="ow">in</span> <span class="n">fkeys</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">]:</span>
                <span class="n">formatdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatter</span><span class="p">[</span><span class="s">&#39;int_kind&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;float_kind&#39;</span> <span class="ow">in</span> <span class="n">fkeys</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;float&#39;</span><span class="p">,</span> <span class="s">&#39;longfloat&#39;</span><span class="p">]:</span>
                <span class="n">formatdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatter</span><span class="p">[</span><span class="s">&#39;float_kind&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;complex_kind&#39;</span> <span class="ow">in</span> <span class="n">fkeys</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;complexfloat&#39;</span><span class="p">,</span> <span class="s">&#39;longcomplexfloat&#39;</span><span class="p">]:</span>
                <span class="n">formatdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatter</span><span class="p">[</span><span class="s">&#39;complex_kind&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;str_kind&#39;</span> <span class="ow">in</span> <span class="n">fkeys</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;numpystr&#39;</span><span class="p">,</span> <span class="s">&#39;str&#39;</span><span class="p">]:</span>
                <span class="n">formatdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatter</span><span class="p">[</span><span class="s">&#39;str_kind&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">formatdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">fkeys</span><span class="p">:</span>
                <span class="n">formatdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatter</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">format_function</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">_format</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;The `_format` attribute is deprecated in Numpy 2.0 and &quot;</span> \
              <span class="s">&quot;will be removed in 2.1. Use the `formatter` kw instead.&quot;</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="c"># find the right formatting function for the array</span>
        <span class="n">dtypeobj</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">dtypeobj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_nt</span><span class="o">.</span><span class="n">bool_</span><span class="p">):</span>
            <span class="n">format_function</span> <span class="o">=</span> <span class="n">formatdict</span><span class="p">[</span><span class="s">&#39;bool&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">dtypeobj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_nt</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">dtypeobj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_nt</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">):</span>
                <span class="n">format_function</span> <span class="o">=</span> <span class="n">formatdict</span><span class="p">[</span><span class="s">&#39;timedelta&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">format_function</span> <span class="o">=</span> <span class="n">formatdict</span><span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">dtypeobj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_nt</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">dtypeobj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_nt</span><span class="o">.</span><span class="n">longfloat</span><span class="p">):</span>
                <span class="n">format_function</span> <span class="o">=</span> <span class="n">formatdict</span><span class="p">[</span><span class="s">&#39;longfloat&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">format_function</span> <span class="o">=</span> <span class="n">formatdict</span><span class="p">[</span><span class="s">&#39;float&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">dtypeobj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_nt</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">dtypeobj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_nt</span><span class="o">.</span><span class="n">clongfloat</span><span class="p">):</span>
                <span class="n">format_function</span> <span class="o">=</span> <span class="n">formatdict</span><span class="p">[</span><span class="s">&#39;longcomplexfloat&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">format_function</span> <span class="o">=</span> <span class="n">formatdict</span><span class="p">[</span><span class="s">&#39;complexfloat&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">dtypeobj</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_nt</span><span class="o">.</span><span class="n">unicode_</span><span class="p">,</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_nt</span><span class="o">.</span><span class="n">string_</span><span class="p">)):</span>
            <span class="n">format_function</span> <span class="o">=</span> <span class="n">formatdict</span><span class="p">[</span><span class="s">&#39;numpystr&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">dtypeobj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_nt</span><span class="o">.</span><span class="n">datetime64</span><span class="p">):</span>
            <span class="n">format_function</span> <span class="o">=</span> <span class="n">formatdict</span><span class="p">[</span><span class="s">&#39;datetime&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">format_function</span> <span class="o">=</span> <span class="n">formatdict</span><span class="p">[</span><span class="s">&#39;numpystr&#39;</span><span class="p">]</span>

    <span class="c"># skip over &quot;[&quot;</span>
    <span class="n">next_line_prefix</span> <span class="o">=</span> <span class="s">&quot; &quot;</span>
    <span class="c"># skip over array(</span>
    <span class="n">next_line_prefix</span> <span class="o">+=</span> <span class="s">&quot; &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>

    <span class="n">lst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_formatArray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">format_function</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">max_line_width</span><span class="p">,</span>
                                          <span class="n">next_line_prefix</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span>
                                          <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrayprint</span><span class="o">.</span><span class="n">_summaryEdgeItems</span><span class="p">,</span> <span class="n">summary_insert</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">lst</span>


<div class="viewcode-block" id="numpy_str2"><a class="viewcode-back" href="../../utool.html#utool.util_str.numpy_str2">[docs]</a><span class="k">def</span> <span class="nf">numpy_str2</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;force_dtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;force_dtype&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;with_dtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;with_dtype&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;suppress_small&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;suppress_small&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;precision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">numpy_str</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="numpy_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.numpy_str">[docs]</a><span class="k">def</span> <span class="nf">numpy_str</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force_dtype</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">with_dtype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">suppress_small</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_line_width</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
              <span class="n">threshold</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    suppress_small = False turns off scientific representation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="s">&#39;suppress&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">suppress_small</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;suppress&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_line_width</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="s">&#39;linewidth&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">max_line_width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;linewidth&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="n">pr</span>
    <span class="c"># TODO: make this a util_str func for numpy reprs</span>
    <span class="k">if</span> <span class="n">strvals</span><span class="p">:</span>
        <span class="n">valstr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
                              <span class="n">suppress_small</span><span class="o">=</span><span class="n">suppress_small</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#valstr = np.array_repr(arr, precision=precision)</span>
        <span class="n">valstr</span> <span class="o">=</span> <span class="n">array_repr2</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">force_dtype</span><span class="o">=</span><span class="n">force_dtype</span><span class="p">,</span>
                             <span class="n">with_dtype</span><span class="o">=</span><span class="n">with_dtype</span><span class="p">,</span>
                             <span class="n">suppress_small</span><span class="o">=</span><span class="n">suppress_small</span><span class="p">,</span>
                             <span class="n">max_line_width</span><span class="o">=</span><span class="n">max_line_width</span><span class="p">,</span>
                             <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">numpy_vals</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">util_type</span><span class="o">.</span><span class="n">NUMPY_SCALAR_NAMES</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;array&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">npval</span> <span class="ow">in</span> <span class="n">numpy_vals</span><span class="p">:</span>
            <span class="n">valstr</span> <span class="o">=</span> <span class="n">valstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">npval</span><span class="p">,</span> <span class="s">&#39;np.&#39;</span> <span class="o">+</span> <span class="n">npval</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">valstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># Align multiline arrays</span>
        <span class="n">valstr</span> <span class="o">=</span> <span class="n">valstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">   &#39;</span><span class="p">)</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">valstr</span>

</div>
<div class="viewcode-block" id="numeric_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.numeric_str">[docs]</a><span class="k">def</span> <span class="nf">numeric_str</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        num (scalar or array):</span>
<span class="sd">        precision (int):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str:</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-numeric_str</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/4541155/check-if-a-number-is-int-or-float</span>

<span class="sd">    Notes:</span>
<span class="sd">        isinstance(np.array([3], dtype=np.uint8)[0], numbers.Integral)</span>
<span class="sd">        isinstance(np.array([3], dtype=np.int32)[0], numbers.Integral)</span>
<span class="sd">        isinstance(np.array([3], dtype=np.uint64)[0], numbers.Integral)</span>
<span class="sd">        isinstance(np.array([3], dtype=object)[0], numbers.Integral)</span>
<span class="sd">        isinstance(np.array([3], dtype=np.float32)[0], numbers.Integral)</span>
<span class="sd">        isinstance(np.array([3], dtype=np.float64)[0], numbers.Integral)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-numeric_str</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; precision = 2</span>
<span class="sd">        &gt;&gt;&gt; result = [numeric_str(num, precision) for num in [1, 2.0, 3.43343,4432]]</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [&#39;1&#39;, &#39;2.00&#39;, &#39;3.43&#39;, &#39;4432&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">numbers</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">scalar_str</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
            <span class="c">#fmtstr = (&#39;%.&#39; + str(precision) + &#39;f&#39;)</span>
            <span class="c">#return fmtstr  % num</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">numpy_str</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="reprfunc"><a class="viewcode-back" href="../../utool.html#utool.util_str.reprfunc">[docs]</a><span class="k">def</span> <span class="nf">reprfunc</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">repr_</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">repr_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;u</span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">repr_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;u&quot;&#39;</span><span class="p">):</span>
            <span class="c"># Remove unicode repr from python2 to agree with python3</span>
            <span class="c"># output</span>
            <span class="n">repr_</span> <span class="o">=</span> <span class="n">repr_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">))</span> <span class="ow">or</span> <span class="n">util_type</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">val</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">scalar_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#import utool as ut</span>
        <span class="c">#print(&#39;val = %r&#39; % (val,))</span>
        <span class="c">#ut.repr2(val)</span>
        <span class="n">repr_</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">repr_</span>

</div>
<div class="viewcode-block" id="list_str_summarized"><a class="viewcode-back" href="../../utool.html#utool.util_str.list_str_summarized">[docs]</a><span class="k">def</span> <span class="nf">list_str_summarized</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">list_name</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    prints the list members when the list is small and the length when it is</span>
<span class="sd">    large</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;len(</span><span class="si">%s</span><span class="s">)=</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">list_name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">list_name</span><span class="p">,</span> <span class="n">list_</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="countdown_flag"><a class="viewcode-back" href="../../utool.html#utool.util_str.countdown_flag">[docs]</a><span class="k">def</span> <span class="nf">countdown_flag</span><span class="p">(</span><span class="n">count_or_bool</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">count_or_bool</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">count_or_bool</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    used by recrusive functions to specify which level to turn a bool on in</span>
<span class="sd">    counting down yeilds True, True, ..., False</span>
<span class="sd">    conting up yeilds False, False, False, ... True</span>

<span class="sd">    Args:</span>
<span class="sd">        count_or_bool (bool or int): if positive will count down, if negative</span>
<span class="sd">            will count up, if bool will remain same</span>

<span class="sd">    Returns:</span>
<span class="sd">        int or bool: count_or_bool_</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-_rectify_countdown_or_bool</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import _rectify_countdown_or_bool  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; count_or_bool = True</span>
<span class="sd">        &gt;&gt;&gt; a1 = (_rectify_countdown_or_bool(2))</span>
<span class="sd">        &gt;&gt;&gt; a2 = (_rectify_countdown_or_bool(1))</span>
<span class="sd">        &gt;&gt;&gt; a3 = (_rectify_countdown_or_bool(0))</span>
<span class="sd">        &gt;&gt;&gt; a4 = (_rectify_countdown_or_bool(-1))</span>
<span class="sd">        &gt;&gt;&gt; a5 = (_rectify_countdown_or_bool(-2))</span>
<span class="sd">        &gt;&gt;&gt; a6 = (_rectify_countdown_or_bool(True))</span>
<span class="sd">        &gt;&gt;&gt; a7 = (_rectify_countdown_or_bool(False))</span>
<span class="sd">        &gt;&gt;&gt; result = [a1, a2, a3, a4, a5, a6, a7]</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [1.0, 0.0, 0, 0.0, -1.0, True, False]</span>

<span class="sd">        [1.0, True, False, False, -1.0, True, False]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">count_or_bool</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">count_or_bool</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">count_or_bool_</span> <span class="o">=</span> <span class="n">count_or_bool</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count_or_bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">count_or_bool</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">sign_</span> <span class="o">=</span>  <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">count_or_bool</span><span class="p">)</span>
        <span class="n">count_or_bool_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count_or_bool</span> <span class="o">-</span> <span class="n">sign_</span><span class="p">)</span>
        <span class="c">#if count_or_bool_ == 0:</span>
        <span class="c">#    return sign_ == 1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">count_or_bool_</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">count_or_bool_</span>


<div class="viewcode-block" id="obj_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.obj_str">[docs]</a><span class="k">def</span> <span class="nf">obj_str</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DEPRICATE in favor of repr2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dict_str</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">list_str</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj_</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="repr3"><a class="viewcode-back" href="../../utool.html#utool.util_str.repr3">[docs]</a><span class="k">def</span> <span class="nf">repr3</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nl</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">repr2</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">_kw</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="trunc_repr"><a class="viewcode-back" href="../../utool.html#utool.util_str.trunc_repr">[docs]</a><span class="k">def</span> <span class="nf">trunc_repr</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">truncate_str</span><span class="p">(</span><span class="n">repr2</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="mi">50</span><span class="p">,</span> <span class="n">truncmsg</span><span class="o">=</span><span class="s">&#39;~//~&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="repr2"><a class="viewcode-back" href="../../utool.html#utool.util_str.repr2">[docs]</a><span class="k">def</span> <span class="nf">repr2</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use in favor of obj_str.</span>
<span class="sd">    Attempt to replace repr more configurable</span>
<span class="sd">    pretty version that works the same in both 2 and 3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">kwitems</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nl</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">hack_liststr</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">kwitems</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dict_str</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwitems</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">kwitems</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nl</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">kwitems</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">list_str</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwitems</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kwitems</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">with_dtype</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">kwitems</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_NUMPY</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">numpy_str</span><span class="p">(</span><span class="n">obj_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwitems</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">reprfunc</span><span class="p">(</span><span class="n">obj_</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="dict_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.dict_str">[docs]</a><span class="k">def</span> <span class="nf">dict_str</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sorted_</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">indent_</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">hack_liststr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">nl</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">explicit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">truncatekw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">key_order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">key_order_metric</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nobraces</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nobr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="o">**</span><span class="n">dictkw</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Makes a pretty printable / human-readable string representation of a</span>
<span class="sd">        dictionary. In most cases this string could be evaled.</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_ (dict_): a dictionary</span>
<span class="sd">        strvals (bool): (default = False)</span>
<span class="sd">        sorted_ (None): returns str sorted by a metric (default = None)</span>
<span class="sd">        newlines (bool): Use nl instead. (default = True)</span>
<span class="sd">        recursive (bool): (default = True)</span>
<span class="sd">        indent_ (str): (default = &#39;&#39;)</span>
<span class="sd">        precision (int): (default = 8)</span>
<span class="sd">        hack_liststr (bool): turn recursive liststr parsing on (default = False)</span>
<span class="sd">        truncate (bool): (default = False)</span>
<span class="sd">        nl (int): prefered alias for newline. can be a coundown variable</span>
<span class="sd">            (default = None)</span>
<span class="sd">        explicit (bool): (default = False)</span>
<span class="sd">        truncatekw (dict): (default = {})</span>
<span class="sd">        key_order (None): overrides default ordering (default = None)</span>
<span class="sd">        key_order_metric (str): special sorting of items. Accepted values:</span>
<span class="sd">                None, &#39;strlen&#39;, &#39;val&#39;</span>
<span class="sd">        nobraces (bool): (default = False)</span>
<span class="sd">        align (bool): (default = False)</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        use_numpy, with_comma</span>

<span class="sd">    Returns:</span>
<span class="sd">        str:</span>

<span class="sd">    FIXME:</span>
<span class="sd">        ALL LIST DICT STRINGS ARE VERY SPAGEHETTI RIGHT NOW</span>


<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-dict_str</span>
<span class="sd">        python -m utool.util_str --test-dict_str --truncate=False --no-checkwant</span>
<span class="sd">        python -m utool.util_str --test-dict_str --truncate=1 --no-checkwant</span>
<span class="sd">        python -m utool.util_str --test-dict_str --truncate=2 --no-checkwant</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import dict_str, dict_itemstr_list</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dict_ = {&#39;foo&#39;: {&#39;spam&#39;: &#39;barbarbarbarbar&#39; * 3, &#39;eggs&#39;: &#39;jam&#39;},</span>
<span class="sd">        &gt;&gt;&gt;          &#39;baz&#39;: &#39;barbarbarbarbar&#39; * 3}</span>
<span class="sd">        &gt;&gt;&gt; truncate = ut.get_argval(&#39;--truncate&#39;, type_=None, default=1)</span>
<span class="sd">        &gt;&gt;&gt; result = dict_str(dict_, strvals=True, truncate=truncate,</span>
<span class="sd">        &gt;&gt;&gt;                    truncatekw={&#39;maxlen&#39;: 20})</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {</span>
<span class="sd">            &#39;baz&#39;: barbarbarbarbarbarbarbarbarbarbarbarbarbarbar,</span>
<span class="sd">            &#39;foo&#39;: {</span>
<span class="sd">                &#39;eggs&#39;: jam,</span>
<span class="sd">                &#39;s ~~~TRUNCATED~~~ ,</span>
<span class="sd">            },</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nobr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">nobraces</span> <span class="o">=</span> <span class="n">nobr</span>
    <span class="k">if</span> <span class="n">nl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">newlines</span> <span class="o">=</span> <span class="n">nl</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">explicit</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;dict()&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;{}&#39;</span>

    <span class="n">newlines_</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">newlines</span><span class="p">)</span>
    <span class="n">truncate_</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">truncate</span><span class="p">)</span>

    <span class="c">#if &#39;braces&#39; in dictkw:</span>
    <span class="c">#    dictkw[&#39;braces&#39;] = _rectify_countdown_or_bool(dictkw[&#39;braces&#39;])</span>
    <span class="c">#    nobraces = not dictkw[&#39;braces&#39;]</span>

    <span class="k">if</span> <span class="n">hack_liststr</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">nl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">hack_liststr</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">itemstr_list</span> <span class="o">=</span> <span class="n">dict_itemstr_list</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">strvals</span><span class="p">,</span> <span class="n">sorted_</span><span class="p">,</span> <span class="n">newlines_</span><span class="p">,</span>
                                     <span class="n">recursive</span><span class="p">,</span> <span class="n">indent_</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span>
                                     <span class="n">hack_liststr</span><span class="p">,</span> <span class="n">explicit</span><span class="p">,</span>
                                     <span class="n">truncate</span><span class="o">=</span><span class="n">truncate_</span><span class="p">,</span> <span class="n">truncatekw</span><span class="o">=</span><span class="n">truncatekw</span><span class="p">,</span>
                                     <span class="n">key_order</span><span class="o">=</span><span class="n">key_order</span><span class="p">,</span>
                                     <span class="n">key_order_metric</span><span class="o">=</span><span class="n">key_order_metric</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">dictkw</span><span class="p">)</span>

    <span class="n">do_truncate</span> <span class="o">=</span> <span class="n">truncate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span> <span class="ow">and</span> <span class="p">(</span><span class="n">truncate</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">truncate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">do_truncate</span><span class="p">:</span>
        <span class="n">itemstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">truncate_str</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="o">**</span><span class="n">truncatekw</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itemstr_list</span><span class="p">]</span>

    <span class="n">leftbrace</span><span class="p">,</span> <span class="n">rightbrace</span>  <span class="o">=</span> <span class="p">(</span><span class="s">&#39;dict(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">explicit</span> <span class="k">else</span> <span class="p">(</span><span class="s">&#39;{&#39;</span><span class="p">,</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nobraces</span><span class="p">:</span>
        <span class="n">leftbrace</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">rightbrace</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">newlines</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
        <span class="k">if</span> <span class="n">nobraces</span><span class="p">:</span>
            <span class="n">retstr</span> <span class="o">=</span>  <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">ut</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">itemstr</span><span class="p">,</span> <span class="s">&#39;    &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">itemstr</span> <span class="ow">in</span> <span class="n">itemstr_list</span><span class="p">]</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
            <span class="n">retstr</span> <span class="o">=</span>  <span class="p">(</span><span class="n">leftbrace</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">body_str</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">rightbrace</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">align</span><span class="p">:</span>
                <span class="n">retstr</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">retstr</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># hack away last comma</span>
        <span class="n">sequence_str</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">)</span>
        <span class="n">sequence_str</span> <span class="o">=</span> <span class="n">sequence_str</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">retstr</span> <span class="o">=</span> <span class="n">leftbrace</span> <span class="o">+</span>  <span class="n">sequence_str</span> <span class="o">+</span> <span class="n">rightbrace</span>
    <span class="c"># Is there a way to make truncate for dict_str compatible with list_str?</span>
    <span class="k">return</span> <span class="n">retstr</span>

</div>
<div class="viewcode-block" id="list_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.list_str">[docs]</a><span class="k">def</span> <span class="nf">list_str</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">indent_</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">newlines</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nobraces</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nl</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">truncatekw</span><span class="o">=</span><span class="p">{},</span> <span class="n">label_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">packed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nobr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="o">**</span><span class="n">listkw</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        list_ (list):</span>
<span class="sd">        indent_ (str): (default = &#39;&#39;)</span>
<span class="sd">        newlines (int): (default = 1)</span>
<span class="sd">        nobraces (bool): (default = False)</span>
<span class="sd">        nl (None): alias for newlines (default = None)</span>
<span class="sd">        truncate (bool): (default = False)</span>
<span class="sd">        truncatekw (dict): (default = {})</span>
<span class="sd">        label_list (list): (default = None)</span>
<span class="sd">        packed (bool): if true packs braces close to body (default = False)</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        strvals, recursive, precision, with_comma</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: retstr</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-list_str</span>
<span class="sd">        python -m utool.util_str --exec-list_str --truncate=True</span>
<span class="sd">        python -m utool.util_str --exec-list_str --truncate=0</span>


<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; list_ = [[((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;),</span>
<span class="sd">        ...     ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;), ((&#39;--verbose-qt&#39;,</span>
<span class="sd">        ...     &#39;--verbqt&#39;), 1, False, &#39;&#39;), ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1,</span>
<span class="sd">        ...     False, &#39;&#39;)], [([&#39;--nodyn&#39;], 1, False, &#39;&#39;), ([&#39;--nodyn&#39;], 1, False,</span>
<span class="sd">        ...     &#39;&#39;)]]</span>
<span class="sd">        &gt;&gt;&gt; indent_ = &#39;&#39;</span>
<span class="sd">        &gt;&gt;&gt; newlines = 2</span>
<span class="sd">        &gt;&gt;&gt; truncate = ut.get_argval(&#39;--truncate&#39;, type_=None, default=False)</span>
<span class="sd">        &gt;&gt;&gt; nobraces = False</span>
<span class="sd">        &gt;&gt;&gt; nl = None</span>
<span class="sd">        &gt;&gt;&gt; result = list_str(list_, indent_, newlines, nobraces, nl,</span>
<span class="sd">        &gt;&gt;&gt;                   truncate=truncate, truncatekw={&#39;maxlen&#39;: 10})</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [</span>
<span class="sd">            [</span>
<span class="sd">                ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;),</span>
<span class="sd">                ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;),</span>
<span class="sd">                ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;),</span>
<span class="sd">                ((&#39;--verbose-qt&#39;, &#39;--verbqt&#39;), 1, False, &#39;&#39;),</span>
<span class="sd">            ],</span>
<span class="sd">            [</span>
<span class="sd">                ([&#39;--nodyn&#39;], 1, False, &#39;&#39;),</span>
<span class="sd">                ([&#39;--nodyn&#39;], 1, False, &#39;&#39;),</span>
<span class="sd">            ],</span>
<span class="sd">        ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">if</span> <span class="n">nobr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">nobraces</span> <span class="o">=</span> <span class="n">nobr</span>
    <span class="k">if</span> <span class="n">nl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">newlines</span> <span class="o">=</span> <span class="n">nl</span>

    <span class="c">#if &#39;braces&#39; in listkw:</span>
    <span class="c">#    listkw[&#39;braces&#39;] = _rectify_countdown_or_bool(listkw[&#39;braces&#39;])</span>
    <span class="c">#    nobraces = not listkw[&#39;braces&#39;]</span>
    <span class="n">newlines_</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">newlines</span><span class="p">)</span>
    <span class="n">truncate_</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">truncate</span><span class="p">)</span>
    <span class="n">packed_</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">packed</span><span class="p">)</span>

    <span class="n">itemstr_list</span> <span class="o">=</span> <span class="n">get_itemstr_list</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">indent_</span><span class="o">=</span><span class="n">indent_</span><span class="p">,</span> <span class="n">newlines</span><span class="o">=</span><span class="n">newlines_</span><span class="p">,</span>
                                    <span class="n">truncate</span><span class="o">=</span><span class="n">truncate_</span><span class="p">,</span> <span class="n">truncatekw</span><span class="o">=</span><span class="n">truncatekw</span><span class="p">,</span>
                                    <span class="n">packed</span><span class="o">=</span><span class="n">packed_</span><span class="p">,</span>
                                    <span class="n">label_list</span><span class="o">=</span><span class="n">label_list</span><span class="p">,</span> <span class="o">**</span><span class="n">listkw</span><span class="p">)</span>
    <span class="n">is_tuple</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nobraces</span><span class="p">:</span>
        <span class="n">leftbrace</span><span class="p">,</span> <span class="n">rightbrace</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_tuple</span><span class="p">:</span>
            <span class="n">leftbrace</span><span class="p">,</span> <span class="n">rightbrace</span>  <span class="o">=</span> <span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">leftbrace</span><span class="p">,</span> <span class="n">rightbrace</span>  <span class="o">=</span> <span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span>

    <span class="k">if</span> <span class="n">newlines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span> <span class="ow">and</span> <span class="p">(</span><span class="n">newlines</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">newlines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nobraces</span> <span class="ow">or</span> <span class="n">label_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">body_str</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">)</span>
            <span class="n">retstr</span> <span class="o">=</span> <span class="n">body_str</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">packed</span><span class="p">:</span>
                <span class="n">joinstr</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">leftbrace</span><span class="p">)</span>
                <span class="n">body_str</span> <span class="o">=</span> <span class="n">joinstr</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">itemstr</span> <span class="k">for</span> <span class="n">itemstr</span> <span class="ow">in</span> <span class="n">itemstr_list</span><span class="p">])</span>
                <span class="n">braced_body_str</span> <span class="o">=</span> <span class="p">(</span><span class="n">leftbrace</span> <span class="o">+</span> <span class="s">&#39;&#39;</span> <span class="o">+</span> <span class="n">body_str</span> <span class="o">+</span> <span class="s">&#39;&#39;</span> <span class="o">+</span> <span class="n">rightbrace</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">body_str</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ut</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">itemstr</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">itemstr</span> <span class="ow">in</span> <span class="n">itemstr_list</span><span class="p">])</span>
                <span class="n">braced_body_str</span> <span class="o">=</span> <span class="p">(</span><span class="n">leftbrace</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span>
                                   <span class="n">body_str</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">rightbrace</span><span class="p">)</span>
            <span class="n">retstr</span> <span class="o">=</span> <span class="n">braced_body_str</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sequence_str</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">)</span>
        <span class="c"># hack away last comma except in 1-tuple case</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">is_tuple</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">sequence_str</span> <span class="o">=</span> <span class="n">sequence_str</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">retstr</span>  <span class="o">=</span> <span class="p">(</span><span class="n">leftbrace</span> <span class="o">+</span> <span class="n">sequence_str</span> <span class="o">+</span>  <span class="n">rightbrace</span><span class="p">)</span>

    <span class="c"># TODO: rectify with dict_truncate</span>
    <span class="n">do_truncate</span> <span class="o">=</span> <span class="n">truncate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span> <span class="ow">and</span> <span class="p">(</span><span class="n">truncate</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">truncate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">do_truncate</span><span class="p">:</span>
        <span class="n">retstr</span> <span class="o">=</span> <span class="n">truncate_str</span><span class="p">(</span><span class="n">retstr</span><span class="p">,</span> <span class="o">**</span><span class="n">truncatekw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">retstr</span>

</div>
<div class="viewcode-block" id="dict_itemstr_list"><a class="viewcode-back" href="../../utool.html#utool.util_str.dict_itemstr_list">[docs]</a><span class="k">def</span> <span class="nf">dict_itemstr_list</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sorted_</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                      <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent_</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">hack_liststr</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">explicit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">key_order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">truncatekw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">key_order_metric</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">use_numpy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_comma</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">dictkw</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: a list of human-readable dictionary items</span>

<span class="sd">    Args:</span>
<span class="sd">        explicit : if True uses dict(key=val,...) format instead of {key:val,...}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">strvals</span><span class="p">:</span>
        <span class="n">valfunc</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">valfunc</span> <span class="o">=</span> <span class="n">reprfunc</span>

    <span class="k">def</span> <span class="nf">recursive_valfunc</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="c"># TODO : Rectify with list version</span>
        <span class="c">#print(&#39;hack_liststr = %r&#39; % (hack_liststr,))</span>
        <span class="n">new_indent</span> <span class="o">=</span> <span class="n">indent_</span> <span class="o">+</span> <span class="s">&#39;    &#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">dict_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="n">strvals</span><span class="p">,</span> <span class="n">sorted_</span><span class="o">=</span><span class="n">sorted_</span><span class="p">,</span>
                            <span class="n">newlines</span><span class="o">=</span><span class="n">newlines</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">,</span>
                            <span class="n">indent_</span><span class="o">=</span><span class="n">new_indent</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
                            <span class="n">truncate</span><span class="o">=</span><span class="n">truncate</span><span class="p">,</span> <span class="n">truncatekw</span><span class="o">=</span><span class="n">truncatekw</span><span class="p">,</span>
                            <span class="n">with_comma</span><span class="o">=</span><span class="n">with_comma</span><span class="p">,</span> <span class="n">key_order</span><span class="o">=</span><span class="n">key_order</span><span class="p">,</span>
                            <span class="n">hack_liststr</span><span class="o">=</span><span class="n">hack_liststr</span><span class="p">,</span>
                            <span class="n">use_numpy</span><span class="o">=</span><span class="n">use_numpy</span><span class="p">,</span> <span class="o">**</span><span class="n">dictkw</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_NUMPY</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">use_numpy</span><span class="p">:</span>
                <span class="n">with_dtype</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;with_dtype&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
                <span class="n">force_dtype</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;force_dtype&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>  <span class="c"># DEP FORCE_DTYPE</span>
                <span class="k">return</span> <span class="n">numpy_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="n">strvals</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
                                 <span class="n">force_dtype</span><span class="o">=</span><span class="n">force_dtype</span><span class="p">,</span> <span class="n">with_dtype</span><span class="o">=</span><span class="n">with_dtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">list_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">newlines</span><span class="o">=</span><span class="n">newlines</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
                                <span class="n">strvals</span><span class="o">=</span><span class="n">strvals</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hack_liststr</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="c">#print(&#39;**dictkw = %r&#39; % (dictkw,))</span>
            <span class="c">#print(&#39;newlines = %r&#39; % (newlines,))</span>
            <span class="k">return</span> <span class="n">list_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">newlines</span><span class="o">=</span><span class="n">newlines</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">))</span> <span class="ow">or</span> <span class="n">util_type</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">val</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">scalar_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># base case</span>
            <span class="k">return</span> <span class="n">valfunc</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sorted_</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">sorted_</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sorted_</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key_order</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># specify order explicilty</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="c"># catches case where keys are of different types</span>
                    <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unordered_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">other_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">unordered_keys</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">key_order</span><span class="p">)))</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="n">key_order</span> <span class="o">+</span> <span class="n">other_keys</span>
                <span class="k">return</span> <span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">)</span>

        <span class="c">#iteritems = lambda d: iter(sorted(six.iteritems(d)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">iteritems</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span>

    <span class="n">_valstr</span> <span class="o">=</span> <span class="n">recursive_valfunc</span> <span class="k">if</span> <span class="n">recursive</span> <span class="k">else</span> <span class="n">valfunc</span>

    <span class="k">def</span> <span class="nf">make_item_str</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">indent_</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">explicit</span><span class="p">:</span>
            <span class="n">repr_str</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">repr_str</span> <span class="o">=</span> <span class="n">reprfunc</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span>
        <span class="n">val_str</span> <span class="o">=</span> <span class="n">_valstr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">padded_indent</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indent_</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">repr_str</span><span class="p">))</span>
        <span class="n">val_str</span> <span class="o">=</span> <span class="n">val_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">padded_indent</span><span class="p">)</span>
        <span class="n">item_str</span> <span class="o">=</span> <span class="n">repr_str</span> <span class="o">+</span> <span class="n">val_str</span>
        <span class="k">if</span> <span class="n">with_comma</span><span class="p">:</span>
            <span class="n">item_str</span> <span class="o">+=</span> <span class="s">&#39;,&#39;</span>
        <span class="k">return</span> <span class="n">item_str</span>

    <span class="n">itemstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_item_str</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">indent_</span><span class="p">)</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)]</span>

    <span class="n">reverse</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">key_order_metric</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key_order_metric</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">):</span>
            <span class="n">key_order_metric</span> <span class="o">=</span> <span class="n">key_order_metric</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="n">key_order_metric</span> <span class="o">==</span> <span class="s">&#39;strlen&#39;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
        <span class="n">metric_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">itemstr</span><span class="p">)</span> <span class="k">for</span> <span class="n">itemstr</span> <span class="ow">in</span> <span class="n">itemstr_list</span><span class="p">]</span>
        <span class="n">itemstr_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">sortedby</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">,</span> <span class="n">metric_list</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">key_order_metric</span> <span class="o">==</span> <span class="s">&#39;val&#39;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
        <span class="n">metric_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">dict_</span><span class="p">)]</span>
        <span class="n">itemstr_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">sortedby</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">,</span> <span class="n">metric_list</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>

    <span class="n">maxlen</span> <span class="o">=</span> <span class="n">dictkw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;maxlen&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">maxlen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemstr_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
        <span class="n">itemstr_list</span> <span class="o">=</span> <span class="n">itemstr_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">maxlen</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">itemstr_list</span>

</div>
<div class="viewcode-block" id="get_itemstr_list"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_itemstr_list">[docs]</a><span class="k">def</span> <span class="nf">get_itemstr_list</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">indent_</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">with_comma</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">listkws</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO: have this replace dict_itemstr list or at least most functionality in</span>
<span class="sd">    it. have it make two itemstr lists over keys and values and then combine</span>
<span class="sd">    them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">strvals</span><span class="p">:</span>
        <span class="n">valfunc</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">valfunc</span> <span class="o">=</span> <span class="n">reprfunc</span>

    <span class="k">def</span> <span class="nf">recursive_valfunc</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">sublabels</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># TODO : Rectify with dict version</span>
        <span class="n">new_indent</span> <span class="o">=</span> <span class="n">indent_</span> <span class="o">+</span> <span class="s">&#39;    &#39;</span> <span class="k">if</span> <span class="n">newlines</span> <span class="k">else</span> <span class="n">indent_</span>
        <span class="n">common_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">strvals</span><span class="o">=</span><span class="n">strvals</span><span class="p">,</span> <span class="n">newlines</span><span class="o">=</span><span class="n">newlines</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">,</span>
            <span class="n">indent_</span><span class="o">=</span><span class="n">new_indent</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">with_comma</span><span class="o">=</span><span class="n">with_comma</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">common_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">sorted_</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">hack_liststr</span><span class="o">=</span><span class="n">listkws</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;hack_liststr&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">dict_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">common_kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">common_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label_list</span><span class="o">=</span><span class="n">sublabels</span><span class="p">,</span> <span class="o">**</span><span class="n">listkws</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">list_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">common_kw</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_NUMPY</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c"># TODO: generally pass down args</span>
            <span class="n">suppress_small</span> <span class="o">=</span> <span class="n">listkws</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;suppress_small&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">with_dtype</span> <span class="o">=</span> <span class="n">listkws</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;with_dtype&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">numpy_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">strvals</span><span class="o">=</span><span class="n">strvals</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
                             <span class="n">suppress_small</span><span class="o">=</span><span class="n">suppress_small</span><span class="p">,</span>
                             <span class="n">with_dtype</span><span class="o">=</span><span class="n">with_dtype</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">))</span> <span class="ow">or</span> <span class="n">util_type</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">val</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">scalar_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># base case</span>
            <span class="k">return</span> <span class="n">valfunc</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="n">_valstr</span> <span class="o">=</span> <span class="n">recursive_valfunc</span> <span class="k">if</span> <span class="n">recursive</span> <span class="k">else</span> <span class="n">valfunc</span>

    <span class="k">def</span> <span class="nf">make_item_str</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">val_str</span> <span class="o">=</span> <span class="n">_valstr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val_str</span> <span class="o">=</span> <span class="n">_valstr</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">label</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span>
            <span class="n">item_str</span> <span class="o">=</span> <span class="n">horiz_string</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span>  <span class="n">val_str</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item_str</span> <span class="o">=</span> <span class="n">val_str</span>
            <span class="k">if</span> <span class="n">with_comma</span><span class="p">:</span>
                <span class="n">item_str</span> <span class="o">+=</span> <span class="s">&#39;,&#39;</span>
        <span class="k">return</span> <span class="n">item_str</span>

    <span class="k">if</span> <span class="n">label_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">label_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span>
        <span class="n">itemstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_item_str</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">label_list</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">itemstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_item_str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">itemstr_list</span>

</div>
<div class="viewcode-block" id="horiz_string"><a class="viewcode-back" href="../../utool.html#utool.util_str.horiz_string">[docs]</a><span class="k">def</span> <span class="nf">horiz_string</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Horizontally concatenates strings reprs preserving indentation</span>

<span class="sd">    Concats a list of objects ensuring that the next item in the list</span>
<span class="sd">    is all the way to the right of any previous items.</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-horiz_string</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # Pretty printing of matrices demo / test</span>
<span class="sd">        &gt;&gt;&gt; import utool</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; # Wouldn&#39;t it be nice if we could print this operation easily?</span>
<span class="sd">        &gt;&gt;&gt; B = np.array(((1, 2), (3, 4)))</span>
<span class="sd">        &gt;&gt;&gt; C = np.array(((5, 6), (7, 8)))</span>
<span class="sd">        &gt;&gt;&gt; A = B.dot(C)</span>
<span class="sd">        &gt;&gt;&gt; # Eg 1:</span>
<span class="sd">        &gt;&gt;&gt; result = (utool.hz_str(&#39;A = &#39;, A, &#39; = &#39;, B, &#39; * &#39;, C))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        A = [[19 22]  = [[1 2]  * [[5 6]</span>
<span class="sd">             [43 50]]    [3 4]]    [7 8]]</span>

<span class="sd">    Exam2:</span>
<span class="sd">        &gt;&gt;&gt; # Eg 2:</span>
<span class="sd">        &gt;&gt;&gt; str_list = [&#39;A = &#39;, str(B), &#39; * &#39;, str(C)]</span>
<span class="sd">        &gt;&gt;&gt; horizstr = (utool.horiz_string(*str_list))</span>
<span class="sd">        &gt;&gt;&gt; result = (horizstr)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        A = [[1 2]  * [[5 6]</span>
<span class="sd">             [3 4]]    [7 8]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;precision&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="n">args</span>
    <span class="n">all_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hpos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c"># for each value in the list or args</span>
    <span class="k">for</span> <span class="n">sx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val_list</span><span class="p">)):</span>
        <span class="c"># Ensure value is a string</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">val_list</span><span class="p">[</span><span class="n">sx</span><span class="p">]</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Hack in numpy precision</span>
            <span class="k">if</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_NUMPY</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                        <span class="n">str_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
                                            <span class="n">suppress_small</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">if</span> <span class="n">str_</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">str_</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">val_list</span><span class="p">[</span><span class="n">sx</span><span class="p">])</span>
        <span class="c"># continue with formating</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">str_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">line_diff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_lines</span><span class="p">)</span>
        <span class="c"># Vertical padding</span>
        <span class="k">if</span> <span class="n">line_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">all_lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">hpos</span><span class="p">]</span> <span class="o">*</span> <span class="n">line_diff</span>
        <span class="c"># Add strings</span>
        <span class="k">for</span> <span class="n">lx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">all_lines</span><span class="p">[</span><span class="n">lx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">line</span>
            <span class="n">hpos</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">hpos</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_lines</span><span class="p">[</span><span class="n">lx</span><span class="p">]))</span>
        <span class="c"># Horizontal padding</span>
        <span class="k">for</span> <span class="n">lx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_lines</span><span class="p">)):</span>
            <span class="n">hpos_diff</span> <span class="o">=</span> <span class="n">hpos</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_lines</span><span class="p">[</span><span class="n">lx</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">hpos_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">all_lines</span><span class="p">[</span><span class="n">lx</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">hpos_diff</span>
    <span class="n">all_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">all_lines</span><span class="p">]</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">all_lines</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="c"># Alias</span></div>
<span class="n">hz_str</span> <span class="o">=</span> <span class="n">horiz_string</span>


<div class="viewcode-block" id="listinfo_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.listinfo_str">[docs]</a><span class="k">def</span> <span class="nf">listinfo_str</span><span class="p">(</span><span class="n">list_</span><span class="p">):</span>
    <span class="n">info_list</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">([(</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_</span><span class="p">])</span>
    <span class="n">info_str</span>  <span class="o">=</span> <span class="n">indentjoin</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="n">info_list</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">  &#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">info_str</span>

</div>
<div class="viewcode-block" id="str2"><a class="viewcode-back" href="../../utool.html#utool.util_str.str2">[docs]</a><span class="k">def</span> <span class="nf">str2</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;type </span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_unix_timedelta_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_unix_timedelta_str">[docs]</a><span class="k">def</span> <span class="nf">get_unix_timedelta_str</span><span class="p">(</span><span class="n">unixtime_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; string representation of time deltas &quot;&quot;&quot;</span>
    <span class="n">timedelta</span> <span class="o">=</span> <span class="n">util_time</span><span class="o">.</span><span class="n">get_unix_timedelta</span><span class="p">(</span><span class="n">unixtime_diff</span><span class="p">)</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span> <span class="k">if</span> <span class="n">unixtime_diff</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">&#39;-&#39;</span>
    <span class="n">timedelta_str</span> <span class="o">=</span> <span class="n">sign</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">timedelta_str</span>

</div>
<div class="viewcode-block" id="str_between"><a class="viewcode-back" href="../../utool.html#utool.util_str.str_between">[docs]</a><span class="k">def</span> <span class="nf">str_between</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">startstr</span><span class="p">,</span> <span class="n">endstr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; gets substring between two sentianl strings &quot;&quot;&quot;</span>
    <span class="n">startpos</span> <span class="o">=</span> <span class="n">str_</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">startstr</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">startstr</span><span class="p">)</span>
    <span class="n">endpos</span> <span class="o">=</span> <span class="n">str_</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">endstr</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">str_</span><span class="p">[</span><span class="n">startpos</span><span class="p">:</span><span class="n">endpos</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="padded_str_range"><a class="viewcode-back" href="../../utool.html#utool.util_str.padded_str_range">[docs]</a><span class="k">def</span> <span class="nf">padded_str_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Builds a list of (end - start) strings padded with zeros &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">nDigits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">end</span><span class="p">))</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;%0&#39;</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">nDigits</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;d&#39;</span>
    <span class="n">str_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">num</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">str_range</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_callable_name"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_callable_name">[docs]</a><span class="k">def</span> <span class="nf">get_callable_name</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Works on must functionlike objects including str, which has no func_name</span>

<span class="sd">    Args:</span>
<span class="sd">        func (?):</span>

<span class="sd">    Returns:</span>
<span class="sd">        ?:</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-get_callable_name</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; func = len</span>
<span class="sd">        &gt;&gt;&gt; result = get_callable_name(func)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        len</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">meta_util_six</span><span class="o">.</span><span class="n">get_funcname</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">builtin_function_name_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">len</span><span class="p">:</span>    <span class="s">&#39;len&#39;</span><span class="p">,</span>
            <span class="nb">zip</span><span class="p">:</span>    <span class="s">&#39;zip&#39;</span><span class="p">,</span>
            <span class="nb">range</span><span class="p">:</span>  <span class="s">&#39;range&#39;</span><span class="p">,</span>
            <span class="nb">map</span><span class="p">:</span>    <span class="s">&#39;map&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="p">:</span>   <span class="s">&#39;type&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">builtin_function_name_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">builtin_function_name_dict</span><span class="p">[</span><span class="n">func</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;type </span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s">&#39;__name__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">((</span><span class="s">&#39;cannot get func_name of func=</span><span class="si">%r</span><span class="s">&#39;</span>
                                        <span class="s">&#39;type(func)=</span><span class="si">%r</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">func</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="align"><a class="viewcode-back" href="../../utool.html#utool.util_str.align">[docs]</a><span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="n">replchar</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Left justifies text on the left side of character</span>

<span class="sd">    align</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to align</span>
<span class="sd">        character (str): character to align at</span>
<span class="sd">        replchar (str): replacement character (default=None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: new_text</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-align:0</span>

<span class="sd">    Example0:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; character = &#39;=&#39;</span>
<span class="sd">        &gt;&gt;&gt; text = &#39;a = b=\none = two\nthree = fish\n&#39;</span>
<span class="sd">        &gt;&gt;&gt; print(text)</span>
<span class="sd">        &gt;&gt;&gt; result = (align(text, &#39;=&#39;))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        a     = b=</span>
<span class="sd">        one   = two</span>
<span class="sd">        three = fish</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line_list</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">new_lines</span> <span class="o">=</span> <span class="n">align_lines</span><span class="p">(</span><span class="n">line_list</span><span class="p">,</span> <span class="n">character</span><span class="p">,</span> <span class="n">replchar</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_lines</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_text</span>

</div>
<div class="viewcode-block" id="align_lines"><a class="viewcode-back" href="../../utool.html#utool.util_str.align_lines">[docs]</a><span class="k">def</span> <span class="nf">align_lines</span><span class="p">(</span><span class="n">line_list</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="n">replchar</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Left justifies text on the left side of character</span>

<span class="sd">    align_lines</span>

<span class="sd">    Args:</span>
<span class="sd">        line_list (list of strs):</span>
<span class="sd">        character (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: new_lines</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-align_lines:0</span>
<span class="sd">        python -m utool.util_str --test-align_lines:1</span>
<span class="sd">        python -m utool.util_str --test-align_lines:2</span>
<span class="sd">        python -m utool.util_str --test-align_lines:3</span>

<span class="sd">    Example0:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; line_list = &#39;a = b\none = two\nthree = fish&#39;.split(&#39;\n&#39;)</span>
<span class="sd">        &gt;&gt;&gt; character = &#39;=&#39;</span>
<span class="sd">        &gt;&gt;&gt; new_lines = align_lines(line_list, character)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;\n&#39;.join(new_lines))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        a     = b</span>
<span class="sd">        one   = two</span>
<span class="sd">        three = fish</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; line_list = &#39;foofish:\n    a = b\n    one    = two\n    three    = fish&#39;.split(&#39;\n&#39;)</span>
<span class="sd">        &gt;&gt;&gt; character = &#39;=&#39;</span>
<span class="sd">        &gt;&gt;&gt; new_lines = align_lines(line_list, character)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;\n&#39;.join(new_lines))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        foofish:</span>
<span class="sd">            a        = b</span>
<span class="sd">            one      = two</span>
<span class="sd">            three    = fish</span>

<span class="sd">    Example2:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; character = &#39;:&#39;</span>
<span class="sd">        &gt;&gt;&gt; text = ut.codeblock(&#39;&#39;&#39;</span>
<span class="sd">            {&#39;max&#39;: &#39;1970/01/01 02:30:13&#39;,</span>
<span class="sd">             &#39;mean&#39;: &#39;1970/01/01 01:10:15&#39;,</span>
<span class="sd">             &#39;min&#39;: &#39;1970/01/01 00:01:41&#39;,</span>
<span class="sd">             &#39;range&#39;: &#39;2:28:32&#39;,</span>
<span class="sd">             &#39;std&#39;: &#39;1:13:57&#39;,}&#39;&#39;&#39;).split(&#39;\n&#39;)</span>
<span class="sd">        &gt;&gt;&gt; new_lines = align_lines(text, &#39;:&#39;, &#39; :&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = &#39;\n&#39;.join(new_lines)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        {&#39;max&#39;   : &#39;1970/01/01 02:30:13&#39;,</span>
<span class="sd">         &#39;mean&#39;  : &#39;1970/01/01 01:10:15&#39;,</span>
<span class="sd">         &#39;min&#39;   : &#39;1970/01/01 00:01:41&#39;,</span>
<span class="sd">         &#39;range&#39; : &#39;2:28:32&#39;,</span>
<span class="sd">         &#39;std&#39;   : &#39;1:13:57&#39;,}</span>

<span class="sd">    Example3:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; line_list = &#39;foofish:\n a = b = c\n one = two = three\nthree=4= fish&#39;.split(&#39;\n&#39;)</span>
<span class="sd">        &gt;&gt;&gt; character = &#39;=&#39;</span>
<span class="sd">        &gt;&gt;&gt; # align the second occurence of a character</span>
<span class="sd">        &gt;&gt;&gt; new_lines = align_lines(line_list, character, pos=None)</span>
<span class="sd">        &gt;&gt;&gt; print((&#39;\n&#39;.join(line_list)))</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;\n&#39;.join(new_lines))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        foofish:</span>
<span class="sd">         a   = b   = c</span>
<span class="sd">         one = two = three</span>
<span class="sd">        three=4    = fish</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># FIXME: continue to fix ansii</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c"># Align all occurences</span>
        <span class="n">num_pos</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">character</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">])</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_pos</span><span class="p">))</span>

    <span class="c"># Allow multiple alignments</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">pos_list</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="c"># recursive calls</span>
        <span class="n">new_lines</span> <span class="o">=</span> <span class="n">line_list</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">pos_list</span><span class="p">:</span>
            <span class="n">new_lines</span> <span class="o">=</span> <span class="n">align_lines</span><span class="p">(</span><span class="n">new_lines</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="n">character</span><span class="p">,</span> <span class="n">replchar</span><span class="o">=</span><span class="n">replchar</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_lines</span>

    <span class="c"># base case</span>
    <span class="k">if</span> <span class="n">replchar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">replchar</span> <span class="o">=</span> <span class="n">character</span>

    <span class="c"># the pos-th character to align</span>
    <span class="n">lpos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">rpos</span> <span class="o">=</span> <span class="n">lpos</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">tup_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">character</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">]</span>

    <span class="n">handle_ansi</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">handle_ansi</span><span class="p">:</span>
        <span class="c"># Remove ansi from length calculation</span>
        <span class="c"># References: http://stackoverflow.com/questions/14693701remove-ansi</span>
        <span class="n">ansi_escape</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\x1b[^m]*m&#39;</span><span class="p">)</span>

    <span class="c"># Find how much padding is needed</span>
    <span class="n">maxlen</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">tup_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">rpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">handle_ansi</span><span class="p">:</span>
                <span class="n">tup</span> <span class="o">=</span> <span class="p">[</span><span class="n">ansi_escape</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tup</span><span class="p">]</span>
            <span class="n">left_lenlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">rpos</span><span class="p">]))</span>
            <span class="n">left_len</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">left_lenlist</span><span class="p">)</span> <span class="o">+</span> <span class="n">lpos</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">replchar</span><span class="p">)</span>
            <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="n">left_len</span><span class="p">)</span>

    <span class="c"># Pad each line to align the pos-th occurence of the chosen character</span>
    <span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">tup_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">rpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lhs</span> <span class="o">=</span> <span class="n">character</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">rpos</span><span class="p">])</span>
            <span class="n">rhs</span> <span class="o">=</span> <span class="n">character</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="n">rpos</span><span class="p">:])</span>
            <span class="c"># pad the new line with requested justification</span>
            <span class="n">newline</span> <span class="o">=</span> <span class="n">lhs</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">maxlen</span><span class="p">)</span> <span class="o">+</span> <span class="n">replchar</span> <span class="o">+</span> <span class="n">rhs</span>
            <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newline</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">replchar</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tup</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">new_lines</span>

</div>
<div class="viewcode-block" id="strip_ansi"><a class="viewcode-back" href="../../utool.html#utool.util_str.strip_ansi">[docs]</a><span class="k">def</span> <span class="nf">strip_ansi</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c"># Remove ansi from length calculation</span>
    <span class="c"># References: http://stackoverflow.com/questions/14693701remove-ansi</span>
    <span class="n">ansi_escape</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\x1b[^m]*m&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ansi_escape</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_freespace_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_freespace_str">[docs]</a><span class="k">def</span> <span class="nf">get_freespace_str</span><span class="p">(</span><span class="n">dir_</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns string denoting free disk space in a directory &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_cplat</span>
    <span class="k">return</span> <span class="n">byte_str2</span><span class="p">(</span><span class="n">util_cplat</span><span class="o">.</span><span class="n">get_free_diskbytes</span><span class="p">(</span><span class="n">dir_</span><span class="p">))</span>


<span class="c"># FIXME: HASHLEN is a global var in util_hash</span></div>
<div class="viewcode-block" id="long_fname_format"><a class="viewcode-back" href="../../utool.html#utool.util_str.long_fname_format">[docs]</a><span class="k">def</span> <span class="nf">long_fname_format</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">,</span> <span class="n">fmt_dict</span><span class="p">,</span> <span class="n">hashable_keys</span><span class="o">=</span><span class="p">[],</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
                      <span class="n">hashlen</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">ABS_MAX_LEN</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">hack27</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Formats a string and hashes certain parts if the resulting string becomes</span>
<span class="sd">    too long. Used for making filenames fit onto disk.</span>

<span class="sd">    Args:</span>
<span class="sd">        fmt_str (str): format of fname</span>
<span class="sd">        fmt_dict (str): dict to format fname with</span>
<span class="sd">        hashable_keys (list): list of dict keys you are willing to have hashed</span>
<span class="sd">        max_len (int): tries to fit fname into this length</span>
<span class="sd">        ABS_MAX_LEN (int): throws AssertionError if fname over this length</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-long_fname_format</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTET</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; fmt_str = &#39;qaid={qaid}_res_{cfgstr}_quuid={quuid}&#39;</span>
<span class="sd">        &gt;&gt;&gt; quuid_str = &#39;blahblahblahblahblahblah&#39;</span>
<span class="sd">        &gt;&gt;&gt; cfgstr = &#39;big_long_string__________________________________&#39;</span>
<span class="sd">        &gt;&gt;&gt; qaid = 5</span>
<span class="sd">        &gt;&gt;&gt; fmt_dict = dict(cfgstr=cfgstr, qaid=qaid, quuid=quuid_str)</span>
<span class="sd">        &gt;&gt;&gt; hashable_keys = [&#39;cfgstr&#39;, &#39;quuid&#39;]</span>
<span class="sd">        &gt;&gt;&gt; max_len = 64</span>
<span class="sd">        &gt;&gt;&gt; hashlen = 8</span>
<span class="sd">        &gt;&gt;&gt; fname0 = ut.long_fname_format(fmt_str, fmt_dict, max_len=None)</span>
<span class="sd">        &gt;&gt;&gt; fname1 = ut.long_fname_format(fmt_str, fmt_dict, hashable_keys,</span>
<span class="sd">        &gt;&gt;&gt;                                  max_len=64, hashlen=8)</span>
<span class="sd">        &gt;&gt;&gt; fname2 = ut.long_fname_format(fmt_str, fmt_dict, hashable_keys, max_len=42,</span>
<span class="sd">        &gt;&gt;&gt;                         hashlen=8)</span>
<span class="sd">        &gt;&gt;&gt; result = fname0 + &#39;\n&#39; + fname1 + &#39;\n&#39; + fname2</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        qaid=5_res_big_long_string___________________________________quuid=blahblahblahblahblahblah</span>
<span class="sd">        qaid=5_res_kjrok785_quuid=blahblahblahblahblahblah</span>
<span class="sd">        qaid=5_res_du1&amp;i&amp;5l_quuid=euuaxoyi</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_hash</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">fmt_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">fmt_dict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_len</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fname</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">:</span>
        <span class="c"># Copy because we will overwrite fmt_dict values with hashed values</span>
        <span class="n">fmt_dict_</span> <span class="o">=</span> <span class="n">fmt_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">hashable_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hack27</span><span class="p">:</span>
                <span class="n">fmt_dict_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">util_hash</span><span class="o">.</span><span class="n">hashstr27</span><span class="p">(</span><span class="n">fmt_dict_</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">hashlen</span><span class="o">=</span><span class="n">hashlen</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmt_dict_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">util_hash</span><span class="o">.</span><span class="n">hashstr</span><span class="p">(</span><span class="n">fmt_dict_</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">hashlen</span><span class="o">=</span><span class="n">hashlen</span><span class="p">)</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">fmt_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">fmt_dict_</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_len</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">:</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">-</span> <span class="n">max_len</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;[util_str] Warning: Too big by </span><span class="si">%d</span><span class="s"> chars. Exausted all options&#39;</span>
                   <span class="s">&#39;to make fname fit into size. &#39;</span><span class="p">)</span>  <span class="o">%</span> <span class="p">(</span><span class="n">diff</span><span class="p">,)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;* len(fname) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;* fname = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ABS_MAX_LEN</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">ABS_MAX_LEN</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fname</span>

</div>
<div class="viewcode-block" id="multi_replace"><a class="viewcode-back" href="../../utool.html#utool.util_str.multi_replace">[docs]</a><span class="k">def</span> <span class="nf">multi_replace</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">search_list</span><span class="p">,</span> <span class="n">repl_list</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Performs multiple replace functions foreach item in search_list and</span>
<span class="sd">    repl_list.</span>

<span class="sd">    Args:</span>
<span class="sd">        str_ (str): string to search</span>
<span class="sd">        search_list (list): list of search strings</span>
<span class="sd">        repl_list (list or str): one or multiple replace strings</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: str_</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-multi_replace</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; str_ = &#39;foo. bar: baz; spam-eggs --- eggs+spam&#39;</span>
<span class="sd">        &gt;&gt;&gt; search_list = [&#39;.&#39;, &#39;:&#39;, &#39;---&#39;]</span>
<span class="sd">        &gt;&gt;&gt; repl_list = &#39;@&#39;</span>
<span class="sd">        &gt;&gt;&gt; str_ = multi_replace(str_, search_list, repl_list)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;str_ = %s&#39; % (str(str_),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        str_ = foo@ bar@ baz; spam-eggs @ eggs+spam</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">repl_list</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">repl_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">repl_list</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">search</span><span class="p">,</span> <span class="n">repl</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">search_list</span><span class="p">,</span> <span class="n">repl_list</span><span class="p">):</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="n">str_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">repl</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">str_</span>

</div>
<div class="viewcode-block" id="replace_nonquoted_text"><a class="viewcode-back" href="../../utool.html#utool.util_str.replace_nonquoted_text">[docs]</a><span class="k">def</span> <span class="nf">replace_nonquoted_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">search_list</span><span class="p">,</span> <span class="n">repl_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    replace_nonquoted_text</span>

<span class="sd">    WARNING: this function is not safely implemented. It can break of searching</span>
<span class="sd">    for single characters or underscores. Depends on utool.modify_quoted_strs</span>
<span class="sd">    which is also unsafely implemented</span>

<span class="sd">    Args:</span>
<span class="sd">        text (?):</span>
<span class="sd">        search_list (list):</span>
<span class="sd">        repl_list (list):</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; text = &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; search_list = &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; repl_list = &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = replace_nonquoted_text(text, search_list, repl_list)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Hacky way to preserve quoted text</span>
    <span class="c"># this will not work if search_list uses underscores or single characters</span>
    <span class="k">def</span> <span class="nf">preserve_quoted_str</span><span class="p">(</span><span class="n">quoted_str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">quoted_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span>
    <span class="k">def</span> <span class="nf">unpreserve_quoted_str</span><span class="p">(</span><span class="n">quoted_str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">quoted_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])[::</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="n">text_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">modify_quoted_strs</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">preserve_quoted_str</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">search</span><span class="p">,</span> <span class="n">repl</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">search_list</span><span class="p">,</span> <span class="n">repl_list</span><span class="p">):</span>
        <span class="n">text_</span> <span class="o">=</span> <span class="n">text_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">repl</span><span class="p">)</span>
    <span class="n">text_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">modify_quoted_strs</span><span class="p">(</span><span class="n">text_</span><span class="p">,</span> <span class="n">unpreserve_quoted_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text_</span>

</div>
<div class="viewcode-block" id="singular_string"><a class="viewcode-back" href="../../utool.html#utool.util_str.singular_string">[docs]</a><span class="k">def</span> <span class="nf">singular_string</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">plural_suffix</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="n">singular_suffix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    tries to use english grammar to make a string singular</span>
<span class="sd">    very naive implementation. will break often</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">str_</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">str_</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">plural_suffix</span><span class="p">)</span> <span class="k">else</span> <span class="n">str_</span>

</div>
<div class="viewcode-block" id="pluralize"><a class="viewcode-back" href="../../utool.html#utool.util_str.pluralize">[docs]</a><span class="k">def</span> <span class="nf">pluralize</span><span class="p">(</span><span class="n">wordtext</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">plural_suffix</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">wordtext</span> <span class="o">+</span> <span class="n">plural_suffix</span><span class="p">)</span> <span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">wordtext</span>

</div>
<div class="viewcode-block" id="quantity_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.quantity_str">[docs]</a><span class="k">def</span> <span class="nf">quantity_str</span><span class="p">(</span><span class="n">typestr</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">plural_suffix</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">pluralize</span><span class="p">(</span><span class="n">typestr</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">plural_suffix</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="remove_vowels"><a class="viewcode-back" href="../../utool.html#utool.util_str.remove_vowels">[docs]</a><span class="k">def</span> <span class="nf">remove_vowels</span><span class="p">(</span><span class="n">str_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; strips all vowels from a string &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">char_</span> <span class="ow">in</span> <span class="s">&#39;AEOIUaeiou&#39;</span><span class="p">:</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="n">str_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char_</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">str_</span>

</div>
<div class="viewcode-block" id="clipstr"><a class="viewcode-back" href="../../utool.html#utool.util_str.clipstr">[docs]</a><span class="k">def</span> <span class="nf">clipstr</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    tries to shorten string as much as it can until it is just barely readable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
        <span class="n">str2</span> <span class="o">=</span> <span class="p">(</span><span class="n">str_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">remove_vowels</span><span class="p">(</span><span class="n">str_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">str2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">maxlen</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">str_</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">maxlen</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">str_</span>
<span class="c">#def parse_commas_wrt_groups(str_):</span>
<span class="c">#    &quot;&quot;&quot;</span>
<span class="c">#    str_ = &#39;cdef np.ndarray[np.float64_t, cast=True] x, y, z&#39;</span>
<span class="c">#    &quot;&quot;&quot;</span>
<span class="c">#    nLParen = 0</span>
<span class="c">#    nLBracket = 0</span>
<span class="c">#    pass</span>

</div>
<div class="viewcode-block" id="msgblock"><a class="viewcode-back" href="../../utool.html#utool.util_str.msgblock">[docs]</a><span class="k">def</span> <span class="nf">msgblock</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; puts text inside a visual ascii block &quot;&quot;&quot;</span>
    <span class="n">blocked_text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="s">&#39; + --- &#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s">&#39; ---</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]</span> <span class="o">+</span>
        <span class="p">[</span><span class="s">&#39; | &#39;</span> <span class="o">+</span> <span class="n">line</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)]</span> <span class="o">+</span>
        <span class="p">[</span><span class="s">&#39; L ___ &#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s">&#39; ___</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">blocked_text</span>

</div>
<div class="viewcode-block" id="number_text_lines"><a class="viewcode-back" href="../../utool.html#utool.util_str.number_text_lines">[docs]</a><span class="k">def</span> <span class="nf">number_text_lines</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        text (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: text_with_lineno - string with numbered lines</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">numbered_linelist</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(((</span><span class="s">&#39;</span><span class="si">%2d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="s">&#39; &gt;&gt;&gt; &#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
    <span class="p">]</span>
    <span class="n">text_with_lineno</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">numbered_linelist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text_with_lineno</span>

</div>
<div class="viewcode-block" id="get_textdiff"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_textdiff">[docs]</a><span class="k">def</span> <span class="nf">get_textdiff</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">num_context_lines</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_whitespace</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Uses difflib to return a difference string between two</span>
<span class="sd">    similar texts</span>

<span class="sd">    References:</span>
<span class="sd">        http://www.java2s.com/Code/Python/Utility/IntelligentdiffbetweentextfilesTimPeters.htm</span>

<span class="sd">    Args:</span>
<span class="sd">        text1 (?):</span>
<span class="sd">        text2 (?):</span>

<span class="sd">    Returns:</span>
<span class="sd">        ?:</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --test-get_textdiff:1</span>
<span class="sd">        python -m utool.util_str --test-get_textdiff:0</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; text1 = &#39;one\ntwo\nthree&#39;</span>
<span class="sd">        &gt;&gt;&gt; text2 = &#39;one\ntwo\nfive&#39;</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; result = get_textdiff(text1, text2)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        - three</span>
<span class="sd">        + five</span>

<span class="sd">    Example2:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; text1 = &#39;one\ntwo\nthree\n3.1\n3.14\n3.1415\npi\n3.4\n3.5\n4&#39;</span>
<span class="sd">        &gt;&gt;&gt; text2 = &#39;one\ntwo\nfive\n3.1\n3.14\n3.1415\npi\n3.4\n4&#39;</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; num_context_lines = 1</span>
<span class="sd">        &gt;&gt;&gt; result = get_textdiff(text1, text2, num_context_lines)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">difflib</span>
    <span class="n">text1</span> <span class="o">=</span> <span class="n">ensure_unicode</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
    <span class="n">text2</span> <span class="o">=</span> <span class="n">ensure_unicode</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
    <span class="n">text1_lines</span> <span class="o">=</span> <span class="n">text1</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">text2_lines</span> <span class="o">=</span> <span class="n">text2</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ignore_whitespace</span><span class="p">:</span>
        <span class="n">all_diff_lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">text1_lines</span><span class="p">,</span> <span class="n">text2_lines</span><span class="p">,</span> <span class="n">difflib</span><span class="o">.</span><span class="n">IS_LINE_JUNK</span><span class="p">,</span> <span class="n">difflib</span><span class="o">.</span><span class="n">IS_CHARACTER_JUNK</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_diff_lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">text1_lines</span><span class="p">,</span> <span class="n">text2_lines</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">num_context_lines</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">diff_lines</span> <span class="o">=</span> <span class="n">all_diff_lines</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_list</span>
        <span class="c"># boolean for every line if it is marked or not</span>
        <span class="n">ismarked_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s">&#39;+-?&#39;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">all_diff_lines</span><span class="p">]</span>
        <span class="c"># flag lines that are within num_context_lines away from a diff line</span>
        <span class="n">isvalid_list</span> <span class="o">=</span> <span class="n">ismarked_list</span><span class="p">[:]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_context_lines</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">isvalid_list</span><span class="p">[:</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">util_list</span><span class="o">.</span><span class="n">or_lists</span><span class="p">(</span><span class="n">isvalid_list</span><span class="p">[:</span><span class="o">-</span><span class="n">i</span><span class="p">],</span> <span class="n">ismarked_list</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
            <span class="n">isvalid_list</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>  <span class="o">=</span> <span class="n">util_list</span><span class="o">.</span><span class="n">or_lists</span><span class="p">(</span><span class="n">isvalid_list</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="n">ismarked_list</span><span class="p">[:</span><span class="o">-</span><span class="n">i</span><span class="p">])</span>
        <span class="n">USE_BREAK_LINE</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">USE_BREAK_LINE</span><span class="p">:</span>
            <span class="c"># insert a visual break when there is a break in context</span>
            <span class="n">diff_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">visual_break</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s"> &lt;... FILTERED CONTEXT ...&gt; </span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="c">#print(isvalid_list)</span>
            <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">valid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_diff_lines</span><span class="p">,</span> <span class="n">isvalid_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
                    <span class="n">diff_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">prev</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
                        <span class="n">diff_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">visual_break</span><span class="p">)</span>
                <span class="n">prev</span> <span class="o">=</span> <span class="n">valid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">diff_lines</span> <span class="o">=</span> <span class="n">util_list</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">all_diff_lines</span><span class="p">,</span> <span class="n">isvalid_list</span><span class="p">)</span>
        <span class="c">#</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff_lines</span><span class="p">)</span>

</div>
<span class="n">difftext</span> <span class="o">=</span> <span class="n">get_textdiff</span>


<div class="viewcode-block" id="conj_phrase"><a class="viewcode-back" href="../../utool.html#utool.util_str.conj_phrase">[docs]</a><span class="k">def</span> <span class="nf">conj_phrase</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">cond</span><span class="o">=</span><span class="s">&#39;or&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Joins a list of words using English conjunction rules</span>

<span class="sd">    Args:</span>
<span class="sd">        list_ (list):  of strings</span>
<span class="sd">        cond (str): a conjunction (or, and, but)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: the joined cconjunction phrase</span>

<span class="sd">    References:</span>
<span class="sd">        http://en.wikipedia.org/wiki/Conjunction_(grammar)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; list_ = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">        &gt;&gt;&gt; result = conj_phrase(list_, &#39;or&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        a, b, or c</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; list_ = [&#39;a&#39;, &#39;b&#39;]</span>
<span class="sd">        &gt;&gt;&gt; result = conj_phrase(list_, &#39;and&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        a and b</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">list_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">list_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cond</span><span class="p">,</span> <span class="n">list_</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">condstr</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s">&#39;, &#39;</span> <span class="o">+</span> <span class="n">cond</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">condstr</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])))</span>

</div>
<div class="viewcode-block" id="doctest_code_line"><a class="viewcode-back" href="../../utool.html#utool.util_str.doctest_code_line">[docs]</a><span class="k">def</span> <span class="nf">doctest_code_line</span><span class="p">(</span><span class="n">line_str</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">varprefix</span> <span class="o">=</span> <span class="n">varname</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span> <span class="k">if</span> <span class="n">varname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    <span class="n">prefix1</span> <span class="o">=</span> <span class="s">&#39;&gt;&gt;&gt; &#39;</span> <span class="o">+</span> <span class="n">varprefix</span>
    <span class="n">prefix2</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">... &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">varprefix</span><span class="p">))</span>
    <span class="n">doctest_line_str</span> <span class="o">=</span> <span class="n">prefix1</span> <span class="o">+</span> <span class="n">prefix2</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">doctest_line_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">doctest_line_str</span>

</div>
<div class="viewcode-block" id="doctest_repr"><a class="viewcode-back" href="../../utool.html#utool.util_str.doctest_repr">[docs]</a><span class="k">def</span> <span class="nf">doctest_repr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="n">varname_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_varname_from_stack</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">varname</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">varname</span>
    <span class="k">if</span> <span class="n">util_type</span><span class="o">.</span><span class="n">HAVE_NUMPY</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">line_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">numpy_str</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">suppress_small</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_str</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="n">doctest_line_str</span> <span class="o">=</span> <span class="n">doctest_code_line</span><span class="p">(</span><span class="n">line_str</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="n">varname_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">doctest_line_str</span>

</div>
<div class="viewcode-block" id="format_text_as_docstr"><a class="viewcode-back" href="../../utool.html#utool.util_str.format_text_as_docstr">[docs]</a><span class="k">def</span> <span class="nf">format_text_as_docstr</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python  ~/local/vim/rc/pyvim_funcs.py  --test-format_text_as_docstr</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from pyvim_funcs import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; text = testdata_text()</span>
<span class="sd">        &gt;&gt;&gt; formated_text = format_text_as_docstr(text)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;formated_text = \n%s&#39; % (str(formated_text),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="n">min_indent</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_minimum_indentation</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">indent_</span> <span class="o">=</span>  <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">min_indent</span>
    <span class="n">formated_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;^&#39;</span> <span class="o">+</span> <span class="n">indent_</span><span class="p">,</span> <span class="s">&#39;&#39;</span> <span class="o">+</span> <span class="n">indent_</span> <span class="o">+</span> <span class="s">&#39;&gt;&gt;&gt; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span>
                           <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="n">formated_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span> <span class="o">+</span> <span class="n">indent_</span> <span class="o">+</span> <span class="s">&#39;&gt;&gt;&gt; #&#39;</span><span class="p">,</span> <span class="n">formated_text</span><span class="p">,</span>
                           <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">formated_text</span>

</div>
<div class="viewcode-block" id="unformat_text_as_docstr"><a class="viewcode-back" href="../../utool.html#utool.util_str.unformat_text_as_docstr">[docs]</a><span class="k">def</span> <span class="nf">unformat_text_as_docstr</span><span class="p">(</span><span class="n">formated_text</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python  ~/local/vim/rc/pyvim_funcs.py  --test-unformat_text_as_docstr</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from pyvim_funcs import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; text = testdata_text()</span>
<span class="sd">        &gt;&gt;&gt; formated_text = format_text_as_docstr(text)</span>
<span class="sd">        &gt;&gt;&gt; unformated_text = unformat_text_as_docstr(formated_text)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;unformated_text = \n%s&#39; % (str(unformated_text),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="n">min_indent</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_minimum_indentation</span><span class="p">(</span><span class="n">formated_text</span><span class="p">)</span>
    <span class="n">indent_</span> <span class="o">=</span>  <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">min_indent</span>
    <span class="n">unformated_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;^&#39;</span> <span class="o">+</span> <span class="n">indent_</span> <span class="o">+</span> <span class="s">&#39;&gt;&gt;&gt; &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span> <span class="o">+</span> <span class="n">indent_</span><span class="p">,</span>
                             <span class="n">formated_text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unformated_text</span>

</div>
<div class="viewcode-block" id="lorium_ipsum"><a class="viewcode-back" href="../../utool.html#utool.util_str.lorium_ipsum">[docs]</a><span class="k">def</span> <span class="nf">lorium_ipsum</span><span class="p">():</span>
    <span class="n">ipsum_str</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed</span>
<span class="s">    do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad</span>
<span class="s">    minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex</span>
<span class="s">    ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate</span>
<span class="s">    velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat</span>
<span class="s">    cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id</span>
<span class="s">    est laborum.</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ipsum_str</span>

</div>
<div class="viewcode-block" id="bubbletext"><a class="viewcode-back" href="../../utool.html#utool.util_str.bubbletext">[docs]</a><span class="k">def</span> <span class="nf">bubbletext</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s">&#39;cybermedium&#39;</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Other fonts include: cybersmall, cybermedium, and cyberlarge</span>

<span class="sd">    import pyfiglet</span>
<span class="sd">    TODO move elsewhere</span>

<span class="sd">    References:</span>
<span class="sd">        http://www.figlet.org/</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; bubble_text1 = ut.bubbletext(&#39;TESTING&#39;, font=&#39;cyberlarge&#39;)</span>
<span class="sd">        &gt;&gt;&gt; bubble_text2 = ut.bubbletext(&#39;BUBBLE&#39;, font=&#39;cybermedium&#39;)</span>
<span class="sd">        &gt;&gt;&gt; bubble_text3 = ut.bubbletext(&#39;TEXT&#39;, font=&#39;cyberlarge&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;\n&#39;.join([bubble_text1, bubble_text2, bubble_text3]))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># TODO: move this function elsewhere</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="n">pyfiglet</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">tryimport</span><span class="p">(</span><span class="s">&#39;pyfiglet&#39;</span><span class="p">,</span> <span class="s">&#39;git+https://github.com/pwaller/pyfiglet&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pyfiglet</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bubble_text</span> <span class="o">=</span> <span class="n">pyfiglet</span><span class="o">.</span><span class="n">figlet_format</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bubble_text</span>

</div>
<div class="viewcode-block" id="edit_distance"><a class="viewcode-back" href="../../utool.html#utool.util_str.edit_distance">[docs]</a><span class="k">def</span> <span class="nf">edit_distance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pip install python-Levenshtein</span>

<span class="sd">    query = &#39;hello world&#39;</span>
<span class="sd">    options = [&#39;goodbye world&#39;, &#39;rofl&#39;, &#39;hello&#39;, &#39;world&#39;, &#39;lowo&#39;]</span>
<span class="sd">    [7, 9, 6, 6, 7]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">Levenshtein</span>
    <span class="n">dist_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">Levenshtein</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">options</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dist_list</span>

</div>
<div class="viewcode-block" id="closet_words"><a class="viewcode-back" href="../../utool.html#utool.util_str.closet_words">[docs]</a><span class="k">def</span> <span class="nf">closet_words</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="n">dist_list</span> <span class="o">=</span> <span class="n">edit_distance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="n">ranked_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">sortedby</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">dist_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ranked_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">num</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="to_title_caps"><a class="viewcode-back" href="../../utool.html#utool.util_str.to_title_caps">[docs]</a><span class="k">def</span> <span class="nf">to_title_caps</span><span class="p">(</span><span class="n">underscore_case</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        underscore_case (?):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: title_str</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-to_title_caps</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; underscore_case = &#39;the_foo_bar_func&#39;</span>
<span class="sd">        &gt;&gt;&gt; title_str = to_title_caps(underscore_case)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;title_str = %s&#39; % (str(title_str),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        title_str = The Foo Bar Func</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">underscore_case</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">words2</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">title_str</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">title_str</span>

</div>
<div class="viewcode-block" id="to_underscore_case"><a class="viewcode-back" href="../../utool.html#utool.util_str.to_underscore_case">[docs]</a><span class="k">def</span> <span class="nf">to_underscore_case</span><span class="p">(</span><span class="n">camelcase_str</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/1175208/convert-camelcase</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; camelcase_str = &#39;UnderscoreFuncname&#39;</span>
<span class="sd">        &gt;&gt;&gt; camel_case_str = to_underscore_case(camelcase_str)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;underscore_str = %s&#39; % (str(camel_case_str),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        underscore_str = underscore_funcname</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;(.)([A-Z][a-z]+)&#39;</span><span class="p">,</span> <span class="s">r&#39;\1_\2&#39;</span><span class="p">,</span> <span class="n">camelcase_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;([a-z0-9])([A-Z])&#39;</span><span class="p">,</span> <span class="s">r&#39;\1_\2&#39;</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="to_camel_case"><a class="viewcode-back" href="../../utool.html#utool.util_str.to_camel_case">[docs]</a><span class="k">def</span> <span class="nf">to_camel_case</span><span class="p">(</span><span class="n">underscore_case</span><span class="p">,</span> <span class="n">mixed</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        underscore_case (?):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: camel_case_str</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-to_camel_case</span>

<span class="sd">    References:</span>
<span class="sd">        https://en.wikipedia.org/wiki/CamelCase</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; underscore_case = &#39;underscore_funcname&#39;</span>
<span class="sd">        &gt;&gt;&gt; camel_case_str = to_camel_case(underscore_case)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;camel_case_str = %s&#39; % (str(camel_case_str),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        camel_case_str = UnderscoreFuncname</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">mixed</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">underscore_case</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">words2</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">thresh</span> <span class="k">else</span>
        <span class="n">word</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">camel_case_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">camel_case_str</span>

</div>
<div class="viewcode-block" id="is_url"><a class="viewcode-back" href="../../utool.html#utool.util_str.is_url">[docs]</a><span class="k">def</span> <span class="nf">is_url</span><span class="p">(</span><span class="n">str_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; heuristic check if str is url formatted &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">([</span>
        <span class="n">str_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;http://&#39;</span><span class="p">),</span>
        <span class="n">str_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;https://&#39;</span><span class="p">),</span>
        <span class="n">str_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;www.&#39;</span><span class="p">),</span>
        <span class="s">&#39;.org/&#39;</span> <span class="ow">in</span> <span class="n">str_</span><span class="p">,</span>
        <span class="s">&#39;.com/&#39;</span> <span class="ow">in</span> <span class="n">str_</span><span class="p">,</span>
    <span class="p">])</span>

</div>
<div class="viewcode-block" id="autoformat_pep8"><a class="viewcode-back" href="../../utool.html#utool.util_str.autoformat_pep8">[docs]</a><span class="k">def</span> <span class="nf">autoformat_pep8</span><span class="p">(</span><span class="n">sourcecode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        code (str):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-autoformat_pep8</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        &#39;aggressive&#39;: 0,</span>
<span class="sd">        &#39;diff&#39;: False,</span>
<span class="sd">        &#39;exclude&#39;: [],</span>
<span class="sd">        &#39;experimental&#39;: False,</span>
<span class="sd">        &#39;files&#39;: [u&#39;&#39;],</span>
<span class="sd">        &#39;global_config&#39;: ~/.config/pep8,</span>
<span class="sd">        &#39;ignore&#39;: set([u&#39;E24&#39;]),</span>
<span class="sd">        &#39;ignore_local_config&#39;: False,</span>
<span class="sd">        &#39;in_place&#39;: False,</span>
<span class="sd">        &#39;indent_size&#39;: 4,</span>
<span class="sd">        &#39;jobs&#39;: 1,</span>
<span class="sd">        &#39;line_range&#39;: None,</span>
<span class="sd">        &#39;list_fixes&#39;: False,</span>
<span class="sd">        &#39;max_line_length&#39;: 79,</span>
<span class="sd">        &#39;pep8_passes&#39;: -1,</span>
<span class="sd">        &#39;recursive&#39;: False,</span>
<span class="sd">        &#39;select&#39;: ,</span>
<span class="sd">        &#39;verbose&#39;: 0,</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">autopep8</span>
    <span class="n">pep8_options</span> <span class="o">=</span> <span class="n">autopep8</span><span class="o">.</span><span class="n">_get_options</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">new_source</span> <span class="o">=</span> <span class="n">autopep8</span><span class="o">.</span><span class="n">fix_code</span><span class="p">(</span><span class="n">sourcecode</span><span class="p">,</span> <span class="n">pep8_options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_source</span>

</div>
<div class="viewcode-block" id="filtered_infostr"><a class="viewcode-back" href="../../utool.html#utool.util_str.filtered_infostr">[docs]</a><span class="k">def</span> <span class="nf">filtered_infostr</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
    <span class="n">removed</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
    <span class="n">reasonstr</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="n">reason</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&#39; based on </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reason</span><span class="p">,)</span>
    <span class="n">percent</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">removed</span> <span class="o">/</span> <span class="n">total</span>
    <span class="n">str_</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Removing </span><span class="si">%d</span><span class="s"> / </span><span class="si">%d</span><span class="s"> (</span><span class="si">%.2f%%</span><span class="s">) </span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">removed</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">percent</span><span class="p">,</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">reasonstr</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">str_</span>

</div>
<div class="viewcode-block" id="chr_range"><a class="viewcode-back" href="../../utool.html#utool.util_str.chr_range">[docs]</a><span class="k">def</span> <span class="nf">chr_range</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Like range but returns characters</span>

<span class="sd">    Args:</span>
<span class="sd">        start (None): (default = None)</span>
<span class="sd">        stop (None): (default = None)</span>
<span class="sd">        step (None): (default = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        list:</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m ibeis.algo.hots.bayes --exec-chr_range</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; args = (5,)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(chr_range(2, base=&#39;a&#39;))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; print(chr_range(0, 5))</span>
<span class="sd">        &gt;&gt;&gt; print(chr_range(0, 50))</span>
<span class="sd">        &gt;&gt;&gt; print(chr_range(0, 5, 2))</span>
<span class="sd">        [&#39;a&#39;, &#39;b&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">stop</span><span class="p">,</span> <span class="o">=</span> <span class="n">args</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">args</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;incorrect args&#39;</span><span class="p">)</span>

    <span class="n">chr_</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">unichr</span>

    <span class="n">base</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;base&#39;</span><span class="p">,</span> <span class="s">&#39;i&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">start</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stop</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">stop</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stop</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">list_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">chr_</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">list_</span>

</div>
<div class="viewcode-block" id="get_colored_diff"><a class="viewcode-back" href="../../utool.html#utool.util_str.get_colored_diff">[docs]</a><span class="k">def</span> <span class="nf">get_colored_diff</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">highlight_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer_name</span><span class="o">=</span><span class="s">&#39;diff&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="highlight_code"><a class="viewcode-back" href="../../utool.html#utool.util_str.highlight_code">[docs]</a><span class="k">def</span> <span class="nf">highlight_code</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer_name</span><span class="o">=</span><span class="s">&#39;python&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">highlight_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer_name</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="highlight_text"><a class="viewcode-back" href="../../utool.html#utool.util_str.highlight_text">[docs]</a><span class="k">def</span> <span class="nf">highlight_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer_name</span><span class="o">=</span><span class="s">&#39;python&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    SeeAlso:</span>
<span class="sd">        color_text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Resolve extensions to languages</span>
    <span class="n">lexer_name</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;py&#39;</span><span class="p">:</span> <span class="s">&#39;python&#39;</span><span class="p">,</span>
        <span class="s">&#39;h&#39;</span><span class="p">:</span> <span class="s">&#39;cpp&#39;</span><span class="p">,</span>
        <span class="s">&#39;cpp&#39;</span><span class="p">:</span> <span class="s">&#39;cpp&#39;</span><span class="p">,</span>
        <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="s">&#39;cpp&#39;</span><span class="p">,</span>
    <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lexer_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="n">lexer_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lexer_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;yellow&#39;</span><span class="p">,</span> <span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="s">&#39;green&#39;</span><span class="p">]:</span>
        <span class="c"># hack for coloring</span>
        <span class="k">return</span> <span class="n">color_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer_name</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">if</span> <span class="n">ENABLE_COLORS</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pygments</span>
            <span class="kn">import</span> <span class="nn">pygments.lexers</span>
            <span class="kn">import</span> <span class="nn">pygments.formatters</span>
            <span class="c">#from pygments import highlight</span>
            <span class="c">#from pygments.lexers import get_lexer_by_name</span>
            <span class="c">#from pygments.formatters import TerminalFormatter</span>
            <span class="c">#if ut.WIN32:</span>
            <span class="c">#    assert False</span>
            <span class="c">#    #formater = pygments.formatters.terminal256.Terminal256Formatter()</span>
            <span class="c">#    import pygments.formatters.terminal256</span>
            <span class="c">#    formater = pygments.formatters.terminal256.Terminal256Formatter()</span>
            <span class="c">#else:</span>
            <span class="kn">import</span> <span class="nn">pygments.formatters.terminal</span>
            <span class="n">formater</span> <span class="o">=</span> <span class="n">pygments</span><span class="o">.</span><span class="n">formatters</span><span class="o">.</span><span class="n">terminal</span><span class="o">.</span><span class="n">TerminalFormatter</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s">&#39;dark&#39;</span><span class="p">)</span>
            <span class="n">lexer</span> <span class="o">=</span> <span class="n">pygments</span><span class="o">.</span><span class="n">lexers</span><span class="o">.</span><span class="n">get_lexer_by_name</span><span class="p">(</span><span class="n">lexer_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pygments</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span> <span class="n">formater</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">SUPER_STRICT</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">return</span> <span class="n">text</span>
    <span class="k">return</span> <span class="n">text</span>

</div>
<div class="viewcode-block" id="color_text"><a class="viewcode-back" href="../../utool.html#utool.util_str.color_text">[docs]</a><span class="k">def</span> <span class="nf">color_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    SeeAlso:</span>
<span class="sd">        highlight_text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ENABLE_COLORS</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">pygments</span>
        <span class="kn">import</span> <span class="nn">pygments.console</span>
        <span class="n">ansi_text</span> <span class="o">=</span> <span class="n">pygments</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">WIN32</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">colorama</span>
            <span class="n">ansi_reset</span> <span class="o">=</span> <span class="p">(</span><span class="n">colorama</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ansi_reset</span> <span class="o">=</span> <span class="n">pygments</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="s">&#39;reset&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ansi_text</span> <span class="o">=</span> <span class="n">ansi_text</span> <span class="o">+</span> <span class="n">ansi_reset</span>
        <span class="k">return</span> <span class="n">ansi_text</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>

</div>
<div class="viewcode-block" id="highlight_regex"><a class="viewcode-back" href="../../utool.html#utool.util_str.highlight_regex">[docs]</a><span class="k">def</span> <span class="nf">highlight_regex</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">pat</span><span class="p">,</span> <span class="n">reflags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FIXME Use pygments instead</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#import colorama</span>
    <span class="c"># from colorama import Fore, Style</span>
    <span class="c">#color = Fore.MAGENTA</span>
    <span class="c"># color = Fore.RED</span>
    <span class="c">#match = re.search(pat, str_, flags=reflags)</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">str_</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">reflags</span><span class="p">))</span>

    <span class="n">colored</span> <span class="o">=</span> <span class="n">str_</span>

    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
        <span class="c">#pass</span>
        <span class="c">#if match is None:</span>
        <span class="c">#    return str_</span>
        <span class="c">#else:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
        <span class="c">#colorama.init()</span>
        <span class="n">colored_part</span> <span class="o">=</span> <span class="n">color_text</span><span class="p">(</span><span class="n">colored</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">colored</span> <span class="o">=</span> <span class="n">colored</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">colored_part</span> <span class="o">+</span> <span class="n">colored</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span>
        <span class="c"># colored = (colored[:start] + color + colored[start:end] +</span>
        <span class="c">#            Style.RESET_ALL + colored[end:])</span>
        <span class="c">#colorama.deinit()</span>
    <span class="k">return</span> <span class="n">colored</span>

</div>
<div class="viewcode-block" id="varinfo_str"><a class="viewcode-back" href="../../utool.html#utool.util_str.varinfo_str">[docs]</a><span class="k">def</span> <span class="nf">varinfo_str</span><span class="p">(</span><span class="n">varval</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">onlyrepr</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">canshowrepr</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                <span class="n">varcolor</span><span class="o">=</span><span class="s">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">colored</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="c"># varval = getattr(cm, varname.replace(&#39;cm.&#39;, &#39;&#39;))</span>
    <span class="n">varinfo_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">print_summary</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">onlyrepr</span> <span class="ow">and</span> <span class="n">ut</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">varval</span><span class="p">)</span>
    <span class="n">show_repr</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">show_repr</span> <span class="o">=</span> <span class="n">show_repr</span> <span class="ow">or</span> <span class="p">(</span><span class="n">onlyrepr</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">print_summary</span><span class="p">)</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span>
    <span class="k">if</span> <span class="n">colored</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">ut</span><span class="o">.</span><span class="n">util_dbg</span><span class="o">.</span><span class="n">COLORED_EXCEPTIONS</span><span class="p">:</span>
        <span class="n">varname</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">color_text</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">varcolor</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_repr</span><span class="p">:</span>
        <span class="n">varval_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr2</span><span class="p">(</span><span class="n">varval</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varval_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">varval_str</span> <span class="o">=</span> <span class="s">&#39;&lt;omitted&gt;&#39;</span>
        <span class="n">varval_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truncate_str</span><span class="p">(</span><span class="n">varval_str</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">varinfo_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;    * </span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">varval_str</span><span class="p">)]</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span>
    <span class="k">if</span> <span class="n">print_summary</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">varval</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">varval</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">depth_profile</span><span class="p">(</span><span class="n">varval</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">show_repr</span><span class="p">:</span>
            <span class="n">varinfo_list</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="c"># &#39;    %s varinfo(%s):&#39; % (symbol, varname,),</span>
                <span class="s">&#39;    </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> = &lt;not shown!&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">varname</span><span class="p">,),</span>
            <span class="p">]</span>
        <span class="n">varinfo_list</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="s">&#39;          len = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">varval</span><span class="p">),)]</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">varval</span><span class="p">):</span>
            <span class="n">depth_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truncate_str</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">depth</span><span class="p">),</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
            <span class="n">varinfo_list</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="s">&#39;          depth = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">depth_str</span><span class="p">,)]</span>
        <span class="n">varinfo_list</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="s">&#39;          types = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">list_type_profile</span><span class="p">(</span><span class="n">varval</span><span class="p">),)]</span>
        <span class="c">#varinfo = &#39;\n&#39;.join(ut.align_lines(varinfo_list, &#39;=&#39;))</span>
    <span class="n">aligned_varinfo_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">align_lines</span><span class="p">(</span><span class="n">varinfo_list</span><span class="p">,</span> <span class="s">&#39;=&#39;</span><span class="p">)</span>
    <span class="n">varinfo</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aligned_varinfo_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">varinfo</span>

</div>
<div class="viewcode-block" id="testdata_text"><a class="viewcode-back" href="../../utool.html#utool.util_str.testdata_text">[docs]</a><span class="k">def</span> <span class="nf">testdata_text</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="c">#ut.util_dbg.COLORED_EXCEPTIONS = False</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s">r&#39;&#39;&#39;</span>
<span class="s">        % COMMENT</span>
<span class="s">        Image matching relies on finding similar features between query and</span>
<span class="s">        database images, and there are many factors that can cause this to be</span>
<span class="s">        difficult.</span>
<span class="s">        % TALK ABOUT APPEARANCE HERE</span>
<span class="s">        Similar to issues seen in (1) instance and (2) face recognition,</span>
<span class="s">        images of animals taken ``in the wild&#39;&#39; contain many challenges such as</span>
<span class="s">        occlusion, distractors and variations in viewpoint, pose, illumination,</span>
<span class="s">        quality, and camera parameters.  We start the discussion of the problem</span>
<span class="s">        addressed in this thesis by considering examples of these challenges.</span>

<span class="s">        \distractorexample</span>

<span class="s">        \paragraph{foobar}</span>
<span class="s">        Occluders are objects in the foreground of an image that impact the</span>
<span class="s">        visibility of the features on the subject animal.</span>
<span class="s">         Both scenery and other animals are the main contributors of occlusion in</span>
<span class="s">        our dataset.</span>
<span class="s">         Occlusion from other animals is especially challenging because not only</span>

<span class="s">        \begin{enumerate} % Affine Adaptation Procedure</span>
<span class="s">           \item Compute the second moment matrix at the warped image patch defined by $\ellmat_i$.</span>

<span class="s">           \item If the keypoint is stable, stop.  If convergence has not been reached in</span>
<span class="s">                some number of iterations stop and discard the keypoint.</span>

<span class="s">           \item</span>
<span class="s">                  Update the affine shape  using the rule $\ellmat_{i + 1} =</span>
<span class="s">                \sqrtm{\momentmat} \ellmat_i$.</span>
<span class="s">                  This ensures the eigenvalues at the previously detected point</span>
<span class="s">                are equal in the new frame.</span>
<span class="s">                  If the keypoint is stable, it should be re-detected close to</span>
<span class="s">                the same location.</span>
<span class="s">                  (The square root of a matrix defined as:</span>
<span class="s">                $\sqrtm{\momentmatNOARG} \equiv \mat{X} \where \mat{X}^T\mat{X}</span>
<span class="s">                = \momentmatNOARG$.</span>
<span class="s">                  If $\momentmatNOARG$ is degenerate than $\mat{X}$ does not</span>
<span class="s">                exist.)</span>
<span class="s">        \end{enumerate}</span>
<span class="s">    &#39;&#39;&#39;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

    <span class="n">text2</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span><span class="s">r&#39;&#39;&#39;</span>
<span class="s">        \begin{comment}</span>
<span class="s">        python -m ibeis -e rank_cdf -t invar -a viewdiff --test_cfgx_slice=6: --db PZ_Master1 --hargv=expt --prefix &quot;Invariance+View Experiment &quot;  # NOQA</span>
<span class="s">        \end{comment}</span>
<span class="s">        \ImageCommand{figuresX/expt_rank_cdf_PZ_Master1_a_viewdiff_t_invar.png}{\textwidth}{</span>
<span class="s">        Results of the invariance experiment with different viewpoints for plains</span>
<span class="s">        zebras.  Only the results with different viewpoints are shown.  The query and</span>
<span class="s">        database annotations are the same as those in the viewpoint experiment.  Thre</span>
<span class="s">        is less than a $2\percent$ gap between the best results with keypoint</span>
<span class="s">        invariance and the results without any keypoint invariance.  (Note that</span>
<span class="s">        invariance we we discuss here only refers to keypoint shape and not the</span>
<span class="s">        invariance that is implicit in the SIFT descriptor).</span>
<span class="s">        }{PZInvarViewExpt}</span>
<span class="s">    &#39;&#39;&#39;</span><span class="p">)</span>  <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s"> foobar foobar fooo. hwodefoobardoo</span><span class="se">\n\n</span><span class="s">&#39;</span>
    <span class="k">return</span> <span class="n">text</span> <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">text2</span>

</div>
<div class="viewcode-block" id="regex_reconstruct_split"><a class="viewcode-back" href="../../utool.html#utool.util_str.regex_reconstruct_split">[docs]</a><span class="k">def</span> <span class="nf">regex_reconstruct_split</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="c">#separators = re.findall(pattern, text)</span>
    <span class="n">separators</span> <span class="o">=</span> <span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)]</span>
    <span class="c">#separators = [match.group() for match in re.finditer(pattern, text, flags=re.MULTILINE)]</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="s">&#39;[recon] separators = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">separators</span><span class="p">),</span> <span class="s">&#39;green&#39;</span><span class="p">)</span>

    <span class="n">remaining</span> <span class="o">=</span> <span class="n">text</span>
    <span class="n">block_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sep</span> <span class="ow">in</span> <span class="n">separators</span><span class="p">:</span>
        <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">remaining</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">block_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="n">tail</span>
    <span class="n">block_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remaining</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="s">&#39;[recon] block_list = &#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">block_list</span><span class="p">),</span> <span class="s">&#39;red&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">block_list</span><span class="p">,</span> <span class="n">separators</span>

</div>
<div class="viewcode-block" id="format_multiple_paragraph_sentences"><a class="viewcode-back" href="../../utool.html#utool.util_str.format_multiple_paragraph_sentences">[docs]</a><span class="k">def</span> <span class="nf">format_multiple_paragraph_sentences</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FIXME: funky things happen when multiple newlines in the middle of</span>
<span class="sd">    paragraphs</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python ~/local/vim/rc/pyvim_funcs.py --test-format_multiple_paragraph_sentences</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-format_multiple_paragraph_sentences --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import os, sys</span>
<span class="sd">        &gt;&gt;&gt; #sys.path.append(os.path.expanduser(&#39;~/local/vim/rc&#39;))</span>
<span class="sd">        &gt;&gt;&gt; text = testdata_text(2)</span>
<span class="sd">        &gt;&gt;&gt; formated_text = format_multiple_paragraph_sentences(text, debug=True)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;+--- Text ---&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(text)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;+--- Formated Text ---&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(formated_text)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;L_____&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="c"># Hack</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;^ *$&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="n">msgblock</span><span class="p">(</span><span class="s">&#39;[fmt] text&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">),</span> <span class="s">&#39;yellow&#39;</span><span class="p">)</span>
    <span class="c">#print(text.replace(&#39; &#39;, &#39;_&#39;))</span>
    <span class="c">#ut.util_dbg.COLORED_EXCEPTIONS = False</span>
    <span class="c"># Patterns that define separations between paragraphs in latex</span>
    <span class="c">#NL = &#39;\n&#39;</span>
    <span class="n">pattern_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">&#39;</span><span class="se">\n\n\n</span><span class="s">*&#39;</span><span class="p">,</span>     <span class="c"># newlines</span>
        <span class="c">#&#39;\n\n*$&#39;,     # newlines</span>
        <span class="c">#&#39;^\n\n*&#39;,     # newlines</span>
        <span class="c">#&#39;\n\n*&#39;,     # newlines</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *%.*</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>  <span class="c"># comments</span>

        <span class="c"># paragraph commands</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *</span><span class="se">\\\\</span><span class="s">paragraph{[^}]*}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="c"># &#39;\n? *\\\\item \\\\textbf{[^}]*}: *\n&#39;,</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *</span><span class="se">\\\\</span><span class="s">item </span><span class="se">\\\\</span><span class="s">textbf{[^:]*}: *</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *</span><span class="se">\\\\</span><span class="s">section{[^}]*}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *</span><span class="se">\\\\</span><span class="s">section{[^}]*}</span><span class="se">\\\\</span><span class="s">label{[^}]*}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *</span><span class="se">\\\\</span><span class="s">subsection{[^}]*}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *</span><span class="se">\\\\</span><span class="s">newcommand{[^}]*}.*</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="c"># generic multiline commands with text inside (like devcomment)</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *</span><span class="se">\\\\</span><span class="s">[a-zA-Z]+{ *</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>

        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *</span><span class="se">\\\\</span><span class="s">begin{[^}]*}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *</span><span class="se">\\\\</span><span class="s">item *</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *</span><span class="se">\\\\</span><span class="s">noindent *</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *</span><span class="se">\\\\</span><span class="s">ImageCommand[^}]*}[^}]*}{</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *</span><span class="se">\\\\</span><span class="s">end{[^}]*}</span><span class="se">\n</span><span class="s">?&#39;</span><span class="p">,</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">}{&#39;</span><span class="p">,</span>

        <span class="c"># docstr stuff</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">TRIPLE_DOUBLE_QUOTE</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">? *Args: *</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="c">#&#39;\n? [A-Za-z_]*[0-9A-Za-z_]* (.*?) *:&#39;,</span>
    <span class="p">]</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pat</span><span class="p">,)</span> <span class="k">for</span> <span class="n">pat</span> <span class="ow">in</span> <span class="n">pattern_list</span><span class="p">])</span>
    <span class="c"># break into paragraph blocks</span>
    <span class="n">block_list</span><span class="p">,</span> <span class="n">separators</span> <span class="o">=</span> <span class="n">regex_reconstruct_split</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span>
                                                     <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">collapse_pos_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># Dont format things within certain block types</span>
    <span class="n">_iter</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">iter_window</span><span class="p">([</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">separators</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">block_list</span><span class="p">,</span> <span class="n">_iter</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">r&#39;\begin{comment}&#39;</span> <span class="ow">and</span>
             <span class="n">window</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">r&#39;\end{comment}&#39;</span><span class="p">):</span>
            <span class="n">collapse_pos_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

    <span class="n">tofmt_block_list</span> <span class="o">=</span> <span class="n">block_list</span><span class="p">[:]</span>

    <span class="n">collapse_pos_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">collapse_pos_list</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">collapse_pos_list</span><span class="p">:</span>
        <span class="n">collapsed_sep</span> <span class="o">=</span> <span class="p">(</span><span class="n">separators</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tofmt_block_list</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">+</span>
                         <span class="n">separators</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
        <span class="n">separators</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">collapsed_sep</span>
        <span class="k">del</span> <span class="n">separators</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">tofmt_block_list</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="s">&#39;[fmt] tofmt_block_list = &#39;</span> <span class="o">+</span>
                      <span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">tofmt_block_list</span><span class="p">),</span> <span class="s">&#39;white&#39;</span><span class="p">)</span>

    <span class="c">#print(pattern)</span>
    <span class="c">#print(separators)</span>
    <span class="c"># apply formatting</span>
    <span class="c">#if debug:</span>
    <span class="c">#    ut.colorprint(&#39;--- FORMAT SENTENCE --- &#39;, &#39;white&#39;)</span>
    <span class="n">formated_block_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">tofmt_block_list</span><span class="p">:</span>
        <span class="n">fmtblock</span> <span class="o">=</span> <span class="n">format_single_paragraph_sentences</span><span class="p">(</span>
            <span class="n">block</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">formated_block_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fmtblock</span><span class="p">)</span>
        <span class="c">#ut.colorprint(&#39;---------- &#39;, &#39;white&#39;)</span>
    <span class="c">#if debug:</span>
    <span class="c">#    ut.colorprint(&#39;--- / FORMAT SENTENCE --- &#39;, &#39;white&#39;)</span>
    <span class="n">rejoined_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">interleave</span><span class="p">((</span><span class="n">formated_block_list</span><span class="p">,</span> <span class="n">separators</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="s">&#39;[fmt] formated_block_list = &#39;</span> <span class="o">+</span>
                      <span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">formated_block_list</span><span class="p">),</span> <span class="s">&#39;turquoise&#39;</span><span class="p">)</span>
        <span class="c">#print(rejoined_list)</span>
    <span class="n">formated_text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rejoined_list</span><span class="p">)</span>
    <span class="c">#ut.colorprint(formated_text.replace(&#39; &#39;, &#39;_&#39;), &#39;red&#39;)</span>
    <span class="k">return</span> <span class="n">formated_text</span>
</div>
<span class="n">format_multi_paragraphs</span> <span class="o">=</span> <span class="n">format_multiple_paragraph_sentences</span>


<div class="viewcode-block" id="format_single_paragraph_sentences"><a class="viewcode-back" href="../../utool.html#utool.util_str.format_single_paragraph_sentences">[docs]</a><span class="k">def</span> <span class="nf">format_single_paragraph_sentences</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">myprefix</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                      <span class="n">sentence_break</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    helps me separatate sentences grouped in paragraphs that I have a difficult</span>
<span class="sd">    time reading due to dyslexia</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: wrapped_text</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_str --exec-format_single_paragraph_sentences --show</span>
<span class="sd">        python -m utool.util_str --exec-format_single_paragraph_sentences --show --nobreak</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_str import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; text = &#39;     lorium ipsum doloar dolar dolar dolar erata man foobar is this there yet almost man not quit ate 80 chars yet hold out almost there? dolar erat. sau.ltum. fds.fd... . . fd oob fd. list: (1) abcd, (2) foobar (4) 123456789 123456789 123456789 123456789 123 123 123 123 123456789 123 123 123 123 123456789 123456789 123456789 123456789 123456789 123 123 123 123 123 123456789 123456789 123456789 123456789 123456789 123456789 (3) spam.&#39;</span>
<span class="sd">        &gt;&gt;&gt; #text = &#39;list: (1) abcd, (2) foobar (3) spam.&#39;</span>
<span class="sd">        &gt;&gt;&gt; #text = &#39;foo. when: (1) there is a new individual,&#39;</span>
<span class="sd">        &gt;&gt;&gt; #text = &#39;when: (1) there is a new individual,&#39;</span>
<span class="sd">        &gt;&gt;&gt; #text = &#39;? ? . lorium. ipsum? dolar erat. saultum. fds.fd...  fd oob fd. ? &#39;  # causes breakdown</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;text = %r&#39; % (text,))</span>
<span class="sd">        &gt;&gt;&gt; sentence_break = not ut.get_argflag(&#39;--nobreak&#39;)</span>
<span class="sd">        &gt;&gt;&gt; wrapped_text = format_single_paragraph_sentences(text, debug=True, sentence_break=sentence_break)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;wrapped_text =\n%s&#39; % (str(wrapped_text),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="c">#ut.util_dbg.COLORED_EXCEPTIONS = False</span>
    <span class="kn">import</span> <span class="nn">textwrap</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="c">#ut.rrrr(verbose=False)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">_rectify_countdown_or_bool</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span>
    <span class="n">min_indent</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_minimum_indentation</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">min_indent</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_indent</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="n">msgblock</span><span class="p">(</span><span class="s">&#39;preflat&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">)),</span> <span class="s">&#39;darkyellow&#39;</span><span class="p">))</span>
    <span class="n">text_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">remove_doublspaces</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="c"># TODO: more intelligent sentence parsing</span>
    <span class="n">text_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">flatten_textlines</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">colorprint</span><span class="p">(</span><span class="n">msgblock</span><span class="p">(</span><span class="s">&#39;postflat&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text_</span><span class="p">)),</span> <span class="s">&#39;yellow&#39;</span><span class="p">))</span>

    <span class="n">raw_sep_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="s">&#39;!&#39;</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="p">]</span>
    <span class="n">USE_REGEX_SPLIT</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">split_sentences</span><span class="p">(</span><span class="n">text_</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">USE_REGEX_SPLIT</span><span class="p">:</span>
            <span class="c"># Old way that just handled periods</span>
            <span class="n">sentence_list</span> <span class="o">=</span> <span class="n">text_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;. &#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># ******* #</span>
            <span class="c"># SPLITS line endings based on regular expressions.</span>
            <span class="n">esc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span>
            <span class="c"># Define separation patterns</span>
            <span class="n">regex_sep_chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">,</span> <span class="n">raw_sep_chars</span><span class="p">))</span>
            <span class="n">regex_sep_prefix</span> <span class="o">=</span> <span class="p">[</span><span class="n">esc</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">r&#39;\d&#39;</span> <span class="o">+</span> <span class="n">esc</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">)]</span>
            <span class="n">regex_sep_list</span> <span class="o">=</span> <span class="n">regex_sep_chars</span> <span class="o">+</span> <span class="n">regex_sep_prefix</span>
            <span class="c"># Combine into a full regex</span>
            <span class="n">sep_pattern</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">regex_or</span><span class="p">(</span><span class="n">regex_sep_list</span><span class="p">)</span>
            <span class="n">full_pattern</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">sep_pattern</span> <span class="o">+</span> <span class="s">r&#39;+\s)&#39;</span>
            <span class="n">full_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">full_pattern</span><span class="p">)</span>
            <span class="c"># Make the splits</span>
            <span class="n">num_groups</span> <span class="o">=</span> <span class="n">full_regex</span><span class="o">.</span><span class="n">groups</span>  <span class="c"># num groups in the regex</span>
            <span class="n">split_list</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">full_pattern</span><span class="p">,</span> <span class="n">text_</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">num_bins</span> <span class="o">=</span> <span class="n">num_groups</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">sentence_list</span> <span class="o">=</span> <span class="n">split_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">num_bins</span><span class="p">]</span>
                <span class="n">sep_list_group1</span> <span class="o">=</span> <span class="n">split_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="n">num_bins</span><span class="p">]</span>
                <span class="n">sep_list</span> <span class="o">=</span> <span class="n">sep_list_group1</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;&lt;SPLIT DBG&gt;&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;num_groups = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_groups</span><span class="p">,))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;len(split_list) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">split_list</span><span class="p">)))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;len(split_list) / len(sentence_list) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">split_list</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">)))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;len(sentence_list) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">),))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;len(sep_list_group1) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sep_list_group1</span><span class="p">),))</span>
                <span class="c">#print(&#39;len(sep_list_group2) = %r&#39; % (len(sep_list_group2),))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;full_pattern = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">full_pattern</span><span class="p">,))</span>
                <span class="c">#print(&#39;split_list = %r&#39; % (split_list,))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;sentence_list = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">list_str</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">),))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;sep_list = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="n">sep_list</span><span class="p">),))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;&lt;/SPLIT DBG&gt;&#39;</span><span class="p">)</span>
            <span class="c"># ******* #</span>
            <span class="k">return</span> <span class="n">sentence_list</span><span class="p">,</span> <span class="n">sep_list</span>

    <span class="k">def</span> <span class="nf">wrap_sentences</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">,</span> <span class="n">min_indent</span><span class="p">):</span>
        <span class="c"># prefix for continuations of a sentence</span>
        <span class="k">if</span> <span class="n">myprefix</span><span class="p">:</span>
            <span class="c"># helps me read LaTeX</span>
            <span class="n">sentence_prefix</span> <span class="o">=</span> <span class="s">&#39;  &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sentence_prefix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">text_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;&gt;&gt;&gt;&#39;</span><span class="p">):</span>
            <span class="c"># Hack to do docstrings</span>
            <span class="c"># TODO: make actualy docstring reformater</span>
            <span class="n">sentence_prefix</span> <span class="o">=</span> <span class="s">&#39;...     &#39;</span>

        <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span> <span class="o">-</span> <span class="n">min_indent</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence_prefix</span><span class="p">)</span>
        <span class="n">wrapkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">break_on_hyphens</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">break_long_words</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c">#wrapped_lines_list = [textwrap.wrap(sentence_prefix + line, **wrapkw)</span>
        <span class="c">#                      for line in sentence_list]</span>
        <span class="n">wrapped_lines_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">):</span>
            <span class="n">wrapped_lines</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="o">**</span><span class="n">wrapkw</span><span class="p">)</span>
            <span class="n">wrapped_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line_</span> <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">sentence_prefix</span> <span class="o">+</span> <span class="n">line_</span>
                             <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">line_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wrapped_lines</span><span class="p">)]</span>
            <span class="n">wrapped_lines_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wrapped_lines</span><span class="p">)</span>

        <span class="n">wrapped_sentences</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">wrapped_lines_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">wrapped_sentences</span>

    <span class="k">def</span> <span class="nf">rewrap_sentences2</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">,</span> <span class="n">sep_list</span><span class="p">):</span>
        <span class="c"># FIXME: probably where nl error is</span>
        <span class="c"># ******* #</span>
        <span class="c"># put the newline before or after the sep depending on if it is</span>
        <span class="c"># supposed to prefix or suffix the sentence.</span>
        <span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="n">zip_longest</span>
        <span class="c"># FIXME: Place the separators either before or after a sentence</span>

        <span class="n">sentence_list2</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>

        <span class="n">_iter</span> <span class="o">=</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">,</span> <span class="n">sep_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_iter</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">sentence_list2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sentence</span>
                <span class="k">continue</span>
            <span class="n">sepchars</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sepchars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">sepchars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">raw_sep_chars</span><span class="p">:</span>
                <span class="n">sentence_list2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sentence</span> <span class="o">+</span> <span class="p">(</span><span class="n">sep</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">sentence_list2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Place before next</span>
                <span class="n">sentence_list2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sentence</span>
                <span class="n">sentence_list2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>

        <span class="n">sentence_list2</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sentence_list2</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">sentence_list2</span>

    <span class="k">def</span> <span class="nf">rejoin_sentences</span><span class="p">(</span><span class="n">wrapped_sentences</span><span class="p">,</span> <span class="n">sep_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">USE_REGEX_SPLIT</span><span class="p">:</span>
            <span class="c"># ******* #</span>
            <span class="c"># put the newline before or after the sep depending on if it is</span>
            <span class="c"># supposed to prefix or suffix the sentence.</span>
            <span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="n">zip_longest</span>
            <span class="n">newsep_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">sep</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="k">if</span> <span class="n">sep</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">raw_sep_chars</span> <span class="k">else</span>
                    <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">sep</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">sep</span> <span class="ow">in</span> <span class="n">sep_list</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">wrapped_sentences2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c"># account for suffix-to-prefix double seperators</span>
            <span class="c"># helps fix things like enumerated stuff: (1) foo (2) you</span>
            <span class="n">_iter</span> <span class="o">=</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">wrapped_sentences</span><span class="p">,</span> <span class="n">newsep_list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_iter</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">sentence</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span>
                        <span class="n">sep</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">wrapped_sentences2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span>
                        <span class="n">wrapped_sentences2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)):</span>
                    <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;--- FixSep Iter </span><span class="si">%d</span><span class="s"> ---&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,))</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;sentence = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sentence</span><span class="p">,))</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;sep = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sep</span><span class="p">,))</span>
                <span class="n">wrapped_sentences2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sentence</span> <span class="o">+</span> <span class="n">sep</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&lt;RESEP DBG&gt;&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;newsep_list = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newsep_list</span><span class="p">,))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;len(newsep_list) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newsep_list</span><span class="p">),))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;len(wrapped_sentences) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wrapped_sentences</span><span class="p">),))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;&lt;/RESEP DBG&gt;&#39;</span><span class="p">)</span>
            <span class="c"># The wrapped block has a level 0 indentation</span>
            <span class="n">wrapped_block</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrapped_sentences2</span><span class="p">)</span>
            <span class="c"># ******* #</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wrapped_block</span> <span class="o">=</span> <span class="s">&#39;.</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrapped_sentences</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapped_block</span>

    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># Old way</span>
        <span class="n">sentence_list</span><span class="p">,</span> <span class="n">sep_list</span> <span class="o">=</span> <span class="n">split_sentences</span><span class="p">(</span><span class="n">text_</span><span class="p">)</span>
        <span class="n">wrapped_sentences</span> <span class="o">=</span> <span class="n">wrap_sentences</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">,</span> <span class="n">min_indent</span><span class="p">)</span>
        <span class="n">wrapped_block</span> <span class="o">=</span> <span class="n">rejoin_sentences</span><span class="p">(</span><span class="n">wrapped_sentences</span><span class="p">,</span> <span class="n">sep_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># New way</span>
        <span class="c">#print(&#39;last_is_nl = %r&#39; % (last_is_nl,))</span>
        <span class="k">if</span> <span class="n">sentence_break</span><span class="p">:</span>
            <span class="n">sentence_list</span><span class="p">,</span> <span class="n">sep_list</span> <span class="o">=</span> <span class="n">split_sentences</span><span class="p">(</span><span class="n">text_</span><span class="p">)</span>
            <span class="c"># FIXME: probably where nl error is</span>
            <span class="n">sentence_list2</span> <span class="o">=</span> <span class="n">rewrap_sentences2</span><span class="p">(</span><span class="n">sentence_list</span><span class="p">,</span> <span class="n">sep_list</span><span class="p">)</span>
            <span class="n">wrapped_sentences</span> <span class="o">=</span> <span class="n">wrap_sentences</span><span class="p">(</span><span class="n">sentence_list2</span><span class="p">,</span> <span class="n">min_indent</span><span class="p">)</span>
            <span class="n">wrapped_block</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrapped_sentences</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span> <span class="o">-</span> <span class="n">min_indent</span>
            <span class="n">wrapkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">break_on_hyphens</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                          <span class="n">break_long_words</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">wrapped_block</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">text_</span><span class="p">,</span> <span class="o">**</span><span class="n">wrapkw</span><span class="p">))</span>
        <span class="c"># HACK for last nl (seems to only happen if nl follows a seperator)</span>
        <span class="n">last_is_nl</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="ow">and</span>  <span class="ow">not</span> <span class="n">wrapped_block</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">first_is_nl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">wrapped_block</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c"># if last_is_nl and wrapped_block.strip().endswith(&#39;.&#39;):</span>
        <span class="k">if</span> <span class="n">last_is_nl</span><span class="p">:</span>
            <span class="n">wrapped_block</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">if</span> <span class="n">first_is_nl</span><span class="p">:</span>
            <span class="n">wrapped_block</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">wrapped_block</span>
    <span class="c"># Do the final indentation</span>
    <span class="n">wrapped_text</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">wrapped_block</span><span class="p">,</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">min_indent</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapped_text</span>

</div>
<div class="viewcode-block" id="find_block_end"><a class="viewcode-back" href="../../utool.html#utool.util_str.find_block_end">[docs]</a><span class="k">def</span> <span class="nf">find_block_end</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">line_list</span><span class="p">,</span> <span class="n">sentinal</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Searches up and down until it finds the endpoints of a block</span>
<span class="sd">    Rectify with find_paragraph_end in pyvim_funcs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="n">row_</span> <span class="o">=</span> <span class="n">row</span>
    <span class="n">line_</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="n">row_</span><span class="p">]</span>
    <span class="n">flag1</span> <span class="o">=</span> <span class="n">row_</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">row_</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">flag2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sentinal</span><span class="p">,</span> <span class="n">line_</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">flag1</span> <span class="ow">or</span> <span class="n">flag2</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">row_</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">row_</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">line_</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="n">row_</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sentinal</span><span class="p">,</span> <span class="n">line_</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">row_</span> <span class="o">+=</span> <span class="n">direction</span>
    <span class="k">return</span> <span class="n">row_</span>

</div>
<div class="viewcode-block" id="insert_block_between_lines"><a class="viewcode-back" href="../../utool.html#utool.util_str.insert_block_between_lines">[docs]</a><span class="k">def</span> <span class="nf">insert_block_between_lines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">row1</span><span class="p">,</span> <span class="n">row2</span><span class="p">,</span> <span class="n">line_list</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
        <span class="n">buffer_tail</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="n">row2</span><span class="p">:]</span>  <span class="c"># Original end of the file</span>
        <span class="n">new_tail</span> <span class="o">=</span> <span class="n">lines</span> <span class="o">+</span> <span class="n">buffer_tail</span>
        <span class="k">del</span> <span class="n">line_list</span><span class="p">[</span><span class="n">row1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:]</span>  <span class="c"># delete old data</span>
        <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_tail</span><span class="p">)</span>  <span class="c"># append new data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[:</span><span class="n">row1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lines</span> <span class="o">+</span> <span class="n">line_list</span><span class="p">[</span><span class="n">row2</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">line_list</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -c &quot;import utool, utool.util_str; utool.doctest_funcs(utool.util_str)&quot;</span>
<span class="sd">        python -m utool.util_str</span>
<span class="sd">        python -m utool.util_str --allexamples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>
    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>  <span class="c"># NOQA</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>


  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Jon Crall.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>





    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.1.2.dev1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>





    <script type="text/javascript" src="../../_static/js/theme.js"></script>




  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>


</body>
</html>
